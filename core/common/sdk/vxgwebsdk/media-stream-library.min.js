/*! For license information please see media-stream-library.min.js.LICENSE.txt */
var mediaStreamLibrary;(()=>{var e={742:(e,t)=>{"use strict";t.byteLength=function(e){var t=a(e),r=t[0],n=t[1];return 3*(r+n)/4-n},t.toByteArray=function(e){var t,r,o=a(e),s=o[0],u=o[1],c=new i(function(e,t,r){return 3*(t+r)/4-r}(0,s,u)),l=0,h=u>0?s-4:s;for(r=0;r<h;r+=4)t=n[e.charCodeAt(r)]<<18|n[e.charCodeAt(r+1)]<<12|n[e.charCodeAt(r+2)]<<6|n[e.charCodeAt(r+3)],c[l++]=t>>16&255,c[l++]=t>>8&255,c[l++]=255&t;return 2===u&&(t=n[e.charCodeAt(r)]<<2|n[e.charCodeAt(r+1)]>>4,c[l++]=255&t),1===u&&(t=n[e.charCodeAt(r)]<<10|n[e.charCodeAt(r+1)]<<4|n[e.charCodeAt(r+2)]>>2,c[l++]=t>>8&255,c[l++]=255&t),c},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,o=[],s=16383,a=0,c=n-i;a<c;a+=s)o.push(u(e,a,a+s>c?c:a+s));return 1===i?(t=e[n-1],o.push(r[t>>2]+r[t<<4&63]+"==")):2===i&&(t=(e[n-2]<<8)+e[n-1],o.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"=")),o.join("")};for(var r=[],n=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0;s<64;++s)r[s]=o[s],n[o.charCodeAt(s)]=s;function a(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function u(e,t,n){for(var i,o,s=[],a=t;a<n;a+=3)i=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(r[(o=i)>>18&63]+r[o>>12&63]+r[o>>6&63]+r[63&o]);return s.join("")}n["-".charCodeAt(0)]=62,n["_".charCodeAt(0)]=63},764:(e,t,r)=>{"use strict";var n=r(742),i=r(645),o="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=u,t.SlowBuffer=function(e){return+e!=e&&(e=0),u.alloc(+e)},t.INSPECT_MAX_BYTES=50;var s=2147483647;function a(e){if(e>s)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,u.prototype),t}function u(e,t,r){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return h(e)}return c(e,t,r)}function c(e,t,r){if("string"==typeof e)return function(e,t){if("string"==typeof t&&""!==t||(t="utf8"),!u.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var r=0|m(e,t),n=a(r),i=n.write(e,t);return i!==r&&(n=n.slice(0,i)),n}(e,t);if(ArrayBuffer.isView(e))return function(e){if(q(e,Uint8Array)){var t=new Uint8Array(e);return f(t.buffer,t.byteOffset,t.byteLength)}return d(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(q(e,ArrayBuffer)||e&&q(e.buffer,ArrayBuffer))return f(e,t,r);if("undefined"!=typeof SharedArrayBuffer&&(q(e,SharedArrayBuffer)||e&&q(e.buffer,SharedArrayBuffer)))return f(e,t,r);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return u.from(n,t,r);var i=function(e){if(u.isBuffer(e)){var t=0|p(e.length),r=a(t);return 0===r.length||e.copy(r,0,0,t),r}return void 0!==e.length?"number"!=typeof e.length||H(e.length)?a(0):d(e):"Buffer"===e.type&&Array.isArray(e.data)?d(e.data):void 0}(e);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return u.from(e[Symbol.toPrimitive]("string"),t,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function h(e){return l(e),a(e<0?0:0|p(e))}function d(e){for(var t=e.length<0?0:0|p(e.length),r=a(t),n=0;n<t;n+=1)r[n]=255&e[n];return r}function f(e,t,r){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw new RangeError('"length" is outside of buffer bounds');var n;return n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),Object.setPrototypeOf(n,u.prototype),n}function p(e){if(e>=s)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s.toString(16)+" bytes");return 0|e}function m(e,t){if(u.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||q(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return D(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return N(e).length;default:if(i)return n?-1:D(e).length;t=(""+t).toLowerCase(),i=!0}}function y(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return O(this,t,r);case"utf8":case"utf-8":return C(this,t,r);case"ascii":return k(this,t,r);case"latin1":case"binary":return R(this,t,r);case"base64":return x(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return B(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function v(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function g(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),H(r=+r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=u.from(t,n)),u.isBuffer(t))return 0===t.length?-1:b(e,t,r,n,i);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):b(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function b(e,t,r,n,i){var o,s=1,a=e.length,u=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;s=2,a/=2,u/=2,r/=2}function c(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(i){var l=-1;for(o=r;o<a;o++)if(c(e,o)===c(t,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===u)return l*s}else-1!==l&&(o-=o-l),l=-1}else for(r+u>a&&(r=a-u),o=r;o>=0;o--){for(var h=!0,d=0;d<u;d++)if(c(e,o+d)!==c(t,d)){h=!1;break}if(h)return o}return-1}function w(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var o=t.length;n>o/2&&(n=o/2);for(var s=0;s<n;++s){var a=parseInt(t.substr(2*s,2),16);if(H(a))return s;e[r+s]=a}return s}function _(e,t,r,n){return F(D(t,e.length-r),e,r,n)}function S(e,t,r,n){return F(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function E(e,t,r,n){return F(N(t),e,r,n)}function T(e,t,r,n){return F(function(e,t){for(var r,n,i,o=[],s=0;s<e.length&&!((t-=2)<0);++s)n=(r=e.charCodeAt(s))>>8,i=r%256,o.push(i),o.push(n);return o}(t,e.length-r),e,r,n)}function x(e,t,r){return 0===t&&r===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,r))}function C(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var o,s,a,u,c=e[i],l=null,h=c>239?4:c>223?3:c>191?2:1;if(i+h<=r)switch(h){case 1:c<128&&(l=c);break;case 2:128==(192&(o=e[i+1]))&&(u=(31&c)<<6|63&o)>127&&(l=u);break;case 3:o=e[i+1],s=e[i+2],128==(192&o)&&128==(192&s)&&(u=(15&c)<<12|(63&o)<<6|63&s)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:o=e[i+1],s=e[i+2],a=e[i+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(u=(15&c)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&u<1114112&&(l=u)}null===l?(l=65533,h=1):l>65535&&(l-=65536,n.push(l>>>10&1023|55296),l=56320|1023&l),n.push(l),i+=h}return function(e){var t=e.length;if(t<=P)return String.fromCharCode.apply(String,e);for(var r="",n=0;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=P));return r}(n)}t.kMaxLength=s,u.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),u.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}}),u.poolSize=8192,u.from=function(e,t,r){return c(e,t,r)},Object.setPrototypeOf(u.prototype,Uint8Array.prototype),Object.setPrototypeOf(u,Uint8Array),u.alloc=function(e,t,r){return function(e,t,r){return l(e),e<=0?a(e):void 0!==t?"string"==typeof r?a(e).fill(t,r):a(e).fill(t):a(e)}(e,t,r)},u.allocUnsafe=function(e){return h(e)},u.allocUnsafeSlow=function(e){return h(e)},u.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==u.prototype},u.compare=function(e,t){if(q(e,Uint8Array)&&(e=u.from(e,e.offset,e.byteLength)),q(t,Uint8Array)&&(t=u.from(t,t.offset,t.byteLength)),!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var r=e.length,n=t.length,i=0,o=Math.min(r,n);i<o;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=u.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var o=e[r];if(q(o,Uint8Array))i+o.length>n.length?u.from(o).copy(n,i):Uint8Array.prototype.set.call(n,o,i);else{if(!u.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,i)}i+=o.length}return n},u.byteLength=m,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)v(this,t,t+1);return this},u.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)v(this,t,t+3),v(this,t+1,t+2);return this},u.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)v(this,t,t+7),v(this,t+1,t+6),v(this,t+2,t+5),v(this,t+3,t+4);return this},u.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?C(this,0,e):y.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(e){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===u.compare(this,e)},u.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},o&&(u.prototype[o]=u.prototype.inspect),u.prototype.compare=function(e,t,r,n,i){if(q(e,Uint8Array)&&(e=u.from(e,e.offset,e.byteLength)),!u.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(this===e)return 0;for(var o=(i>>>=0)-(n>>>=0),s=(r>>>=0)-(t>>>=0),a=Math.min(o,s),c=this.slice(n,i),l=e.slice(t,r),h=0;h<a;++h)if(c[h]!==l[h]){o=c[h],s=l[h];break}return o<s?-1:s<o?1:0},u.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},u.prototype.indexOf=function(e,t,r){return g(this,e,t,r,!0)},u.prototype.lastIndexOf=function(e,t,r){return g(this,e,t,r,!1)},u.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return w(this,e,t,r);case"utf8":case"utf-8":return _(this,e,t,r);case"ascii":case"latin1":case"binary":return S(this,e,t,r);case"base64":return E(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return T(this,e,t,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var P=4096;function k(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function R(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function O(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=t;o<r;++o)i+=$[e[o]];return i}function B(e,t,r){for(var n=e.slice(t,r),i="",o=0;o<n.length-1;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function I(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function j(e,t,r,n,i,o){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function L(e,t,r,n,i,o){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function A(e,t,r,n,o){return t=+t,r>>>=0,o||L(e,0,r,4),i.write(e,t,r,n,23,4),r+4}function M(e,t,r,n,o){return t=+t,r>>>=0,o||L(e,0,r,8),i.write(e,t,r,n,52,8),r+8}u.prototype.slice=function(e,t){var r=this.length;(e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);var n=this.subarray(e,t);return Object.setPrototypeOf(n,u.prototype),n},u.prototype.readUintLE=u.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||I(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n},u.prototype.readUintBE=u.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||I(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},u.prototype.readUint8=u.prototype.readUInt8=function(e,t){return e>>>=0,t||I(e,1,this.length),this[e]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(e,t){return e>>>=0,t||I(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(e,t){return e>>>=0,t||I(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(e,t){return e>>>=0,t||I(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(e,t){return e>>>=0,t||I(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||I(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},u.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||I(e,t,this.length);for(var n=t,i=1,o=this[e+--n];n>0&&(i*=256);)o+=this[e+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},u.prototype.readInt8=function(e,t){return e>>>=0,t||I(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){e>>>=0,t||I(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt16BE=function(e,t){e>>>=0,t||I(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt32LE=function(e,t){return e>>>=0,t||I(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return e>>>=0,t||I(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readFloatLE=function(e,t){return e>>>=0,t||I(e,4,this.length),i.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return e>>>=0,t||I(e,4,this.length),i.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return e>>>=0,t||I(e,8,this.length),i.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return e>>>=0,t||I(e,8,this.length),i.read(this,e,!1,52,8)},u.prototype.writeUintLE=u.prototype.writeUIntLE=function(e,t,r,n){e=+e,t>>>=0,r>>>=0,n||j(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[t]=255&e;++o<r&&(i*=256);)this[t+o]=e/i&255;return t+r},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(e,t,r,n){e=+e,t>>>=0,r>>>=0,n||j(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+r},u.prototype.writeUint8=u.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||j(this,e,t,1,255,0),this[t]=255&e,t+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||j(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||j(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||j(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||j(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},u.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*r-1);j(this,e,t,r,i-1,-i)}var o=0,s=1,a=0;for(this[t]=255&e;++o<r&&(s*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+r},u.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*r-1);j(this,e,t,r,i-1,-i)}var o=r-1,s=1,a=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+r},u.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||j(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},u.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||j(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},u.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||j(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},u.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||j(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},u.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||j(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},u.prototype.writeFloatLE=function(e,t,r){return A(this,e,t,!0,r)},u.prototype.writeFloatBE=function(e,t,r){return A(this,e,t,!1,r)},u.prototype.writeDoubleLE=function(e,t,r){return M(this,e,t,!0,r)},u.prototype.writeDoubleBE=function(e,t,r){return M(this,e,t,!1,r)},u.prototype.copy=function(e,t,r,n){if(!u.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i=n-r;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,r,n):Uint8Array.prototype.set.call(e,this.subarray(r,n),t),i},u.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!u.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===e.length){var i=e.charCodeAt(0);("utf8"===n&&i<128||"latin1"===n)&&(e=i)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var o;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(o=t;o<r;++o)this[o]=e;else{var s=u.isBuffer(e)?e:u.from(e,n),a=s.length;if(0===a)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(o=0;o<r-t;++o)this[o+t]=s[o%a]}return this};var U=/[^+/0-9A-Za-z-_]/g;function D(e,t){var r;t=t||1/0;for(var n=e.length,i=null,o=[],s=0;s<n;++s){if((r=e.charCodeAt(s))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===n){(t-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function N(e){return n.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(U,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function F(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}function q(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function H(e){return e!=e}var $=function(){for(var e="0123456789abcdef",t=new Array(256),r=0;r<16;++r)for(var n=16*r,i=0;i<16;++i)t[n+i]=e[r]+e[i];return t}()},227:(e,t,r)=>{var n=r(155);t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;t.splice(1,0,r,"color: inherit");let n=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(n++,"%c"===e&&(i=n))})),t.splice(i,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&void 0!==n&&"env"in n&&(e=n.env.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=r(447)(t);const{formatters:i}=e.exports;i.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},447:(e,t,r)=>{e.exports=function(e){function t(e){let r;function o(...e){if(!o.enabled)return;const n=o,i=Number(new Date),s=i-(r||i);n.diff=s,n.prev=r,n.curr=i,r=i,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let a=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((r,i)=>{if("%%"===r)return r;a++;const o=t.formatters[i];if("function"==typeof o){const t=e[a];r=o.call(n,t),e.splice(a,1),a--}return r})),t.formatArgs.call(n,e),(n.log||t.log).apply(n,e)}return o.namespace=e,o.enabled=t.enabled(e),o.useColors=t.useColors(),o.color=t.selectColor(e),o.destroy=n,o.extend=i,"function"==typeof t.init&&t.init(o),t.instances.push(o),o}function n(){const e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}function i(e,r){const n=t(this.namespace+(void 0===r?":":r)+e);return n.log=this.log,n}function o(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){const e=[...t.names.map(o),...t.skips.map(o).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let r;t.save(e),t.names=[],t.skips=[];const n=("string"==typeof e?e:"").split(/[\s,]+/),i=n.length;for(r=0;r<i;r++)n[r]&&("-"===(e=n[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")));for(r=0;r<t.instances.length;r++){const e=t.instances[r];e.enabled=t.enabled(e.namespace)}},t.enabled=function(e){if("*"===e[e.length-1])return!0;let r,n;for(r=0,n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=r(824),Object.keys(e).forEach((r=>{t[r]=e[r]})),t.instances=[],t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let r=0;for(let t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t}},187:e=>{"use strict";var t,r="object"==typeof Reflect?Reflect:null,n=r&&"function"==typeof r.apply?r.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};t=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,e.exports.once=function(e,t){return new Promise((function(r,n){function i(r){e.removeListener(t,o),n(r)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",i),r([].slice.call(arguments))}m(e,t,o,{once:!0}),"error"!==t&&function(e,t,r){"function"==typeof e.on&&m(e,"error",t,{once:!0})}(e,i)}))},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var s=10;function a(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function u(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function c(e,t,r,n){var i,o,s,c;if(a(r),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),o=e._events),s=o[t]),void 0===s)s=o[t]=r,++e._eventsCount;else if("function"==typeof s?s=o[t]=n?[r,s]:[s,r]:n?s.unshift(r):s.push(r),(i=u(e))>0&&s.length>i&&!s.warned){s.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=s.length,c=l,console&&console.warn&&console.warn(c)}return e}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=l.bind(n);return i.listener=r,n.wrapFn=i,i}function d(e,t,r){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(i):p(i,i.length)}function f(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function p(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function m(e,t,r,n){if("function"==typeof e.on)n.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(o){n.once&&e.removeEventListener(t,i),r(o)}))}}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");s=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return u(this)},o.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var i="error"===e,o=this._events;if(void 0!==o)i=i&&void 0===o.error;else if(!i)return!1;if(i){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var u=o[e];if(void 0===u)return!1;if("function"==typeof u)n(u,this,t);else{var c=u.length,l=p(u,c);for(r=0;r<c;++r)n(l[r],this,t)}return!0},o.prototype.addListener=function(e,t){return c(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return c(this,e,t,!0)},o.prototype.once=function(e,t){return a(t),this.on(e,h(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,h(this,e,t)),this},o.prototype.removeListener=function(e,t){var r,n,i,o,s;if(a(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,o=r.length-1;o>=0;o--)if(r[o]===t||r[o].listener===t){s=r[o].listener,i=o;break}if(i<0)return this;0===i?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,s||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var i,o=Object.keys(r);for(n=0;n<o.length;++n)"removeListener"!==(i=o[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},o.prototype.listeners=function(e){return d(this,e,!0)},o.prototype.rawListeners=function(e){return d(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):f.call(e,t)},o.prototype.listenerCount=f,o.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},349:(e,t,r)=>{"use strict";var n=r(509).Buffer,i=r(473).Transform;function o(e){i.call(this),this._block=n.allocUnsafe(e),this._blockSize=e,this._blockOffset=0,this._length=[0,0,0,0],this._finalized=!1}r(717)(o,i),o.prototype._transform=function(e,t,r){var n=null;try{this.update(e,t)}catch(e){n=e}r(n)},o.prototype._flush=function(e){var t=null;try{this.push(this.digest())}catch(e){t=e}e(t)},o.prototype.update=function(e,t){if(function(e,t){if(!n.isBuffer(e)&&"string"!=typeof e)throw new TypeError("Data must be a string or a buffer")}(e),this._finalized)throw new Error("Digest already called");n.isBuffer(e)||(e=n.from(e,t));for(var r=this._block,i=0;this._blockOffset+e.length-i>=this._blockSize;){for(var o=this._blockOffset;o<this._blockSize;)r[o++]=e[i++];this._update(),this._blockOffset=0}for(;i<e.length;)r[this._blockOffset++]=e[i++];for(var s=0,a=8*e.length;a>0;++s)this._length[s]+=a,(a=this._length[s]/4294967296|0)>0&&(this._length[s]-=4294967296*a);return this},o.prototype._update=function(){throw new Error("_update is not implemented")},o.prototype.digest=function(e){if(this._finalized)throw new Error("Digest already called");this._finalized=!0;var t=this._digest();void 0!==e&&(t=t.toString(e)),this._block.fill(0),this._blockOffset=0;for(var r=0;r<4;++r)this._length[r]=0;return t},o.prototype._digest=function(){throw new Error("_digest is not implemented")},e.exports=o},645:(e,t)=>{t.read=function(e,t,r,n,i){var o,s,a=8*i-n-1,u=(1<<a)-1,c=u>>1,l=-7,h=r?i-1:0,d=r?-1:1,f=e[t+h];for(h+=d,o=f&(1<<-l)-1,f>>=-l,l+=a;l>0;o=256*o+e[t+h],h+=d,l-=8);for(s=o&(1<<-l)-1,o>>=-l,l+=n;l>0;s=256*s+e[t+h],h+=d,l-=8);if(0===o)o=1-c;else{if(o===u)return s?NaN:1/0*(f?-1:1);s+=Math.pow(2,n),o-=c}return(f?-1:1)*s*Math.pow(2,o-n)},t.write=function(e,t,r,n,i,o){var s,a,u,c=8*o-i-1,l=(1<<c)-1,h=l>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:o-1,p=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=l):(s=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-s))<1&&(s--,u*=2),(t+=s+h>=1?d/u:d*Math.pow(2,1-h))*u>=2&&(s++,u/=2),s+h>=l?(a=0,s=l):s+h>=1?(a=(t*u-1)*Math.pow(2,i),s+=h):(a=t*Math.pow(2,h-1)*Math.pow(2,i),s=0));i>=8;e[r+f]=255&a,f+=p,a/=256,i-=8);for(s=s<<i|a,c+=i;c>0;e[r+f]=255&s,f+=p,s/=256,c-=8);e[r+f-p]|=128*m}},717:e=>{"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}}},318:(e,t,r)=>{"use strict";var n=r(717),i=r(349),o=r(509).Buffer,s=new Array(16);function a(){i.call(this,64),this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878}function u(e,t){return e<<t|e>>>32-t}function c(e,t,r,n,i,o,s){return u(e+(t&r|~t&n)+i+o|0,s)+t|0}function l(e,t,r,n,i,o,s){return u(e+(t&n|r&~n)+i+o|0,s)+t|0}function h(e,t,r,n,i,o,s){return u(e+(t^r^n)+i+o|0,s)+t|0}function d(e,t,r,n,i,o,s){return u(e+(r^(t|~n))+i+o|0,s)+t|0}n(a,i),a.prototype._update=function(){for(var e=s,t=0;t<16;++t)e[t]=this._block.readInt32LE(4*t);var r=this._a,n=this._b,i=this._c,o=this._d;r=c(r,n,i,o,e[0],3614090360,7),o=c(o,r,n,i,e[1],3905402710,12),i=c(i,o,r,n,e[2],606105819,17),n=c(n,i,o,r,e[3],3250441966,22),r=c(r,n,i,o,e[4],4118548399,7),o=c(o,r,n,i,e[5],1200080426,12),i=c(i,o,r,n,e[6],2821735955,17),n=c(n,i,o,r,e[7],4249261313,22),r=c(r,n,i,o,e[8],1770035416,7),o=c(o,r,n,i,e[9],2336552879,12),i=c(i,o,r,n,e[10],4294925233,17),n=c(n,i,o,r,e[11],2304563134,22),r=c(r,n,i,o,e[12],1804603682,7),o=c(o,r,n,i,e[13],4254626195,12),i=c(i,o,r,n,e[14],2792965006,17),r=l(r,n=c(n,i,o,r,e[15],1236535329,22),i,o,e[1],4129170786,5),o=l(o,r,n,i,e[6],3225465664,9),i=l(i,o,r,n,e[11],643717713,14),n=l(n,i,o,r,e[0],3921069994,20),r=l(r,n,i,o,e[5],3593408605,5),o=l(o,r,n,i,e[10],38016083,9),i=l(i,o,r,n,e[15],3634488961,14),n=l(n,i,o,r,e[4],3889429448,20),r=l(r,n,i,o,e[9],568446438,5),o=l(o,r,n,i,e[14],3275163606,9),i=l(i,o,r,n,e[3],4107603335,14),n=l(n,i,o,r,e[8],1163531501,20),r=l(r,n,i,o,e[13],2850285829,5),o=l(o,r,n,i,e[2],4243563512,9),i=l(i,o,r,n,e[7],1735328473,14),r=h(r,n=l(n,i,o,r,e[12],2368359562,20),i,o,e[5],4294588738,4),o=h(o,r,n,i,e[8],2272392833,11),i=h(i,o,r,n,e[11],1839030562,16),n=h(n,i,o,r,e[14],4259657740,23),r=h(r,n,i,o,e[1],2763975236,4),o=h(o,r,n,i,e[4],1272893353,11),i=h(i,o,r,n,e[7],4139469664,16),n=h(n,i,o,r,e[10],3200236656,23),r=h(r,n,i,o,e[13],681279174,4),o=h(o,r,n,i,e[0],3936430074,11),i=h(i,o,r,n,e[3],3572445317,16),n=h(n,i,o,r,e[6],76029189,23),r=h(r,n,i,o,e[9],3654602809,4),o=h(o,r,n,i,e[12],3873151461,11),i=h(i,o,r,n,e[15],530742520,16),r=d(r,n=h(n,i,o,r,e[2],3299628645,23),i,o,e[0],4096336452,6),o=d(o,r,n,i,e[7],1126891415,10),i=d(i,o,r,n,e[14],2878612391,15),n=d(n,i,o,r,e[5],4237533241,21),r=d(r,n,i,o,e[12],1700485571,6),o=d(o,r,n,i,e[3],2399980690,10),i=d(i,o,r,n,e[10],4293915773,15),n=d(n,i,o,r,e[1],2240044497,21),r=d(r,n,i,o,e[8],1873313359,6),o=d(o,r,n,i,e[15],4264355552,10),i=d(i,o,r,n,e[6],2734768916,15),n=d(n,i,o,r,e[13],1309151649,21),r=d(r,n,i,o,e[4],4149444226,6),o=d(o,r,n,i,e[11],3174756917,10),i=d(i,o,r,n,e[2],718787259,15),n=d(n,i,o,r,e[9],3951481745,21),this._a=this._a+r|0,this._b=this._b+n|0,this._c=this._c+i|0,this._d=this._d+o|0},a.prototype._digest=function(){this._block[this._blockOffset++]=128,this._blockOffset>56&&(this._block.fill(0,this._blockOffset,64),this._update(),this._blockOffset=0),this._block.fill(0,this._blockOffset,56),this._block.writeUInt32LE(this._length[0],56),this._block.writeUInt32LE(this._length[1],60),this._update();var e=o.allocUnsafe(16);return e.writeInt32LE(this._a,0),e.writeInt32LE(this._b,4),e.writeInt32LE(this._c,8),e.writeInt32LE(this._d,12),e},e.exports=a},824:e=>{var t=1e3,r=60*t,n=60*r,i=24*n;function o(e,t,r,n){var i=t>=1.5*r;return Math.round(e/r)+" "+n+(i?"s":"")}e.exports=function(e,s){s=s||{};var a,u,c=typeof e;if("string"===c&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var o=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(o){var s=parseFloat(o[1]);switch((o[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*s;case"weeks":case"week":case"w":return 6048e5*s;case"days":case"day":case"d":return s*i;case"hours":case"hour":case"hrs":case"hr":case"h":return s*n;case"minutes":case"minute":case"mins":case"min":case"m":return s*r;case"seconds":case"second":case"secs":case"sec":case"s":return s*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return s;default:return}}}}(e);if("number"===c&&isFinite(e))return s.long?(a=e,(u=Math.abs(a))>=i?o(a,u,i,"day"):u>=n?o(a,u,n,"hour"):u>=r?o(a,u,r,"minute"):u>=t?o(a,u,t,"second"):a+" ms"):function(e){var o=Math.abs(e);return o>=i?Math.round(e/i)+"d":o>=n?Math.round(e/n)+"h":o>=r?Math.round(e/r)+"m":o>=t?Math.round(e/t)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},155:e=>{var t,r,n=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:i}catch(e){t=i}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(e){r=o}}();var a,u=[],c=!1,l=-1;function h(){c&&a&&(c=!1,a.length?u=a.concat(u):l=-1,u.length&&d())}function d(){if(!c){var e=s(h);c=!0;for(var t=u.length;t;){for(a=u,u=[];++l<t;)a&&a[l].run();l=-1,t=u.length}a=null,c=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{return r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function p(){}n.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new f(e,t)),1!==u.length||c||s(d)},f.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=p,n.addListener=p,n.once=p,n.off=p,n.removeListener=p,n.removeAllListeners=p,n.emit=p,n.prependListener=p,n.prependOnceListener=p,n.listeners=function(e){return[]},n.binding=function(e){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},281:e=>{"use strict";var t={};function r(e,r,n){n||(n=Error);var i=function(e){var t,n;function i(t,n,i){return e.call(this,function(e,t,n){return"string"==typeof r?r:r(e,t,n)}(t,n,i))||this}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,i}(n);i.prototype.name=n.name,i.prototype.code=e,t[e]=i}function n(e,t){if(Array.isArray(e)){var r=e.length;return e=e.map((function(e){return String(e)})),r>2?"one of ".concat(t," ").concat(e.slice(0,r-1).join(", "),", or ")+e[r-1]:2===r?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}return"of ".concat(t," ").concat(String(e))}r("ERR_INVALID_OPT_VALUE",(function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'}),TypeError),r("ERR_INVALID_ARG_TYPE",(function(e,t,r){var i,o,s,a,u;if("string"==typeof t&&(o="not ",t.substr(0,4)===o)?(i="must not be",t=t.replace(/^not /,"")):i="must be",function(e,t,r){return(void 0===r||r>e.length)&&(r=e.length),e.substring(r-9,r)===t}(e," argument"))s="The ".concat(e," ").concat(i," ").concat(n(t,"type"));else{var c=("number"!=typeof u&&(u=0),u+1>(a=e).length||-1===a.indexOf(".",u)?"argument":"property");s='The "'.concat(e,'" ').concat(c," ").concat(i," ").concat(n(t,"type"))}return s+". Received type ".concat(typeof r)}),TypeError),r("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),r("ERR_METHOD_NOT_IMPLEMENTED",(function(e){return"The "+e+" method is not implemented"})),r("ERR_STREAM_PREMATURE_CLOSE","Premature close"),r("ERR_STREAM_DESTROYED",(function(e){return"Cannot call "+e+" after a stream was destroyed"})),r("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),r("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),r("ERR_STREAM_WRITE_AFTER_END","write after end"),r("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),r("ERR_UNKNOWN_ENCODING",(function(e){return"Unknown encoding: "+e}),TypeError),r("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),e.exports.q=t},753:(e,t,r)=>{"use strict";var n=r(155),i=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t};e.exports=l;var o=r(481),s=r(229);r(717)(l,o);for(var a=i(s.prototype),u=0;u<a.length;u++){var c=a[u];l.prototype[c]||(l.prototype[c]=s.prototype[c])}function l(e){if(!(this instanceof l))return new l(e);o.call(this,e),s.call(this,e),this.allowHalfOpen=!0,e&&(!1===e.readable&&(this.readable=!1),!1===e.writable&&(this.writable=!1),!1===e.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",h)))}function h(){this._writableState.ended||n.nextTick(d,this)}function d(e){e.end()}Object.defineProperty(l.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(l.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(l.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(l.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}})},725:(e,t,r)=>{"use strict";e.exports=i;var n=r(605);function i(e){if(!(this instanceof i))return new i(e);n.call(this,e)}r(717)(i,n),i.prototype._transform=function(e,t,r){r(null,e)}},481:(e,t,r)=>{"use strict";var n,i=r(155);e.exports=x,x.ReadableState=T,r(187).EventEmitter;var o,s=function(e,t){return e.listeners(t).length},a=r(503),u=r(764).Buffer,c=(void 0!==r.g?r.g:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){},l=r(616);o=l&&l.debuglog?l.debuglog("stream"):function(){};var h,d,f,p=r(327),m=r(195),y=r(457).getHighWaterMark,v=r(281).q,g=v.ERR_INVALID_ARG_TYPE,b=v.ERR_STREAM_PUSH_AFTER_EOF,w=v.ERR_METHOD_NOT_IMPLEMENTED,_=v.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;r(717)(x,a);var S=m.errorOrDestroy,E=["error","close","destroy","pause","resume"];function T(e,t,i){n=n||r(753),e=e||{},"boolean"!=typeof i&&(i=t instanceof n),this.objectMode=!!e.objectMode,i&&(this.objectMode=this.objectMode||!!e.readableObjectMode),this.highWaterMark=y(this,e,"readableHighWaterMark",i),this.buffer=new p,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(h||(h=r(553).s),this.decoder=new h(e.encoding),this.encoding=e.encoding)}function x(e){if(n=n||r(753),!(this instanceof x))return new x(e);var t=this instanceof n;this._readableState=new T(e,this,t),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),a.call(this)}function C(e,t,r,n,i){o("readableAddChunk",t);var s,a=e._readableState;if(null===t)a.reading=!1,function(e,t){if(o("onEofChunk"),!t.ended){if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,t.sync?O(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,B(e)))}}(e,a);else if(i||(s=function(e,t){var r,n;return n=t,u.isBuffer(n)||n instanceof c||"string"==typeof t||void 0===t||e.objectMode||(r=new g("chunk",["string","Buffer","Uint8Array"],t)),r}(a,t)),s)S(e,s);else if(a.objectMode||t&&t.length>0)if("string"==typeof t||a.objectMode||Object.getPrototypeOf(t)===u.prototype||(t=function(e){return u.from(e)}(t)),n)a.endEmitted?S(e,new _):P(e,a,t,!0);else if(a.ended)S(e,new b);else{if(a.destroyed)return!1;a.reading=!1,a.decoder&&!r?(t=a.decoder.write(t),a.objectMode||0!==t.length?P(e,a,t,!1):I(e,a)):P(e,a,t,!1)}else n||(a.reading=!1,I(e,a));return!a.ended&&(a.length<a.highWaterMark||0===a.length)}function P(e,t,r,n){t.flowing&&0===t.length&&!t.sync?(t.awaitDrain=0,e.emit("data",r)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&O(e)),I(e,t)}Object.defineProperty(x.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),x.prototype.destroy=m.destroy,x.prototype._undestroy=m.undestroy,x.prototype._destroy=function(e,t){t(e)},x.prototype.push=function(e,t){var r,n=this._readableState;return n.objectMode?r=!0:"string"==typeof e&&((t=t||n.defaultEncoding)!==n.encoding&&(e=u.from(e,t),t=""),r=!0),C(this,e,t,!1,r)},x.prototype.unshift=function(e){return C(this,e,null,!0,!1)},x.prototype.isPaused=function(){return!1===this._readableState.flowing},x.prototype.setEncoding=function(e){h||(h=r(553).s);var t=new h(e);this._readableState.decoder=t,this._readableState.encoding=this._readableState.decoder.encoding;for(var n=this._readableState.buffer.head,i="";null!==n;)i+=t.write(n.data),n=n.next;return this._readableState.buffer.clear(),""!==i&&this._readableState.buffer.push(i),this._readableState.length=i.length,this};var k=1073741824;function R(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=k?e=k:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function O(e){var t=e._readableState;o("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(o("emitReadable",t.flowing),t.emittedReadable=!0,i.nextTick(B,e))}function B(e){var t=e._readableState;o("emitReadable_",t.destroyed,t.length,t.ended),t.destroyed||!t.length&&!t.ended||(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,U(e)}function I(e,t){t.readingMore||(t.readingMore=!0,i.nextTick(j,e,t))}function j(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){var r=t.length;if(o("maybeReadMore read 0"),e.read(0),r===t.length)break}t.readingMore=!1}function L(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function A(e){o("readable nexttick read 0"),e.read(0)}function M(e,t){o("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),U(e),t.flowing&&!t.reading&&e.read(0)}function U(e){var t=e._readableState;for(o("flow",t.flowing);t.flowing&&null!==e.read(););}function D(e,t){return 0===t.length?null:(t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):r=t.buffer.consume(e,t.decoder),r);var r}function N(e){var t=e._readableState;o("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,i.nextTick(F,t,e))}function F(e,t){if(o("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&0===e.length&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var r=t._writableState;(!r||r.autoDestroy&&r.finished)&&t.destroy()}}function q(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}x.prototype.read=function(e){o("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&((0!==t.highWaterMark?t.length>=t.highWaterMark:t.length>0)||t.ended))return o("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?N(this):O(this),null;if(0===(e=R(e,t))&&t.ended)return 0===t.length&&N(this),null;var n,i=t.needReadable;return o("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&o("length less than watermark",i=!0),t.ended||t.reading?o("reading or ended",i=!1):i&&(o("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=R(r,t))),null===(n=e>0?D(e,t):null)?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.awaitDrain=0),0===t.length&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&N(this)),null!==n&&this.emit("data",n),n},x.prototype._read=function(e){S(this,new w("_read()"))},x.prototype.pipe=function(e,t){var r=this,n=this._readableState;switch(n.pipesCount){case 0:n.pipes=e;break;case 1:n.pipes=[n.pipes,e];break;default:n.pipes.push(e)}n.pipesCount+=1,o("pipe count=%d opts=%j",n.pipesCount,t);var a=t&&!1===t.end||e===i.stdout||e===i.stderr?m:u;function u(){o("onend"),e.end()}n.endEmitted?i.nextTick(a):r.once("end",a),e.on("unpipe",(function t(i,s){o("onunpipe"),i===r&&s&&!1===s.hasUnpiped&&(s.hasUnpiped=!0,o("cleanup"),e.removeListener("close",f),e.removeListener("finish",p),e.removeListener("drain",c),e.removeListener("error",d),e.removeListener("unpipe",t),r.removeListener("end",u),r.removeListener("end",m),r.removeListener("data",h),l=!0,!n.awaitDrain||e._writableState&&!e._writableState.needDrain||c())}));var c=function(e){return function(){var t=e._readableState;o("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&s(e,"data")&&(t.flowing=!0,U(e))}}(r);e.on("drain",c);var l=!1;function h(t){o("ondata");var i=e.write(t);o("dest.write",i),!1===i&&((1===n.pipesCount&&n.pipes===e||n.pipesCount>1&&-1!==q(n.pipes,e))&&!l&&(o("false write response, pause",n.awaitDrain),n.awaitDrain++),r.pause())}function d(t){o("onerror",t),m(),e.removeListener("error",d),0===s(e,"error")&&S(e,t)}function f(){e.removeListener("finish",p),m()}function p(){o("onfinish"),e.removeListener("close",f),m()}function m(){o("unpipe"),r.unpipe(e)}return r.on("data",h),function(e,t,r){if("function"==typeof e.prependListener)return e.prependListener(t,r);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]:e.on(t,r)}(e,"error",d),e.once("close",f),e.once("finish",p),e.emit("pipe",r),n.flowing||(o("pipe resume"),r.resume()),e},x.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r)),this;if(!e){var n=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<i;o++)n[o].emit("unpipe",this,{hasUnpiped:!1});return this}var s=q(t.pipes,e);return-1===s||(t.pipes.splice(s,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r)),this},x.prototype.on=function(e,t){var r=a.prototype.on.call(this,e,t),n=this._readableState;return"data"===e?(n.readableListening=this.listenerCount("readable")>0,!1!==n.flowing&&this.resume()):"readable"===e&&(n.endEmitted||n.readableListening||(n.readableListening=n.needReadable=!0,n.flowing=!1,n.emittedReadable=!1,o("on readable",n.length,n.reading),n.length?O(this):n.reading||i.nextTick(A,this))),r},x.prototype.addListener=x.prototype.on,x.prototype.removeListener=function(e,t){var r=a.prototype.removeListener.call(this,e,t);return"readable"===e&&i.nextTick(L,this),r},x.prototype.removeAllListeners=function(e){var t=a.prototype.removeAllListeners.apply(this,arguments);return"readable"!==e&&void 0!==e||i.nextTick(L,this),t},x.prototype.resume=function(){var e=this._readableState;return e.flowing||(o("resume"),e.flowing=!e.readableListening,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,i.nextTick(M,e,t))}(this,e)),e.paused=!1,this},x.prototype.pause=function(){return o("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(o("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},x.prototype.wrap=function(e){var t=this,r=this._readableState,n=!1;for(var i in e.on("end",(function(){if(o("wrapped end"),r.decoder&&!r.ended){var e=r.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(i){o("wrapped data"),r.decoder&&(i=r.decoder.write(i)),r.objectMode&&null==i||(r.objectMode||i&&i.length)&&(t.push(i)||(n=!0,e.pause()))})),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var s=0;s<E.length;s++)e.on(E[s],this.emit.bind(this,E[s]));return this._read=function(t){o("wrapped _read",t),n&&(n=!1,e.resume())},this},"function"==typeof Symbol&&(x.prototype[Symbol.asyncIterator]=function(){return void 0===d&&(d=r(850)),d(this)}),Object.defineProperty(x.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(x.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(x.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),x._fromList=D,Object.defineProperty(x.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(x.from=function(e,t){return void 0===f&&(f=r(167)),f(x,e,t)})},605:(e,t,r)=>{"use strict";e.exports=l;var n=r(281).q,i=n.ERR_METHOD_NOT_IMPLEMENTED,o=n.ERR_MULTIPLE_CALLBACK,s=n.ERR_TRANSFORM_ALREADY_TRANSFORMING,a=n.ERR_TRANSFORM_WITH_LENGTH_0,u=r(753);function c(e,t){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(null===n)return this.emit("error",new o);r.writechunk=null,r.writecb=null,null!=t&&this.push(t),n(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function l(e){if(!(this instanceof l))return new l(e);u.call(this,e),this._transformState={afterTransform:c.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",h)}function h(){var e=this;"function"!=typeof this._flush||this._readableState.destroyed?d(this,null,null):this._flush((function(t,r){d(e,t,r)}))}function d(e,t,r){if(t)return e.emit("error",t);if(null!=r&&e.push(r),e._writableState.length)throw new a;if(e._transformState.transforming)throw new s;return e.push(null)}r(717)(l,u),l.prototype.push=function(e,t){return this._transformState.needTransform=!1,u.prototype.push.call(this,e,t)},l.prototype._transform=function(e,t,r){r(new i("_transform()"))},l.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},l.prototype._read=function(e){var t=this._transformState;null===t.writechunk||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))},l.prototype._destroy=function(e,t){u.prototype._destroy.call(this,e,(function(e){t(e)}))}},229:(e,t,r)=>{"use strict";var n,i=r(155);function o(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,r){var n=e.entry;for(e.entry=null;n;){var i=n.callback;t.pendingcb--,i(undefined),n=n.next}t.corkedRequestsFree.next=e}(t,e)}}e.exports=x,x.WritableState=T;var s,a={deprecate:r(927)},u=r(503),c=r(764).Buffer,l=(void 0!==r.g?r.g:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){},h=r(195),d=r(457).getHighWaterMark,f=r(281).q,p=f.ERR_INVALID_ARG_TYPE,m=f.ERR_METHOD_NOT_IMPLEMENTED,y=f.ERR_MULTIPLE_CALLBACK,v=f.ERR_STREAM_CANNOT_PIPE,g=f.ERR_STREAM_DESTROYED,b=f.ERR_STREAM_NULL_VALUES,w=f.ERR_STREAM_WRITE_AFTER_END,_=f.ERR_UNKNOWN_ENCODING,S=h.errorOrDestroy;function E(){}function T(e,t,s){n=n||r(753),e=e||{},"boolean"!=typeof s&&(s=t instanceof n),this.objectMode=!!e.objectMode,s&&(this.objectMode=this.objectMode||!!e.writableObjectMode),this.highWaterMark=d(this,e,"writableHighWaterMark",s),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var a=!1===e.decodeStrings;this.decodeStrings=!a,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var r=e._writableState,n=r.sync,o=r.writecb;if("function"!=typeof o)throw new y;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(r),t)!function(e,t,r,n,o){--t.pendingcb,r?(i.nextTick(o,n),i.nextTick(B,e,t),e._writableState.errorEmitted=!0,S(e,n)):(o(n),e._writableState.errorEmitted=!0,S(e,n),B(e,t))}(e,r,n,t,o);else{var s=R(r)||e.destroyed;s||r.corked||r.bufferProcessing||!r.bufferedRequest||k(e,r),n?i.nextTick(P,e,r,s,o):P(e,r,s,o)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new o(this)}function x(e){var t=this instanceof(n=n||r(753));if(!t&&!s.call(x,this))return new x(e);this._writableState=new T(e,this,t),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),u.call(this)}function C(e,t,r,n,i,o,s){t.writelen=n,t.writecb=s,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new g("write")):r?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function P(e,t,r,n){r||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,n(),B(e,t)}function k(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var n=t.bufferedRequestCount,i=new Array(n),s=t.corkedRequestsFree;s.entry=r;for(var a=0,u=!0;r;)i[a]=r,r.isBuf||(u=!1),r=r.next,a+=1;i.allBuffers=u,C(e,t,!0,t.length,i,"",s.finish),t.pendingcb++,t.lastBufferedRequest=null,s.next?(t.corkedRequestsFree=s.next,s.next=null):t.corkedRequestsFree=new o(t),t.bufferedRequestCount=0}else{for(;r;){var c=r.chunk,l=r.encoding,h=r.callback;if(C(e,t,!1,t.objectMode?1:c.length,c,l,h),r=r.next,t.bufferedRequestCount--,t.writing)break}null===r&&(t.lastBufferedRequest=null)}t.bufferedRequest=r,t.bufferProcessing=!1}function R(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function O(e,t){e._final((function(r){t.pendingcb--,r&&S(e,r),t.prefinished=!0,e.emit("prefinish"),B(e,t)}))}function B(e,t){var r=R(t);if(r&&(function(e,t){t.prefinished||t.finalCalled||("function"!=typeof e._final||t.destroyed?(t.prefinished=!0,e.emit("prefinish")):(t.pendingcb++,t.finalCalled=!0,i.nextTick(O,e,t)))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"),t.autoDestroy))){var n=e._readableState;(!n||n.autoDestroy&&n.endEmitted)&&e.destroy()}return r}r(717)(x,u),T.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(T.prototype,"buffer",{get:a.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(s=Function.prototype[Symbol.hasInstance],Object.defineProperty(x,Symbol.hasInstance,{value:function(e){return!!s.call(this,e)||this===x&&e&&e._writableState instanceof T}})):s=function(e){return e instanceof this},x.prototype.pipe=function(){S(this,new v)},x.prototype.write=function(e,t,r){var n,o=this._writableState,s=!1,a=!o.objectMode&&(n=e,c.isBuffer(n)||n instanceof l);return a&&!c.isBuffer(e)&&(e=function(e){return c.from(e)}(e)),"function"==typeof t&&(r=t,t=null),a?t="buffer":t||(t=o.defaultEncoding),"function"!=typeof r&&(r=E),o.ending?function(e,t){var r=new w;S(e,r),i.nextTick(t,r)}(this,r):(a||function(e,t,r,n){var o;return null===r?o=new b:"string"==typeof r||t.objectMode||(o=new p("chunk",["string","Buffer"],r)),!o||(S(e,o),i.nextTick(n,o),!1)}(this,o,e,r))&&(o.pendingcb++,s=function(e,t,r,n,i,o){if(!r){var s=function(e,t,r){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=c.from(t,r)),t}(t,n,i);n!==s&&(r=!0,i="buffer",n=s)}var a=t.objectMode?1:n.length;t.length+=a;var u=t.length<t.highWaterMark;if(u||(t.needDrain=!0),t.writing||t.corked){var l=t.lastBufferedRequest;t.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:o,next:null},l?l.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else C(e,t,!1,a,n,i,o);return u}(this,o,a,e,t,r)),s},x.prototype.cork=function(){this._writableState.corked++},x.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||k(this,e))},x.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new _(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(x.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(x.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),x.prototype._write=function(e,t,r){r(new m("_write()"))},x.prototype._writev=null,x.prototype.end=function(e,t,r){var n=this._writableState;return"function"==typeof e?(r=e,e=null,t=null):"function"==typeof t&&(r=t,t=null),null!=e&&this.write(e,t),n.corked&&(n.corked=1,this.uncork()),n.ending||function(e,t,r){t.ending=!0,B(e,t),r&&(t.finished?i.nextTick(r):e.once("finish",r)),t.ended=!0,e.writable=!1}(this,n,r),this},Object.defineProperty(x.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(x.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),x.prototype.destroy=h.destroy,x.prototype._undestroy=h.undestroy,x.prototype._destroy=function(e,t){t(e)}},850:(e,t,r)=>{"use strict";var n,i=r(155);function o(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var s=r(610),a=Symbol("lastResolve"),u=Symbol("lastReject"),c=Symbol("error"),l=Symbol("ended"),h=Symbol("lastPromise"),d=Symbol("handlePromise"),f=Symbol("stream");function p(e,t){return{value:e,done:t}}function m(e){var t=e[a];if(null!==t){var r=e[f].read();null!==r&&(e[h]=null,e[a]=null,e[u]=null,t(p(r,!1)))}}function y(e){i.nextTick(m,e)}var v=Object.getPrototypeOf((function(){})),g=Object.setPrototypeOf((o(n={get stream(){return this[f]},next:function(){var e=this,t=this[c];if(null!==t)return Promise.reject(t);if(this[l])return Promise.resolve(p(void 0,!0));if(this[f].destroyed)return new Promise((function(t,r){i.nextTick((function(){e[c]?r(e[c]):t(p(void 0,!0))}))}));var r,n=this[h];if(n)r=new Promise(function(e,t){return function(r,n){e.then((function(){t[l]?r(p(void 0,!0)):t[d](r,n)}),n)}}(n,this));else{var o=this[f].read();if(null!==o)return Promise.resolve(p(o,!1));r=new Promise(this[d])}return this[h]=r,r}},Symbol.asyncIterator,(function(){return this})),o(n,"return",(function(){var e=this;return new Promise((function(t,r){e[f].destroy(null,(function(e){e?r(e):t(p(void 0,!0))}))}))})),n),v);e.exports=function(e){var t,r=Object.create(g,(o(t={},f,{value:e,writable:!0}),o(t,a,{value:null,writable:!0}),o(t,u,{value:null,writable:!0}),o(t,c,{value:null,writable:!0}),o(t,l,{value:e._readableState.endEmitted,writable:!0}),o(t,d,{value:function(e,t){var n=r[f].read();n?(r[h]=null,r[a]=null,r[u]=null,e(p(n,!1))):(r[a]=e,r[u]=t)},writable:!0}),t));return r[h]=null,s(e,(function(e){if(e&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code){var t=r[u];return null!==t&&(r[h]=null,r[a]=null,r[u]=null,t(e)),void(r[c]=e)}var n=r[a];null!==n&&(r[h]=null,r[a]=null,r[u]=null,n(p(void 0,!0))),r[l]=!0})),e.on("readable",y.bind(null,r)),r}},327:(e,t,r)=>{"use strict";function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function o(e,t,r){return(t=a(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,a(n.key),n)}}function a(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}var u=r(764).Buffer,c=r(361).inspect,l=c&&c.custom||"inspect";e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}var t,r;return t=e,(r=[{key:"push",value:function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}},{key:"unshift",value:function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}},{key:"shift",value:function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(e){if(0===this.length)return"";for(var t=this.head,r=""+t.data;t=t.next;)r+=e+t.data;return r}},{key:"concat",value:function(e){if(0===this.length)return u.alloc(0);for(var t,r,n,i=u.allocUnsafe(e>>>0),o=this.head,s=0;o;)t=o.data,r=i,n=s,u.prototype.copy.call(t,r,n),s+=o.data.length,o=o.next;return i}},{key:"consume",value:function(e,t){var r;return e<this.head.data.length?(r=this.head.data.slice(0,e),this.head.data=this.head.data.slice(e)):r=e===this.head.data.length?this.shift():t?this._getString(e):this._getBuffer(e),r}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(e){var t=this.head,r=1,n=t.data;for(e-=n.length;t=t.next;){var i=t.data,o=e>i.length?i.length:e;if(o===i.length?n+=i:n+=i.slice(0,e),0==(e-=o)){o===i.length?(++r,t.next?this.head=t.next:this.head=this.tail=null):(this.head=t,t.data=i.slice(o));break}++r}return this.length-=r,n}},{key:"_getBuffer",value:function(e){var t=u.allocUnsafe(e),r=this.head,n=1;for(r.data.copy(t),e-=r.data.length;r=r.next;){var i=r.data,o=e>i.length?i.length:e;if(i.copy(t,t.length-e,0,o),0==(e-=o)){o===i.length?(++n,r.next?this.head=r.next:this.head=this.tail=null):(this.head=r,r.data=i.slice(o));break}++n}return this.length-=n,t}},{key:l,value:function(e,t){return c(this,i(i({},t),{},{depth:0,customInspect:!1}))}}])&&s(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}()},195:(e,t,r)=>{"use strict";var n=r(155);function i(e,t){s(e,t),o(e)}function o(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit("close")}function s(e,t){e.emit("error",t)}e.exports={destroy:function(e,t){var r=this,a=this._readableState&&this._readableState.destroyed,u=this._writableState&&this._writableState.destroyed;return a||u?(t?t(e):e&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,n.nextTick(s,this,e)):n.nextTick(s,this,e)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){!t&&e?r._writableState?r._writableState.errorEmitted?n.nextTick(o,r):(r._writableState.errorEmitted=!0,n.nextTick(i,r,e)):n.nextTick(i,r,e):t?(n.nextTick(o,r),t(e)):n.nextTick(o,r)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(e,t){var r=e._readableState,n=e._writableState;r&&r.autoDestroy||n&&n.autoDestroy?e.destroy(t):e.emit("error",t)}}},610:(e,t,r)=>{"use strict";var n=r(281).q.ERR_STREAM_PREMATURE_CLOSE;function i(){}e.exports=function e(t,r,o){if("function"==typeof r)return e(t,null,r);r||(r={}),o=function(e){var t=!1;return function(){if(!t){t=!0;for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];e.apply(this,n)}}}(o||i);var s=r.readable||!1!==r.readable&&t.readable,a=r.writable||!1!==r.writable&&t.writable,u=function(){t.writable||l()},c=t._writableState&&t._writableState.finished,l=function(){a=!1,c=!0,s||o.call(t)},h=t._readableState&&t._readableState.endEmitted,d=function(){s=!1,h=!0,a||o.call(t)},f=function(e){o.call(t,e)},p=function(){var e;return s&&!h?(t._readableState&&t._readableState.ended||(e=new n),o.call(t,e)):a&&!c?(t._writableState&&t._writableState.ended||(e=new n),o.call(t,e)):void 0},m=function(){t.req.on("finish",l)};return function(e){return e.setHeader&&"function"==typeof e.abort}(t)?(t.on("complete",l),t.on("abort",p),t.req?m():t.on("request",m)):a&&!t._writableState&&(t.on("end",u),t.on("close",u)),t.on("end",d),t.on("finish",l),!1!==r.error&&t.on("error",f),t.on("close",p),function(){t.removeListener("complete",l),t.removeListener("abort",p),t.removeListener("request",m),t.req&&t.req.removeListener("finish",l),t.removeListener("end",u),t.removeListener("close",u),t.removeListener("finish",l),t.removeListener("end",d),t.removeListener("error",f),t.removeListener("close",p)}}},167:e=>{e.exports=function(){throw new Error("Readable.from is not available in the browser")}},946:(e,t,r)=>{"use strict";var n,i=r(281).q,o=i.ERR_MISSING_ARGS,s=i.ERR_STREAM_DESTROYED;function a(e){if(e)throw e}function u(e){e()}function c(e,t){return e.pipe(t)}e.exports=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var l,h=function(e){return e.length?"function"!=typeof e[e.length-1]?a:e.pop():a}(t);if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new o("streams");var d=t.map((function(e,i){var o=i<t.length-1;return function(e,t,i,o){o=function(e){var t=!1;return function(){t||(t=!0,e.apply(void 0,arguments))}}(o);var a=!1;e.on("close",(function(){a=!0})),void 0===n&&(n=r(610)),n(e,{readable:t,writable:i},(function(e){if(e)return o(e);a=!0,o()}));var u=!1;return function(t){if(!a&&!u)return u=!0,function(e){return e.setHeader&&"function"==typeof e.abort}(e)?e.abort():"function"==typeof e.destroy?e.destroy():void o(t||new s("pipe"))}}(e,o,i>0,(function(e){l||(l=e),e&&d.forEach(u),o||(d.forEach(u),h(l))}))}));return t.reduce(c)}},457:(e,t,r)=>{"use strict";var n=r(281).q.ERR_INVALID_OPT_VALUE;e.exports={getHighWaterMark:function(e,t,r,i){var o=function(e,t,r){return null!=e.highWaterMark?e.highWaterMark:t?e[r]:null}(t,i,r);if(null!=o){if(!isFinite(o)||Math.floor(o)!==o||o<0)throw new n(i?r:"highWaterMark",o);return Math.floor(o)}return e.objectMode?16:16384}}},503:(e,t,r)=>{e.exports=r(187).EventEmitter},473:(e,t,r)=>{(t=e.exports=r(481)).Stream=t,t.Readable=t,t.Writable=r(229),t.Duplex=r(753),t.Transform=r(605),t.PassThrough=r(725),t.finished=r(610),t.pipeline=r(946)},509:(e,t,r)=>{var n=r(764),i=n.Buffer;function o(e,t){for(var r in e)t[r]=e[r]}function s(e,t,r){return i(e,t,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=n:(o(n,t),t.Buffer=s),s.prototype=Object.create(i.prototype),o(i,s),s.from=function(e,t,r){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,r)},s.alloc=function(e,t,r){if("number"!=typeof e)throw new TypeError("Argument must be a number");var n=i(e);return void 0!==t?"string"==typeof r?n.fill(t,r):n.fill(t):n.fill(0),n},s.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},s.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n.SlowBuffer(e)}},830:(e,t,r)=>{e.exports=i;var n=r(187).EventEmitter;function i(){n.call(this)}r(717)(i,n),i.Readable=r(481),i.Writable=r(229),i.Duplex=r(753),i.Transform=r(605),i.PassThrough=r(725),i.finished=r(610),i.pipeline=r(946),i.Stream=i,i.prototype.pipe=function(e,t){var r=this;function i(t){e.writable&&!1===e.write(t)&&r.pause&&r.pause()}function o(){r.readable&&r.resume&&r.resume()}r.on("data",i),e.on("drain",o),e._isStdio||t&&!1===t.end||(r.on("end",a),r.on("close",u));var s=!1;function a(){s||(s=!0,e.end())}function u(){s||(s=!0,"function"==typeof e.destroy&&e.destroy())}function c(e){if(l(),0===n.listenerCount(this,"error"))throw e}function l(){r.removeListener("data",i),e.removeListener("drain",o),r.removeListener("end",a),r.removeListener("close",u),r.removeListener("error",c),e.removeListener("error",c),r.removeListener("end",l),r.removeListener("close",l),e.removeListener("close",l)}return r.on("error",c),e.on("error",c),r.on("end",l),r.on("close",l),e.on("close",l),e.emit("pipe",r),e}},553:(e,t,r)=>{"use strict";var n=r(509).Buffer,i=n.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function o(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(n.isEncoding===i||!i(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=u,this.end=c,t=4;break;case"utf8":this.fillLast=a,t=4;break;case"base64":this.text=l,this.end=h,t=3;break;default:return this.write=d,void(this.end=f)}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(t)}function s(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function a(e){var t=this.lastTotal-this.lastNeed,r=function(e,t,r){if(128!=(192&t[0]))return e.lastNeed=0,"";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,""}}(this,e);return void 0!==r?r:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function u(e,t){if((e.length-t)%2==0){var r=e.toString("utf16le",t);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function c(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,r)}return t}function l(e,t){var r=(e.length-t)%3;return 0===r?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,1===r?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function h(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function d(e){return e.toString(this.encoding)}function f(e){return e&&e.length?this.write(e):""}t.s=o,o.prototype.write=function(e){if(0===e.length)return"";var t,r;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""},o.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"":t},o.prototype.text=function(e,t){var r=function(e,t,r){var n=t.length-1;if(n<r)return 0;var i=s(t[n]);return i>=0?(i>0&&(e.lastNeed=i-1),i):--n<r||-2===i?0:(i=s(t[n]))>=0?(i>0&&(e.lastNeed=i-2),i):--n<r||-2===i?0:(i=s(t[n]))>=0?(i>0&&(2===i?i=0:e.lastNeed=i-3),i):0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;var n=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,n),e.toString("utf8",t,n)},o.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},927:(e,t,r)=>{function n(e){try{if(!r.g.localStorage)return!1}catch(e){return!1}var t=r.g.localStorage[e];return null!=t&&"true"===String(t).toLowerCase()}e.exports=function(e,t){if(n("noDeprecation"))return e;var r=!1;return function(){if(!r){if(n("throwDeprecation"))throw new Error(t);n("traceDeprecation")?console.trace(t):console.warn(t),r=!0}return e.apply(this,arguments)}}},361:()=>{},616:()=>{}},t={};function r(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,r),o.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};(()=>{"use strict";r.r(n),r.d(n,{AACDepay:()=>I,BasicDepay:()=>L,CanvasSink:()=>F,CustomDepay:()=>z,H264Depay:()=>Q,HTTPTunnelSource:()=>sr,Html5CanvasMetadataPipelineExtended:()=>Cr,Html5CanvasPipeline:()=>Sr,Html5VideoMetadataPipeline:()=>Br,Html5VideoMetadataPipelineExtended:()=>Ir,Html5VideoPipeline:()=>kr,Html5VideoPipeline_HTTP:()=>Or,HttpMsePipeline:()=>Gr,HttpSource:()=>ne,Inspector:()=>oe,JPEGDepay:()=>Se,MessageType:()=>O,MetadataPipeline:()=>Ar,Mp4Capture:()=>xe,Mp4Muxer:()=>it,MseSink:()=>at,ONVIFDepay:()=>ct,Pipeline:()=>ur,RTSP_METHOD:()=>Nt,RtspDecoderPipeline:()=>Ur,RtspMjpegPipeline:()=>fr,RtspMp4Pipeline:()=>dr,RtspParser:()=>Bt,RtspPipeline:()=>lr,RtspSession:()=>Ft,SDPUpdater:()=>zt,Scheduler:()=>D,Sink:()=>d,Source:()=>l,Tube:()=>h,WSSource:()=>Gt,WebCodecsDecoder:()=>Xt,WsSdpPipeline:()=>Nr,base64ArrayBuffer:()=>nr,bodyOffset:()=>Ct,cSrc:()=>T,cSrcCount:()=>g,components:()=>e,connectionEnded:()=>Tt,contentBase:()=>Et,createTransform:()=>B,dataCatcherDepay:()=>Qt,extHeader:()=>C,extHeaderLength:()=>x,extension:()=>v,extractHeaderValue:()=>gt,extractURIs:()=>mt,g711toPCM:()=>tr,getJPEGResolutionFromExtHeader:()=>k,getTime:()=>Lt,init_connection:()=>ir,marker:()=>b,messageFromBuffer:()=>vt,padding:()=>y,parse:()=>yt,parseExtHeader:()=>P,payload:()=>R,payloadType:()=>w,pipelines:()=>t,range:()=>xt,sSrc:()=>E,send_command:()=>or,sequence:()=>bt,sequenceNumber:()=>_,sessionId:()=>wt,sessionTimeout:()=>_t,statusCode:()=>St,timestamp:()=>S,utils:()=>i,version:()=>m});var e={};r.r(e),r.d(e,{AACDepay:()=>I,BasicDepay:()=>L,CanvasSink:()=>F,CustomDepay:()=>z,H264Depay:()=>Q,HTTPTunnelSource:()=>sr,HttpSource:()=>ne,Inspector:()=>oe,JPEGDepay:()=>Se,MessageType:()=>O,Mp4Capture:()=>xe,Mp4Muxer:()=>it,MseSink:()=>at,ONVIFDepay:()=>ct,RTSP_METHOD:()=>Nt,RtspParser:()=>Bt,RtspSession:()=>Ft,SDPUpdater:()=>zt,Sink:()=>d,Source:()=>l,Tube:()=>h,WSSource:()=>Gt,WebCodecsDecoder:()=>Xt,base64ArrayBuffer:()=>nr,createTransform:()=>B,dataCatcherDepay:()=>Qt,g711toPCM:()=>tr,init_connection:()=>ir,send_command:()=>or});var t={};r.r(t),r.d(t,{Html5CanvasMetadataPipelineExtended:()=>Cr,Html5CanvasPipeline:()=>Sr,Html5VideoMetadataPipeline:()=>Br,Html5VideoMetadataPipelineExtended:()=>Ir,Html5VideoPipeline:()=>kr,Html5VideoPipeline_HTTP:()=>Or,HttpMsePipeline:()=>Gr,MetadataPipeline:()=>Ar,Pipeline:()=>ur,RtspDecoderPipeline:()=>Ur,RtspMjpegPipeline:()=>fr,RtspMp4Pipeline:()=>dr,RtspPipeline:()=>lr,WsSdpPipeline:()=>Nr});var i={};r.r(i),r.d(i,{Scheduler:()=>D,bodyOffset:()=>Ct,cSrc:()=>T,cSrcCount:()=>g,connectionEnded:()=>Tt,contentBase:()=>Et,extHeader:()=>C,extHeaderLength:()=>x,extension:()=>v,extractHeaderValue:()=>gt,extractURIs:()=>mt,getJPEGResolutionFromExtHeader:()=>k,getTime:()=>Lt,marker:()=>b,messageFromBuffer:()=>vt,padding:()=>y,parse:()=>yt,parseExtHeader:()=>P,payload:()=>R,payloadType:()=>w,range:()=>xt,sSrc:()=>E,sequence:()=>bt,sequenceNumber:()=>_,sessionId:()=>wt,sessionTimeout:()=>_t,statusCode:()=>St,timestamp:()=>S,version:()=>m});var o=r(830),s=r(764).Buffer;class a{static consumer(e=(()=>{})){return new o.Writable({objectMode:!0,write(t,r,n){e(t),n()}})}static peeker(e){if("function"!=typeof e)throw new Error("you must supply a function");return new o.Transform({objectMode:!0,transform(t,r,n){e(t),n(void 0,t)}})}static producer(e){let t=0;return new o.Readable({objectMode:!0,read(){void 0!==e&&(t<e.length?this.push(e[t++]):this.push(null))}})}static recorder(e,t){return new o.Transform({objectMode:!0,transform(r,n,i){const o=Date.now(),s=Object.assign({},r,{data:r.data.toString("base64")});t.write(JSON.stringify({type:e,timestamp:o,message:s},null,2)),t.write(",\n"),i(void 0,r)}})}static replayer(e){let t=0,r=e[0].timestamp;return new o.Readable({objectMode:!0,read(){const n=e[t++];if(n){const{type:e,timestamp:t,message:i}=n,o=t-r;if(r=t,i){const t=i.data?s.from(i.data,"base64"):s.alloc(0),r=Object.assign({},i,{data:t});this.push({type:e,delay:o,msg:r})}else this.push({type:e,delay:o,msg:null})}else this.push(null)}})}}function u(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class c{constructor(){u(this,"incoming",void 0),u(this,"outgoing",void 0),u(this,"next",void 0),u(this,"prev",void 0),u(this,"_incomingErrorHandler",void 0),u(this,"_outgoingErrorHandler",void 0)}}class l extends c{static fromMessages(e){return new l(a.producer(e),a.consumer())}constructor(e=new o.Readable({objectMode:!0}),t=new o.Writable({objectMode:!0})){super(),u(this,"incoming",void 0),u(this,"outgoing",void 0),u(this,"next",void 0),u(this,"prev",void 0),this.incoming=e,this.outgoing=t,this.next=null,this.prev=null}connect(e){if(null===e)return this;if(null!==this.next||null!==e.prev)throw new Error("connection failed: component(s) already connected");if(!this.incoming.readable||!this.outgoing.writable)throw new Error("connection failed: this component not compatible");if(!e.incoming.writable||!e.outgoing.readable)throw new Error("connection failed: next component not compatible");try{this.incoming.pipe(e.incoming),e.outgoing.pipe(this.outgoing)}catch(e){throw new Error(`connection failed: ${e.message}`)}const t=e=>{this.incoming.emit("error",e)};e.incoming.on("error",t);const r=t=>{e.outgoing.emit("error",t)};return this.outgoing.on("error",r),this.next=e,e.prev=this,this._incomingErrorHandler=t,this._outgoingErrorHandler=r,e}disconnect(){const e=this.next;return null!==e&&(this.incoming.unpipe(e.incoming),e.outgoing.unpipe(this.outgoing),void 0!==this._incomingErrorHandler&&e.incoming.removeListener("error",this._incomingErrorHandler),void 0!==this._outgoingErrorHandler&&this.outgoing.removeListener("error",this._outgoingErrorHandler),this.next=null,e.prev=null,delete this._incomingErrorHandler,delete this._outgoingErrorHandler),this}}class h extends l{static fromHandlers(e,t){const r=e?a.peeker(e):void 0,n=t?a.peeker(t):void 0;return new h(r,n)}constructor(e=new o.PassThrough({objectMode:!0}),t=new o.PassThrough({objectMode:!0})){super(e,t),u(this,"incoming",void 0),u(this,"outgoing",void 0),this.incoming=e,this.outgoing=t}}class d extends c{static fromHandler(e){const t=new d(a.consumer(e),a.producer(void 0));return t.incoming.on("finish",(()=>{t.outgoing.push(null)})),t}constructor(e=new o.Writable({objectMode:!0}),t=new o.Readable({objectMode:!0})){super(),u(this,"incoming",void 0),u(this,"outgoing",void 0),u(this,"next",void 0),u(this,"prev",void 0),this.incoming=e,this.outgoing=t,this.next=null,this.prev=null}connect(){throw new Error("connection failed: attempting to connect after a sink")}disconnect(){return this}}const f=[128,64,32,16,8,4,2,1];var p=r(764).Buffer;const m=e=>e[0]>>>6,y=e=>!!(e[0]&f[2]),v=e=>!!(e[0]&f[3]),g=e=>15&e[0],b=e=>!!(e[1]&f[0]),w=e=>127&e[1],_=e=>e.readUInt16BE(2),S=e=>e.readUInt32BE(4),E=e=>e.readUInt32BE(8),T=(e,t=0)=>g(e)>t?e.readUInt32BE(12+4*t):0,x=e=>!1===v(e)?0:e.readUInt16BE(12+4*g(e)+2),C=e=>0===x(e)?p.from([]):e.slice(12+4*g(e),12+4*g(e)+4+4*x(e)),P=e=>{if(e&&0!==e.length){let t={},r=4;for(;e.length-r>4;){let n=e.readUInt16BE(r),i=e.readUInt16BE(r+2);t[n]=e.slice(r+4,r+2+i),r+=2+i}return t}return{}},k=e=>{let t={width:0,height:0};if(e&&e.length>4){let r=4;for(;e.length-r>4;){let n=e.readUInt16BE(r),i=e.readUInt16BE(r+2);65472===n&&(t.height=e.readUInt16BE(r+5),t.width=e.readUInt16BE(r+7)),r+=2+i}return t}return t},R=e=>!1===v(e)?e.slice(12+4*g(e)):e.slice(12+4*g(e)+4+4*x(e));let O=function(e){return e[e.UNKNOWN=0]="UNKNOWN",e[e.RAW=1]="RAW",e[e.RTP=2]="RTP",e[e.RTCP=3]="RTCP",e[e.RTSP=4]="RTSP",e[e.SDP=5]="SDP",e[e.ELEMENTARY=6]="ELEMENTARY",e[e.H264=7]="H264",e[e.ISOM=8]="ISOM",e[e.XML=9]="XML",e[e.JPEG=10]="JPEG",e[e.PCM=11]="PCM",e[e.SPS=12]="SPS",e[e.PPS=13]="PPS",e[e.META_RAW=14]="META_RAW",e[e.SEI=15]="SEI",e}({});const B=e=>new o.Transform({objectMode:!0,transform:e});class I extends h{constructor(){let e,t;super(B((function(r,n,i){if(r.type===O.SDP){let n;if(r.sdp.media)for(const e of r.sdp.media)"audio"===e.type&&e.fmtp&&e.fmtp.parameters&&"AAC-hbr"===e.fmtp.parameters.mode&&void 0!==e.recvonly&&1==e.recvonly&&(n=e);if(n&&void 0!==n.rtpmap){e=Number(n.rtpmap.payloadType);const r=n.fmtp.parameters,i=Number(r.sizelength)||0,o=Number(r.indexlength)||0,s=Number(r.indexdeltalength)||0,a=Number(r.ctsdeltalength)||0,u=Number(r.dtsdeltalength)||0,c=Number(r.randomaccessindication)||0,l=Number(r.streamstateindication)||0,h=Number(r.auxiliarydatasizelength)||0;t=i+Math.max(o,s)+a+u+c+l+h>0}i(void 0,r)}else r.type===O.RTP&&w(r.data)===e?(function(e,t,r){const n=R(e.data);let i=0;if(t){const e=n.readUInt16BE(0);i=2+(e+e%8)/8}let o=n.readUInt16BE(i);65520==(65520&o)&&(i+=1==(1&o)?7:9),r({type:O.ELEMENTARY,data:n.slice(i),payloadType:w(e.data),timestamp:S(e.data),ntpTimestamp:e.ntpTimestamp})}(r,t,this.push.bind(this)),i()):i(void 0,r)})))}}var j=r(764).Buffer;class L extends h{constructor(e){if(void 0===e)throw new Error("you must supply a payload type to BasicDepayComponent");let t=j.alloc(0);super(B((function(r,n,i){if(r.type===O.RTP&&w(r.data)===e){const e=R(r.data);t=j.concat([t,e]),b(r.data)&&(t.length>0&&this.push({data:t,timestamp:S(r.data),ntpTimestamp:r.ntpTimestamp,payloadType:w(r.data),type:O.ELEMENTARY}),t=j.alloc(0)),i()}else i(void 0,r)})))}}function A(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class M{constructor(){A(this,"started",void 0),A(this,"stopped",void 0),A(this,"elapsed",void 0),this.elapsed=0,this.started=0,this.stopped=!0}start(){this.stopped&&(this.started=window.performance.now(),this.stopped=!1)}stop(){this.stopped||(this.elapsed=this.now(),this.stopped=!0)}reset(){this.elapsed=0,this.started=0,this.stopped=!0}now(){return this.stopped?this.elapsed:this.elapsed+(window.performance.now()-this.started)}play(){this.start()}pause(){this.stop()}get currentTime(){return this.now()/1e3}}function U(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class D{constructor(e,t,r=10){U(this,"_clock",void 0),U(this,"_handler",void 0),U(this,"_tolerance",void 0),U(this,"_nextRun",void 0),U(this,"_nextPlay",void 0),U(this,"_fifo",void 0),U(this,"_ntpPresentationTime",void 0),U(this,"_suspended",void 0),this._clock=e,this._handler=t,this._tolerance=r,this._nextRun=0,this._nextPlay=0,this._fifo=[],this._ntpPresentationTime=0,this._suspended=!1}reset(){clearTimeout(this._nextRun),clearTimeout(this._nextPlay),this._fifo=[],this._ntpPresentationTime=0,this._suspended=!1}init(e){this._ntpPresentationTime=e}suspend(){clearTimeout(this._nextPlay),this._suspended=!0}resume(){this._suspended=!1,this.run(void 0)}run(e){if(clearTimeout(this._nextRun),void 0===this._ntpPresentationTime)return;if(void 0!==e&&this._fifo.push(e),this._suspended)return;if(0===this._fifo.length)return;let t,r=0;do{const e=this._fifo.shift();if(void 0===e)throw new Error("internal error: message should never be undefined");t=e;const n=t.ntpTimestamp;void 0!==n&&(r=n-this._ntpPresentationTime-1e3*this._clock.currentTime,Math.abs(r)<this._tolerance&&this._handler&&this._handler(t))}while(r<this._tolerance&&this._fifo.length>0);r<-this._tolerance?(clearTimeout(this._nextPlay),this._clock.pause(),this._nextPlay=window.setTimeout((()=>this._clock.play()),-r)):r>this._tolerance&&(this._fifo.unshift(t),this._nextRun=window.setTimeout((()=>this.run(void 0)),r))}}function N(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class F extends d{constructor(e){if(void 0===e)throw new Error("canvas element argument missing");let t=0,r=0,n=0;const i={bitrate:0,framerate:0,renderedFrames:0};let s,a,u=null;if(void 0!==window.createImageBitmap&&(u=e.getContext("bitmaprenderer")),null===u&&(u=e.getContext("2d")),null===u)a=()=>{};else if("transferFromImageBitmap"in u){const e=u;a=({blob:t})=>{i.renderedFrames++,window.createImageBitmap(t).then((t=>{e.transferFromImageBitmap(t)})).catch((()=>{}))}}else{const e=u,t=new Image;t.onload=()=>{e.drawImage(t,0,0)},a=({blob:e})=>{i.renderedFrames++;const r=window.URL.createObjectURL(e);t.src=r}}const c=new M,l=new D(c,a);let h=0;const d=()=>{this.onCanplay&&this.onCanplay()},f=e=>{this.onSync&&this.onSync(e)},p=new o.Writable({objectMode:!0,write:(o,a,u)=>{if(o.type===O.SDP){c.reset(),l.reset(),t=0;const e=o.sdp.media?.find((e=>"video"===e.type&&void 0!==e.rtpmap&&"JPEG"===e.rtpmap.encodingName));void 0!==e&&void 0!==e.rtpmap&&(n=e.rtpmap.clockrate,(e=>{e.bitrate=0,e.framerate=0,e.renderedFrames=0})(i),s=(e=>{let t=0,r=0,n=0;return(i,{byteLength:o,duration:s})=>{if(t+=o,r+=s,n++,r>=e){const o=8*t,s=n,a=r/e;i.bitrate=o/a,i.framerate=s/a,t=0,r=0,n=0}}})(n)),u()}else if(o.type===O.JPEG){const{timestamp:a,ntpTimestamp:c}=o;if(!t){t=a,r=a;const{width:n,height:i}=o.framesize;e.width=n,e.height=i,l.init(0)}const p=1e3*(a-t)/n,m=new window.Blob([o.data],{type:"image/jpeg"});!h&&c&&(h=c-p,f(h)),l.run({ntpTimestamp:p,blob:m}),a===t&&d(),s(i,{byteLength:o.data.length,duration:a-r}),r=a,u()}else u()}}),m=new o.Readable({objectMode:!0,read:function(){}});m.on("error",(()=>{console.warn("outgoing stream broke somewhere")})),super(p,m),N(this,"onCanplay",void 0),N(this,"onSync",void 0),N(this,"_clock",void 0),N(this,"_scheduler",void 0),N(this,"_info",void 0),this._clock=c,this._scheduler=l,this._info=i,this.onCanplay=void 0,this.onSync=void 0}get currentTime(){return this._clock.currentTime}pause(){this._scheduler.suspend(),this._clock.pause()}play(){this._clock.play(),this._scheduler.resume()}get bitrate(){return this._info.bitrate}get framerate(){return this._info.framerate}}var q=r(227),H=r.n(q),$=r(764).Buffer;class z extends h{constructor(e,t,r){let n=H()("msl:customdepay"),i=r;super(new o.Transform({objectMode:!0,transform:function(r,o,s){if(r.type===O.SDP){let e;if(r.sdp.media)for(const n of r.sdp.media)"application"===n.type&&n.rtpmap&&n.rtpmap.encodingName===t&&(e=n);e&&e.rtpmap&&(i=Number(e.rtpmap.payloadType),n("using payload type %s for %s",i,t)),s(void 0,r)}else if(r.type===O.RTP&&w(r.data)===i){const t={timestamp:S(r.data),ntpTimestamp:r.ntpTimestamp,payloadType:w(r.data),data:$.concat([$.from([]),R(r.data)]),type:O.META_RAW};e?e(t):this.push(t),s()}else s(void 0,r)}}))}}var W=r(764).Buffer;let V=function(e){return e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.NON_IDR_PICTURE=1]="NON_IDR_PICTURE",e[e.IDR_PICTURE=5]="IDR_PICTURE",e[e.SPS=7]="SPS",e[e.PPS=8]="PPS",e}({});const G=H()("msl:h264depay");class Y{constructor(){var e,t,r;e=this,r=void 0,(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t="_buffer"))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,this._buffer=W.alloc(0)}parse(e){const t=R(e.data),r=31&t[0];if(28===r){const r=t[0],n=t[1],i=31&n,o=224&r|i,s=64&n;if(n>>7)return this._buffer=W.concat([W.from([0,0,0,0,o]),t.slice(2)]),null;if(s){const r=W.concat([this._buffer,t.slice(2)]);r.writeUInt32BE(r.length-4,0);const n={data:r,type:O.H264,timestamp:S(e.data),ntpTimestamp:e.ntpTimestamp,payloadType:w(e.data),nalType:i};return this._buffer=W.alloc(0),n}return this._buffer=W.concat([this._buffer,t.slice(2)]),null}if(r!==V.NON_IDR_PICTURE&&r!==V.IDR_PICTURE||0!==this._buffer.length)return G(`H264depayComponent can only extract types 1,5 and 28, got ${r}`),this._buffer=W.alloc(0),null;{const n=W.concat([W.from([0,0,0,0]),t]);n.writeUInt32BE(n.length-4,0);const i={data:n,type:O.H264,timestamp:S(e.data),ntpTimestamp:e.ntpTimestamp,payloadType:w(e.data),nalType:r};return this._buffer=W.alloc(0),i}}}var J=r(764).Buffer;function K(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function X(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?K(Object(r),!0).forEach((function(t){Z(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):K(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Z(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Q extends h{constructor(){let e,t=!1,r=[];const n=new Y,i=e=>{this.onDataCallback&&this.onDataCallback(e)};super(new o.Transform({objectMode:!0,transform:function(o,s,a){if(o.type===O.SDP){const t=o.sdp.media?.find((e=>"video"===e.type&&void 0!==e.rtpmap&&"H264"===e.rtpmap.encodingName));void 0!==t&&void 0!==t.rtpmap&&(e=t.rtpmap.payloadType),a(void 0,o)}else if(o.type===O.RTP&&w(o.data)===e){const e=b(o.data),s=n.parse(o);if(null===s||!t&&s.nalType!==V.IDR_PICTURE)return void a();t=!0,i&&i(s),r.push(s.data),e&&(this.push(X(X({},s),{},{data:1===r.length?r[0]:J.concat(r)})),r=[]),a(void 0,s)}else a(void 0,o)}})),Z(this,"onDataCallback",void 0)}}var ee=r(764).Buffer;function te(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const re=H()("msl:http-source");class ne extends l{constructor(e){const{uri:t,headers:r}=e,n=new o.Readable({objectMode:!0,read:function(){}});n.on("error",(e=>{console.warn("closing socket due to incoming error",e),this._reader&&this._reader.cancel()})),super(n),te(this,"uri",void 0),te(this,"headers",void 0),te(this,"length",void 0),te(this,"_reader",void 0),n._read=()=>{this._pull()},this.uri=t,this.headers=r}play(){if(void 0===this.uri)throw new Error("cannot start playing when there is no URI");this.length=0,fetch(this.uri,{headers:this.headers}).then((e=>{if(null===e.body)throw new Error("empty response body");this._reader=e.body.getReader(),this._pull()})).catch((e=>{throw new Error(e)}))}_pull(){void 0!==this._reader&&this._reader.read().then((({done:e,value:t})=>{if(e)return re("fetch completed, total downloaded: ",this.length," bytes"),void this.incoming.push(null);if(void 0===t)throw new Error("expected value to be defined");if(void 0===this.length)throw new Error("expected length to be defined");this.length+=t.length;const r=ee.from(t);this.incoming.push({data:r,type:O.RAW})?this._pull():re("downstream back pressure: pausing read")}))}}const ie=(e,t)=>{let r=Date.now();const n=t=>{const n=Date.now();console.log(`${e}: +${n-r}ms`,t),r=n};return void 0===t?n:e=>e.type===t&&n(e)};class oe extends h{constructor(e){const t=ie("incoming",e),r=new o.Transform({objectMode:!0,transform:function(e,r,n){t(e),n(void 0,e)}}),n=ie("outgoing",e);super(r,new o.Transform({objectMode:!0,transform:function(e,t,r){n(e),r(void 0,e)}}))}}var se=r(764).Buffer;const ae=[0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],ue=[0,1,2,3,4,5,6,7,8,9,10,11],ce=[0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],le=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],he=[0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],de=[0,1,2,3,4,5,6,7,8,9,10,11],fe=[0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],pe=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function me(e,t,r){return e>r?r:e<t?t:e}var ye=r(764).Buffer;const ve=[16,11,12,14,12,10,16,14,13,14,18,17,16,19,24,40,26,24,22,22,24,49,35,37,29,40,58,51,61,60,57,51,56,55,64,72,92,78,64,68,87,69,55,56,80,109,81,87,95,98,103,104,103,62,77,113,121,112,100,120,92,101,103,99],ge=[17,18,18,24,21,24,47,26,26,47,99,66,56,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99];function be(e){const t=me(e,1,99),r=ye.alloc(128),n=e<50?Math.floor(5e3/t):200-2*t;for(let e=0;e<64;e++){const t=Math.floor((ve[e]*n+50)/100),i=Math.floor((ge[e]*n+50)/100);r.writeUInt8(me(t,1,255),e),r.writeUInt8(me(i,1,255),e+64)}return r}var we=r(764).Buffer;function _e(e=0,t=0){const r=se.from([255,216]),n=function(){const e=[[255,196,0,3+ae.length+ue.length,0],ae,ue],t=[[255,196,0,3+ce.length+le.length,16],ce,le],r=[[255,196,0,3+he.length+de.length,1],he,de],n=[[255,196,0,3+fe.length+pe.length,17],fe,pe];return se.concat([...e.map(se.from),...t.map(se.from),...r.map(se.from),...n.map(se.from)])}(),i=se.from([255,218,0,12,3,0,0,1,17,2,17,0,63,0]);return function(o){let s;const a=[];for(const r of o){let n=R(r);const i=n.readUInt8(0),o=n.readUInt8(1)<<16|n.readUInt8(2)<<8|n.readUInt8(3),u=n.readUInt8(4),c=n.readUInt8(5),l=8*n.readUInt8(6)||e,h=8*n.readUInt8(7)||t;n=n.slice(8);let d=0;if(u>=64&&u<=127&&(d=n.readUInt16BE(0),n=n.slice(4)),c>=128&&0===o){const e=n.readUInt8(1),t=n.readUInt16BE(2);s={typeSpecific:i,type:u,width:l,height:h,DRI:d,precision:e,qTable:n.slice(4,4+t)},n=n.slice(4+t)}else c<128&&0===o&&(s={typeSpecific:i,type:u,width:l,height:h,DRI:d,precision:0,qTable:be(c)});a.push(n)}if(void 0===s)throw new Error("no quantization header present");const{precision:u,qTable:c,type:l,width:h,height:d}=s,f=function(e,t){const r=1&e?128:64,n=2&e?128:64;if(t.length!==r+n)throw new Error("invalid quantization table");const i=se.from([255,219,0,r+3,0]),o=se.from([255,219,0,n+3,1]);return se.concat([i,t.slice(0,r),o,t.slice(r)])}(u,c);if(0!==s.DRI)throw new Error("not implemented: DRI");const p=function(e,t,r){return se.from([255,192,0,17,8,t>>8,t,e>>8,e,3,0,0===r?33:34,0,1,17,1,2,17,1])}(h,d,l);return{size:{width:h,height:d},data:we.concat([r,f,p,n,i,...a])}}}class Se extends h{constructor(){const e=debug("msl:jpegdepay");let t,r,n,i=[];super(new o.Transform({objectMode:!0,transform:function(o,s,a){if(o.type===O.SDP){const e=o.sdp.media?.find((e=>"video"===e.type&&void 0!==e.rtpmap&&"JPEG"===e.rtpmap.encodingName));if(void 0!==e&&void 0!==e.rtpmap){t=Number(e.rtpmap.payloadType);const r=e.framesize;if(void 0!==r){const[e,t]=r;n=_e(e,t)}else n=_e()}a(void 0,o)}else if(o.type===O.RTP&&w(o.data)===t){if(i.push(o.data),v(o.data)&&(r=C(o.data)),b(o.data)&&i.length>0){let t=n(i);const s=k(r);(s.width>0&&t.size.width!==s.width||s.height>0&&t.size.height!==s.height)&&(e("updated resolution from rtp header: %o",s),n=_e(s.width,s.height),t=n(i)),this.push({timestamp:S(o.data),ntpTimestamp:o.ntpTimestamp,payloadType:w(o.data),data:t.data,framesize:t.size,type:O.JPEG}),i=[]}a()}else a(void 0,o)}}))}}var Ee=r(764).Buffer;function Te(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class xe extends h{constructor(e=225e6){const t=new o.Transform({objectMode:!0,transform:(e,t,r)=>{e.type===O.SDP?this._active&&(this._capture=!0):this._capture&&e.type===O.ISOM&&(this._bufferOffset<this._buffer.byteLength-e.data.byteLength?(e.data.copy(this._buffer,this._bufferOffset),this._bufferOffset+=e.data.byteLength):this.stop()),r(void 0,e)}});t.on("finish",(()=>{this.stop()})),super(t),Te(this,"_active",void 0),Te(this,"_capture",void 0),Te(this,"_captureCallback",void 0),Te(this,"_bufferOffset",void 0),Te(this,"_bufferSize",void 0),Te(this,"_buffer",void 0),this._buffer=Ee.allocUnsafe(0),this._bufferSize=e,this._bufferOffset=0,this._active=!1,this._capture=!1,this._captureCallback=()=>{}}start(e){this._active||(H()("msl:capture:start")(e),this._captureCallback=e,this._buffer=Ee.allocUnsafe(this._bufferSize),this._bufferOffset=0,this._active=!0)}stop(){if(this._active){H()("msl:capture:stop")(`captured bytes: ${this._bufferOffset}`);try{this._captureCallback(this._buffer.slice(0,this._bufferOffset))}catch(e){console.error(e)}this._buffer=Ee.allocUnsafe(0),this._bufferOffset=0,this._active=!1,this._capture=!1}}}var Ce=r(764).Buffer;function Pe(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}new Set(["moov"]);const ke=Math.pow(2,32);class Re{constructor(e){Pe(this,"byteLength",void 0),Pe(this,"value",void 0),this.byteLength=e}}class Oe extends Re{constructor(e=0){super(e),Pe(this,"copy",((e,t)=>{e.fill(0,t,t+this.byteLength)}))}load(){}}class Be extends Re{constructor(e){super(e.length),Pe(this,"value",void 0),Pe(this,"copy",((e,t)=>{for(let r=0;r<this.byteLength;r+=1)e[t+r]=this.value.charCodeAt(r)})),Pe(this,"load",((e,t)=>{this.value=e.slice(t,t+this.byteLength).toString("ascii")})),this.value=e}}class Ie extends Re{constructor(e=0){super(1),Pe(this,"value",void 0),Pe(this,"copy",((e,t)=>{e.writeUInt8(this.value,t)})),Pe(this,"load",((e,t)=>{this.value=e.readUInt8(t)})),this.value=e}}class je extends Re{constructor(e){super(e.length),Pe(this,"value",void 0),Pe(this,"copy",((e,t)=>{for(let r=0;r<this.value.length;++r)e.writeUInt8(this.value[r],t+r)})),Pe(this,"load",((e,t)=>{for(let r=0;r<this.value.length;++r)this.value[r]=e.readUInt8(t+r)})),this.value=e}}class Le extends Re{constructor(e=0){super(2),Pe(this,"value",void 0),Pe(this,"copy",((e,t)=>{e.writeUInt16BE(this.value,t)})),Pe(this,"load",((e,t)=>{this.value=e.readUInt16BE(t)})),this.value=e}}class Ae extends Re{constructor(e=0){super(3),Pe(this,"value",void 0),Pe(this,"copy",((e,t)=>{e.writeUInt8(this.value>>16&255,t),e.writeUInt8(this.value>>8&255,t+1),e.writeUInt8(255&this.value,t+2)})),Pe(this,"load",((e,t)=>{this.value=e.readUInt8(t)<<16+e.readUInt8(t+1)<<8+e.readUInt8(t+2)})),this.value=e}}class Me extends Re{constructor(e=0){super(4),Pe(this,"value",void 0),Pe(this,"copy",((e,t)=>{e.writeUInt32BE(this.value,t)})),Pe(this,"load",((e,t)=>{this.value=e.readUInt32BE(t)})),this.value=e}}class Ue extends Re{constructor(e){super(4*e.length),Pe(this,"value",void 0),Pe(this,"copy",((e,t)=>{for(let r=0;r<this.value.length;++r)e.writeUInt32BE(this.value[r],t+4*r)})),Pe(this,"load",((e,t)=>{for(let r=0;r<this.value.length;++r)this.value[r]=e.readUInt32BE(t+4*r)})),this.value=e}}const De=function(e=0){return class extends Re{constructor(t){super(0),Pe(this,"value",void 0),Pe(this,"copy",((e,t)=>{let r=0;for(const n of this.value)n.copy(e,t+r),r+=n.byteLength})),Pe(this,"load",(()=>{})),this.value=t.reduce(((e,t)=>e.concat(new Le(t.length),new je(t))),[new Ie(e|t.length)]),this.byteLength=this.value.reduce(((e,t)=>e+t.byteLength),0)}}},Ne={ftyp:{container:"file",mandatory:!0,quantity:"one",box:"Box",is_container:!0,body:[["major_brand",Be,"isom"],["minor_version",Me,0],["compatible_brands",Be,"mp41"]]},moov:{container:"file",mandatory:!0,quantity:"one",box:"Box",is_container:!0},mdat:{container:"file",mandatory:!1,quantity:"any",box:"Box",is_container:!1,body:[]},mvhd:{container:"moov",mandatory:!0,quantity:"one",box:"FullBox",is_container:!1,body:[["creation_time",Me,0],["modification_time",Me,0],["timescale",Me,1e3],["duration",Me,4294967295],["rate",Me,65536],["volume",Le,256],["reserved",Oe,10],["matrix",Ue,[65536,0,0,0,65536,0,0,0,1073741824]],["pre_defined",Oe,24],["next_track_ID",Me,4294967295]]},trak:{container:"moov",mandatory:!0,quantity:"one+",box:"Box",is_container:!0},tkhd:{container:"trak",mandatory:!0,quantity:"one",box:"FullBox",is_container:!1,config:{flags:3},body:[["creation_time",Me,0],["modification_time",Me,0],["track_ID",Me,1],["reserved",Oe,4],["duration",Me,0],["reserved2",Oe,8],["layer",Le,0],["alternate_group",Le,0],["volume",Le,256],["reserved3",Oe,2],["matrix",Ue,[65536,0,0,0,65536,0,0,0,1073741824]],["width",Me,0],["height",Me,0]]},tref:{container:"trak",mandatory:!1,quantity:"one-",box:"Box",is_container:!1},mdia:{container:"trak",mandatory:!1,quantity:"one",box:"Box",is_container:!0},mdhd:{container:"mdia",mandatory:!1,quantity:"one",box:"FullBox",is_container:!1,body:[["creation_time",Me,0],["modification_time",Me,0],["timescale",Me,1e3],["duration",Me,4294967295],["language",Le,0],["pre_defined",Le,0]]},hdlr:{container:"mdia",mandatory:!0,quantity:"one",box:"FullBox",is_container:!1,body:[["predefined",Me,0],["handler_type",Be,"vide"],["reserved",Oe,12],["name",Be,"VideoHandler\0"]]},minf:{container:"mdia",mandatory:!0,quantity:"one",box:"Box",is_container:!0},vmhd:{container:"minf",mandatory:!0,quantity:"one",box:"FullBox",is_container:!1,config:{flags:1},body:[["graphicsmode",Le,0],["opcolor",class extends Re{constructor(e){super(2*e.length),Pe(this,"value",void 0),Pe(this,"copy",((e,t)=>{for(let r=0;r<this.value.length;++r)e.writeUInt16BE(this.value[r],t+2*r)})),Pe(this,"load",((e,t)=>{for(let r=0;r<this.value.length;++r)this.value[r]=e.readUInt16BE(t+2*r)})),this.value=e}},[0,0,0]]]},smhd:{container:"minf",mandatory:!0,quantity:"one",box:"FullBox",is_container:!1,body:[["balance",Le,0],["reserved",Le]]},dinf:{container:"minf",mandatory:!0,quantity:"one",box:"Box",is_container:!0},dref:{container:"dinf",mandatory:!0,quantity:"one",box:"FullBox",is_container:!0,body:[["entry_count",Me,0]]},"url ":{container:"dref",mandatory:!0,quantity:"one+",box:"FullBox",is_container:!1,config:{flags:1},body:[]},stbl:{container:"minf",mandatory:!0,quantity:"one",box:"Box",is_container:!0},stts:{container:"stbl",mandatory:!0,quantity:"one",box:"FullBox",is_container:!1,body:[["entry_count",Me,0]]},stsd:{container:"stbl",mandatory:!0,quantity:"one",box:"FullBox",is_container:!0,body:[["entry_count",Me,1]]},avc1:{container:"stsd",mandatory:!1,quantity:"one",box:"Box",is_container:!0,body:[["reserved",Oe,6],["data_reference_index",Le,1],["pre_defined",Le,0],["reserved2",Oe,2],["pre_defined2",Ue,[0,0,0]],["width",Le,1920],["height",Le,1080],["horizresolution",Me,4718592],["vertresolution",Me,4718592],["reserved3",Me,0],["frame_count",Le,1],["compressorname",je,Ce.alloc(32)],["depth",Le,24],["pre_defined3",Le,65535]]},avcC:{container:"avc1",mandatory:!1,quantity:"one",box:"Box",is_container:!1,body:[["configurationVersion",Ie,1],["AVCProfileIndication",Ie,77],["profile_compatibility",Ie,0],["AVCLevelIndication",Ie,41],["lengthSizeMinusOne",Ie,255],["sequenceParameterSets",De(224),[]],["pictureParameterSets",De(),[]]]},mp4a:{container:"stsd",mandatory:!1,quantity:"one",box:"Box",is_container:!0,body:[["reserved",Oe,6],["data_reference_index",Le,1],["reserved2",Ue,[0,0]],["channelcount",Le,2],["samplesize",Le,16],["pre_defined",Le,0],["reserved3",Le,0],["samplerate",Me,0]]},esds:{container:"mp4a",mandatory:!1,quantity:"one",box:"FullBox",is_container:!1,body:[["ES_DescrTag",Ie,3],["ES_DescrLength",Ie,25],["ES_ID",Le,1],["flagsAndStreamPriority",Ie,0],["DecoderConfigDescrTag",Ie,4],["DecoderConfigDescrLength",Ie,17],["objectProfileIndication",Ie,64],["streamTypeUpstreamReserved",Ie,21],["bufferSizeDB",je,[0,0,0]],["maxBitRate",Me,0],["avgBitRate",Me,0],["DecSpecificInfoShortTag",Ie,5],["DecSpecificInfoShortLength",Ie,2],["audioConfigBytes",Le,0],["SLConfigDescrTag",Ie,6],["SLConfigDescrLength",Ie,1],["SLConfigDescrPredefined",Ie,2]]},stsz:{container:"stbl",mandatory:!0,quantity:"one",box:"FullBox",is_container:!1,body:[["sample_size",Me,0],["sample_count",Me,0]]},stsc:{container:"stbl",mandatory:!0,quantity:"one",box:"FullBox",is_container:!1,body:[["entry_count",Me,0]]},stco:{container:"stbl",mandatory:!0,quantity:"one",box:"FullBox",is_container:!1,body:[["entry_count",Me,0]]},stss:{container:"stbl",mandatory:!1,quantity:"one-",box:"FullBox",is_container:!1,body:[["entry_count",Me,0]]},edts:{container:"trak",mandatory:!1,quantity:"one-",box:"Box",is_container:!0},elst:{container:"edts",mandatory:!1,quantity:"one-",box:"FullBox",is_container:!1,body:[["entry_count",Me,1],["segment_duration",Me,0],["media_time",Me,4294967295],["media_rate_integer",Le,1],["media_rate_fraction",Le,0]]},mvex:{container:"moov",mandatory:!1,quantity:"one-",box:"Box",is_container:!0},mehd:{container:"mvex",mandatory:!1,quantity:"one-",box:"FullBox",is_container:!1,body:[["fragment_duration",Me,0]]},trex:{container:"mvex",mandatory:!0,quantity:"one+",box:"FullBox",is_container:!1,body:[["track_ID",Me,1],["default_sample_description_index",Me,1],["default_sample_duration",Me,0],["default_sample_size",Me,0],["default_sample_flags",Me,0]]},moof:{container:"file",mandatory:!1,quantity:"zero+",box:"Box",is_container:!1},mfhd:{container:"moof",mandatory:!0,quantity:"one",box:"FullBox",is_container:!1,body:[["sequence_number",Me,0]]},traf:{container:"moof",mandatory:!1,quantity:"zero+",box:"Box",is_container:!0},tfhd:{container:"traf",mandatory:!0,quantity:"one",box:"FullBox",is_container:!1,config:{flags:32},body:[["track_ID",Me,1],["default_sample_flags",Me,0]]},tfdt:{container:"traf",mandatory:!1,quantity:"one-",box:"FullBox",is_container:!1,config:{version:1},body:[["baseMediaDecodeTime",class extends Re{constructor(e=0){super(8),Pe(this,"value",void 0),Pe(this,"copy",((e,t)=>{const r=this.value/ke|0,n=this.value-r*ke;e.writeUInt32BE(r,t),e.writeUInt32BE(n,t+4)})),Pe(this,"load",((e,t)=>{const r=e.readUInt32BE(t),n=e.readUInt32BE(t+4);this.value=r*ke+n})),this.value=e}},0]]},trun:{container:"traf",mandatory:!1,quantity:"zero+",box:"FullBox",is_container:!1,config:{flags:773},body:[["sample_count",Me,1],["data_offset",Me,0],["first_sample_flags",Me,0],["sample_duration",Me,0],["sample_size",Me,0]]},"....":{box:"Box",is_container:!1,body:[]},file:{box:"None",is_container:!0,mandatory:!0,quantity:"one"}};class Fe{static None(){return[]}static Box(e){return[["size",Me,0],["type",Be,e]]}static FullBox(e){return[].concat(this.Box(e),[["version",Ie,0],["flags",Ae,0]])}}class qe extends Re{constructor(e,t){super(0),Pe(this,"type",void 0),Pe(this,"config",void 0),Pe(this,"struct",void 0),this.type=e;const r=Ne[this.type];if(void 0===r)throw new Error(`unknown box type: ${e}`);this.config=Object.assign({},r.config,t);const n=Fe[r.box](this.type),i=r.body||[];this.struct=new Map;let o=0;for(const[e,t,r]of[].concat(n,i)){if(this.has(e))throw new Error("Trying to add existing key");let n=r;this.config[e]&&(n=this.config[e]);const i=new t(n);this.struct.set(e,{offset:o,element:i}),o+=i.byteLength}this.byteLength=o}element(e){const t=this.struct.get(e);if(void 0===t)throw new Error("invalid key");return t.element}set(e,t){this.element(e).value=t}get(e){return this.element(e).value}offset(e){const t=this.struct.get(e);if(void 0===t)throw new Error("invalid key");return t.offset}has(e){return this.struct.has(e)}add(e,t){if(this.has(e))throw new Error("Trying to add existing key");return this.struct.set(e,{offset:this.byteLength,element:t}),this.byteLength+=t.byteLength,this}buffer(){const e=Ce.allocUnsafe(this.byteLength);return this.copy(e),e}copy(e,t=0){this.set("size",this.byteLength);for(const r of this.struct.values())r.element.copy(e,t+r.offset)}load(e,t=0){for(const r of this.struct.values())void 0!==r.element.load&&r.element.load(e,t+r.offset)}format(e=0){const t=[" ".repeat(e)+`[${this.type}] (${this.byteLength})`];for(const[r,n]of this.struct){const i=n.element;void 0!==i.format?t.push(i.format(e+2)):t.push(" ".repeat(e+2)+`${r} = ${i.value} (${i.byteLength})`)}return t.join("\n")}print(e){console.warn(this.format(e))}}class He extends qe{constructor(e,t,...r){super(e,t),Pe(this,"boxSize",void 0),this.boxSize=0,this.append(...r)}append(...e){for(const t of e)this.add("box_"+this.boxSize++,t);return this}parse(e){const t=[];for(;e.byteLength>0;){const r=new Be("....");r.load(e,4);const n=r.value,i=Ne[n];let o;if(void 0!==i){if(i.is_container){o=new He(n),o.load(e);const r=o.parse(e.slice(o.byteLength,o.get("size")));t.push(...r)}else if(o=new qe(n),o.load(e),"avcC"===n){const e=o.element("AVCProfileIndication").value.toString(16).padStart(2,0),r=o.element("profile_compatibility").value.toString(16).padStart(2,0),n=o.element("AVCLevelIndication").value.toString(16).padStart(2,0);t.push({type:"video",mime:`avc1.${e}${r}${n}`})}else if("esds"===n){const e=o.element("audioConfigBytes").value>>>11&31;t.push({type:"audio",mime:`mp4a.40.${e}`})}}else o=new qe("...."),o.load(e),o.type=o.get("type");this.append(o),e=e.slice(o.get("size"))}return t}}const $e={1:"AAC Main",2:"AAC LC"},ze={0:"96 kHz",1:"88.2 kHz",2:"64 kHz",3:"48 kHz",4:"44.1 kHz",5:"32 kHz",6:"24 kHz",7:"22.05 kHz",8:"16 kHz",9:"12 kHz",10:"11.025 kHz",11:"8 kHz",12:"7.35 kHz"},We={1:"Mono",2:"Stereo"},Ve=e=>{const t=e>>>11&31,r=e>>>3&15;return{coding:$e[t]||`AAC (${t})`,samplingRate:ze[e>>>7&15]||"unknown",channels:We[r]||r.toString()}};function Ge(e,t){const r=e.replace(/[^A-Za-z0-9+/]/g,""),n=r.length,i=t?Math.ceil((3*n+1>>2)/t)*t:3*n+1>>2,o=new Uint8Array(i);let s,a,u=0,c=0;for(let e=0;e<n;e++)if(a=3&e,u|=((l=r.charCodeAt(e))>64&&l<91?l-65:l>96&&l<123?l-71:l>47&&l<58?l+4:43===l?62:47===l?63:0)<<18-6*a,3===a||n-e==1){for(s=0;s<3&&c<i;s++,c++)o[c]=u>>>(16>>>s&24)&255;u=0}var l;return o}function Ye(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Je{constructor(e){Ye(this,"_buffer",void 0),Ye(this,"_dataView",void 0),Ye(this,"_offset",void 0),Ye(this,"_bitpos",void 0),Ye(this,"_byte",void 0),this._buffer=e,this._dataView=new DataView(this._buffer),this._offset=0,this._bitpos=0,this._byte=0}readUint8(e){return this._dataView.getUint8(e)}readUint16(e){return this._dataView.getUint16(e)}readUint32(e){return this._dataView.getUint32(e)}readNext(){const e=this.readUint8(this._offset);return this._offset+=1,e}readBits(e){if(e>32||0===e)throw new Error("length has to be between 0 - 31 bits");let t=0;for(let r=1;r<=e;++r)0===this._bitpos&&(this._byte=this.readNext()),t=t<<1|this._byte>>8-++this._bitpos&1,this._bitpos%=8;return t}readUnsignedExpGolomb(){let e=0;for(;1!==this.readBits(1);)e++;if(0===e)return 0;if(e>=31)throw new Error("read unsigned exponential Golomb: internal error");let t=this.readBits(e);return t|=1<<e,t-1}readSignedExpGolomb(){let e=this.readUnsignedExpGolomb();return e=1&e?e+1>>1:-(e>>1),e}size(){return this._buffer.byteLength}getUint8Array(){return new Uint8Array(this._buffer)}getArrayBuffer(){return this._buffer}}class Ke{constructor(e){var t,r,n;t=this,n=void 0,(r=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(r="reader"))in t?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n,this.reader=new Je(e)}parse(){this.reader.readNext();const e=this.reader.readNext();this.reader.readNext();const t=this.reader.readNext();if(this.reader.readUnsignedExpGolomb(),[100,110,122,244,44,83,86,118].indexOf(e)>=0){const e=this.reader.readUnsignedExpGolomb();if(3===e&&this.reader.readBits(1),this.reader.readUnsignedExpGolomb(),this.reader.readUnsignedExpGolomb(),this.reader.readBits(1),this.reader.readBits(1))for(let t=0;t<(3!==e?8:12);t++)this.reader.readBits(1)}this.reader.readUnsignedExpGolomb();const r=this.reader.readUnsignedExpGolomb();if(0===r)this.reader.readUnsignedExpGolomb();else if(1===r){let e=0;this.reader.readBits(1),this.reader.readSignedExpGolomb(),this.reader.readSignedExpGolomb(),e=this.reader.readUnsignedExpGolomb();for(let t=0;t<e;t++)this.reader.readSignedExpGolomb()}this.reader.readUnsignedExpGolomb(),this.reader.readBits(1);const n=this.reader.readUnsignedExpGolomb(),i=this.reader.readUnsignedExpGolomb(),o=this.reader.readBits(1);this.reader.readBits(1);const s=this.reader.readBits(1);return{profile:e,level:t/10,width:16*(n+1)-2*(s?this.reader.readUnsignedExpGolomb():0)-2*(s?this.reader.readUnsignedExpGolomb():0),height:(2-o)*(i+1)*16-2*(s?this.reader.readUnsignedExpGolomb():0)-2*(s?this.reader.readUnsignedExpGolomb():0)}}}const Xe={66:"Baseline",77:"Main",100:"High"},Ze=e=>{const t=parseInt(e.substr(0,2),16),r=parseInt(e.substr(4,2),16);return{coding:"H.264",profile:Xe[t]||t.toString(),level:(r/10).toFixed(1)}};function Qe(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const et={"MPEG4-GENERIC":(e,t,r)=>{const n=Number(e.fmtp.parameters.bitrate)||32e4,i=parseInt(e.fmtp.parameters.config,16),o=i>>>11&31;return{tkhd:{track_ID:r,creation_time:t,modification_time:t,width:0,height:0,volume:1},mdhd:{timescale:Number(e.rtpmap.clockrate),creation_time:t,modification_time:t,duration:0},hdlr:{handler_type:"soun",name:"SoundHandler\0"},mediaHeaderBox:new qe("smhd"),sampleEntryBox:new He("mp4a",{samplerate:e.rtpmap.clockrate<<16>>>0},new qe("esds",{audioConfigBytes:i,maxBitRate:n,avgBitRate:n})),defaultFrameDuration:1024,mime:`mp4a.40.${o}`,codec:Ve(i)}},H264:(e,t,r)=>{e.fmtp||(H()("adding dummy fmtp block"),e.fmtp={format:"35",parameters:{"packetization-mode":1,"profile-level-id":"4d402a","sprop-parameter-sets":"Z01AKo2NYDwBE/LgLcBDQECA,aO44gA=="}});const n=e.fmtp.parameters["profile-level-id"],i=e.fmtp.parameters["sprop-parameter-sets"].split(",").map(Ge),o=i.slice(0,1),s=i.slice(1),a=new Ke(o[0].buffer).parse();return{mediaHeaderBox:new qe("vmhd"),sampleEntryBox:new He("avc1",{width:a.width,height:a.height},new qe("avcC",{AVCProfileIndication:o[0][1],profile_compatibility:o[0][2],AVCLevelIndication:o[0][3],sequenceParameterSets:o,pictureParameterSets:s})),tkhd:{track_ID:r,creation_time:t,modification_time:t,width:a.width<<16,height:a.height<<16,volume:0},hdlr:{},mdhd:{timescale:e.rtpmap.clockrate,creation_time:t,modification_time:t,duration:0},defaultFrameDuration:void 0!==e.framerate&&e.framerate>0&&Number(e.rtpmap.clockrate)/Number(e.framerate)||3600,mime:`avc1.${n}`,codec:Ze(n)}}};class tt{constructor(){Qe(this,"trackIdMap",void 0),Qe(this,"sequenceNumber",void 0),Qe(this,"ntpPresentationTime",void 0),Qe(this,"trackData",void 0),Qe(this,"videoTrackId",void 0),this.trackIdMap={},this.sequenceNumber=0,this.ntpPresentationTime=0,this.trackData=[]}trak(e){const t=new He("trak"),r=new He("mdia"),n=new He("minf"),i=new He("dinf"),o=new He("dref"),s=new He("stbl");return o.set("entry_count",1),t.append(new qe("tkhd",e.tkhd),r.append(new qe("mdhd",e.mdhd),new qe("hdlr",e.hdlr),n.append(e.mediaHeaderBox,i.append(o.append(new qe("url "))),s.append(new He("stsd",void 0,e.sampleEntryBox),new qe("stts"),new qe("stsc"),new qe("stco"),new qe("stsz"),new qe("stss"))))),t}moov(e,t){const r=new He("moov");r.append(new qe("mvhd",{creation_time:t,modification_time:t,duration:0}));const n=new He("mvex");this.trackIdMap={},this.sequenceNumber=0,this.ntpPresentationTime=0;let i=0;return this.trackData=[],e.media?.forEach((e=>{if(void 0===e.rtpmap)return;const o=e.rtpmap.payloadType,s=e.rtpmap.encodingName;if(void 0!==et[s]){this.trackIdMap[o]=++i,"video"===e.type.toLowerCase()&&(this.videoTrackId=i);const a=et[s](e,t,i);e.mime=a.mime,e.codec=a.codec;const u={lastTimestamp:0,baseMediaDecodeTime:0,defaultFrameDuration:0,clockrate:0,bitrate:0,framerate:0,cumulativeByteLength:0,cumulativeDuration:0,cumulativeFrames:0};u.clockrate=e.rtpmap.clockrate,u.defaultFrameDuration=a.defaultFrameDuration,this.trackData.push(u);const c=this.trak(a);r.append(c),n.append(new qe("trex",{track_ID:i}))}})),r.append(n),r}moof(e){let t=H()("msl:boxbuilder:moof");const{trackId:r,timestamp:n,byteLength:i}=e,o=r-1,s=this.trackData[o];let a=0!==s.lastTimestamp?n-s.lastTimestamp|0:s.defaultFrameDuration;a<0&&(t("track duration < 0! using default frame duration (duration: %o, timestamp: %o, last timestamp: %o, trackdata: %o)",a,n,s.lastTimestamp,s),a=s.defaultFrameDuration),s.lastTimestamp=n,a<0&&(a=s.defaultFrameDuration);const u=new He("moof"),c=new He("traf"),l=new qe("trun",{sample_duration:a,sample_size:i,first_sample_flags:64});return u.append(new qe("mfhd",{sequence_number:this.sequenceNumber++}),c.append(new qe("tfhd",{track_ID:r}),new qe("tfdt",{baseMediaDecodeTime:s.baseMediaDecodeTime}),l)),s.baseMediaDecodeTime+=a,l.set("data_offset",u.byteLength+8),((e,{byteLength:t,duration:r})=>{if(e.cumulativeByteLength+=t,e.cumulativeDuration+=r,e.cumulativeFrames++,e.cumulativeDuration>=e.clockrate){const t=8*e.cumulativeByteLength,r=e.cumulativeFrames,n=e.cumulativeDuration/e.clockrate;e.bitrate=t/n,e.framerate=r/n,e.cumulativeByteLength=0,e.cumulativeDuration=0,e.cumulativeFrames=0}})(s,{byteLength:i,duration:a}),u}mdat(e){const t=new qe("mdat");return t.add("data",e),t}setPresentationTime(e,t){if(!this.ntpPresentationTime&&t&&e===this.videoTrackId){const r=e-1,n=this.trackData[r];this.ntpPresentationTime=t-n.baseMediaDecodeTime/n.clockrate*1e3}}}var rt=r(764).Buffer;function nt(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class it extends h{constructor(){const e=new tt,t=e=>{this.onSync&&this.onSync(e)},r=new o.Transform({objectMode:!0,transform:function(r,n,i){if(r.type===O.SDP){const t=Math.floor((new Date).getTime()/1e3+2082852e3),n=new qe("ftyp"),i=e.moov(r.sdp,t),o=rt.allocUnsafe(n.byteLength+i.byteLength);n.copy(o,0),i.copy(o,n.byteLength),H()("msl:mp4:isom")(`ftyp: ${n.format()}`),H()("msl:mp4:isom")(`moov: ${i.format()}`);const s=r.sdp.media?.map((e=>{var t=void 0===e.sendonly;return{type:e.type,encoding:e.rtpmap&&e.rtpmap.encodingName,mime:e.mime,codec:e.codec,isrecv:t}}));this.push({type:O.ISOM,data:o,tracks:s,ftyp:n,moov:i})}else if(r.type===O.ELEMENTARY||r.type===O.H264){const{payloadType:n,timestamp:i,ntpTimestamp:o}=r,s=e.trackIdMap[n];if(s){let n;e.ntpPresentationTime||(e.setPresentationTime(s,o),e.ntpPresentationTime&&t(e.ntpPresentationTime));const a=r.type===O.H264?r.nalType===V.IDR_PICTURE:void 0;if(e.ntpPresentationTime&&a&&void 0!==r.ntpTimestamp&&(n=(r.ntpTimestamp-e.ntpPresentationTime)/1e3),e.ntpPresentationTime){const t=r.data.byteLength,a=e.moof({trackId:s,timestamp:i,byteLength:t}),u=e.mdat(r.data),c=rt.allocUnsafe(a.byteLength+u.byteLength);a.copy(c,0),u.copy(c,a.byteLength),this.push({type:O.ISOM,data:c,moof:a,mdat:u,ntpTimestamp:o,checkpointTime:n})}}}else this.push(r);i()}});super(r),nt(this,"boxBuilder",void 0),nt(this,"onSync",void 0),this.boxBuilder=e}get bitrate(){return this.boxBuilder.trackData&&this.boxBuilder.trackData.map((e=>e.bitrate))}get framerate(){return this.boxBuilder.trackData&&this.boxBuilder.trackData.map((e=>e.framerate))}get ntpPresentationTime(){return this.boxBuilder.ntpPresentationTime}}const ot=e=>e[1];function st(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}H()("msl:mse");class at extends d{constructor(e){if(void 0===e)throw new Error("video element argument missing");let t,r;const n=new o.Writable({objectMode:!0,write:(i,o,s)=>{if(i.type===O.ISOM)if(this._done=s,void 0!==i.tracks){const o=i.tracks;let s=!1;if(o.map((e=>{"video"!==e.type||"H265"!==e.encoding||e.mime||(e.mime="hvc1",s=!0)})),s)return;if(t)try{t.endOfStream()}catch(e){}this._lastCheckpointTime=0,t=new MediaSource,e.src=window.URL.createObjectURL(t);const a=()=>{t.removeEventListener("sourceopen",a),this.onSourceOpen&&this.onSourceOpen(t,o);let s=o.map((e=>e.mime)).filter((e=>e)),u="avc1.640029, mp4a.40.2";"avc1.010101"===s.join(", ")||"avc1.010201"===s.join(", ")?u="avc1.4d4028":0!==s.length&&(u=s.join(", ")),r=this.addSourceBuffer(e,t,`video/mp4; codecs="${u}"`),r.onerror=e=>{console.error("error on SourceBuffer: ",e),n.emit("error")};try{r.appendBuffer(i.data),this.onDataCallback&&this.onDataCallback(i)}catch(e){console.error("failed to append to SourceBuffer: ",e,i)}};t.addEventListener("sourceopen",a)}else{this._lastCheckpointTime=void 0!==i.checkpointTime?i.checkpointTime:this._lastCheckpointTime;try{r.appendBuffer(i.data),this.onDataCallback&&this.onDataCallback(i)}catch(e){console.error("failed to append to SourceBuffer: ",e,i)}}else i.type===O.RTCP?(203===ot(i.data)&&"open"===t.readyState&&t.endOfStream(),s()):s()}});n.on("finish",(()=>{console.warn("incoming stream finished: end stream"),t&&"open"===t.readyState&&t.endOfStream()})),n.on("error",(()=>{console.error("error on incoming stream: end stream"),r.updating?r.addEventListener("updateend",(()=>{"open"===t.readyState&&t.endOfStream()})):"open"===t.readyState&&t.endOfStream()}));const i=new o.Readable({objectMode:!0,read:function(){}});i.on("error",(()=>{console.warn("outgoing stream broke somewhere")})),super(n,i),st(this,"_videoEl",void 0),st(this,"_done",void 0),st(this,"_lastCheckpointTime",void 0),st(this,"onDataCallback",void 0),st(this,"onSourceOpen",void 0),this._videoEl=e,this._lastCheckpointTime=0}addSourceBuffer(e,t,r){const n=t.addSourceBuffer(r);let i=0;return n.addEventListener("updateend",(()=>{if(++i,i>100&&n.buffered.length){i=0;const t=n.buffered.length-1,r=n.buffered.start(t),o=Math.min(e.currentTime,this._lastCheckpointTime)-10;try{if(o>r)return void n.remove(r,o)}catch(e){console.warn(e)}}this._done&&this._done()})),n}get currentTime(){return this._videoEl.currentTime}play(){return this._videoEl.play()}pause(){return this._videoEl.pause()}}var ut=r(764).Buffer;class ct extends h{constructor(e){let t,r=[];super(new o.Transform({objectMode:!0,transform:function(n,i,o){if(n.type===O.SDP){let e;if(n.sdp.media){for(const t of n.sdp.media)"application"===t.type&&t.rtpmap&&"VND.ONVIF.METADATA"===t.rtpmap.encodingName&&(e=t);e&&e.rtpmap&&(t=Number(e.rtpmap.payloadType))}o(void 0,n)}else if(n.type===O.RTP&&w(n.data)===t){if(r.push(R(n.data)),b(n.data)&&r.length>0){const t={timestamp:S(n.data),ntpTimestamp:n.ntpTimestamp,payloadType:w(n.data),data:ut.concat(r),type:O.XML};e?e(t):this.push(t),r=[]}o()}else o(void 0,n)}}))}}var lt=r(764).Buffer;const ht=e=>e.match(/^m=/),dt=(e,t)=>{const r=t.indexOf(e);return r<0?[t.slice(0)]:[t.slice(0,r),t.slice(r+1)]},ft={fmtp:e=>{const[t,r]=dt(" ",e);{const e=r.trim().split(";"),n={};return e.forEach((e=>{const[t,r]=dt("=",e),i=t.trim().toLowerCase();""!==i&&(n[i]=r.trim())})),{format:t,parameters:n}}},framerate:Number,rtpmap:e=>{const[t,r]=dt(" ",e),[n,i,o]=r.toUpperCase().split("/");return void 0===o?{payloadType:Number(t),encodingName:n,clockrate:Number(i)}:{payloadType:Number(t),encodingName:n,clockrate:Number(i),encodingParameters:o}},transform:e=>e.split(";").map((e=>e.split(",").map(Number))),framesize:e=>e.split(" ")[1].split("-").map(Number)},pt=e=>{const t=e.slice(0,1),r=e.slice(2);switch(t){case"v":return{version:r};case"o":const[e,t,n,i,o,s]=r.split(" ");return{origin:{addrType:o,netType:i,sessionId:t,sessionVersion:n,unicastAddress:s,username:e}};case"s":return{sessionName:r};case"i":return{sessionInformation:r};case"u":return{uri:r};case"e":return{email:r};case"p":return{phone:r};case"c":const[a,u,c]=r.split(" ");return{connectionData:{addrType:u,connectionAddress:c,netType:a}};case"b":const[l,h]=r.split(":");return{bwtype:l,bandwidth:h};case"t":const[d,f]=r.split(" ").map(Number);return{time:{startTime:d,stopTime:f}};case"r":const[p,m,...y]=r.split(" ").map(Number);return{repeatTimes:{repeatInterval:p,activeDuration:m,offsets:y}};case"z":case"k":return;case"a":return(e=>{const[t,r]=dt(":",e);return void 0===r?{[t]:!0}:void 0!==ft[t]?{[t]:ft[t](r)}:{[t]:r}})(r);case"m":const[v,g,b,w]=r.split(" ");return{type:v,port:Number(g),protocol:b,fmt:Number(w)}}},mt=e=>{const t=e.indexOf("\nm=");return((e,t,r=0)=>{const n=`\n${"a=control:"}`;r=e.indexOf(n,r);let i=0;const o=[];for(;r>=0;)i=e.indexOf("\n",r+n.length),o.push(e.toString("ascii",r+n.length,i).trim()),r=e.indexOf(n,i);return o})(e,0,t)},yt=e=>{const t=e.toString("ascii").split("\n").map((e=>e.trim())),r={session:{},media:[]};let n=0,i=r.session;for(const e of t)ht(e)&&(r.media[n]={},i=r.media[n],++n),i=Object.assign(i,pt(e));return r},vt=e=>({type:O.SDP,data:e,sdp:yt(e)}),gt=(e,t)=>{const r=`\n${t.toLowerCase()}: `,n=e.toString().toLowerCase().indexOf(r);if(n>=0){const t=e.indexOf("\n",n+r.length);return e.toString("ascii",n+r.length,t).trim()}return null},bt=e=>{const t=gt(e,"CSeq");return null!==t?Number(t):null},wt=e=>{const t=gt(e,"Session");return t?t.split(";")[0]:null},_t=e=>{const t=gt(e,"Session");if(null===t)return null;const r=t.toLowerCase().indexOf("timeout=");if(-1!==r){let e=t.substring(r+8);e=e.split(";")[0];const n=parseInt(e);return isNaN(n)?null:n}return null},St=e=>Number(e.toString("ascii",9,12)),Et=e=>gt(e,"Content-Base"),Tt=e=>{const t=gt(e,"Connection");return null!==t&&"close"===t.toLowerCase()},xt=e=>{const t=gt(e,"Range");if(null!==t)return t.split("=")[1].split("-")},Ct=e=>{const t=["\n\n","\r\r","\r\n\r\n"].map((t=>{const r=e.indexOf(t);return-1!==r?r+t.length:r})).filter((e=>-1!==e));return t.length>0?t.reduce(((e,t)=>Math.min(e,t))):-1};var Pt=r(764).Buffer;function kt(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Rt=function(e){return e[e.IDLE=0]="IDLE",e[e.INTERLEAVED=1]="INTERLEAVED",e[e.RTSP=2]="RTSP",e}(Rt||{});class Ot{constructor(){kt(this,"_chunks",[]),kt(this,"_length",0),kt(this,"_state",Rt.IDLE),kt(this,"_packet",void 0),this._init()}_init(){this._chunks=[],this._length=0,this._state=Rt.IDLE}_push(e){this._chunks.push(e),this._length+=e.length}_parseRtsp(){const e=[],t=Pt.concat(this._chunks),r=Ct(t);if(-1===r)return e;const n=r,i=gt(t,"Content-Length");if(i&&parseInt(i)>t.length-n)return e;if(this._init(),n===t.length||36===t[n]){const r=t.slice(0,n);e.push({type:O.RTSP,data:r});const i=t.slice(n);this._push(i)}else{const r=t,i=t.slice(n);e.push({type:O.RTSP,data:r}),e.push(vt(i))}return e}_parseInterleaved(){const e=[];if(this._length<4)return e;if(this._packet||(this._packet=(e=>{const t=Pt.alloc(4);let r=0,n=0;for(;n<t.length;){const i=e[r++],o=Math.min(i.length,t.length-n);i.copy(t,n,0,o),n+=o}const i=t[1],o=t.length;return{channel:i,begin:o,end:o+t.readUInt16BE(2)}})(this._chunks)),this._length<this._packet.end)return e;const t=Pt.concat(this._chunks),r=t.slice(this._packet.begin,this._packet.end),n=t.slice(0,this._packet.begin),i=t.slice(this._packet.end),o=this._packet.channel;if(delete this._packet,this._init(),this._push(i),o%2==0)e.push({type:O.RTP,data:r,header:n,channel:o});else{let t=r;do{const r=4*t.readUInt16BE(2)+4;var s=t.slice(0,r);e.push({type:O.RTCP,data:s,header:n,channel:o}),t=t.slice(r)}while(t.length>0)}return e}_setState(){for(;this._chunks.length>0&&0===this._chunks[0].length;)this._chunks.shift();const e=this._chunks[0];if(0===this._chunks.length)this._state=Rt.IDLE;else if(36===e[0])this._state=Rt.INTERLEAVED;else{if("RTSP"!==e.toString("ascii",0,4))throw new Error(`Unknown chunk of length ${e.length}`);this._state=Rt.RTSP}}parse(e){this._push(e),this._state===Rt.IDLE&&this._setState();let t=[],r=!1;for(;!r;){let e=[];switch(this._state){case Rt.IDLE:break;case Rt.INTERLEAVED:e=this._parseInterleaved();break;case Rt.RTSP:e=this._parseRtsp();break;default:throw new Error("internal error: unknown state")}e.length>0?t=t.concat(e):r=!0,this._setState()}return t}}class Bt extends h{constructor(){const e=new Ot,t=new o.Transform({objectMode:!0,transform:function(r,n,i){if(r.type===O.RAW)try{e.parse(r.data).forEach((e=>t.push(e))),i()}catch(e){i(e)}else i(void 0,r)}}),r=new o.Transform({objectMode:!0,transform:function(e,t,r){if(e.type===O.RTSP){const t=(e=>{if(!e.method||!e.uri)throw new Error("message needs to contain a method and a uri");const t=e.protocol||"RTSP/1.0",r=e.headers||{},n=[`${e.method} ${e.uri} ${t}`,Object.entries(r).map((([e,t])=>e+": "+t)).join("\r\n"),"\r\n"].join("\r\n");return H()("msl:rtsp:outgoing")(n),lt.from(n)})(e);r(void 0,{type:O.RAW,data:t})}else r(void 0,e)}});super(t,r)}}const It=(e,t)=>{let r;if(void 0!==t){if("object"!=typeof t)throw new Error("merge expects override to be an object!");r=Object.keys(t).reduce(((e,r)=>(void 0!==t[r]&&(e[r]=t[r]),e)),{})}return Object.assign({},e,r)},jt=Date.UTC(1900,0,1);function Lt(e,t){return jt+1e3*(e+t/4294967296)}var At=r(764).Buffer;function Mt(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ut(e){return/^[^:]+:\/\//.test(e)}var Dt=function(e){return e.IDLE="idle",e.PLAYING="playing",e.PAUSED="paused",e}(Dt||{});let Nt=function(e){return e.OPTIONS="OPTIONS",e.DESCRIBE="DESCRIBE",e.SETUP="SETUP",e.PLAY="PLAY",e.PAUSE="PAUSE",e.TEARDOWN="TEARDOWN",e}({});class Ft extends h{constructor(e={}){const{uri:t,headers:r,defaultHeaders:n}=It(((e=("undefined"==typeof window?"":window.location.hostname),t=[])=>({uri:t.length>0?`rtsp://${e}/media/media.amp?${t.join("&")}`:`rtsp://${e}/media/media.amp`}))(e.hostname,e.parameters),e),i=new o.Transform({objectMode:!0,transform:(e,t,r)=>{if(e.type===O.RTSP)this._onRtsp(e),r();else if(e.type===O.RTCP)this._onRtcp(e),r(void 0,e);else if(e.type===O.RTP)this._onRtp(e),r(void 0,e);else if(e.type===O.SDP){var n=[];if(e.sdp.media)for(var i=0;i<e.sdp.media.length;i++)if(e.sdp.media[i]&&e.sdp.media[i].recvonly&&!0===e.sdp.media[i].recvonly)n.push(e.sdp.media[i]);else if(e.sdp.media[i]){var o=e.sdp.media[i].control;!o||-1==o.indexOf("audioback")&&-1==o.indexOf("backchannel")||(this.audioback_chnl=2*i,this.audioback_control=o)}e&&e.sdp&&e.sdp.media&&delete e.sdp.media,e.sdp.media=n,this._onSdp(e),e.sdp.rawdata=e.data,this.onSdp&&this.onSdp(e.sdp),r(void 0,e)}else r(void 0,e)}});i.on("end",(()=>{this._outgoingClosed=!0})),super(i),Mt(this,"uri",void 0),Mt(this,"audioback_chnl",void 0),Mt(this,"audioback_control",void 0),Mt(this,"headers",void 0),Mt(this,"defaultHeaders",void 0),Mt(this,"t0",void 0),Mt(this,"n0",void 0),Mt(this,"clockrates",void 0),Mt(this,"startTime",void 0),Mt(this,"onSdp",void 0),Mt(this,"onError",void 0),Mt(this,"onPlay",void 0),Mt(this,"_outgoingClosed",void 0),Mt(this,"_sequence",void 0),Mt(this,"_retry",void 0),Mt(this,"_callStack",void 0),Mt(this,"_callHistory",void 0),Mt(this,"_state",void 0),Mt(this,"_waiting",void 0),Mt(this,"_contentBase",void 0),Mt(this,"_sessionId",void 0),Mt(this,"_renewSessionInterval",void 0),this._outgoingClosed=!1,this._reset(),this.update(t,r,n)}update(e,t={},r={}){if(void 0===e)throw new Error("You must supply an uri when creating a RtspSessionComponent");this.uri=e,this.defaultHeaders=r,this.headers=Object.assign({[Nt.OPTIONS]:{},[Nt.PLAY]:{},[Nt.SETUP]:{Blocksize:"64000"},[Nt.DESCRIBE]:{Accept:"application/sdp"},[Nt.PAUSE]:{}},t)}_reset(){this._sequence=1,this._retry=()=>console.error("No request sent, can't retry"),this._callStack=[],this._callHistory=[],this._state=Dt.IDLE,this._waiting=!1,this._contentBase=null,this._sessionId=null,null!==this._renewSessionInterval&&clearInterval(this._renewSessionInterval),this._renewSessionInterval=null,this.t0=void 0,this.n0=void 0,this.clockrates=void 0}_onRtsp(e){this._waiting=!1;const t=St(e.data),r=Tt(e.data),n=bt(e.data);if(null===n)throw new Error("rtsp: expected sequence number");if(void 0===this._callHistory)throw new Error("rtsp: internal error");const i=this._callHistory[n-1];if(H()("msl:rtsp:incoming")(`${e.data}`),!this._sessionId&&!r){this._sessionId=wt(e.data);const t=_t(e.data);null!==t&&(null!==this._renewSessionInterval&&clearInterval(this._renewSessionInterval),this._renewSessionInterval=setInterval((()=>{this._enqueue({method:Nt.OPTIONS}),this._dequeue()}),1e3*Math.max(5,t-5)))}this._contentBase||(this._contentBase=Et(e.data)),t>=400&&this.onError&&this.onError(new Error(e.data.toString("ascii"))),i===Nt.PLAY&&this.onPlay&&this.onPlay(xt(e.data)),r&&(H()("msl:rtsp:incoming")(`RTSP Session ${this._sessionId} ended with statusCode: ${t}`),this._sessionId=null),this._dequeue()}_onRtcp(e){if(void 0===this.t0||void 0===this.n0)throw new Error("rtsp: internal error");if(200===ot(e.data)){const t=e.channel-1;this.t0[t]=e.data.readUInt32BE(16),this.n0[t]=Lt((e=>e.readUInt32BE(8))(e.data),(e=>e.readUInt32BE(12))(e.data))}}_onRtp(e){if(void 0===this.t0||void 0===this.n0||void 0===this.clockrates)throw new Error("rtsp: internal error");const t=e.channel,r=this.t0[t],n=this.n0[t];if(void 0!==r&&void 0!==n){const i=this.clockrates[t],o=S(e.data)-r|0;e.ntpTimestamp=o/i*1e3+n}}_onSdp(e){if(this.n0={},this.t0={},this.clockrates={},e.sdp.media?.forEach(((e,t)=>{let r=e.control;void 0===e.rtpmap&&0==e.fmt&&(e.rtpmap={clockrate:8e3,encodingName:"PCMU",payloadType:0});var n=8e3;e&&e.rtpmap&&e.rtpmap.clockrate&&(n=e.rtpmap.clockrate);const i=2*t,o=i+1;void 0!==r&&(Ut(r)||(r=this._contentBase+r),-1!=r.indexOf("audioback")&&(this.audioback_chnl=i),this._enqueue({method:Nt.SETUP,headers:{Transport:"RTP/AVP/TCP;unicast;interleaved="+i+"-"+o},uri:r}),void 0!==this.clockrates&&(this.clockrates[i]=n))})),this.audioback_chnl){let e=this.audioback_control;console.log("audioback_chnl = ",this.audioback_chnl),Ut(e)||(e=this._contentBase+e),this._enqueue({method:Nt.SETUP,headers:{Transport:"RTP/AVP/TCP;unicast;interleaved="+this.audioback_chnl+"-"+(this.audioback_chnl+1)},uri:e})}this._state===Dt.PLAYING&&this._enqueue({method:Nt.PLAY,headers:{Range:`npt=${this.startTime||0}-`}}),this._dequeue()}play(e=0){if(this._state===Dt.IDLE)this.startTime=Number(e)||0,this._enqueue({method:Nt.OPTIONS}),this._enqueue({method:Nt.DESCRIBE});else if(this._state===Dt.PAUSED){if(null===this._sessionId||void 0===this._sessionId)throw new Error("rtsp: internal error");this._enqueue({method:Nt.PLAY,headers:{Session:this._sessionId}})}this._state=Dt.PLAYING,this._dequeue()}pause(){this._enqueue({method:Nt.PAUSE}),this._state=Dt.PAUSED,this._dequeue()}stop(){this._sessionId?this._enqueue({method:Nt.TEARDOWN}):this._callStack=[],this._state=Dt.IDLE,null!==this._renewSessionInterval&&(clearInterval(this._renewSessionInterval),this._renewSessionInterval=null),this._dequeue()}send(e){const{method:t,headers:r,uri:n}=e;if(void 0===t)throw new Error("missing method when send request");if(this._waiting=!0,this._retry=this.send.bind(this,e),void 0===this._sequence||void 0===this.headers||void 0===this._callHistory)throw new Error("rtsp: internal error");const i=Object.assign({type:O.RTSP,uri:n||this.uri,data:At.alloc(0)},{method:t,headers:r},{headers:Object.assign({CSeq:this._sequence++},this.defaultHeaders,this.headers[t],r)});this._sessionId&&(i.headers.Session=this._sessionId),this._callHistory.push(t),this._outgoingClosed?H()("msl:rtsp:outgoing")(`Unable to send ${t}, connection closed`):this.outgoing.push(i)}_enqueue(e){if(void 0===this._callStack)throw new Error("rtsp: internal error");this._callStack.push(e)}_dequeue(){if(void 0===this._callStack)throw new Error("rtsp: internal error");if(!this._waiting&&this._callStack.length>0){const e=this._callStack.shift();void 0!==e&&this.send(e)}}}function qt(e){return window.btoa(Array.from(e).map((function(e){return String.fromCharCode(e)})).join(""))}var Ht=r(764).Buffer;function $t(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}class zt extends h{constructor(){let e,t=H()("msl:sdpupdater"),r=!1,n=35,i=0,s=0,a=0;const u=new o.Transform({objectMode:!0,transform:function(o,c,l){if(o.type===O.SDP){e=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?$t(Object(r),!0).forEach((function(t){var n,i,o;n=e,i=t,o=r[t],(i=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(i))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$t(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},o.sdp);let r=e.media?e.media.find((function(e){return"video"===e.type})):null;r&&r.rtpmap&&(n=r.rtpmap.payloadType),t("SDP received: %o",e)}else if(o.type===O.SPS){const n=e.media?e.media.find((e=>"video"===e.type)):null;if(n){const i=n.fmtp.parameters["sprop-parameter-sets"].split(",")[0],s=qt(o.data);i!==s&&(n.fmtp.parameters["sprop-parameter-sets"]=n.fmtp.parameters["sprop-parameter-sets"].replace(/^.*,/,s+","),n.fmtp.parameters["profile-level-id"]=Ht.from(o.data.slice(1,4)).toString("hex"),t("new SPS received %o, forward as SDP %o: ",new Ke(o.data.buffer).parse(),e),r=!0)}}else if(o.type===O.PPS){const n=e.media?e.media.find((e=>"video"===e.type)):null;if(n){const i=n.fmtp.parameters["sprop-parameter-sets"].split(",")[1],s=qt(o.data);(i!==s||r)&&(r=!1,n.fmtp.parameters["sprop-parameter-sets"]=n.fmtp.parameters["sprop-parameter-sets"].replace(/,.*$/,","+s),t("new PPS received %o, forward as SDP %o: ",Ht.from(o.data).toString("hex"),e),u.push({type:O.SDP,sdp:e}))}}else if(o.type===O.SEI);else if(o.type===O.ELEMENTARY&&o.payloadType===n&&(0===s&&(s=o.ntpTimestamp||0),0===i&&(i=o.timestamp||0),s>0&&i>0)){let r=(o.ntpTimestamp||0)-s;(o.ntpTimestamp||0)>0&&(r=(o.ntpTimestamp||0)-s,s=o.ntpTimestamp||0);const n=o.timestamp-i;i=o.timestamp,0===a&&(a=n);const c=(n+a)/2;n<0&&t("negative rtp timestamp: %d (diff: %d, last: %d, avg: %d), ntp: %d (diff: %d)",o.timestamp,n,a,c,o.ntpTimestamp,r),n<-5*a||c>5*a?(t("rtp timestamp jump detected, resend SDP (diff: %d, avg: %d, last diff: %d)...",n,c,a),u.push({type:O.SDP,sdp:e}),a=0,i=0,s=0):a=c}l(void 0,o)}});super(u)}}var Wt=r(764).Buffer;function Vt(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Gt extends l{constructor(e){if(void 0===e)throw new Error("socket argument missing");const t=new o.Readable({objectMode:!0,read:function(){}});e.onmessage=r=>{const n=Wt.from(r.data);t.push({data:n,type:O.RAW})||e.readyState===WebSocket.OPEN&&(H()("msl:websocket:incoming")("downstream frozen"),e.close())},t.on("error",(t=>{console.warn("closing socket due to incoming error",t),e.close()}));const r=new o.Writable({objectMode:!0,write:function(t,r,n){try{e.send(t.data)}catch(e){console.warn("message lost during send:",t)}n()}});r.on("error",(e=>{console.warn("error during websocket send, ignoring:",e)})),r.on("finish",(()=>{H()("msl:websocket:outgoing")("finish"),e.readyState!==WebSocket.CLOSED&&e.close()})),e.onclose=e=>{H()("msl:websocket:close")(`${e.code}`),1001===e.code&&this.onServerClose&&this.onServerClose(),this.onSocketClose&&this.onSocketClose(e),t.push(null),r.end()},super(t,r),Vt(this,"onServerClose",void 0),Vt(this,"onSocketClose",void 0)}static open(e){return((e={})=>{const{uri:t,tokenUri:r,protocol:n,timeout:i}=It(((e=window.location.host,t=window.location.protocol)=>({uri:`${"https:"===t?"wss:":"ws:"}//${e}/rtsp-over-websocket`,tokenUri:`${t}//${e}/cgi/rtspwssession.cgi`,protocol:"binary",timeout:10007}))(e.host,e.scheme),e);if(void 0===t)throw new Error("ws: internal error");return new Promise(((e,r)=>{try{const o=new WebSocket(t,n),s=setTimeout((()=>{clearTimeout(s),o.readyState===WebSocket.CONNECTING&&(o.onerror=null,r(new Error("websocket connection timed out")))}),i);o.binaryType="arraybuffer",o.onerror=e=>{console.error(e)},o.onopen=()=>{clearTimeout(s),e(o)}}catch(e){r(e)}}))})(e).then((e=>new Gt(e)))}}function Yt(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Jt{constructor(e){Yt(this,"dbg",void 0),Yt(this,"cnv",void 0),Yt(this,"ctx",void 0),Yt(this,"frames",[]),Yt(this,"renderingInProgress",!1),Yt(this,"framecnt",0),Yt(this,"curFps",0),Yt(this,"deltaToNow",0),Yt(this,"isRunning",!1),this.dbg=H()("msl:renderer"),this.dbg("constructor, el: ",e),this.cnv=e,this.ctx=this.cnv.getContext("2d",{alpha:!1}),this.ctx.font="30px Arial",this.ctx.fillStyle="#ffffff",setInterval((()=>{this.curFps=this.framecnt,this.framecnt=0,this.dbg("fps: ",this.curFps)}),1e3)}processFrame(e){0!==e.timestamp&&(this.frames.push(e),this.frames.length>=4&&!this.isRunning&&(this.isRunning=!0,setTimeout((()=>{this.renderFrame()}),0)))}async renderFrame(){if(!this.renderingInProgress&&this.frames.length>0){this.renderingInProgress=!0;let e=this.getTimeToWait(this.frames[0].timestamp);for(;e<0&&this.frames.length>1;)this.dbg(`skip this frame (waittime: ${e}, timestamp: ${this.frames[0].timestamp}, framebuffer: ${this.frames.length})`),this.frames.shift().close(),e=this.getTimeToWait(this.frames[0].timestamp);e>=0&&(await this.sleep(e),this.dbg(`draw image (buffer: ${this.frames.length})`),this.ctx.drawImage(this.frames[0],0,0,this.cnv.width,this.cnv.height),this.ctx.fillText("FPS: "+this.curFps,10,30),this.framecnt++,this.frames.shift().close()),this.renderingInProgress=!1}this.isRunning&&setTimeout((()=>{this.renderFrame()}),0)}getTimeToWait(e){if(0===this.deltaToNow)return this.deltaToNow=e-performance.now(),this.dbg("deltaToNow: ",this.deltaToNow,e),0;{let t=e-this.deltaToNow,r=t-performance.now();return this.dbg(`wait: ${r}, timestamp: ${e}, now: ${performance.now()}, target: ${t}, frames: ${this.frames.length}`),r}}sleep(e){return new Promise((t=>{setTimeout(t,e)}))}}var Kt=r(764).Buffer;class Xt extends h{constructor(e){let t,r,n=H()("msl:decoder");e&&(r=new Jt(e));const i={output:e=>{r?r.processFrame(e):n("no canvas give, frame: ",e)},error:e=>{console.log("error: ",e)}};super(new o.Transform({objectMode:!0,transform:function(e,r,o){if(e.type===O.SDP){n("sdp: ",e);const r=e.sdp.media?e.sdp.media.find((e=>"video"===e.type&&void 0!==e.rtpmap&&"H264"===e.rtpmap.encodingName)):null;if(n("h264: ",r),r){const e="avc1."+r.fmtp.parameters["profile-level-id"],o=r.fmtp.parameters["sprop-parameter-sets"].split(",").map(Ge),s=o.slice(0,1),a=o.slice(1),u=new Ke(s[0].buffer).parse();n("sps: ",s),n("pps: ",a);let c=Kt.alloc(8);c.writeUInt8(1,0),c.writeUInt8(s[0][1],1),c.writeUInt8(s[0][2],2),c.writeUInt8(s[0][3],3),c.writeUInt8(255,4),c.writeUInt8(225,5),c.writeUInt16BE(s[0].length,6);let l=c.length+s[0].length+3;c=Kt.concat([c,Kt.from(s[0])],l),c.writeUInt8(1,c.length-3),c.writeUInt16BE(a[0].length,c.length-2),l=c.length+a[0].length,c=Kt.concat([c,Kt.from(a[0])],l),n("avcc: ",c);const h={codec:e,description:c,codedWidth:u.width,codedHeight:u.height};t=new window.VideoDecoder(i),t.configure(h),n(`videodecoder config: ${JSON.stringify(h)}, queue size: ${t.decodeQueueSize}`)}else{n("h264 media not found");const r=e.sdp.media?e.sdp.media.find((e=>"video"===e.type&&void 0!==e.rtpmap&&"H265"===e.rtpmap.encodingName)):null;if(r){n("h265: ",r);const e="hevc",o=Ge(r.fmtp.parameters["sprop-sps"],0),s=Ge(r.fmtp.parameters["sprop-pps"],0),a=new Ke(o.buffer).parse();n("sps: ",o),n("parsed: ",a),n("pps: ",s);let u=Kt.alloc(8);u.writeUInt8(1,0),u.writeUInt8(o[1],1),u.writeUInt8(o[2],2),u.writeUInt8(o[3],3),u.writeUInt8(255,4),u.writeUInt8(225,5),u.writeUInt16BE(o.length,6);let c=u.length+o.length+3;u=Kt.concat([u,Kt.from(o)],c),u.writeUInt8(1,u.length-3),u.writeUInt16BE(s.length,u.length-2),c=u.length+s.length,u=Kt.concat([u,Kt.from(s)],c),n("avcc: ",u);const l={codec:e,description:u,codedWidth:a.width,codedHeight:a.height};n("config: "+JSON.stringify(l)),t=new window.VideoDecoder(i),t.configure(l)}}o(void 0,e)}else if(e.type===O.ELEMENTARY){if(t){const r=5==(31&e.data[4]);let n=new window.EncodedVideoChunk({type:r?"key":"delta",timestamp:e.ntpTimestamp,data:e.data});t.decode(n)}else n("decoder not initialized");o()}else e.type===O.SPS?(n("sps: ",e),o()):e.type===O.PPS?(n("pps: ",e),o()):o();return Kt.alloc(0)}})),n("created")}}var Zt=r(764).Buffer;class Qt extends h{constructor(e){if(void 0===e)throw new Error("you must supply a payload type to BasicDepayComponent");const t=e=>{this.onDataCallback&&this.onDataCallback(e)};let r=Zt.alloc(0);var n,i,o;super(B((function(n,i,o){if(w(n.data)===e||-1==e){const e=R(n.data);if(r=Zt.concat([r,e]),r.length>0){var s={data:r,rawdata:n.data,header:n.header,timestamp:S(n.data),ntpTimestamp:n.ntpTimestamp,payloadType:w(n.data),type:O.UNKNOWN};t&&t(s)}r=Zt.alloc(0),o(void 0,n)}else o(void 0,n)}))),n=this,o=void 0,(i=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(i="onDataCallback"))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o}}var er=r(764).Buffer;class tr extends h{constructor(){let e=0;const t=e=>{this.onDataCallback&&this.onDataCallback(e)};let r=er.alloc(0);var n,i,o;super(B((function(n,i,o){var s,a,u,c,l=w(n.data);if(n.type===O.SDP){const t=n.sdp.media?.find((e=>"audio"===e.type&&void 0!==e.rtpmap&&"PCMU"===e.rtpmap.encodingName));void 0!==t&&void 0!==t.rtpmap&&(e=t.rtpmap.payloadType,t.rtpmap.encodingName="PCM"),o(void 0,n)}else if(n.type===O.RTP&&l===e){const e=R(n.data);if(r=er.concat([r,e]),r.length>0){for(var h=new Int16Array(r.length),d=0;d<r.length;d++)h[d]=(void 0,void 0,c=void 0,c=0,128&(s=~(s=r[d]))&&(s&=-129,c=-1),u=(1<<(a=5+((240&s)>>4))|(15&s)<<a-4|1<<a-5)-33,0==c?u:-u);var f={data:h,timestamp:S(n.data),ntpTimestamp:n.ntpTimestamp,payloadType:w(n.data),type:O.PCM};t&&t(f),o(void 0,f),h=new Int16Array(0)}else o(void 0,n);r=er.alloc(0)}else o(void 0,n)}))),n=this,o=void 0,(i=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(i="onDataCallback"))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o}}var rr=r(764).Buffer;function nr(e){for(var t,r="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=new Uint8Array(e),o=i.byteLength,s=o%3,a=o-s,u=0;u<a;u+=3)r+=n[(16515072&(t=i[u]<<16|i[u+1]<<8|i[u+2]))>>18]+n[(258048&t)>>12]+n[(4032&t)>>6]+n[63&t];return 1==s?r+=n[(252&(t=i[a]))>>2]+n[(3&t)<<4]+"==":2==s&&(r+=n[(64512&(t=i[a]<<8|i[a+1]))>>10]+n[(1008&t)>>4]+n[(15&t)<<2]+"="),r}function ir(e,t,r){return fetch(e,{method:"GET",signal:t,mode:"cors",cache:"no-cache",credentials:"include",headers:{"x-sessioncookie":r,Accept:"application/x-rtsp-tunnelled",Pragma:"no-cache","Cache-Control":"no-cache","Accept-Encoding":""}}).catch((e=>console.error("Connection error: "+e)))}function or(e,t,r){let n=new XMLHttpRequest;n.open("POST",t),n.setRequestHeader("x-sessioncookie",r),n.setRequestHeader("Content-Type","application/x-rtsp-tunnelled"),n.setRequestHeader("Pragma","no-cache"),n.send(e),n.send(e),n.onload=function(){200!=n.status&&console.error("Error: "+n.status+": "+n.statusText)},n.onprogress=function(e){e.lengthComputable},n.onerror=function(e){console.error("Error: "+e.error+": "+e.message)}}class sr extends l{constructor(e){const t=new o.Readable({objectMode:!0,read:function(){}}),r=e=>e.read().then((n=>{if(n.done)return;const i=n.value;var o=rr.from(i.buffer);return t.push({data:o,type:O.RAW}),r(e)})),n=new AbortController,i=n.signal,s=Math.floor(99999*Math.random());e.uri&&ir(e.uri,i,s.toString()).then((e=>{if(e&&e.body)return r(e.body.getReader())})).then((e=>{console.log(e)}));const a=new o.Writable({objectMode:!0,write:function(t,r,n){try{var i=null;i=t.constructor===Uint8Array?nr(t.subarray(0,3))+nr(t.subarray(4)):btoa(t.data),e.uri&&or(i,e.uri,s.toString())}catch(e){console.warn("message lost during send:",t)}n()}});var u,c,l;a.on("error",(e=>{console.warn("error during send, ignoring:",e)})),a.on("finish",(()=>{n.abort(),H()("msl:http_tunnel:outgoing")("finish")})),super(t,a),u=this,l=void 0,(c=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(c="onServerClose"))in u?Object.defineProperty(u,c,{value:l,enumerable:!0,configurable:!0,writable:!0}):u[c]=l}static open(e){return((e={})=>{const{uri:t,protocol:r,timeout:n}=It(((e=window.location.host,t=window.location.protocol)=>({uri:`${"https:"===t?"https:":"http:"}//${e}/rtsp_tunnnel`,protocol:"binary",timeout:10007}))(e.host,e.scheme),e);if(void 0===t)throw new Error("http_tunnel: internal error");return new Promise(((e,t)=>{try{e(void 0)}catch(e){t(e)}}))})(e).then((t=>new sr(e)))}}function ar(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class ur{constructor(...e){ar(this,"firstComponent",void 0),ar(this,"lastComponent",void 0),ar(this,"_set",void 0);const[t,...r]=e;this._set=new Set(e),this.firstComponent=t,this.lastComponent=r.reduce(((e,t)=>e.connect(t)),t)}init(...e){const[t,...r]=e;this._set=new Set(e),this.firstComponent=t,this.lastComponent=r.reduce(((e,t)=>e.connect(t)),t)}insertAfter(e,t){if(!this._set.has(e))throw new Error("insertion point not part of pipeline");if(this._set.has(t))throw new Error("new component already in the pipeline");const r=e.next;return null===r?(e.connect(t),this.lastComponent=t):(e.disconnect(),e.connect(t).connect(r)),this._set.add(t),this}insertBefore(e,t){if(!this._set.has(e))throw new Error("insertion point not part of pipeline");if(this._set.has(t))throw new Error("new component already in the pipeline");const r=e.prev;return null===r?(t.connect(e),this.firstComponent=t):(r.disconnect(),r.connect(t).connect(e)),this._set.add(t),this}remove(e){if(!this._set.has(e))throw new Error("component not part of pipeline");const t=e.prev,r=e.next;if(null===t&&null===r)throw new Error("cannot remove last component");return null===t&&null!==r?(e.disconnect(),this.firstComponent=r):null!==t&&null===r?(t.disconnect(),this.lastComponent=t):null!==t&&null!==r&&(t.disconnect(),e.disconnect(),t.connect(r)),this._set.delete(e),this}append(...e){return e.forEach((e=>{this.insertAfter(this.lastComponent,e)})),this}prepend(...e){return e.forEach((e=>{this.insertBefore(this.firstComponent,e)})),this}}function cr(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class lr extends ur{constructor(e){const t=new Bt,r=new Ft(e);r.onSdp=e=>{this.onSdp&&this.onSdp(e)},r.onPlay=e=>{this.onPlay&&this.onPlay(e)},super(t,r),cr(this,"onSdp",void 0),cr(this,"onPlay",void 0),cr(this,"rtsp",void 0),this.rtsp=r}}function hr(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class dr extends lr{constructor(e){super(e),hr(this,"onSync",void 0),hr(this,"_mp4Muxer",void 0);const t=new Q,r=new I,n=new it;n.onSync=e=>{this.onSync&&this.onSync(e)},this.append(t,r,n),this._mp4Muxer=n}get bitrate(){return this._mp4Muxer.bitrate}get framerate(){return this._mp4Muxer.framerate}}class fr extends lr{constructor(e){super(e);const t=new Se;this.append(t)}}var pr=r(318),mr=r.n(pr);function yr(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class vr{constructor(e,t,r){yr(this,"realm",void 0),yr(this,"nonce",void 0),yr(this,"opaque",void 0),yr(this,"algorithm",void 0),yr(this,"qop",void 0),yr(this,"username",void 0),yr(this,"ha1Base",void 0),yr(this,"count",void 0),yr(this,"nc",(()=>(++this.count,this.count.toString(16).padStart(8,"0")))),yr(this,"cnonce",(()=>new Array(4).fill(0).map((()=>Math.floor(256*Math.random()))).map((e=>e.toString(16))).join(""))),yr(this,"ha1",(e=>{let t=this.ha1Base;return"md5-sess"===this.algorithm&&(t=(new(mr())).update(`${t}:${this.nonce}:${e}`).digest("hex")),t})),yr(this,"ha2",((e,t,r="")=>{let n=(new(mr())).update(`${e}:${t}`).digest("hex");if("md5-sess"===this.algorithm){const i=(new(mr())).update(r).digest("hex");n=(new(mr())).update(`${e}:${t}:${i}`).digest("hex")}return n})),yr(this,"authorization",((e="GET",t="",r)=>{const n=this.nc(),i=this.cnonce(),o=this.ha1(i),s=this.ha2(e,t,r),a=void 0===this.qop?(new(mr())).update(`${o}:${this.nonce}:${s}`).digest("hex"):(new(mr())).update(`${o}:${this.nonce}:${n}:${i}:${this.qop}:${s}`).digest("hex"),u=[];return u.push(`username="${this.username}"`),u.push(`realm="${this.realm}"`),u.push(`nonce="${this.nonce}"`),u.push(`uri="${t}"`),void 0!==this.qop&&(u.push(`qop=${this.qop}`),u.push(`nc=${n}`),u.push(`cnonce="${i}"`)),u.push(`response="${a}"`),void 0!==this.opaque&&u.push(`opaque="${this.opaque}"`),`Digest ${u.join(", ")}`}));const n=e.get("realm");if(void 0===n)throw new Error("no realm in digest challenge");this.realm=n,this.ha1Base=(new(mr())).update(`${t}:${n}:${r}`).digest("hex");const i=e.get("nonce");if(void 0===i)throw new Error("no nonce in digest challenge");this.nonce=i,this.opaque=e.get("opaque");const o=e.get("algorithm");void 0!==o?"md5"===o?this.algorithm="md5":"md5-sess"===o&&(this.algorithm="md5-sess"):this.algorithm="md5";const s=e.get("qop");if(void 0!==s){const e=s.split(",").map((e=>e.trim()));e.some((e=>"auth"===e))?this.qop="auth":e.some((e=>"auth-int"===e))&&(this.qop="auth-int")}this.count=0,this.username=t}}var gr=r(764).Buffer;const br={username:"root",password:"pass"};class wr extends h{constructor(e={}){const{username:t,password:r}=It(br,e);if(void 0===t||void 0===r)throw new Error("need username and password");let n,i;const o=B((function(e,t,r){e.type===O.RTSP&&(n=e,i&&e.headers&&(e.headers.Authorization=i)),r(void 0,e)}));super(B((function(e,s,a){if(e.type===O.RTSP&&401===St(e.data)){const s=e.data.toString().split("\n").find((e=>/WWW-Auth/i.test(e)));if(void 0===s)throw new Error("cannot find WWW-Authenticate header");const u=(e=>{const[,t,...r]=e.split(" "),n=[],i=/\s*([^=]+)=\"([^\"]*)\",?/gm;let o;do{if(o=i.exec(r.join(" ")),null!==o){const[,e,t]=o;n.push([e,t])}}while(null!==o);const s=new Map(n);return{type:t.toLowerCase(),params:s}})(s);if("basic"===u.type)i="Basic "+gr.from(t+":"+r).toString("base64");else{if("digest"!==u.type)return;{const e=new vr(u.params,t,r);i=e.authorization(n.method,n.uri)}}o.write(n,(()=>a()))}else a(void 0,e)})),o)}}function _r(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Sr extends fr{constructor(e){const{ws:t,rtsp:r,mediaElement:n,auth:i}=e;if(super(r),_r(this,"onCanplay",void 0),_r(this,"onSync",void 0),_r(this,"onServerClose",void 0),_r(this,"ready",void 0),_r(this,"_src",void 0),_r(this,"_sink",void 0),i){const e=new wr(i);this.insertBefore(this.rtsp,e)}const o=new F(n);o.onCanplay=()=>{o.play(),this.onCanplay&&this.onCanplay()},o.onSync=e=>{this.onSync&&this.onSync(e)},this.append(o),this._sink=o;const s=Gt.open(t);this.ready=s.then((e=>{e.onServerClose=()=>{this.onServerClose&&this.onServerClose()},this.prepend(e),this._src=e}))}close(){this._src&&this._src.outgoing.end()}get currentTime(){return this._sink.currentTime}play(){return this._sink.play()}pause(){return this._sink.pause()}get bitrate(){return this._sink.bitrate}get framerate(){return this._sink.framerate}}var Er=r(764).Buffer;class Tr{constructor(e){var t,r,n;t=this,n=void 0,(r=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(r="_buffer"))in t?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n,this._buffer=e}parse(){this.cleanByteArray();let e=new DataView(this._buffer),t=19,r=new Map;for(;t<e.buffer.byteLength-4;){let n={tag:0,length:0,data:Er.from([])};n.tag=e.getUint16(t),t+=2,n.length=e.getUint16(t),t+=2,n.data=e.buffer.slice(t,t+n.length),t+=n.length,this.parseTag(n),r.set(n.tag,n)}return r}parseTag(e){if(133===e.tag){let t=new DataView(e.data);e.parsed={tagname:"roi_pos_info",tl:{x:t.getUint16(0),y:t.getUint16(2)},br:{x:t.getUint16(4),y:t.getUint16(6)}},e.data.byteLength>=16&&(e.parsed.deltatime=t.getInt32(8),e.parsed.maxdeltatime=t.getInt32(12))}}cleanByteArray(){let e=[],t=0,r=new Uint8Array(this._buffer);for(let n=0;n<r.byteLength;n++)n>1&&3===r[n]&&0===t||(e.push(r[n]),t=(t<<8)+r[n]&65535);this._buffer=new Uint8Array(e).buffer}}class xr extends h{constructor(e,t){const r=H()("msl:streaminfo");let n=0,i=0;const s={video:null,audio:null,meta:null,sei:null,kbit_sec:0};super(new o.Transform({objectMode:!0,transform:function(o,a,u){let c=!1;if(o.type===O.SDP){const e=JSON.parse(JSON.stringify(s)),t=o.sdp.media?o.sdp.media.find((e=>"video"===e.type)):null;if(t){if(s.video={},t.fmtp){if(t.fmtp.parameters["sprop-parameter-sets"]){const e=t.fmtp.parameters["sprop-parameter-sets"].split(",").map(Ge),r=new Ke(e[0].buffer).parse();s.video.width=r.width,s.video.height=r.height}!e.video||e.video.width===s.video.width&&e.video.height===s.video.height||(r("videoresolution changed, forcing event: %o",s.video),c=!0)}t.codec?(s.video.codec={},s.video.codec.coding=t.codec.coding,s.video.codec.level=t.codec.level,s.video.codec.profile=t.codec.profile):t.rtpmap&&(s.video.codec={},s.video.codec.coding=t.rtpmap.encodingName)}const n=o.sdp.media?o.sdp.media.find((e=>"audio"===e.type)):null;n&&(n.codec?(s.audio={codec:{}},s.audio.codec.channels=n.codec.channels,s.audio.codec.coding=n.codec.coding,s.audio.codec.samplingrate=n.codec.samplingRate):n.rtpmap&&(s.audio={codec:{}},s.audio.codec.coding=n.rtpmap.encodingName));const i=o.sdp.media?o.sdp.media.find((e=>"application"===e.type)):null;i&&i.rtpmap&&(s.meta={},s.meta.encoding=i.rtpmap.encodingName)}else if(o.type===O.JPEG)o.framesize&&(s.video||(s.video={}),s.video.width=o.framesize.width,s.video.height=o.framesize.height);else if(o.type===O.SEI){const e=new Tr(o.data.buffer).parse();s.sei=e,t&&t(e)}o.data&&(i+=o.data.length);const l=(new Date).getTime()-n;(l>2e3||c||0===n)&&(s.kbit_sec=0===n?0:i/l*8,n=(new Date).getTime(),c=!1,i=0,e&&e(s)),u(void 0,o)}}))}}class Cr extends Sr{constructor(e){const{metadataHandler:t,metadataType:r,picinfoHandler:n,streaminfoHandler:i,seiinfoHandler:o}=e;let s=H()("msl:canvas-pipeline-extended");super(e),"onvif"===(r||"").toLowerCase()?(s("using onvif metadata"),this.insertAfter(this.rtsp,new ct(t))):"bosch"===(r||"").toLowerCase()&&(s("using bosch metadata"),this.insertAfter(this.rtsp,new z(t,"VND.BOSCH.METADATA"))),n?this.insertAfter(this.rtsp,new z(n,null,97)):s("no picinfo handler");const a=new zt;let u=this.findComponent(Se);null!=u&&u instanceof h&&this.insertBefore(u,a),(i||o)&&null!=u&&u instanceof h&&this.insertAfter(u,new xr(i,o))}findComponent(e){let t=this.firstComponent;if(t instanceof e)return t;for(;null!=t.next;)if(t=t.next,t instanceof e)return t;return null}listComponents(){let e=this.firstComponent;for(console.log("first: ",e);null!=e.next;)e=e.next,console.log(typeof e,e)}}function Pr(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class kr extends dr{constructor(e){const{ws:t,rtsp:r,mediaElement:n,auth:i}=e;if(super(r),Pr(this,"onSourceOpen",void 0),Pr(this,"onServerClose",void 0),Pr(this,"onSocketClose",void 0),Pr(this,"ready",void 0),Pr(this,"_src",void 0),Pr(this,"_sink",void 0),i){const e=new wr(i);this.insertBefore(this.rtsp,e)}const o=new at(n);o.onSourceOpen=(e,t)=>{this.onSourceOpen&&this.onSourceOpen(e,t)},this.append(o),this._sink=o;const s=Gt.open(t);this.ready=s.then((e=>{e.onServerClose=()=>{this.onServerClose&&this.onServerClose()},e.onSocketClose=e=>{this.onSocketClose&&this.onSocketClose(e)},this.prepend(e),this._src=e}))}close(){this._src&&this._src.outgoing.end()}get currentTime(){return this._sink.currentTime}play(){return this._sink.play()}pause(){return this._sink.pause()}}function Rr(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Or extends dr{constructor(e){const{ws:t,rtsp:r,mediaElement:n,auth:i}=e;if(super(r),Rr(this,"onDataCallback",void 0),Rr(this,"onSourceOpen",void 0),Rr(this,"onServerClose",void 0),Rr(this,"ready",void 0),Rr(this,"tracks",void 0),Rr(this,"_src",void 0),Rr(this,"_sink",void 0),i){const e=new wr(i);this.insertBefore(this.rtsp,e)}const o=new at(n);if(o.onSourceOpen=(e,t)=>{this.tracks=t,this.onSourceOpen&&this.onSourceOpen(e,t)},o.onDataCallback=e=>{this.onDataCallback&&this.onDataCallback(e)},this.append(o),this._sink=o,t){const e=sr.open(t);this.ready=e.then((e=>{e.onServerClose=()=>{this.onServerClose&&this.onServerClose()},this.prepend(e),this._src=e}))}}close(){this._src&&this._src.outgoing.end()}get currentTime(){return this._sink.currentTime}play(){return this._sink.play()}pause(){return this._sink.pause()}}class Br extends kr{constructor(e){const{metadataHandler:t}=e;super(e);const r=new ct;this.insertAfter(this.rtsp,r);const n=h.fromHandlers((e=>{e.type===O.XML&&t(e)}),void 0);this.insertAfter(r,n)}}class Ir extends kr{constructor(e){const{metadataHandler:t,metadataType:r,picinfoHandler:n,streaminfoHandler:i,seiinfoHandler:o,timestampJumpFactor:s,socketClosedHandler:a}=e,u=H()("msl:video-pipeline-extended");super(e),this.onSocketClose=e=>{u("socket close received: %o",e),a&&a(e)},"onvif"===(r||"").toLowerCase()?(u("using onvif metadata"),this.insertAfter(this.rtsp,new ct(t))):"bosch"===(r||"").toLowerCase()&&(u("using bosch metadata"),this.insertAfter(this.rtsp,new z(t,"VND.BOSCH.METADATA"))),n?this.insertAfter(this.rtsp,new z(n,null,97)):u("no picinfo handler");const c=new zt,l=this.findComponent(it);null!=l&&l instanceof h&&this.insertBefore(l,c),(i||o)&&null!=l&&l instanceof h&&this.insertAfter(l,new xr(i,o))}findComponent(e){let t=this.firstComponent;if(t instanceof e)return t;for(;null!=t.next;)if(t=t.next,t instanceof e)return t;return null}listComponents(){let e=this.firstComponent;for(console.log("first: ",e);null!=e.next;)e=e.next,console.log(typeof e,e)}}function jr(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const Lr={parameters:["audio=0","video=0","event=on","ptz=all"]};class Ar extends lr{constructor(e){const{ws:t,rtsp:r,metadataHandler:n}=e;super(Object.assign({},Lr,r)),jr(this,"onServerClose",void 0),jr(this,"ready",void 0),jr(this,"_src",void 0);const i=new ct;this.append(i);const o=d.fromHandler((e=>{e.type===O.XML&&n(e)}));this.append(o);const s=Gt.open(t);this.ready=s.then((e=>{e.onServerClose=()=>{this.onServerClose&&this.onServerClose()},this.prepend(e),this._src=e}))}close(){this._src&&this._src.outgoing.end()}}function Mr(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Ur extends lr{constructor(e){const{ws:t,rtsp:r,canvasElement:n}=e;super(r),Mr(this,"onSourceOpen",void 0),Mr(this,"onServerClose",void 0),Mr(this,"onSocketClose",void 0),Mr(this,"ready",void 0),Mr(this,"_src",void 0);const i=new Q,o=new I,s=new Xt(n);this.append(i,o,s);const a=Gt.open(t);this.ready=a.then((e=>{e.onServerClose=()=>{this.onServerClose&&this.onServerClose()},e.onSocketClose=e=>{this.onSocketClose&&this.onSocketClose(e)},this.prepend(e),this._src=e}))}close(){this._src&&this._src.outgoing.end()}}function Dr(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Nr extends lr{constructor(e){const{ws:t,rtsp:r,auth:n}=e;if(super(r),Dr(this,"onServerClose",void 0),Dr(this,"ready",void 0),Dr(this,"_src",void 0),n){const e=new wr(n);this.insertBefore(this.rtsp,e)}const i=Gt.open(t);this.ready=i.then((e=>{e.onServerClose=()=>{this.onServerClose&&this.onServerClose()},this.prepend(e),this._src=e}))}close(){this._src&&this._src.outgoing.end()}get sdp(){return this.ready.then((()=>{const e=new Promise((e=>{this.rtsp.onSdp=e}));return this.rtsp.send({method:Nt.DESCRIBE}),this.rtsp.send({method:Nt.TEARDOWN}),e}))}}const Fr=e=>e.toString("ascii",4,8).toLowerCase();var qr=r(764).Buffer;function Hr(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const $r=H()("msl:mp4-parser"),zr=new Set(["ftyp","moov","styp","moof","mdat"]);class Wr{constructor(){Hr(this,"_chunks",[]),Hr(this,"_length",0),Hr(this,"_box",void 0),Hr(this,"_ftyp",void 0),this._init()}_init(){this._chunks=[],this._length=0}_push(e){this._chunks.push(e),this._length+=e.length}_parseBox(){if(this._length<8)return null;if(this._box||(this._box=(e=>{const t=qr.alloc(8);let r=0,n=0;for(;n<t.length;){const i=e[r++],o=Math.min(i.length,t.length-n);i.copy(t,n,0,o),n+=o}const i=t.readUInt32BE(0);return{type:Fr(t),size:i}})(this._chunks)),this._length<this._box.size)return null;const e=1===this._chunks.length?this._chunks[0]:qr.concat(this._chunks),t=e.slice(0,this._box.size),r=e.slice(this._box.size);return this._init(),this._push(r),zr.has(this._box.type)?(delete this._box,t):(console.warn(`ignored non-ISO BMFF Byte Stream box type: ${this._box.type} (${this._box.size} bytes)`),qr.alloc(0))}parse(e){this._push(e);const t=[];let r=!1;for(;!r;){const e=this._parseBox();if(null!==e)if("ftyp"===Fr(e))this._ftyp=e;else if("moov"===Fr(e)){const r=new He("moov").parse(e);$r("MP4 tracks: ",r),t.push({type:O.ISOM,data:qr.concat([this._ftyp??qr.alloc(0),e]),tracks:r})}else t.push({type:O.ISOM,data:e});else r=!0}return t}}class Vr extends h{constructor(){const e=new Wr,t=new o.Transform({objectMode:!0,transform:function(r,n,i){r.type===O.RAW?(e.parse(r.data).forEach((e=>t.push(e))),i()):i(void 0,r)}});super(t)}}class Gr extends ur{constructor(e){const{http:t,mediaElement:r}=e,n=new ne(t);var i,o,s;super(n,new Vr,new at(r)),i=this,s=void 0,(o=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(o="http"))in i?Object.defineProperty(i,o,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[o]=s,this.http=n}}})(),mediaStreamLibrary=n})();