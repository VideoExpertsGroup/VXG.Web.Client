// CloudSDK.min.js
// version: 3.3.19
// date-of-build: 240226
// copyright (c) VXG Inc
// Includes gl-matrix  <https://github.com/toji/gl-matrix>
// ver: 3.3.0 // Available under MIT License 
// <https://github.com/toji/gl-matrix/blob/master/LICENSE.md> 
// Includes rangeslider.js <https://github.com/andreruffert/rangeslider.js>
// Available under MIT License 
// <https://github.com/andreruffert/rangeslider.js/blob/develop/LICENSE.md> 
// Includes momentjs  <https://github.com/moment/moment/>
// ver: 2.29.1// Available under MIT License 
// <https://github.com/moment/moment/blob/develop/LICENSE> 
// Includes moment-timezone <https://github.com/moment/moment-timezone/>
// ver: 0.5.32// Available under MIT License 
// <https://github.com/moment/moment-timezone/blob/develop/LICENSE>

window.Log=function(e){var t=this;t.mElementID=e,t.el=document.getElementById(e),t.el&&(t.el.innerHTML='<div class="logger-line">Start</div>'),t.escape=function(e){if(void 0===e)return"undefined";for(var t=e="object"==typeof e?JSON.stringify(e):e,o=[[/&/g,"&amp;"],[/</g,"&lt;"],[/>/g,"&gt;"],[/"/g,"&quot;"]],n=0;n<o.length;n++)t=t.replace(o[n][0],o[n][1]);return t},t.info=function(e){console.log(e),t.el&&(t.el.innerHTML+='<div class="logger-line info">'+t.escape(e)+"</div>")},t.error=function(e){console.error(e),t.el&&(t.el.innerHTML+='<div class="logger-line error">'+t.escape(e)+"</div>")},t.warn=function(e){console.warn(e),t.el&&(t.el.innerHTML+='<div class="logger-line warn">'+t.escape(e)+"</div>")}},window.CloudHelpers=window.CloudHelpers||{},CloudHelpers.POSITION_LIVE=-1,window.CloudHelpers.RequestWrap=function(){this.request=function(e){var o=CloudHelpers.promise(),n=new("onload"in new XMLHttpRequest?XMLHttpRequest:XDomainRequest);return n.open(e.type,e.url,!0),n.withCredentials=!0,e.contentType&&n.setRequestHeader("Content-Type",e.contentType),e.access_token&&n.setRequestHeader("Authorization","Acc "+e.access_token),n.onload=function(){var e="";if(""!=this.responseText)try{e=JSON.parse(this.responseText)}catch(e){return console.error(e),void o.reject(CloudReturnCode.ERROR_WRONG_RESPONSE)}var t=this.status;200<=t&&t<300?o.resolve(e):o.reject(e),delete n},n.onerror=function(){o.reject(n),delete n},e.data?n.send(e.data):n.send(),o},this.destroy=function(){this.isRequestAnswerAlowed=0}},CloudHelpers.parseUri=function(e){var t={},o=(t.source=e).split("/");t.protocol=o[0],t.protocol=t.protocol.slice(0,t.protocol.length-1),t.protocol=t.protocol.toLowerCase(),e=e.slice(t.protocol.length+3),"http"==t.protocol&&(t.port=80),"https"==t.protocol&&(t.port=443);var n=-1!=(n=e.indexOf("/"))?n:e.length,o=-1!=(o=e.indexOf("?"))?o:e.length,o=Math.min(n,o),r=e.substring(0,o);e=e.slice(o);for(var a,l="";-1!=r.indexOf("@");)l+=r.substring(0,r.indexOf("@")+1),r=r.slice(r.indexOf("@")+1);return""!=l&&(-1!=l.indexOf(":")?(a=l.split(":"),t.user=a[0],t.password=a[1],t.password=t.password.substring(0,t.password.length-1)):t.user=l),-1==r.indexOf(":")||(a=new RegExp(".*:(\\d+)$","g").exec(r))&&1<a.length&&(t.port=parseInt(a[1],10),r=r.slice(0,r.length-a[1].length-1)),t.host=r,-1!=e.indexOf("?")?(t.query=e.substring(e.indexOf("?"),e.length),t.path=e.substring(0,e.indexOf("?"))):(t.query="",t.path=e),t.path&&""!=t.path||(t.path="/"),t},CloudHelpers.promise=function(){var t={completed:!1,failed:!1,successed:!1,done:function(e){return t.done_callback=e,t.completed&&"function"==typeof t.done_callback&&t.successed&&t.done_callback.apply(this,t.result_arguments),t},fail:function(e){return t.fail_callback=e,t.completed&&"function"==typeof t.fail_callback&&t.failed&&t.fail_callback.apply(this,t.error_arguments),t},resolve:function(){t.completed||(t.result_arguments=arguments,"function"==typeof t.done_callback&&t.done_callback.apply(this,t.result_arguments)),t.successed=!0,t.completed=!0},reject:function(){t.completed||(t.error_arguments=arguments,"function"==typeof t.fail_callback&&t.fail_callback.apply(this,t.error_arguments)),t.failed=!0,t.completed=!0}};return t},CloudHelpers.waitPromises=function(e){var t=CloudHelpers.promise(),o=e.length,n=[];function r(e){n.push(e),n.length==o&&t.resolve(n)}for(var a=0;a<o;a++)e[a].done(r).fail(r);return t},CloudHelpers.request=function(e){var o=CloudHelpers.promise(),n=new("onload"in new XMLHttpRequest?XMLHttpRequest:XDomainRequest);return n.open(e.type,e.url,!0),n.withCredentials=!0,e.contentType&&n.setRequestHeader("Content-Type",e.contentType),n.onload=function(){var e="";if(""!=this.responseText)try{e=JSON.parse(this.responseText)}catch(e){return console.error(e),void o.reject(CloudReturnCode.ERROR_WRONG_RESPONSE)}var t=this.status;200<=t&&t<300?o.resolve(e):o.reject(e),delete n},n.onerror=function(){o.reject(n),delete n},e.data?n.send(e.data):n.send(),o},CloudHelpers.request2=function(e){var o=CloudHelpers.promise(),n=new("onload"in new XMLHttpRequest?XMLHttpRequest:XDomainRequest);return n.open(e.type,e.url,!0),n.withCredentials=!0,e.contentType&&n.setRequestHeader("Content-Type",e.contentType),e.access_token&&n.setRequestHeader("Authorization","Acc "+e.access_token),e.license_key&&n.setRequestHeader("Authorization","Lic "+e.license_key),n.onload=function(){var e="";if(""!=this.responseText)try{e=JSON.parse(this.responseText)}catch(e){return console.error(e),void o.reject(CloudReturnCode.ERROR_WRONG_RESPONSE)}var t=this.status;200<=t&&t<300?o.resolve(e):o.reject(e),delete n},n.onerror=function(){o.reject(n),delete n},e.data?n.send(e.data):n.send(),o},CloudHelpers.requestJS=function(url,beforeEval){var p=CloudHelpers.promise(),xhr=new("onload"in new XMLHttpRequest?XMLHttpRequest:XDomainRequest);return xhr.open("GET",url,!0),xhr.onload=function(){var r="";if(""!=this.responseText)try{r=this.responseText}catch(e){return console.error(e),void p.reject(CloudReturnCode.ERROR_WRONG_RESPONSE)}var st=this.status;200<=st&&st<300?(beforeEval&&(r=beforeEval(r)),eval(r),p.resolve(r)):p.reject(r),delete xhr},xhr.onerror=function(){p.reject(xhr),delete xhr},xhr.send(),p},CloudHelpers.handleError=function(e,t,o){e.errorDetail&&404==e.status?t.reject(CloudReturnCode.ERROR_NOT_FOUND):e.errorDetail&&401==e.status?t.reject(CloudReturnCode.ERROR_NOT_AUTHORIZED):o?o(e,t):t.reject(e)},CloudHelpers.requestAsyncList=function(n,r,a){var l={meta:{limit:1e3,offset:0,total_count:-1},objects:[]};r.limit=l.meta.limit,r.offset=l.meta.offset,n(r).fail(function(e){a.reject(e)}).done(function(e){if(l.meta.total_count=e.meta.total_count,l.objects=l.objects.concat(e.objects),e.meta.offset+e.objects.length>=e.meta.total_count)a.resolve(l);else{for(var t=[],o=l.meta.limit;o<l.meta.total_count;o+=l.meta.limit)r.offset=o,t.push(n(r));CloudHelpers.waitPromises(t).done(function(e){for(var t=0;t<e.length;t++)l.objects=l.objects.concat(e[t].objects);a.resolve(l)}).fail(function(e){a.reject(e)})}})},CloudHelpers.flashVersion=void 0,CloudHelpers.getFlashVersion=function(){try{try{var e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");try{e.AllowScriptAccess="always"}catch(e){return"6,0,0"}}catch(e){}return new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version").replace(/\D+/g,",").match(/^,?(.+),?$/)[1]}catch(e){try{if(navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin)return(navigator.plugins["Shockwave Flash 2.0"]||navigator.plugins["Shockwave Flash"]).description.replace(/\D+/g,",").match(/^,?(.+),?$/)[1]}catch(e){}}return"0,0,0"},CloudHelpers.supportFlash=function(){return CloudHelpers.flashVersion||(CloudHelpers.flashVersion=CloudHelpers.getFlashVersion()),"0,0,0"!=CloudHelpers.flashVersion},CloudHelpers.useHls=function(){return CloudHelpers.isMobile()||!CloudHelpers.supportFlash()||CloudHelpers.containsPageParam("hls")},CloudHelpers.supportWebRTC=function(){return!!(window.mozRTCPeerConnection||window.webkitRTCPeerConnection||window.RTCPeerConnection)},CloudHelpers.mapToUrlQuery=function(e){if(!e)return"";var t,o=[];for(t in e)o.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return o.join("&")},CloudHelpers.lang=function(){return CloudHelpers.sLang||CloudHelpers.locale()},CloudHelpers.locale=function(){var e;return langs=["en","ko","ru"],CloudHelpers.sLang="en",CloudHelpers.containsPageParam("lang")&&-1<=langs.indexOf(CloudHelpers.pageParams.lang)?CloudHelpers.sLang=CloudHelpers.pageParams.lang:navigator?(e="en",e=navigator.language?navigator.language.substring(0,2):e,e=navigator.browserLanguage?navigator.browserLanguage.substring(0,2):e,e=navigator.systemLanguage?navigator.systemLanguage.substring(0,2):e,e=navigator.userLanguage?navigator.userLanguage.substring(0,2):e,-1<=langs.indexOf(e)?CloudHelpers.sLang=e:console.warn("Unsupported lang "+e+", will be used default lang: "+CloudHelpers.sLang),CloudHelpers.sLang=-1<=langs.indexOf(e)?e:CloudHelpers.sLang):CloudHelpers.sLang="en",CloudHelpers.sLang},CloudHelpers.parsePageParams=function(){for(var e=window.location.search.slice(1).split("&"),t={},o=new RegExp("(.*)=([^&#]*)"),n=0;n<e.length;n++)""!=e[n].trim()&&(p=o.exec(e[n].trim()),null==p?t[decodeURIComponent(e[n].trim().replace(/\+/g," "))]="":t[decodeURIComponent(p[1].replace(/\+/g," "))]=decodeURIComponent(p[2].replace(/\+/g," ")));return t},CloudHelpers.pageParams=CloudHelpers.parsePageParams(),CloudHelpers.containsPageParam=function(e){return void 0!==CloudHelpers.pageParams[e]},CloudHelpers.keepParams=["lang","url","fcno","vendor","demo","messaging","hls","svcp_host","backwardDeactivateAfter","mobile","experimental_hls","page_id","preview","customswf"],CloudHelpers.changeLocationState=function(e){for(var t,o=[],n=0;n<CloudHelpers.keepParams.length;n++){var r=CloudHelpers.keepParams[n];CloudHelpers.containsPageParam(r)&&o.push(r+"="+encodeURIComponent(CloudHelpers.pageParams[r]))}for(t in e)o.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]));var a=("file:"==window.location.protocol?"http:":window.location.protocol)+"//"+window.location.host+window.location.pathname+"?"+o.join("&");try{window.history.pushState?window.history.pushState(e,document.title,a):console.error("window.history.pushState - function not found")}catch(e){console.error("changeLocationState: Could not change location to "+a)}},CloudHelpers.osname=function(){var e="unknown";return-1!=navigator.appVersion.indexOf("Win")&&(e="win"),-1!=navigator.appVersion.indexOf("Mac")&&(e="mac"),-1!=navigator.appVersion.indexOf("X11")&&(e="unix"),e=-1!=navigator.appVersion.indexOf("Linux")?"linux":e},CloudHelpers.isSafari=function(){var e=-1<window.navigator.userAgent.toLowerCase().indexOf("chrome"),t=-1<window.navigator.userAgent.toLowerCase().indexOf("safari");return!e&&t},CloudHelpers.isEdge=function(){return-1<window.navigator.userAgent.indexOf("Edge")},CloudHelpers.isChrome=function(){return/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)},CloudHelpers.isMobile=function(){return!!(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i))},CloudHelpers.isIpV4=function(e){return null!=e.match(/^([0-9]{1,3}\.){3}[0-9]{1,3}/)},CloudHelpers.parseUTCTime=function(e){var t=(e=(e=(e=e.replace(new RegExp("-","g")," ")).replace(new RegExp("T","g")," ")).replace(new RegExp(":","g")," ")).split(" "),e=new Date;e.setUTCFullYear(parseInt(t[0],10)),e.setUTCMonth(parseInt(t[1],10)-1),e.setUTCDate(parseInt(t[2],10)),e.setUTCHours(parseInt(t[3],10)),e.setUTCMinutes(parseInt(t[4],10)),e.setUTCSeconds(parseInt(t[5],10));e=e.getTime();return e-=e%1e3},CloudHelpers.formatUTCTime=function(e){var t=new Date;return t.setTime(e),t.getUTCFullYear()+"-"+("00"+(t.getUTCMonth()+1)).slice(-2)+"-"+("00"+t.getUTCDate()).slice(-2)+"T"+("00"+t.getUTCHours()).slice(-2)+":"+("00"+t.getUTCMinutes()).slice(-2)+":"+("00"+t.getUTCSeconds()).slice(-2)},CloudHelpers.readableFormatUTCTime=function(e){var t=new Date;return t.setTime(e),t.getUTCFullYear()+"/"+("00"+(t.getUTCMonth()+1)).slice(-2)+"/"+("00"+t.getUTCDate()).slice(-2)+" "+("00"+t.getUTCHours()).slice(-2)+":"+("00"+t.getUTCMinutes()).slice(-2)+":"+("00"+t.getUTCSeconds()).slice(-2)},CloudHelpers.ONE_SECOND=1e3,CloudHelpers.ONE_MINUTE=6e4,CloudHelpers.ONE_HOUR=36e5,CloudHelpers.getCurrentTimeUTC=function(){return Date.now()},CloudHelpers.isLocalFile=function(){return"https:"!=window.location.protocol&&"http:"!=window.location.protocol},CloudHelpers.combineURL=function(e,t,o){""==t&&(t=void 0),""==o&&(o=void 0);var n=CloudHelpers.parseUri(e),e=n.protocol+"://";return(t||o)&&(e+=t,o&&(e+=":"+o),e+="@"),e+=n.host+(""!=n.port?":"+n.port:"")+n.path},CloudHelpers.validIpV4=function(e){for(var t=e.split("."),o=0;o<4;o++){var n=parseInt(t[o],10);if(n<0||255<n)return!1}return!0},CloudHelpers.convertIpV4ToInt=function(e){for(var t=e.split("."),o=0,n=1,r=3;0<=r;r--)o+=parseInt(t[r],10)*n,n*=256;return o},CloudHelpers.isValidHostID=function(e){e=CloudHelpers.parseUri(e);return"localhost"==e.host||(!(CloudHelpers.isIpV4(e.host)&&!CloudHelpers.validIpV4(e.host))||(console.error("Address "+e.host+" - invalid address"),!1))},CloudHelpers.isLocalUrlOrIP=function(e){e=CloudHelpers.parseUri(e);if("localhost"==e.host)return!0;if(CloudHelpers.isIpV4(e.host)){if(!CloudHelpers.validIpV4(e.host))return console.error("Address "+e.host+" - invalid address"),!0;var t=CloudHelpers.convertIpV4ToInt(e.host),o=[];o.push({from:"127.0.0.0",to:"127.255.255.255",comment:"localhost addresses"});for(var n=0;n<o.length;n++){var r=CloudHelpers.convertIpV4ToInt(o[n].from),a=CloudHelpers.convertIpV4ToInt(o[n].to),l=o[n].comment;if(r<=t&&t<=a)return console.error(l),!0}}return!1},CloudHelpers.isPublicUrl=function(e){e=CloudHelpers.parseUri(e);if("localhost"==e.host)return!1;if(CloudHelpers.isIpV4(e.host)){if(!CloudHelpers.validIpV4(e.host))return console.error("Address "+e.host+" - invalid address"),!1;var t=CloudHelpers.convertIpV4ToInt(e.host),o=[];o.push({from:"10.0.0.0",to:"10.255.255.255",comment:"single class A network"}),o.push({from:"172.16.0.0",to:"172.31.255.255",comment:"16 contiguous class B network"}),o.push({from:"192.168.0.0",to:"192.168.255.255",comment:"256 contiguous class C network"}),o.push({from:"169.254.0.0",to:"169.254.255.255",comment:"Link-local address also refered to as Automatic Private IP Addressing"}),o.push({from:"127.0.0.0",to:"127.255.255.255",comment:"localhost addresses"});for(var n=0;n<o.length;n++){var r=CloudHelpers.convertIpV4ToInt(o[n].from),a=CloudHelpers.convertIpV4ToInt(o[n].to),l=o[n].comment;if(r<=t&&t<=a)return console.error(l),!1}}return!0},CloudHelpers.isFrame=function(){try{return window.self!==window.top}catch(e){return!0}},CloudHelpers.isIE=function(){var e=navigator.userAgent.toLowerCase();return-1!==e.indexOf("msie")||-1<e.indexOf("trident")},CloudHelpers.isFireFox=function(){return-1<navigator.userAgent.toLowerCase().indexOf("firefox")},CloudHelpers.isAndroid=function(){return!!navigator.userAgent.match(/Android/i)},CloudHelpers.isIOS=function(){return!!(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i))},CloudHelpers.isWindowsPhone=function(){return!!navigator.userAgent.match(/Windows Phone/i)},CloudHelpers.isBlackBerry=function(){return!!navigator.userAgent.match(/BlackBerry/i)},CloudHelpers.splitUserInfoFromURL=function(e){e=CloudHelpers.parseUri(e);return{url:e.protocol+"://"+e.host+(e.port?":"+e.port:"")+e.path,login:e.user,password:e.password}},CloudHelpers.getAbsolutePosition=function(e){var t={x:e.offsetLeft,y:e.offsetTop};return e.offsetParent&&(e=CloudHelpers.getAbsolutePosition(e.offsetParent),t.x+=e.x,t.y+=e.y),t},CloudHelpers.cache=CloudHelpers.cache||{},CloudHelpers.cache.timezones=CloudHelpers.cache.timezones||{},CloudHelpers.getOffsetTimezone=function(e){return moment?(null==CloudHelpers.cache.timezones[e]&&(t=new Date,e&&""!=e?(t="-"==(o=(n=moment(t).tz(e).format("Z"))[0])?-1:1,o=(n=o<"0"||"9"<o?n.substring(1):n).split(":"),n=t*(60*parseInt(o[0],10)+parseInt(o[1],10)),CloudHelpers.cache.timezones[e]=6e4*n):CloudHelpers.cache.timezones[e]=0),CloudHelpers.cache.timezones[e]):(console.warn("Requrired moment.js library"),0);var t,o,n},Number.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},CloudHelpers.autoPlayAllowed=!0,CloudHelpers.checkAutoplay=function(e){e=e||function(){};var t=new CloudHelpers.promise;t.done(function(){console.log("checkAutoplay: done"),e(CloudHelpers.autoPlayAllowed)}),t.fail(function(){console.log("checkAutoplay: waiting"),e(CloudHelpers.autoPlayAllowed)});var o=null,n=document.createElement("div");n.innerHTML="<video muted></video>",(n=n.children[0]).addEventListener("waiting",function(){console.log("checkAutoplay: waiting, ",o),null==o&&(CloudHelpers.autoPlayAllowed=!0,t.resolve(),n.parentNode.removeChild(n))},!1);var r=n.play(),a="";window.Promise&&(a=window.Promise.toString()),r&&-1!==a.indexOf("function Promise()")||-1!==a.indexOf("function ZoneAwarePromise()")?r.catch(function(e){if("NotAllowedError"==e.name)console.error("error.name:","NotAllowedError"),o=!1,CloudHelpers.autoPlayAllowed=o,t.reject();else if(t.reject(),"AbortError"!=e.name)throw console.error("checkAutoplay: happened something else"),e;n.parentNode&&n.parentNode.removeChild(n)}):(console.warn("checkAutoplay could not work in your browser"),t.reject(),e(CloudHelpers.autoPlayAllowed))},"undefined"!=typeof document&&CloudHelpers.checkAutoplay(function(e){console.log("checkautoplay: autoplay2 ",e)}),CloudHelpers.humanFileSize=function(e){if(e<1024)return e+" B";for(var t=-1;++t,1024<=(e/=1024););return e.toFixed(1)+" "+["kB","MB","GB","TB","PB","EB","ZB","YB"][t]},CloudHelpers.base64_encode=function(e){return window.btoa(e)},CloudHelpers.base64_decode=function(e){return window.atob(e)},CloudHelpers.copy=function(e){if(null==e||"object"!=typeof e)return console.error("Expected object"),e;var t,o=e.constructor();for(t in e)e.hasOwnProperty(t)&&(o[t]=e[t]);return o},CloudHelpers.unpackAccessToken=function(e){var t={host:"web.skyvr.videoexpertsgroup.com"};try{var o=atob(e),o=JSON.parse(o);if(console.log("Token: ",o),!o.token)return console.error('Invalid access token format (missing "token")'),null;if(!o.access)return console.error('Invalid access token format (missing "access")'),null;o.token&&o.camid&&o.access&&""!==o.token&&""!==o.camid&&""!==o.access&&(t.share_token=o.token,t.camid=o.camid,t.access=o.access),o.api&&(t.host=o.api),o.api_p&&(t.api_port=o.api_p),o.api_security_port&&(t.api_security_port=o.api_security_port)}catch(e){return console.error("Invalid access token format"),null}if(t.base_url=t.host,"web.skyvr.videoexpertsgroup.com"==t.host)t.base_url="https://"+t.host;else if("https:"===location.protocol)t.base_url="https://"+t.host,null!=t.api_secutiry_port?(t.base_url+=":"+t.api_secutiry_port,t.port=t.api_secutiry_port):t.port=443;else{if("http:"!==location.protocol&&"file:"!==location.protocol)return console.error("Invalid protocol"),null;t.base_url="http://"+t.host,null!=self.api_port?(t.base_url+=":"+t.api_port,t.port=t.api_port):t.port=80}return t},CloudHelpers.createCallbacks=function(){return new function(){var n={};console.log(this);var o=this;o.executeCallbacks=function(e,t){for(var o in n)!function(e,t,o){setTimeout(function(){n[e](t,o)},1)}(o,e,t)},o.removeCallback=function(e){delete n[e]},o.addCallback=function(e,t){"function"==typeof t?(n[e]&&(console.warn(e+" - already registered callback, will be removed before add"),o.removeCallback(e)),n[e]=t):console.error("Second parameter expected function")}}},CloudHelpers.compareVersions=function(e,t){t=t||"0.0.0";var o=(e=e||"0.0.0").split("."),n=t.split(".");if(3==o.length&&3==n.length){for(var r=0;r<3;r++)if(o[r]=parseInt(o[r],10),n[r]=parseInt(n[r],10),o[r]!=n[r])return n[r]-o[r];return 0}console.error("[CloudHelpers.compareVersions] could not compare versions ",e,t)},window.CloudAPI=function(e,t){var l=this;l.token=e.token,l.token_expire=e.expire,l.token_expireUTC=Date.parse(e.expire+"Z"),l.host=t,l.token_type=e.type,l.requestWrap=new CloudHelpers.RequestWrap,l.isShareToken=function(){return"share"==l.token_type},l.endpoints={api:l.host+"api/v2/",cameras:l.host+"api/v2/cameras/",admin_cameras:l.host+"api/v2/admin/cameras/",camsess:l.host+"api/v2/camsess/",server:l.host+"api/v2/server/",account:l.host+"api/v2/account/",cmngrs:l.host+"api/v2/cmngrs/",storage:l.host+"api/v2/storage/",clips:l.host+"api/v2/storage/clips/",channels:l.host+"api/v3/channels/"},l.endpoints_v4={api:l.host+"api/v4/",live_watch:l.host+"api/v4/live/watch/",images:l.host+"api/v4/storage/images/"},l._getCloudToken=function(){return l.token},l.updateApiToken=function(){return l.requestWrap.request({url:l.endpoints.account+"token/api/",type:"GET",token:l._getCloudToken()})},l.isShareToken()||l.updateApiToken().done(function(e){console.warn("[CloudConnection] Cloud Token Api refreshed"),l.token=e.token,l.token_expire=e.expire,l.token_expireUTC=Date.parse(e.expire+"Z"),clearInterval(l.updateTokenInterval),l.updateTokenInterval=setInterval(function(){l.token_expireUTC-(new Date).getTime()<12e5?l.updateApiToken().done(function(e){console.warn("[CloudConnection] Cloud Token api refreshed"),l.token=e.token,l.token_expire=e.expire,l.token_expireUTC=Date.parse(e.expire+"Z")}):console.log("[CloudConnection] Cloud Token is live")},3e5)}),l.dispose=function(){delete l.requestWrap,l.token=null,clearInterval(l.updateTokenInterval)},l.createCamera=function(e){return l.requestWrap.request({url:l.endpoints.cameras+"?detail=detail",type:"POST",token:l._getCloudToken(),data:JSON.stringify(e),contentType:"application/json"})},l.camerasList=function(e){e=e||{},l.isShareToken()&&(e.token=l._getCloudToken());e=CloudHelpers.mapToUrlQuery(e);return l.requestWrap.request({url:l.endpoints.cameras+"?"+e,type:"GET",token:l._getCloudToken(),contentType:"application/json"})},l.getCameraList=l.camerasList,l.deleteCamera=function(e){return l.requestWrap.request({url:l.endpoints.cameras+e+"/",type:"DELETE",token:l._getCloudToken()})},l.getCamera=function(e,t){(t=t||{}).detail="detail",l.isShareToken()&&(t.token=l._getCloudToken());t=CloudHelpers.mapToUrlQuery(t);return l.requestWrap.request({url:l.endpoints.cameras+e+"/?"+t,type:"GET",token:l._getCloudToken()})},l.getCamera2=function(e,t){t=t||{},l.isShareToken()&&(t.token=l._getCloudToken());t=CloudHelpers.mapToUrlQuery(t);return l.requestWrap.request({url:l.endpoints.cameras+e+"/?"+t,type:"GET",token:l._getCloudToken()})},l.cameraUsage=function(e){return l.requestWrap.request({url:l.endpoints.cameras+e+"/usage/",type:"GET",token:l._getCloudToken()})},l.updateCamera=function(e,t){t=t||{},l.isShareToken()&&(t.token=l._getCloudToken());var o=CloudHelpers.mapToUrlQuery(t);return l.requestWrap.request({url:l.endpoints.cameras+e+"/?"+o,type:"PUT",token:l._getCloudToken(),data:JSON.stringify(t),contentType:"application/json"})},l.cameraLiveUrls=function(e,t=""){var o={},e=l.endpoints.cameras+e+"/live_urls/?";""!==t&&(o.stream_id=t),l.isShareToken()&&(o.token=l._getCloudToken(),e=l.endpoints_v4.live_watch+"?");o=CloudHelpers.mapToUrlQuery(o);return l.requestWrap.request({url:e+o,type:"GET",token:l._getCloudToken()})},l.cameraBackwardUrls=function(e){var t={},o=l.endpoints.cameras+e+"/live_urls/?media_urls=webrtc_back,rtmp_back&";l.isShareToken()&&(t.token=l._getCloudToken());e=CloudHelpers.mapToUrlQuery(t);return l.requestWrap.request({url:o+e,type:"GET",token:l._getCloudToken(),data:JSON.stringify(t)})},l.cameraStreamUrls_webrtc=function(e){var t={},o=l.endpoints.cameras+e+"/stream_urls/?";t.proto="webrtc",l.isShareToken()&&(t.token=l._getCloudToken());e=CloudHelpers.mapToUrlQuery(t);return l.requestWrap.request({url:o+e,type:"GET",token:l._getCloudToken(),data:JSON.stringify(t)})},l.getServerTime=function(){var o=CloudHelpers.promise();return l.requestWrap.request({url:l.endpoints.api+"server/time/",type:"GET"}).done(function(e){var t=CloudHelpers.getCurrentTimeUTC();l.diffServerTime=Date.parse(e.utc+"Z")-t,o.resolve(e)}).fail(function(e){o.reject(e)}),o},l.getAccountInfo=function(){return l.requestWrap.request({url:l.endpoints.account,type:"GET",token:l._getCloudToken()})},l.getAccountCapabilities=function(){return l.requestWrap.request({url:l.endpoints.account+"capabilities/",type:"GET",token:l._getCloudToken()})},l.cameraMediaStreams=function(e){var t={};l.isShareToken()&&(t.token=l._getCloudToken());t=CloudHelpers.mapToUrlQuery(t);return l.requestWrap.request({url:l.endpoints.cameras+e+"/media_streams/?"+t,type:"GET",token:l._getCloudToken()})},l.updateCameraMediaStreams=function(e,t){t=t||{},l.isShareToken()&&(t.token=l._getCloudToken());var o=CloudHelpers.mapToUrlQuery(t);return l.requestWrap.request({url:l.endpoints.cameras+e+"/media_streams/?"+o,type:"PUT",token:l._getCloudToken(),data:JSON.stringify(t),contentType:"application/json"})},l.getCameraVideoStreams=function(e){return l.requestWrap.request({url:l.endpoints.cameras+e+"/video/streams",type:"GET",contentType:"application/json",token:l._getCloudToken()})},l.getCameraVideoStream=function(e,t){var o={};l.isShareToken()&&(o.token=l._getCloudToken());o=CloudHelpers.mapToUrlQuery(o);return l.requestWrap.request({url:l.endpoints.cameras+e+"/video/streams/"+t+"/?"+o,type:"GET",token:l._getCloudToken()})},l.cameraPreview=function(e){var t={};l.isShareToken()&&(t.token=l._getCloudToken());t=CloudHelpers.mapToUrlQuery(t);return l.requestWrap.request({url:l.endpoints.cameras+e+"/preview/?"+t,type:"GET",token:l._getCloudToken()})},l.cameraUpdatePreview=function(e){var t={};l.isShareToken()&&(t.token=l._getCloudToken());t=CloudHelpers.mapToUrlQuery(t);return l.requestWrap.request({url:l.endpoints.cameras+e+"/preview/update/?"+t,type:"POST",token:l._getCloudToken()})},l.cameraSendPtz=function(e,t){t=t||{};var o={};l.isShareToken()&&(o.token=l._getCloudToken());o=CloudHelpers.mapToUrlQuery(o);return l.requestWrap.request({url:l.endpoints.cameras+e+"/send_ptz/?"+o,type:"POST",token:l._getCloudToken(),data:JSON.stringify(t),contentType:"application/json"})},l.cameraPtzExecute=function(e,t){t=t||{};var o={};l.isShareToken()&&(o.token=l._getCloudToken());o=CloudHelpers.mapToUrlQuery(o);return l.requestWrap.request({url:l.endpoints.cameras+e+"/ptz/execute/?"+o,type:"POST",token:l._getCloudToken(),data:JSON.stringify(t),contentType:"application/json"})},l.cameraPtz=function(e){var t={};l.isShareToken()&&(t.token=l._getCloudToken());t=CloudHelpers.mapToUrlQuery(t);return l.requestWrap.request({url:l.endpoints.cameras+e+"/ptz/?"+t,type:"GET",token:l._getCloudToken()})},l.cameraAudio=function(e){var t={};l.isShareToken()&&(t.token=l._getCloudToken());t=CloudHelpers.mapToUrlQuery(t);return l.requestWrap.request({url:l.endpoints.cameras+e+"/audio/?"+t,type:"GET",token:l._getCloudToken()})},l.storageRecords=function(e,t,o){var n=CloudHelpers.promise(),t={camid:e,limit:1e3,offset:0,start:t};return o&&(t.end=o),l.isShareToken()&&(t.token=l._getCloudToken()),CloudHelpers.requestAsyncList(function(e){return e=CloudHelpers.mapToUrlQuery(e),l.requestWrap.request({url:l.endpoints.storage+"data/?"+e,type:"GET",token:l._getCloudToken()})},t,n),n},l.storageRecordsFirst=function(e,t,o){CloudHelpers.promise();t={camid:e,limit:o,offset:0,start:t};t.limit=o,l.isShareToken()&&(t.token=l._getCloudToken());t=CloudHelpers.mapToUrlQuery(t);return l.requestWrap.request({url:l.endpoints.storage+"data/?"+t,type:"GET",token:l._getCloudToken()})},l.storageTimeline=function(e,t,o,n){n={start:t,end:o,slices:n};l.isShareToken()&&(n.token=l._getCloudToken());n=CloudHelpers.mapToUrlQuery(n);return l.requestWrap.request({url:l.endpoints.storage+"timeline/"+e+"/?"+n,type:"GET",token:l._getCloudToken()})},l.storageActivity=function(e,t){e={camid:e};t&&(e.daysincamtz=""),l.isShareToken()&&(e.token=l._getCloudToken());e=CloudHelpers.mapToUrlQuery(e);return l.requestWrap.request({url:l.endpoints.storage+"activity/?"+e,type:"GET",token:l._getCloudToken()})},l.resetCameraManager=function(e,t){return l.isShareToken()?(t=t||{},l.requestWrap.request({url:l.endpoints.cmngrs+e+"/reset/?token="+l._getCloudToken(),type:"POST",data:JSON.stringify(t),contentType:"application/json"})):(t=t||{},l.requestWrap.request({url:l.endpoints.cmngrs+e+"/reset/",type:"POST",token:l._getCloudToken(),data:JSON.stringify(t),contentType:"application/json"}))},l.updateCameraManager=function(e,t){return t=t||{},l.requestWrap.request({url:l.endpoints.cmngrs+e+"/",type:"PUT",token:l._getCloudToken(),data:JSON.stringify(t),contentType:"application/json"})},l.getCamsessList=function(e){e=CloudHelpers.mapToUrlQuery(e);return l.requestWrap.request({url:l.endpoints.camsess+"?"+e,type:"GET",token:l._getCloudToken(),contentType:"application/json"})},l.getCamsess=function(e){return l.requestWrap.request({url:l.endpoints.camsess+e+"/?detail=detail",type:"GET",token:l._getCloudToken(),contentType:"application/json"})},l.getCamsessRecords=function(e){return l.requestWrap.request({url:l.endpoints.camsess+e+"/records/",type:"GET",token:l._getCloudToken(),contentType:"application/json"})},l.deleteCamsess=function(e){return l.requestWrap.request({url:l.endpoints.camsess+e+"/",type:"DELETE",token:l._getCloudToken()})},l.creareCameraSharingToken=function(e,t,o){return t=t||"",l.requestWrap.request({url:l.endpoints.cameras+e+"/sharings/",type:"POST",data:JSON.stringify({camid:e,name:t,access:o}),contentType:"application/json",token:l._getCloudToken()})},l.updateCameraSharingToken=function(e,t,o){return(o=o||{}).camid=e,o.shid=t,l.requestWrap.request({url:l.endpoints.cameras+e+"/sharings/"+t+"/",type:"PUT",data:JSON.stringify(o),contentType:"application/json",token:l._getCloudToken()})},l.getCameraSharingTokensList=function(e){return l.requestWrap.request({url:l.endpoints.cameras+e+"/sharings/?detail=detail",type:"GET",token:l._getCloudToken()})},l.deleteCameraSharingToken=function(e,t){return l.requestWrap.request({url:l.endpoints.cameras+e+"/sharings/"+t+"/",type:"DELETE",token:l._getCloudToken()})},l.toggleMemRec=function(e,t,o){var n=n||{};return n.memorycard_recording=t,l.requestWrap.request({url:l.endpoints.cameras+e,type:"PUT",data:JSON.stringify(n),contentType:"application/json",access_token:o})},l.createClip=function(e,t,o,n,r,a){obj={},obj.camid=e,obj.source_camid=e,obj.start=o,obj.end=n,obj.wait_for_data=!0,void 0!==r&&(obj.delete_at=r);r={};return r.url=l.endpoints.clips,r.type="POST",r.data=JSON.stringify(obj),r.contentType="application/json",void 0!==a?r.access_token=a:r.token=l._getCloudToken(),l.requestWrap.request(r)},l.getClip=function(e,t){var o={};return o.url=l.endpoints.clips+e+"/",o.type="GET",void 0!==t?o.access_token=t:o.token=l._getCloudToken(),l.requestWrap.request(o)},l.getChannels=function(){return l.requestWrap.request({url:l.endpoints.channels,type:"GET",token:l._getCloudToken()})},l.getCameraStreamingURLs=function(e){return l.requestWrap.request({url:l.endpoints.cameras+e+"/stream_urls/",type:"GET",token:l._getCloudToken()})},l.cameraImages=function(e){var t={};l.isShareToken()&&(t.token=l._getCloudToken()),void 0!==e.start&&(t.start=e.start),void 0!==e.end&&(t.end=e.end),void 0!==e.order_by&&(t.order_by=e.order_by),void 0!==e.origin&&(t.origin=e.origin),void 0!==e.limit&&(t.limit=e.limit),void 0!==e.offset&&(t.offset=e.offset);var o=l.endpoints_v4.images+"?",e=CloudHelpers.mapToUrlQuery(t);return l.requestWrap.request({url:o+e,type:"GET",token:l._getCloudToken(),data:JSON.stringify(t)})}},window.SkyVR=window.CloudAPI,CloudAPI.config={url:"",url_cameras:"",url_api:"",cameraID:"",user_name:"",vendor:""},CloudAPI.setToCookie=function(e,t){var o=new Date((new Date).getTime()+6048e5);document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+"; path=/; expires="+o.toUTCString()},CloudAPI.getFromCookie=function(e){e=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return e?decodeURIComponent(e[1]):""},CloudAPI.removeFromCookie=function(e){document.cookie=encodeURIComponent(e)+"=; path=/;"},CloudAPI.cache={cameras:{},timezones:{}},CloudAPI.cache.cameraInfo=function(e){return e?CloudAPI.cache.cameras[e]:CloudAPI.isCameraID()?CloudAPI.cache.cameras[CloudAPI.cameraID()]:void 0},CloudAPI.cache.getCameraInfo=CloudAPI.cache.cameraInfo,CloudAPI.cache.mergeObjects=function(e,t){for(var o in t){var n=typeof t[o];"boolean"==n||"string"==n||"number"==n?e[o]!=t[o]&&(e[o]&&(console.log("Changed "+o),CloudAPI.events.trigger("CAMERA_INFO_CHANGED",{name:o,new_value:t[o]})),e[o]=t[o]):Array.isArray(t[o])?e[o]=t[o]:"object"==n&&(e[o]||(e[o]={}),e[o]=CloudAPI.cache.mergeObjects(e[o],t[o]))}return e},CloudAPI.cache.updateCameraInfo=function(e){var t=e.id;CloudAPI.cache.cameras[t]||(CloudAPI.cache.cameras[t]={}),CloudAPI.cache.cameras[t]=CloudAPI.cache.mergeObjects(CloudAPI.cache.cameras[t],e)},CloudAPI.cache.setCameraInfo=function(e){var t=e.id;null==CloudAPI.cache.cameras[t]&&(CloudAPI.cache.cameras[t]={});var o=!(!e.p2p_streaming||1!=e.p2p_streaming),n=CloudAPI.cache.cameras[t];return CloudAPI.cache.cameras[t]=CloudAPI.cache.mergeObjects(n,e),CloudAPI.cache.cameras[t].lastTimeUpdated=Date.now(),o},CloudAPI.cache.setP2PSettings=function(e,t){null==CloudAPI.cache.cameras[e]&&(CloudAPI.cache.cameras[e]={}),CloudAPI.cache.cameras[e].p2p=t,CloudAPI.cache.cameras[e].p2p_settings=CloudAPI.cache.cameras[e].p2p},CloudAPI.cache.setMemoryCard=function(e,t){null==CloudAPI.cache.cameras[e]&&(CloudAPI.cache.cameras[e]={}),CloudAPI.cache.cameras[e].memory_card=t},CloudAPI.cache.setPtzCaps=function(e,t){null==CloudAPI.cache.cameras[e]&&(CloudAPI.cache.cameras[e]={}),CloudAPI.cache.cameras[e].ptz=t},CloudAPI.cache.updateCameraAudio=function(e,t){CloudAPI.cache.cameras[e]||(CloudAPI.cache.cameras[e]={}),CloudAPI.cache.cameras[e].audio||(CloudAPI.cache.cameras[e].audio={}),CloudAPI.cache.cameras[e].audio=CloudAPI.cache.mergeObjects(CloudAPI.cache.cameras[e].audio,t)},CloudAPI.cache.cameraAudio=function(e){return e=e||CloudAPI.cameraID(),CloudAPI.cache.cameras[e]?CloudAPI.cache.cameras[e].audio:{}},CloudAPI.cache.updateCameraVideo=function(e,t){CloudAPI.cache.cameras[e]||(CloudAPI.cache.cameras[e]={}),CloudAPI.cache.cameras[e].video||(CloudAPI.cache.cameras[e].video={});var o=CloudAPI.cache.cameras[e].video;CloudAPI.cache.cameras[e].video=CloudAPI.cache.mergeObjects(o,t)},CloudAPI.cache.cameraVideo=function(e){return e=e||CloudAPI.cameraID(),CloudAPI.cache.cameras[e]?CloudAPI.cache.cameras[e].video:{}},CloudAPI.cache.cameraVideoStreamName=function(e){if(e=e||CloudAPI.cameraID(),!CloudAPI.cache.cameras[e])return{};var t=CloudAPI.cache.cameras[e].video;if(t.streams){e=0;if(e<t.streams.length)return v}},CloudAPI.cache.cameraVideoStreams=function(e){if(e=e||CloudAPI.cameraID(),!CloudAPI.cache.cameras[e])return{};e=CloudAPI.cache.cameras[e].video;return e.streams||void 0},CloudAPI.cache.setLimits=function(e,t){CloudAPI.cache.cameras[e]||(CloudAPI.cache.cameras[e]={}),CloudAPI.cache.cameras[e].limits=t},CloudAPI.cache.updateCameraVideoStream=function(e,t,o){CloudAPI.cache.cameras[e]||(CloudAPI.cache.cameras[e]={}),CloudAPI.cache.cameras[e].video||(CloudAPI.cache.cameras[e].video={}),CloudAPI.cache.cameras[e].video.streams||(CloudAPI.cache.cameras[e].video.streams={}),CloudAPI.cache.cameras[e].video.streams[t]||(CloudAPI.cache.cameras[e].video.streams[t]={});var n=CloudAPI.cache.cameras[e].video.streams[t];CloudAPI.cache.cameras[e].video.streams[t]=CloudAPI.cache.mergeObjects(n,o)},CloudAPI.cache.setAudioStream=function(e,t,o){CloudAPI.cache.cameras[e]||(CloudAPI.cache.cameras[e]={}),CloudAPI.cache.cameras[e].audio||(CloudAPI.cache.cameras[e].audio={}),CloudAPI.cache.cameras[e].audio.streams||(CloudAPI.cache.cameras[e].audio.streams={}),CloudAPI.cache.cameras[e].audio.streams[t]=o},CloudAPI.cache.setMediaStreams=function(e,t){CloudAPI.cache.cameras[e]||(CloudAPI.cache.cameras[e]={}),CloudAPI.cache.cameras[e].media_streams=t},CloudAPI.cache.updateEventProcessingEventsMotion=function(e,t){CloudAPI.cache.cameras[e]||(CloudAPI.cache.cameras[e]={}),CloudAPI.cache.cameras[e].event_processing||(CloudAPI.cache.cameras[e].event_processing={}),CloudAPI.cache.cameras[e].event_processing.events||(CloudAPI.cache.cameras[e].event_processing.events={}),CloudAPI.cache.cameras[e].event_processing.events.motion||(CloudAPI.cache.cameras[e].event_processing.events.motion={});var o=CloudAPI.cache.cameras[e].event_processing.events.motion;CloudAPI.cache.cameras[e].event_processing.events.motion=CloudAPI.cache.mergeObjects(o,t)},CloudAPI.cache.updateCameraEventProcessingEventsSound=function(e,t){CloudAPI.cache.cameras[e]||(CloudAPI.cache.cameras[e]={}),CloudAPI.cache.cameras[e].event_processing||(CloudAPI.cache.cameras[e].event_processing={}),CloudAPI.cache.cameras[e].event_processing.events||(CloudAPI.cache.cameras[e].event_processing.events={}),CloudAPI.cache.cameras[e].event_processing.events.sound||(CloudAPI.cache.cameras[e].event_processing.events.sound={});var o=CloudAPI.cache.cameras[e].event_processing.events.sound;CloudAPI.cache.cameras[e].event_processing.events.sound=CloudAPI.cache.mergeObjects(o,t)},CloudAPI.generateNewLocation=function(e){var t=[];return CloudHelpers.containsPageParam("lang")&&t.push("lang="+encodeURIComponent(CloudAPI.pageParams.lang)),CloudHelpers.containsPageParam("vendor")&&t.push("vendor="+encodeURIComponent(CloudAPI.pageParams.vendor)),CloudHelpers.containsPageParam("mobile")&&t.push("mobile="+encodeURIComponent(CloudAPI.pageParams.mobile)),t.push("p="+encodeURIComponent(e)),"?"+t.join("&")},CloudAPI.setURL=function(e){var t;CloudAPI.config.url!=e&&(CloudAPI.config.url=e,CloudAPI.config.url_api=e+"api/v2/",CloudAPI.config.url_cameras=e+"api/v2/cameras/",CloudAPI.config.url_admin_cameras=e+"api/v2/admin/cameras/",CloudAPI.config.url_camsess=e+"api/v2/camsess/",CloudAPI.config.url_server=e+"api/v2/server/",CloudAPI.config.url_account=e+"api/v2/account/",CloudAPI.config.url_cmngrs=e+"api/v2/cmngrs/",CloudAPI.config.url_storage=e+"api/v2/storage/",CloudAPI.config.url_clips=e+"api/v2/storage/clips/",CloudAPI.config.anonToken={token:"",type:"anon",expire:"",expireTimeUTC:0},void 0!==localStorage&&localStorage.getItem("SkyVR_anonToken")&&(CloudAPI.config.anonToken=JSON.parse(localStorage.getItem("SkyVR_anonToken"))),CloudAPI.config.apiToken={token:"",type:"api",expire:"",expireTimeUTC:0},CloudAPI.config.shareToken={},!(t=CloudAPI.getFromStorage("SkyVR_apiToken"))||(t=JSON.parse(t)).expireTimeUTC>Date.now()&&(CloudAPI.config.apiToken=t),CloudAPI.setToStorage("CloudAPI_svcp_host",e))},CloudAPI.isExpiredApiToken=function(){return!CloudAPI.config.apiToken.expireTimeUTC||!(CloudAPI.config.apiToken.expireTimeUTC>Date.now())},CloudAPI.applyApiToken=function(){$.ajaxSetup({crossDomain:!0,cache:!1,beforeSend:function(e,t){CloudAPI.config.apiToken&&CloudAPI.config.apiToken.token}})},CloudAPI.enable401handler=function(){},CloudAPI.disable401handler=function(){$.ajaxSetup({error:function(e,t,o){}})},CloudAPI.printStack=function(){var e=new Error;console.error(e.stack)},CloudAPI.PAGE_SIGNIN="signin",CloudAPI.hasAccess=function(e,t){if(SkyUI.isDemo())return!0;if(!e)return!1;if(!e.access)return!0;for(var o=!1,n=0;n<e.access.length;n++)e.access[n]==t&&(o=!0);return o},CloudAPI.hasAccessSettings=function(e){return!!SkyUI.isDemo()||(e=e||CloudAPI.cache.cameraInfo(),CloudAPI.hasAccess(e,"all"))},CloudAPI.hasAccessMotionDetection=function(e){return!!SkyUI.isDemo()||(e=e||CloudAPI.cache.cameraInfo(),CloudAPI.hasAccess(e,"all")||CloudAPI.hasAccess(e,"ptz"))},CloudAPI.hasAccessClips=function(e){return!!SkyUI.isDemo()||(e=e||CloudAPI.cache.cameraInfo(),CloudAPI.hasAccess(e,"clipping")||CloudAPI.hasAccess(e,"clipplay")||CloudAPI.hasAccess(e,"watch")||CloudAPI.hasAccess(e,"cplay")||CloudAPI.hasAccess(e,"all"))},CloudAPI.hasAccessLive=function(e){return!!SkyUI.isDemo()||(e=e||CloudAPI.cache.cameraInfo(),CloudAPI.hasAccess(e,"ptz")||CloudAPI.hasAccess(e,"live")||CloudAPI.hasAccess(e,"watch")||CloudAPI.hasAccess(e,"all"))},CloudAPI.hasAccessPlayback=function(e){return!!SkyUI.isDemo()||(e=e||CloudAPI.cache.cameraInfo(),CloudAPI.hasAccess(e,"clipping")||CloudAPI.hasAccess(e,"play")||CloudAPI.hasAccess(e,"watch")||CloudAPI.hasAccess(e,"splay")||CloudAPI.hasAccess(e,"all"))},CloudAPI.hasAccessMakeClip=function(e){return!!SkyUI.isDemo()||(e=e||CloudAPI.cache.cameraInfo(),CloudAPI.hasAccess(e,"clipping")||CloudAPI.hasAccess(e,"all"))},CloudAPI.hasAccessBackAudio=function(e){return!!SkyUI.isDemo()||(e=e||CloudAPI.cache.cameraInfo(),CloudAPI.hasAccess(e,"all")||CloudAPI.hasAccess(e,"backaudio"))},CloudAPI.handleNothing=function(e){},CloudAPI.handleNothingError=function(e,t,o){},CloudAPI.handleError=function(e,t,o){console.error(o)},CloudAPI.parseUri=function(e){function a(e){for(var n=a.options,t=n.parser[n.strictMode?"strict":"loose"].exec(e),r={},o=14;o--;)r[n.key[o]]=t[o]||"";return r[n.q.name]={},r[n.key[12]].replace(n.q.parser,function(e,t,o){t&&(r[n.q.name][t]=o)}),r}return a.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},a(e)},CloudAPI.logout=function(e){$.ajax({url:CloudAPI.config.url_account+"logout/",type:"POST",success:e,error:CloudAPI.handleError})},CloudAPI.cameraVideoStream=function(t){var o=$.Deferred();if(!CloudAPI.isCameraID())return o.reject(),o;var n=CloudAPI.config.cameraID;return $.ajax({url:CloudAPI.config.url_cameras+n+"/video/streams/"+t+"/",type:"GET"}).done(function(e){CloudAPI.cache.updateCameraVideoStream(n,t,e),o.resolve(e)}).fail(function(){o.reject()}),o},CloudAPI.cameraLimits=function(){var t=$.Deferred();if(!CloudAPI.isCameraID())return t.reject(),t;var e=CloudAPI.config.cameraID;return $.ajax({url:CloudAPI.config.url_cameras+e+"/limits/",type:"GET"}).done(function(e){CloudAPI.cache.setLimits(CloudAPI.cameraID(),e),t.resolve(e)}).fail(function(){t.reject()}),t},CloudAPI.cameraEventProcessingEventsMotion=function(){var t=$.Deferred();if(!CloudAPI.isCameraID())return t.reject(),t;var o=CloudAPI.config.cameraID;return $.ajax({url:CloudAPI.config.url_cameras+o+"/event_processing/events/motion/",type:"GET"}).done(function(e){CloudAPI.cache.updateEventProcessingEventsMotion(o,e),t.resolve(e)}).fail(function(){t.reject()}),t},CloudAPI.updateCameraEventProcessingEventsMotion=function(e){var t=$.Deferred();if(!CloudAPI.isCameraID())return t.reject(),t;var o=CloudAPI.cameraID();return $.ajax({url:CloudAPI.config.url_cameras+o+"/event_processing/events/motion/",type:"PUT",data:JSON.stringify(e),contentType:"application/json"}).done(function(){CloudAPI.cache.updateEventProcessingEventsMotion(o,e),t.resolve()}).fail(function(){t.reject()}),t},CloudAPI.cameraEventProcessingEventsSound=function(){var t=$.Deferred();if(!CloudAPI.isCameraID())return t.reject(),t;var o=CloudAPI.config.cameraID;return $.ajax({url:CloudAPI.config.url_cameras+o+"/event_processing/events/sound/",type:"GET"}).done(function(e){CloudAPI.cache.updateCameraEventProcessingEventsSound(o,e),t.resolve(e)}).fail(function(){t.reject()}),t},CloudAPI.updateCameraEventProcessingEventsSound=function(e){var t=$.Deferred();if(!CloudAPI.isCameraID())return t.reject(),t;var o=CloudAPI.cameraID();return $.ajax({url:CloudAPI.config.url_cameras+o+"/event_processing/events/sound/",type:"PUT",data:JSON.stringify(e),contentType:"application/json"}).done(function(){CloudAPI.cache.updateCameraEventProcessingEventsSound(o,e),t.resolve()}).fail(function(){t.reject()}),t},CloudAPI.updateCameraVideoStream=function(e,t){var o=$.Deferred();if(!CloudAPI.isCameraID())return o.reject(),o;var n=CloudAPI.cameraID();return $.ajax({url:CloudAPI.config.url_cameras+n+"/video/streams/"+e+"/",type:"PUT",data:JSON.stringify(t),contentType:"application/json"}).done(function(){console.log("[CLOUDAPI] [CLOUDAPI] Updated video/streams/"+e+" in cache for "+n),CloudAPI.cache.updateCameraVideoStream(n,e,t),o.resolve()}).fail(function(){o.reject()}),o},CloudAPI.setVBRQuality=function(e,t,o,n){CloudAPI.isCameraID()&&(o=null==o?CloudAPI.handleNothing:o,n=null==n?CloudAPI.handleError:n,(n={}).vbr_quality=e,n.vbr=!0,$.ajax({url:CloudAPI.config.url_cameras+CloudAPI.config.cameraID+"/video/streams/"+t+"/",type:"PUT",success:o,error:o,data:JSON.stringify(n),contentType:"application/json"}))},CloudAPI.formatMemoryCard=function(){var t=$.Deferred();if(!CloudAPI.isCameraID())return t.reject(),t;var e=CloudAPI.config.cameraID;return $.ajax({url:CloudAPI.config.url_cameras+e+"/format_memory_card/",type:"POST"}).done(function(e){t.resolve(e)}).fail(function(){t.reject()}),t},CloudAPI.cameraMemoryCard=function(t){var o=$.Deferred();return(t=t||CloudAPI.config.cameraID)?$.ajax({url:CloudAPI.config.url_cameras+t+"/memory_card/",type:"GET"}).done(function(e){CloudAPI.cache.setMemoryCard(t,e),o.resolve(e)}).fail(function(){CloudAPI.cache.setMemoryCard(t,{status:"none"}),o.reject()}):o.reject(),o},CloudAPI.cameraWifi=function(){var t=$.Deferred();return CloudAPI.isCameraID()?$.ajax({url:CloudAPI.config.url_cameras+CloudAPI.config.cameraID+"/wifi/",type:"GET"}).done(function(e){t.resolve(e)}).fail(function(){t.reject()}):t.reject(),t},CloudAPI.cameraFirmwares=function(){var t=$.Deferred();return CloudAPI.isCameraID()?$.ajax({url:CloudAPI.config.url_cameras+CloudAPI.config.cameraID+"/firmwares/?limit=1000",type:"GET",contentType:"application/json"}).done(function(e){t.resolve(e.objects)}).fail(function(){t.reject()}):t.reject(),t},CloudAPI.cameraFirmwaresUpgrade=function(e){var o=$.Deferred();if(!CloudAPI.isCameraID())return o.reject(),o;console.log("[CLOUDAPI] upgrade firmware to version: "+e);var t={};return t.version=e,$.ajax({url:CloudAPI.config.url_cameras+CloudAPI.config.cameraID+"/firmwares/upgrade/",type:"POST",data:JSON.stringify(t),contentType:"application/json"}).done(function(){o.resolve()}).fail(function(e,t){console.error("[CLOUDAPI] cameraFirmwaresUpgrade, "+t,e),o.reject()}),o},CloudAPI.accountInfo=function(){var t=$.Deferred();return $.ajax({url:CloudAPI.config.url_account,type:"GET",cache:!1}).done(function(e){CloudAPI.cache.account=e,t.resolve(e)}).fail(function(e){console.log("Fail "+CloudAPI.config.url_account),console.error(e),t.reject(e)}),t},CloudAPI.anonToken=function(){var t=$.Deferred(),e=Date.now(),o=CloudAPI.config.anonToken.expireTimeUTC-6e5,n=CloudAPI.config.anonToken.expireTimeUTC-3e5;return o<e&&e<n?($.ajaxSetup({crossDomain:!0,cache:!1,headers:{}}),t.resolve(CloudAPI.config.anonToken)):$.ajax({url:CloudAPI.config.url_account+"token/anon/",type:"GET"}).done(function(e){CloudAPI.config.anonToken.token=e.token,CloudAPI.config.anonToken.type=e.type,CloudAPI.config.anonToken.expire=e.expire,CloudAPI.config.anonToken.expireTimeUTC=Date.parse(e.expire+"Z"),CloudAPI.setToStorage("SkyVR_anonToken",JSON.stringify(CloudAPI.config.anonToken)),$.ajaxSetup({crossDomain:!0,cache:!1,headers:{}}),t.resolve(CloudAPI.config.anonToken)}).fail(function(){t.reject()}),t},CloudAPI.accountShare=function(e){return CloudAPI.cameraID(),$.ajax({url:CloudAPI.config.url_account+"share/",type:"POST",data:JSON.stringify(e),contentType:"application/json",cache:!1})},CloudAPI.capabilities=function(e,t){e=null==e?CloudAPI.handleNothing:e,t=null==t?CloudAPI.handleError:t,$.ajax({url:CloudAPI.config.url_api+"capabilities/",type:"GET",success:e,error:t})},CloudAPI.cameraInfo=function(t){var o=$.Deferred();return null==(t=t||CloudAPI.cameraID())?o.reject():$.ajax({url:CloudAPI.config.url_cameras+t+"/",type:"GET"}).done(function(e){CloudAPI.cache.cameras[e.id]&&!CloudAPI.cache.cameras[e.id].memory_card?(console.log("cameraInfo cahce has not memory card info for camid="+e.id),CloudAPI.cameraMemoryCard(e.id)):CloudAPI.cache.cameras[e.id]||(console.log("cameraInfo has not in cache for camid="+e.id),CloudAPI.cameraMemoryCard(e.id)),CloudAPI.cache.setCameraInfo(e)?CloudAPI.cameraP2PSettings(t).done(function(e){o.resolve(CloudAPI.cache.cameras[t])}).fail(function(){o.resolve(CloudAPI.cache.cameras[t])}):o.resolve(CloudAPI.cache.cameras[t])}).fail(function(){o.reject()}),o},CloudAPI.updateCamera=function(t){var o=$.Deferred();return CloudAPI.isCameraID()?$.ajax({url:CloudAPI.config.url_cameras+CloudAPI.cameraID()+"/",type:"PUT",data:JSON.stringify(t),contentType:"application/json"}).done(function(e){console.log("[CLOUDAPI] Updated camera in cache for "+CloudAPI.cameraID()),t.id=CloudAPI.cameraID(),CloudAPI.cache.updateCameraInfo(t),o.resolve(e)}).fail(function(){o.reject()}):o.reject(),o},CloudAPI.cameraMesaging=function(e){var t=$.Deferred();return null==(e=e||CloudAPI.cameraID())?t.reject():$.ajax({url:CloudAPI.config.url_cameras+e+"/raw_messaging/",type:"GET"}).done(function(e){t.resolve(e)}).fail(function(e){t.reject(e)}),t},CloudAPI.updateCameraAudio=function(t){var o=$.Deferred();if(!CloudAPI.isCameraID())return o.reject(),o;var n=CloudAPI.cameraID();return $.ajax({url:CloudAPI.config.url_cameras+n+"/audio/",type:"PUT",data:JSON.stringify(t),contentType:"application/json"}).done(function(e){console.log("[CLOUDAPI] Updated audio in cache for "+n),CloudAPI.cache.updateCameraAudio(n,t),o.resolve(e)}).fail(function(){o.reject()}),o},CloudAPI.cameraAudio=function(){var t=$.Deferred();if(!CloudAPI.isCameraID())return t.reject(),t;var o=CloudAPI.cameraID();return $.ajax({url:CloudAPI.config.url_cameras+o+"/audio/",type:"GET"}).done(function(e){CloudAPI.cache.updateCameraAudio(o,e),t.resolve(e)}).fail(function(){t.reject()}),t},CloudAPI.cameraVideo=function(){var t=$.Deferred();if(!CloudAPI.isCameraID())return t.reject(),t;var o=CloudAPI.cameraID();return $.ajax({url:CloudAPI.config.url_cameras+o+"/video/",type:"GET"}).done(function(e){CloudAPI.cache.updateCameraVideo(o,e),t.resolve(e)}).fail(function(){t.reject()}),t},CloudAPI.updateCameraVideo=function(t){var o=$.Deferred();if(!CloudAPI.isCameraID())return o.reject(),o;var n=CloudAPI.cameraID();return $.ajax({url:CloudAPI.config.url_cameras+n+"/video/",type:"PUT",contentType:"application/json",data:JSON.stringify(t)}).done(function(e){CloudAPI.cache.updateCameraVideo(n,t),o.resolve(e)}).fail(function(){o.reject()}),o},CloudAPI.setCameraVideo=function(e,t,o){if(CloudAPI.isCameraID())return t=t||CloudAPI.handleNothing,o=o||CloudAPI.handleError,$.ajax({url:CloudAPI.config.url_cameras+CloudAPI.cameraID()+"/video/",type:"PUT",success:t,error:o,contentType:"application/json",data:JSON.stringify(e)})},CloudAPI.cameraMediaStreams=function(){var t=$.Deferred();if(!CloudAPI.isCameraID())return t.reject(),t;var o=CloudAPI.cameraID();return $.ajax({url:CloudAPI.config.url_cameras+o+"/media_streams/",type:"GET"}).done(function(e){CloudAPI.cache.setMediaStreams(o,e),t.resolve(e)}).fail(function(){t.reject()}),t},CloudAPI.updateCameraMediaStreams=function(e,t){var o=$.Deferred();return(t=t||CloudAPI.cameraID())?$.ajax({url:CloudAPI.config.url_cameras+t+"/media_streams/",type:"PUT",data:JSON.stringify(e),contentType:"application/json"}).done(function(e){o.resolve(e)}).fail(function(e){o.reject(e)}):o.reject(),o},CloudAPI.cameraLiveUrls=function(e){var t=$.Deferred();return(e=e||CloudAPI.cameraID())?$.ajax({url:CloudAPI.config.url_cameras+e+"/live_urls/",type:"GET"}).done(function(e){t.resolve(e)}).fail(function(e){t.reject(e)}):t.reject(),t},CloudAPI.cameraBackwardStart=function(){var e;CloudAPI.isCameraID()&&(e={},CloudAPI.config.backwardURL&&(e.url=CloudAPI.config.backwardURL,CloudAPI.config.tmpBackwardURL==CloudAPI.config.backwardURL?CloudAPI.config.tmpBackwardURLCount++:(CloudAPI.config.tmpBackwardURLCount=1,CloudAPI.config.tmpBackwardURL=CloudAPI.config.backwardURL),CloudAPI.isP2PStreaming()&&(console.log("[CLOUDAPI] Send (audio streaming) backward start: "+CloudAPI.config.backwardURL),$.ajax({url:CloudAPI.config.url_cameras+CloudAPI.cameraID()+"/audio/backward/start/",type:"POST",success:CloudAPI.handleNothing,data:JSON.stringify(e),contentType:"application/json"}))))},CloudAPI.cameraBackwardStop=function(){if(CloudAPI.isCameraID()){var e={};if(CloudAPI.config.backwardURL){if(e.url=CloudAPI.config.backwardURL,CloudAPI.config.tmpBackwardURL==CloudAPI.config.backwardURL){if(0==CloudAPI.config.tmpBackwardURLCount)return;CloudAPI.config.tmpBackwardURLCount--}CloudAPI.isP2PStreaming()&&(console.log("[CLOUDAPI] Send (audio streaming) backward stop: "+CloudAPI.config.backwardURL),$.ajax({url:CloudAPI.config.url_cameras+CloudAPI.cameraID()+"/audio/backward/stop/",type:"POST",success:CloudAPI.handleNothing,data:JSON.stringify(e),contentType:"application/json"}))}}},CloudAPI.cameraSchedule=function(){if(CloudAPI.isCameraID())return $.ajax({url:CloudAPI.config.url_cameras+CloudAPI.cameraID()+"/schedule/",type:"GET",cache:!1})},CloudAPI.updateCameraSchedule=function(e){return $.ajax({url:CloudAPI.config.url_cameras+CloudAPI.cameraID()+"/schedule/",type:"PUT",data:JSON.stringify(e),cache:!1,contentType:"application/json"})},CloudAPI.hasAccessCameraPreview=function(e){e=CloudAPI.cache.cameraInfo(e);return!!e&&(CloudAPI.hasAccess(e,"live")||CloudAPI.hasAccess(e,"all")||CloudAPI.hasAccess(e,"ptz"))},CloudAPI.cameraPreview=function(e,t,o){return t=null==t?CloudAPI.handleNothing:t,o=null==o?CloudAPI.handleError:o,$.ajax({url:CloudAPI.config.url_cameras+e+"/preview/",type:"GET",success:t,error:o})},CloudAPI.hasAccessCameraUpdatePreview=function(e){e=CloudAPI.cache.cameraInfo(e);return!!e&&(CloudAPI.hasAccess(e,"live")||CloudAPI.hasAccess(e,"all")||CloudAPI.hasAccess(e,"ptz"))},CloudAPI.cameraUpdatePreview=function(e){return $.ajax({url:CloudAPI.config.url_cameras+e+"/preview/update/",type:"POST"})},CloudAPI.storageDataFirstRecord=function(e){var t=$.Deferred(),o={camid:CloudAPI.cameraID(),limit:1,offset:0};return e&&(o.start=e),$.ajax({url:CloudAPI.config.url_storage+"data/",data:o,cache:!1,type:"GET"}).done(function(e){0<e.objects.length?t.resolve(e.objects[0]):t.reject()}).fail(function(){t.reject()}),t},CloudAPI.storageEventsFirstRecord=function(){var t=$.Deferred(),e={camid:CloudAPI.cameraID(),limit:1,offset:0};return $.ajax({url:CloudAPI.config.url_storage+"events/",data:e,cache:!1,type:"GET"}).done(function(e){0<e.objects.length?t.resolve(e.objects[0]):t.reject()}).fail(function(){t.reject()}),t},CloudAPI.storageThumbnailsFirstRecord=function(){var t=$.Deferred(),e={camid:CloudAPI.cameraID(),limit:1,offset:0};return $.ajax({url:CloudAPI.config.url_storage+"thumbnails/",data:e,cache:!1,type:"GET"}).done(function(e){0<e.objects.length?t.resolve(e.objects[0]):t.reject()}).fail(function(){t.reject()}),t},CloudAPI.getAllData=function(e,t){},CloudAPI.storageThumbnails=function(e,t){var n=$.Deferred(),r={meta:{limit:1e3,offset:0,total_count:-1},objects:[]},a={camid:CloudAPI.cameraID(),limit:r.meta.limit,offset:r.meta.offset,start:e};function l(e){var t=$.Deferred();return $.ajax({url:CloudAPI.config.url_storage+"thumbnails/",data:e,cache:!1,async:!0,type:"GET"}).done(function(e){t.resolve(e)}).fail(function(){t.reject()}),t}return t&&(a.end=t),l(a).fail(function(){n.reject()}).done(function(e){if(r.meta.total_count=e.meta.total_count,r.meta.expire=e.meta.expire,$.merge(r.objects,e.objects),e.meta.offset+e.objects.length>=e.meta.total_count)n.resolve(r);else{for(var t=[],o=r.meta.limit;o<e.meta.total_count;o+=r.meta.limit)a.offset=o,t.push(l(a));$.when.apply($,t).done(function(){for(var e=0;e<arguments.length;e++)$.merge(r.objects,arguments[e].objects);n.resolve(r)}).fail(function(){n.reject()})}}),n},CloudAPI.storageTimeline=function(e,t){var n=$.Deferred(),r={meta:{limit:1e3,offset:0,total_count:-1},objects:[]},a={slices:1,camid:CloudAPI.cameraID(),limit:r.meta.limit,offset:r.meta.offset,start:e};function l(e){var t=$.Deferred();return $.ajax({url:CloudAPI.config.url_storage+"timeline/"+CloudAPI.cameraID()+"/",data:e,cache:!1,async:!0,type:"GET"}).done(function(e){t.resolve(e)}).fail(function(){t.reject()}),t}return t&&(a.end=t),l(a).fail(function(){n.reject()}).done(function(e){if(r.meta.total_count=e.meta.total_count,r.meta.expire=e.meta.expire,$.merge(r.objects,e.objects),e.meta.offset+e.objects.length>=e.meta.total_count)n.resolve(r);else{for(var t=[],o=r.meta.limit;o<e.meta.total_count;o+=r.meta.limit)a.offset=o,t.push(l(a));$.when.apply($,t).done(function(){for(var e=0;e<arguments.length;e++)$.merge(r.objects,arguments[e].objects);n.resolve(r)}).fail(function(){n.reject()})}}),n},CloudAPI.storageEvents=function(e,t){var n=$.Deferred(),r={meta:{limit:1e3,offset:0,total_count:-1},objects:[]},a={camid:CloudAPI.cameraID(),limit:r.meta.limit,offset:r.meta.offset,start:e};function l(e){var t=$.Deferred();return $.ajax({url:CloudAPI.config.url_storage+"events/",data:e,cache:!1,async:!0,type:"GET"}).done(function(e){t.resolve(e)}).fail(function(){t.reject()}),t}return t&&(a.end=t),l(a).fail(function(){n.reject()}).done(function(e){if(r.meta.total_count=e.meta.total_count,r.meta.expire=e.meta.expire,$.merge(r.objects,e.objects),e.meta.offset+e.objects.length>=e.meta.total_count)n.resolve(r);else{for(var t=[],o=r.meta.limit;o<e.meta.total_count;o+=r.meta.limit)a.offset=o,t.push(l(a));$.when.apply($,t).done(function(){for(var e=0;e<arguments.length;e++)$.merge(r.objects,arguments[e].objects);n.resolve(r)}).fail(function(){n.reject()})}}),n},CloudAPI.cameraMotionDetectionDemo=function(){return JSON.parse('{"caps": {"columns": 23, "max_regions": 8, "region_shape": "rect", "rows": 15, "sensitivity": "region"}}')},CloudAPI.cameraMotionDetection=function(){return $.ajax({url:CloudAPI.config.url_cameras+CloudAPI.cameraID()+"/motion_detection/",type:"GET"})},CloudAPI.cameraMotionDetectionRegionsDemo=function(){return JSON.parse('{"meta": {"limit": 20, "next": null, "offset": 0, "previous": null, "total_count": 8}, "objects": [{"enabled": true, "id": 2686, "map": "ZmQwMDBjM2ZjMDAwN2Y4MDAwZmYwMDAxZmUwMDAzZmNlNjAw", "name": "motion1", "sensitivity": 5}, {"enabled": true, "id": 2687, "map": "ZjYwMDBmMGZmODAwMWZmMDAwM2ZlMDAwN2ZjMDAwZmY4MDAxZmZmMDAw", "name": "motion2", "sensitivity": 5}, {"enabled": true, "id": 2688, "map": "ZjQwMDBmM2ZlMDAwN2ZjMDAwZmY4MDAxZmYwMDAzZmUwMDA3ZmNmMjAw", "name": "motion3", "sensitivity": 5}, {"enabled": true, "id": 2689, "map": "ZWMwMDBjMWZlMDAwM2ZjMDAwN2Y4MDAwZmYwMDAxZmVmNzAw", "name": "motion4", "sensitivity": 5}, {"enabled": true, "id": 2690, "map": "ZTQwMDA2ZTAwMDAxYzAwMDAzODBmOTAw", "name": "motion5", "sensitivity": 5}, {"enabled": true, "id": 2691, "map": "MmIwMWZmMDAwM2ZlMDAwN2ZjMDAwZmY4MDAxZmYwMDAzZmUwMDA3ZmMwMDBmZjgwMDFmZjAwMDNmZTAwMDdmYzAwMGZmODAwMWZmMDAwM2ZlMDAwN2ZjMDAw", "name": "motion6", "sensitivity": 5}, {"enabled": true, "id": 2692, "map": "MTJmZjgwMDFmZjAwMDNmZTAwMDdmYzAwMGZmODAwMWZmMDAwM2ZlMGU4MDA=", "name": "motion7", "sensitivity": 5}, {"enabled": false, "id": 2693, "map": "", "name": "motion8", "sensitivity": 5}]}')},CloudAPI.cameraMotionDetectionRegions=function(){return $.ajax({url:CloudAPI.config.url_cameras+CloudAPI.cameraID()+"/motion_detection/regions/",type:"GET"})},CloudAPI.cameraP2PSettings=function(t,o,e,n){return t=t||CloudAPI.cameraID(),o=null==o?CloudAPI.handleNothing:o,e=null==e?CloudAPI.handleError:e,n=null==n?CloudAPI.handleNothing:n,$.ajax({url:CloudAPI.config.url_cameras+t+"/p2p_settings/",type:"GET",success:function(e){CloudAPI.cache.setP2PSettings(t,e),o(e)},error:e,complete:n})},CloudAPI.cameraSetP2PSettings=function(e){return $.ajax({url:CloudAPI.config.url_cameras+CloudAPI.cameraID()+"/p2p_settings/",type:"PUT",data:JSON.stringify(e),cache:!1,contentType:"application/json"})},CloudAPI.cameraLog=function(){return $.ajax({url:CloudAPI.config.url_cameras+CloudAPI.cameraID()+"/log/",type:"GET"})},CloudAPI.cameraLogDownload=function(e){var t=$.Deferred(),o=null;return(o=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")).onreadystatechange=function(){o.readyState==XMLHttpRequest.DONE&&(200==o.status?t.resolve(o.responseText):t.reject())},o.open("GET",e,!0),o.send(),t.promise()},CloudAPI.cameraLogUpdate=function(){return $.ajax({url:CloudAPI.config.url_cameras+CloudAPI.cameraID()+"/log/update/",type:"POST"})},CloudAPI.cameraManagersList=function(e,t){e=e||CloudAPI.handleNothing,t=t||CloudAPI.handleError,$.ajax({url:CloudAPI.config.url_cmngrs,type:"GET",success:e,error:t})},CloudAPI.cameraManagerReset=function(e){return $.ajax({url:CloudAPI.config.url_cmngrs+e+"/reset/",type:"POST"})},CloudAPI.camerasList=function(e){e=e||{};var t,r=$.Deferred(),n={meta:{limit:20,offset:0,total_count:-1},objects:[]},a={limit:n.meta.limit,offset:n.meta.offset};for(t in e)a[t]=e[t];function l(e){var t=$.Deferred();return $.ajax({url:CloudAPI.config.url_cameras,data:e,cache:!1,type:"GET"}).done(function(e){t.resolve(e)}).fail(function(){t.reject()}),t}function i(t){var o=0,n=t.objects.length;o==n&&r.resolve(t);for(var e=0;e<n;e++)cam=t.objects[e],CloudAPI.cache.setCameraInfo(cam)?(console.log("update p2p_settings: ",cam.id),CloudAPI.cameraP2PSettings(cam.id).done(function(e){CloudAPI.cameraMemoryCard(cam.id).done(function(){(o+=1)==n&&r.resolve(t)}).fail(function(){(o+=1)==n&&r.resolve(t)})}).fail(function(){(o+=1)==n&&r.resolve(t)})):(o+=1)==n&&r.resolve(t)}return l(a).fail(function(){r.reject()}).done(function(e){if(n.meta.total_count=e.meta.total_count,$.merge(n.objects,e.objects),e.meta.offset+e.objects.length>=e.meta.total_count)i(n);else{for(var t=[],o=n.meta.limit;o<e.meta.total_count;o+=n.meta.limit)a.offset=o,t.push(l(a));$.when.apply($,t).done(function(){for(var e=0;e<arguments.length;e++)$.merge(n.objects,arguments[e].objects);i(n)}).fail(function(){r.reject()})}}),r},CloudAPI.camerasListByCriterions=function(e,t,o){t=t||CloudAPI.handleNothing,o=o||CloudAPI.handleError,$.ajax({url:CloudAPI.config.url_cameras,data:e,type:"GET",success:t,error:o})},CloudAPI.cameraManagerInfo=function(e,t,o){t=t||CloudAPI.handleNothing,o=o||CloudAPI.handleError,$.ajax({url:CloudAPI.config.url_cmngrs+e+"/",type:"GET",success:t,error:o})},CloudAPI.cameraManagerSetTimezone=function(e,t,o,n){o=o||CloudAPI.handleNothing,n=n||CloudAPI.handleError;var r={};r.timezone=t,$.ajax({url:CloudAPI.config.url_cmngrs+e+"/",type:"PUT",success:o,error:n,data:JSON.stringify(r),contentType:"application/json"})},CloudAPI.storageClipList=function(){var n=$.Deferred(),r={meta:{limit:100,offset:0,total_count:-1},objects:[]},a={limit:r.meta.limit,offset:r.meta.offset,camid:CloudAPI.cameraID(),usecamtz:""};function l(e){var t=$.Deferred();return $.ajax({url:CloudAPI.config.url_clips,data:e,cache:!1,type:"GET"}).done(function(e){t.resolve(e)}).fail(function(){t.reject()}),t}return l(a).fail(function(){n.reject()}).done(function(e){if(r.meta.total_count=e.meta.total_count,r.meta.expire=e.meta.expire,$.merge(r.objects,e.objects),e.meta.offset+e.objects.length>=e.meta.total_count)n.resolve(r);else{for(var t=[],o=r.meta.limit;o<e.meta.total_count;o+=r.meta.limit)a.offset=o,t.push(l(a));$.when.apply($,t).done(function(){for(var e=0;e<arguments.length;e++)$.merge(r.objects,arguments[e].objects);n.resolve(r)}).fail(function(){n.reject()})}}),n},CloudAPI.storageClipListAnon=function(t){var l=$.Deferred();return CloudAPI.anonToken().done(function(e){var n={meta:{limit:100,offset:0,total_count:-1},objects:[]},r={limit:n.meta.limit,offset:n.meta.offset,usecamtz:""};function a(e){var t=$.Deferred();return $.ajax({url:CloudAPI.config.url_clips,data:e,cache:!1,type:"GET",headers:{}}).done(function(e){t.resolve(e)}).fail(function(){t.reject()}),t}t&&(r.token=t),a(r).fail(function(){l.reject()}).done(function(e){if(n.meta.total_count=e.meta.total_count,n.meta.expire=e.meta.expire,$.merge(n.objects,e.objects),e.meta.offset+e.objects.length>=e.meta.total_count)l.resolve(n);else{for(var t=[],o=n.meta.limit;o<e.meta.total_count;o+=n.meta.limit)r.offset=o,t.push(a(r));$.when.apply($,t).done(function(){for(var e=0;e<arguments.length;e++)$.merge(n.objects,arguments[e].objects);l.resolve(n)}).fail(function(){l.reject()})}})}).fail(function(){l.reject()}),l},CloudAPI.storageClipCreate=function(e,t,o,n,r){var a={};return a.camid=CloudAPI.cameraID(),a.title=e,a.group=t,a.start=o,a.end=n,a.delete_at=r,$.ajax({url:CloudAPI.config.url_clips,type:"POST",data:JSON.stringify(a),cache:!1,contentType:"application/json"})},CloudAPI.storageClip=function(e){return $.ajax({url:CloudAPI.config.url_clips+e+"/",type:"GET",cache:!1})},CloudAPI.serverTime=function(){return $.ajax({url:CloudAPI.config.url_server+"time/",type:"GET",cache:!1})},CloudAPI.storageClipAnon=function(t,e){var o=$.Deferred(),n={};return e&&(n.token=e),CloudAPI.anonToken().done(function(e){$.ajax({url:CloudAPI.config.url_clips+t+"/",type:"GET",data:n,cache:!1,headers:{}}).done(function(e){o.resolve(e)}).fail(function(){o.reject()})}).fail(function(){o.reject()}),o},CloudAPI.storageClipDelete=function(e){return $.ajax({url:CloudAPI.config.url_clips+e+"/",type:"DELETE",cache:!1})},CloudAPI.storageClipUpdate=function(e,t){return $.ajax({url:CloudAPI.config.url_clips+e+"/",data:JSON.stringify(t),type:"PUT",cache:!1,contentType:"application/json"})},CloudAPI.cameraSettings=function(){var a,e=$.Deferred(),t=[];function o(e){var t=$.Deferred();return e.always(function(){t.resolve()}),t}return t.push(o((a=$.Deferred(),CloudAPI.cameraMediaStreams().done(function(e){console.log("MediaStreams: ",e);var t=e.mstreams_supported,o=e.live_ms_id;if(0<t.length&&""!=o){for(var n="",r=0;r<t.length;r++)if(t[r].id==o){n=t[r].vs_id;break}""!=n?CloudAPI.cameraVideoStream(n).done(function(){a.resolve()}).fail(function(){a.reject()}):a.reject()}else a.resolve()}).fail(function(){a.reject()}),a))),CloudAPI.cache.cameraInfo().url||(t.push(o(CloudAPI.cameraVideo())),t.push(o(CloudAPI.cameraAudio())),t.push(o(CloudAPI.cameraLimits())),t.push(o(CloudAPI.cameraEventProcessingEventsMotion())),t.push(o(CloudAPI.cameraEventProcessingEventsSound())),t.push(o(CloudAPI.cameraMemoryCard()))),$.when.apply($,t).done(function(){e.resolve(CloudAPI.cache.cameraInfo())}).fail(function(){e.reject()}),e},CloudAPI.createCamsess=function(e){return e=e||{},$.ajax({url:CloudAPI.config.url_camsess,data:JSON.stringify(e),type:"POST",contentType:"application/json",cache:!1})},CloudAPI.updateCamsess=function(e,t){return t=t||{},$.ajax({url:CloudAPI.config.url_camsess+e+"/",data:JSON.stringify(t),type:"PUT",contentType:"application/json",cache:!1})},CloudAPI.cameraCreate=function(e){var t=$.Deferred();return e=e||{},$.ajax({url:CloudAPI.config.url_cameras,type:"POST",data:JSON.stringify(e),cache:!1,contentType:"application/json"}).done(function(e){t.resolve(e)}).fail(function(e){t.reject(e)}),t},CloudAPI.cameraDelete=function(e){var t=$.Deferred();return $.ajax({url:CloudAPI.config.url_cameras+e+"/",type:"DELETE",cache:!1}).done(function(e){t.resolve(e)}).fail(function(e){t.reject(e)}),t},CloudAPI.cameraUpdate=function(e,t){var o=$.Deferred();return t=t||{},$.ajax({url:CloudAPI.config.url_cameras+e+"/",type:"PUT",data:JSON.stringify(t),cache:!1,contentType:"application/json"}).done(function(e){o.resolve(e)}).fail(function(e){o.reject(e)}),o},CloudAPI.adminCameras=function(e){return e=e||{},$.ajax({url:CloudAPI.config.url_admin_cameras,data:e,type:"GET",cache:!1})},CloudAPI.adminCameraInfo=function(e){return $.ajax({url:CloudAPI.config.url_admin_cameras+e+"/",type:"GET",cache:!1})},CloudAPI.updateAdminCamera=function(e,t){return t=t||{},$.ajax({url:CloudAPI.config.url_admin_cameras+e+"/",type:"PUT",data:JSON.stringify(t),contentType:"application/json",cache:!1})},CloudAPI.store={},CloudAPI.store.volume=function(e){return e&&CloudAPI.setToStorage("volume",e),CloudAPI.getFromStorage("volume")},CloudAPI.store.prev_volume=function(e){return e&&CloudAPI.setToStorage("prev_volume",e),CloudAPI.getFromStorage("prev_volume")},CloudAPI.store.zoom=function(e){return null!=e&&CloudAPI.setToStorage("zoom",e),CloudAPI.getFromStorage("zoom")},CloudAPI.store.zoom_left=function(e){return null!=e&&CloudAPI.setToStorage("zoom_left",e),CloudAPI.getFromStorage("zoom_left")},CloudAPI.store.zoom_top=function(e){return null!=e&&CloudAPI.setToStorage("zoom_top",e),CloudAPI.getFromStorage("zoom_top")},CloudAPI.store.user_profile=function(e){return null!=e&&CloudAPI.setToStorage("user_profile",e),CloudAPI.getFromStorage("user_profile")},CloudAPI.store.svcp_host=function(e){return null!=e&&CloudAPI.setToStorage("svcp_host",e),CloudAPI.getFromStorage("svcp_host")},CloudAPI.storageTemp={},CloudAPI.storageMode="local",CloudAPI.detectStorageMode=function(){try{localStorage.setItem("detectStorageMode","yes")}catch(e){CloudAPI.storageMode="temp"}},CloudAPI.detectStorageMode(),CloudAPI.setToStorage=function(e,t){"local"==CloudAPI.storageMode?localStorage.setItem(e,t):CloudAPI.storageTemp[e]=t},CloudAPI.getFromStorage=function(e){return"local"==CloudAPI.storageMode?localStorage.getItem(e):CloudAPI.storageTemp[e]},CloudAPI.removeFromStorage=function(e){"local"==CloudAPI.storageMode?localStorage.removeItem(e):CloudAPI.storageTemp[e]=void 0},CloudAPI.loadApiTokenFromHref=function(){for(var e=window.location.href.split("#"),t=(t=e[e.length-1]).split("&"),o=0;o<t.length;o++){var n=t[o].split("=")[0],r=decodeURIComponent(t[o].split("=")[1]);"token"==n?(CloudAPI.config.apiToken=CloudAPI.config.apiToken||{},CloudAPI.config.apiToken.token=r,CloudAPI.config.apiToken.type="api"):"expire"==n&&(CloudAPI.config.apiToken=CloudAPI.config.apiToken||{},CloudAPI.config.apiToken.expire=r,CloudAPI.config.apiToken.expireTimeUTC=Date.parse(r+"Z"))}console.log("Href token: ",CloudAPI.config.apiToken),CloudAPI.setToStorage("SkyVR_apiToken",JSON.stringify(CloudAPI.config.apiToken))},CloudAPI.cleanupApiToken=function(){CloudAPI.removeFromStorage("SkyVR_apiToken"),CloudAPI.config.apiToken=null,$.ajaxSetup({crossDomain:!0,cache:!1,beforeSend:function(e,t){e.setRequestHeader("Authorization","")}})},CloudHelpers.containsPageParam("svcp_host")?CloudAPI.setURL(CloudAPI.pageParams.svcp_host):CloudAPI.getFromStorage("CloudAPI_svcp_host")?CloudAPI.setURL(CloudAPI.getFromStorage("CloudAPI_svcp_host")):CloudAPI.setURL(("file:"==window.location.protocol?"http":window.location.protocol)+"//"+window.location.host.toString()+"/"),CloudAPI.events={},CloudAPI.events.listeners={},CloudAPI.events.names=["CAMERA_INFO_CHANGED"],CloudAPI.events.on=function(e,t,o){-1!=CloudAPI.events.names.indexOf(e)?(CloudAPI.events.listeners[e]||(CloudAPI.events.listeners[e]={}),CloudAPI.events.listeners[e][t]=o):console.error("[CLOUDAPI] Could not find event with name "+e)},CloudAPI.events.off=function(e,t){-1!=CloudAPI.events.names.indexOf(e)&&CloudAPI.events.listeners[e]?CloudAPI.events.listeners[e][t]?delete CloudAPI.events.listeners[e][t]:console.error("[CLOUDAPI] Could not find event with name "+e+" by id "+t):console.error("[CLOUDAPI] Could not find event with name "+e)},CloudAPI.events.trigger=function(e,o){var n;-1!=CloudAPI.events.names.indexOf(e)?CloudAPI.events.listeners[e]&&(n=CloudAPI.events.listeners[e],setTimeout(function(){for(var t in n)try{n[t](o)}catch(e){console.error("[CLOUDAPI] error on execute callback event ("+t+")",e)}},1)):console.error("[CLOUDAPI] Could not find event with name "+e)},window.CloudReturnCode={},CloudReturnCode.OK={name:"OK",code:0,text:"Success"},CloudReturnCode.OK_COMPLETIONPENDING={name:"OK_COMPLETIONPENDING",code:1,text:"Operation Pending"},CloudReturnCode.ERROR_NOT_CONFIGURED={name:"ERROR_NOT_CONFIGURED",code:-2,text:"Object not configured"},CloudReturnCode.ERROR_NOT_IMPLEMENTED={name:"ERROR_NOT_IMPLEMENTED",code:-1,text:"Function not implemented"},CloudReturnCode.ERROR_NO_MEMORY={name:"ERROR_NO_MEMORY",code:-12,text:"Out of memory"},CloudReturnCode.ERROR_ACCESS_DENIED={name:"ERROR_ACCESS_DENIED",code:-13,text:"Access denied"},CloudReturnCode.ERROR_BADARGUMENT={name:"ERROR_BADARGUMENT",code:-22,text:"Invalid argument"},CloudReturnCode.ERROR_STREAM_UNREACHABLE={name:"ERROR_STREAM_UNREACHABLE",code:-5049,text:"The stream specified is not reachable. Please check source URL or restart the stream"},CloudReturnCode.ERROR_EXPECTED_FILTER={name:"ERROR_EXPECTED_FILTER",code:-5050,text:"Expected filter"},CloudReturnCode.ERROR_NO_CLOUD_CONNECTION={name:"ERROR_NO_CLOUD_CONNECTION",code:-5051,text:"No cloud connection (has not conenction object or token is invalid)"},CloudReturnCode.ERROR_WRONG_RESPONSE={name:"ERROR_WRONG_RESPONSE",code:-5052,text:"Response from cloud expected in json, but got something else"},CloudReturnCode.ERROR_SOURCE_NOT_CONFIGURED={name:"ERROR_SOURCE_NOT_CONFIGURED",code:-5053,text:"Source not configured"},CloudReturnCode.ERROR_INVALID_SOURCE={name:"ERROR_INVALID_SOURCE",code:-5054,text:"Invalid source"},CloudReturnCode.ERROR_RECORDS_NOT_FOUND={name:"ERROR_RECORDS_NOT_FOUND",code:-5055,text:"Records are not found"},CloudReturnCode.ERROR_STREAM_UNREACHABLE_HLS={name:"ERROR_STREAM_UNREACHABLE_HLS",code:-5056,text:"The stream specified is not reachable (HLS)."},CloudReturnCode.ERROR_NOT_FOUND_HLS_PLUGIN={name:"ERROR_NOT_FOUND_HLS_PLUGIN",code:-5057,text:"HLS plugin not found."},CloudReturnCode.ERROR_COULD_NOT_DECODE_STREAM_OR_COULD_NOT_SET_COOKIE_HLS={name:"ERROR_COULD_NOT_DECODE_STREAM_OR_COULD_NOT_SET_COOKIE_HLS",code:-5058,text:"Could not decode stream or could not set cookie for streaming server (please allow cookie)."},CloudReturnCode.ERROR_WEBRTC_SERVER_ERROR={name:"ERROR_WEBRTC_SERVER_ERROR",code:-5059,text:"Unable to connect to server. Please check that you added an exception for the certificate, and that the port is available."},CloudReturnCode.ERROR_CAMERA_OFFLINE={name:"ERROR_CAMERA_OFFLINE",code:-5060,text:"Video source is offline"},CloudReturnCode.PLAYER_NOT_SUPPORTED={name:"PLAYER_NOT_SUPPORTED",code:-5061,text:"Player not supported"},CloudReturnCode.NOT_SUPPORTED_FORMAT={name:"NOT_SUPPORTED_FORMAT",code:-5062,text:"Not supported format"},CloudReturnCode.ERROR_HLS_ENDED={name:"ERROR_HLS_ENDED",code:-5063,text:"The stream is ended (HLS)."},CloudReturnCode.ERROR_INVALID_ACCESS_TOKEN_FORMAT={name:"ERROR_INVALID_ACCESS_TOKEN_FORMAT",code:-5064,text:"Invalid access token format"},CloudReturnCode.ERROR_CHANNEL_NOT_FOUND={name:"ERROR_CHANNEL_NOT_FOUND",code:-5065,text:"Channel is not found"},CloudReturnCode.ERROR_NETWORK_ERROR={name:"ERROR_NETWORK_ERROR",code:-5066,text:"Network error"},CloudReturnCode.ERROR_ACCESS_TOKEN_REQUIRED={name:"ERROR_ACCESS_TOKEN_REQUIRED",code:-5067,text:"Access token is required"},CloudReturnCode.ERROR_ACCESS_TOKEN_EXPIRED={name:"ERROR_ACCESS_TOKEN_EXPIRED",code:-5068,text:"Access token is expired"},CloudReturnCode.ERROR_NOT_AUTHORIZED={name:"ERROR_NOT_AUTHORIZED",code:-5401,text:"Failed authorization on cloud (wrong credentials)"},CloudReturnCode.ERROR_NOT_FOUND={name:"ERROR_NOT_FOUND",code:-5404,text:"Not found object"},window.CloudCameraPrivacyFilter={},CloudCameraPrivacyFilter.PS_OWNER_NOT_PUBLIC={name:"PS_OWNER_NOT_PUBLIC",code:0,text:"My cameras which not public"},CloudCameraPrivacyFilter.PS_OWNER={name:"PS_OWNER",code:1,text:"Only my cameras"},CloudCameraPrivacyFilter.PS_PUBLIC_NOT_OWNERS={name:"PS_PUBLIC_NOT_OWNERS",code:2,text:"Public cameras exclude my"},CloudCameraPrivacyFilter.PS_PUBLIC={name:"PS_PUBLIC",code:3,text:"All public cameras"},CloudCameraPrivacyFilter.PS_OWNERS_PUBLIC={name:"PS_OWNERS_PUBLIC",code:4,text:"My public cameras"},CloudCameraPrivacyFilter.PS_ALL={name:"PS_ALL",code:5,text:"All cameras"},window.CloudCameraRecordingMode={},CloudCameraRecordingMode.CONTINUES={name:"CONTINUES",code:0},CloudCameraRecordingMode.BY_EVENT={name:"BY_EVENT",code:1},CloudCameraRecordingMode.NO_RECORDING={name:"NO_RECORDING",code:2},CloudCameraRecordingMode.SERVER_BY_EVENT={name:"SERVER_BY_EVENT",code:3},window.CloudCameraStatus={},CloudCameraStatus.ACTIVE={name:"ACTIVE",code:0},CloudCameraStatus.UNAUTHORIZED={name:"UNAUTHORIZED",code:1},CloudCameraStatus.INACTIVE={name:"INACTIVE",code:2},CloudCameraStatus.INACTIVE_BY_SCHEDULER={name:"INACTIVE_BY_SCHEDULER",code:3},CloudCameraStatus.OFFLINE={name:"OFFLINE",code:4},window.CloudTrialConnection=function(){var n=this;n.mAPI=null,n.AccountProviderUrl=("file:"==window.location.protocol?"http:":window.location.protocol)+"//cnvrclient2.videoexpertsgroup.com/",n.setAccpUrl=function(e){n.AccountProviderUrl=e},n.setSvcpUrlBase=function(e){n.ServiceProviderUrl=e},n.setApiConfig=function(e,t,o){n.ApiHost=e,n.ApiPort=t,n.ApiSecurePort=o},n.setCamConfig=function(e,t,o){n.CamHost=e,n.CamPort=t,n.CamSecurePort=o},n.open=function(e){var t=CloudHelpers.promise();return n.TrialKey=e,n.RequestData={username:n.TrialKey,password:n.TrialKey,cloud_token:!0},n._asyncLogin(t),t},n.isOpened=function(){return null!=n.mAPI},n.close=function(){n.mAPI=null},n._getAPI=function(){return n.mAPI},n.getUserInfo=function(){var o=CloudHelpers.promise();return n.isOpened()?n.mAPI.getAccountInfo().done(function(t){n.mAPI.getAccountCapabilities().done(function(e){e=new CloudUserInfo(n,t,e);o.resolve(e)}).fail(function(e){CloudHelpers.handleError(e,o)})}).fail(function(e){CloudHelpers.handleError(e,o)}):o.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),o},n.getServerTimeDiff=function(){return n.mAPI.diffServerTime},n._asyncLogin=function(o){CloudHelpers.request({url:n.AccountProviderUrl+"api/v1/account/login/",type:"POST",data:JSON.stringify(n.RequestData),contentType:"application/json"}).done(function(e){var t;e.cloud_token&&e.cloud_token.token?(t=CloudHelpers.parseUri(e.svcp_auth_app_url).host,t=("file:"==window.location.protocol?"http:":window.location.protocol)+"//"+t+"/",n.mAPI=new CloudAPI(e.cloud_token,n.ServiceProviderUrl||t),n.mAPI.getServerTime().done(function(){o.resolve()}).fail(function(e){o.reject(e)})):(console.warn("Try again after 1 sec"),setTimeout(function(){n._asyncLogin(o)},1e3))}).fail(function(e){console.error(e),o.reject(e)})}},window.CloudTokenConnection=function(e){var r=this;r.mAPI=null,r.options=e,r.ServiceProviderUrl=("file:"==window.location.protocol?"http:":window.location.protocol)+"//"+(r.options.cloud_domain||"web.skyvr.videoexpertsgroup.com")+"/",r.open=function(e,t,o){t={token:e,expire:t,type:"api"};o&&(r.ServiceProviderUrl=o);var n=CloudHelpers.promise();return r.mAPI=new CloudAPI(t,r.ServiceProviderUrl),r.mAPI.getServerTime().done(function(){n.resolve()}).fail(function(e){n.reject(e)}),n},r.isOpened=function(){return null!=r.mAPI},r.close=function(){r.mAPI=null},r._getAPI=function(){return r.mAPI},r.getUserInfo=function(){var o=CloudHelpers.promise();return r.isOpened()?r.mAPI.getAccountInfo().done(function(t){r.mAPI.getAccountCapabilities().done(function(e){console.warn("caps:",e);e=new CloudUserInfo(r,t,e);o.resolve(e)}).fail(function(e){CloudHelpers.handleError(e,o)})}).fail(function(e){CloudHelpers.handleError(e,o)}):o.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),o},r.getServerTimeDiff=function(){return r.mAPI.diffServerTime}},window.CloudShareConnection=function(e){var n=this;n.options=e,n.mAPI=null,n.ServiceProviderUrl=("file:"==window.location.protocol?"http:":window.location.protocol)+"//"+(n.options.cloud_domain||"web.skyvr.videoexpertsgroup.com")+"/",n.open=function(e){var e={token:e,expire:"",type:"share"},t=CloudHelpers.promise();return n.mAPI=new CloudAPI(e,n.ServiceProviderUrl),n.mAPI.getServerTime().done(function(){t.resolve()}).fail(function(e){t.reject(e)}),t},n.updateToken=function(e){n.mAPI&&(n.mAPI.token=e)},n.isOpened=function(){return null!=n.mAPI},n.close=function(){n.mAPI=null},n._getAPI=function(){return n.mAPI},n.getUserInfo=function(){var o=CloudHelpers.promise();return n.isOpened()?n.mAPI.getAccountInfo().done(function(t){n.mAPI.getAccountCapabilities().done(function(e){console.warn("caps:",e);e=new CloudUserInfo(n,t,e);o.resolve(e)}).fail(function(e){CloudHelpers.handleError(e,o)})}).fail(function(e){CloudHelpers.handleError(e,o)}):o.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),o},n.getServerTimeDiff=function(){return n.mAPI.diffServerTime}},window.CloudUserConnection=function(){var o,n,r=this;r.mAPI=null,r.AccountProviderUrl=("file:"==window.location.protocol?"http:":window.location.protocol)+"//cnvrclient2.videoexpertsgroup.com/",r.open=function(e,t){o=e,n=t;t=CloudHelpers.promise();return r.RequestData={username:o,password:n,cloud_token:!0},r._asyncLogin(t),t},r.isOpened=function(){return null!=r.mAPI},r.close=function(){r.mAPI=null},r._getAPI=function(){return r.mAPI},r.getUserInfo=function(){var n=CloudHelpers.promise();return r.isOpened()?r.mAPI.getAccountInfo().done(function(o){r.mAPI.getAccountCapabilities().done(function(e){console.warn("caps:",e);e=new CloudUserInfo(r,o,e);n.resolve(e)}).fail(function(e){var t;500==e.status?(t=new CloudUserInfo(r,o),n.resolve(t)):CloudHelpers.handleError(e,n)})}).fail(function(e){CloudHelpers.handleError(e,n)}):n.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),n},r.getServerTimeDiff=function(){return r.mAPI.diffServerTime},r._asyncLogin=function(o){CloudHelpers.request({url:r.AccountProviderUrl+"api/v1/account/login/",type:"POST",data:JSON.stringify(r.RequestData),contentType:"application/json"}).done(function(e){var t;e.cloud_token&&e.cloud_token.token?(t=CloudHelpers.parseUri(e.svcp_auth_app_url).host,t=("file:"==window.location.protocol?"http:":window.location.protocol)+"//"+t+"/",r.mAPI=new CloudAPI(e.cloud_token,t),r.mAPI.getServerTime().done(function(){o.resolve()}).fail(function(e){o.reject(e)})):(console.warn("Try again after 1 sec"),setTimeout(function(){r._asyncLogin(o)},1e3))}).fail(function(e){console.error(e),o.reject(e)})}},window.CloudUserInfo=function(e,t,o){var n,r,a,l,i,s,c,u,d,m=this,p=e;function f(e,t){r=t,a=(n=e).id,l=e.email,i=e.first_name,s=e.last_name,c=e.preferred_name,t?(u=t.cameras_creation.limits.total_cameras,t.cameras_creation.limits.hosted_cameras,d=t.cameras_creation.created.total_cameras,t.cameras_creation.created.hosted_cameras):d=u=0}f(t,o),m._getConn=function(){return p},m._origJsonAccount=function(){return n},m._origJsonCapabilities=function(){return r},m.getID=function(){return a},m.getEmail=function(){return l},m.getFirstName=function(){return i},m.getLastName=function(){return s},m.getPreferredName=function(){return c},m.getCameraLimit=function(){return u},m.getCameraCreated=function(){return d},m.refresh=function(){var o=CloudHelpers.promise();return p&&p.isOpened()?p._getAPI().getAccountInfo().done(function(t){p._getAPI().getAccountCapabilities().done(function(e){f(t,e),o.resolve()}).fail(function(e){500==e.status?f(t):CloudHelpers.handleError(e,o)})}).fail(function(e){CloudHelpers.handleError(e,o)}):o.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),o}},window.CloudCamera=function(e,t){var o=this;o.type="camera";var n,r,a,l,i,s,c,u,d,m,p,f,g,h,v,y,C,_,E,P=e,T=t.id,b=t.cmngrid;function I(e){a=(n=e).login,l=e.password,r=e.url,m=e.name,s=e.timezone,i=e.status,c=e.latitude,u=e.longitude,p=e.rec_mode,f="on"==e.rec_status,d=e.delete_at,g=e.brand,h=e.group_name,v=e.fw_version,C=e.model,e.serial_number,_=e.uuid,y=e.led,E=e.public||!1}var w={};I(t),o._getConn=function(){return console.log("mConn = "+P),P},o._origJson=function(){return n},o.getID=function(){return T},o.getRecStatus=function(){console.warn("TODO")},o.hasPTZ=function(){console.warn("TODO")},o.getURL=function(){return r},o.setURL=function(e){r=e,w.url=e},o.getURLLogin=function(){return a},o.setURLLogin=function(e){a=e,w.login=e},o.getURLPassword=function(){return l},o.setURLPassword=function(e){l=e,w.password=e},o.getDeleteAt=function(){return d},o.getTimezone=function(){return s},o.setTimezone=function(e){s=e,w.timezone=e},o.isPublic=function(){return E},o.setPublic=function(e){E=e,w.public=e},o.getStatus=function(){var e=i.toUpperCase();return CloudCameraStatus[e]?CloudHelpers.copy(CloudCameraStatus[e]):(console.error("Unknown camera status"),null)},o.getName=function(){return m},o.setName=function(e){m=e,w.name=e},o.getLatitude=function(){return c},o.setLatitude=function(e){c=e,w.latitude=e},o.getLongitude=function(){return u},o.setLongitude=function(e){u=e,w.longitude=e},o.isRecording=function(){return f},o.getCameraManagerID=function(){return b},o.getBrand=function(){return g},o.getGroupName=function(){return h},o.getFirmwareVersion=function(){return v},o.getModel=function(){return C},o.getUUID=function(){return _},o.getLed=function(){return y},o.setRecordingMode=function(e){e.name==CloudCameraRecordingMode.CONTINUES.name?w.rec_mode="on":e.name==CloudCameraRecordingMode.BY_EVENT.name?w.rec_mode="by_event":e.name==CloudCameraRecordingMode.NO_RECORDING.name?w.rec_mode="off":e.name==CloudCameraRecordingMode.SERVER_BY_EVENT.name?w.rec_mode="server_by_event":console.error("[CloudCamera] Unknown mode of recording")},o.getRecordingMode=function(){return"on"==p?CloudHelpers.copy(CloudCameraRecordingMode.CONTINUES):"by_event"==p?CloudHelpers.copy(CloudCameraRecordingMode.BY_EVENT):"off"==p?CloudHelpers.copy(CloudCameraRecordingMode.NO_RECORDING):"server_by_event"===p?CloudHelpers.copy(CloudCameraRecordingMode.SERVER_BY_EVENT):void console.error("[CloudCamera] Unknown mode of recording")},o.save=function(){var t=CloudHelpers.promise();return P._getAPI().updateCamera(T,w).done(function(e){I(e),w.timezone?P._getAPI().updateCameraManager(b,{timezone:w.timezone}).done(function(){s=w.timezone,w={},t.resolve()}).fail(function(e){CloudHelpers.handleError(e,t)}):(w={},t.resolve())}).fail(function(e){CloudHelpers.handleError(e,t)}),t},o.getPreview=function(){var o=CloudHelpers.promise();if(!P||!P.isOpened())return o.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),o;var n=P._getAPI().diffServerTime;return P._getAPI().cameraPreview(T).done(function(t){console.log(t);var e=CloudHelpers.parseUTCTime(t.time);curr_time=CloudHelpers.getCurrentTimeUTC()+n,60<(curr_time-e)/1e3?P._getAPI().cameraUpdatePreview(T).done(function(e){o.resolve(t.url)}).fail(function(e){CloudHelpers.handleError(e,o)}):o.resolve(t.url)}).fail(function(e){CloudHelpers.handleError(e,o)}),o},o.getTimeline=function(a,l){var i=CloudHelpers.promise();if(!P||!P.isOpened())return i.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),i;var e=CloudHelpers.formatUTCTime(a),t=CloudHelpers.formatUTCTime(l);return P._getAPI().storageTimeline(T,e,t,4).done(function(e){var t={};t.start=a,t.end=l,t.periods=[];for(var o=e.objects[0][4],n=0;n<o.length;n++){var r={};r.start=CloudHelpers.parseUTCTime(o[n][0]),r.end=r.start+1e3*o[n][1],t.periods.push(r)}i.resolve(t)}).fail(function(e){CloudHelpers.handleError(e,i)}),i},o.getTimelineDays=function(e){var n=CloudHelpers.promise();return P&&P.isOpened()?P._getAPI().storageActivity(T,e).done(function(e){for(var t=[],o=0;o<e.objects.length;o++)t.push(CloudHelpers.parseUTCTime(e.objects[o]+"T00:00:00"));n.resolve(t)}).fail(function(e){CloudHelpers.handleError(e,n)}):n.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),n},o.getCameraUsage=function(){var t=CloudHelpers.promise();return P&&P.isOpened()?P._getAPI().cameraUsage(T).done(function(e){t.resolve(e)}).fail(function(e){CloudHelpers.handleError(e,t)}):t.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),t};var A="COMMON_SHARING_TOKEN";function R(e){var t={};return t.token=e,t.camid=T,t.access="watch",P.ServiceProviderUrl&&(t.svcp=P.ServiceProviderUrl),P.ApiHost&&(t.api=P.ApiHost),P.ApiPort&&80!=P.ApiPort&&(t.api_p=P.ApiPort),P.ApiSecurePort&&443!=P.ApiSecurePort&&(t.api_sp=P.ApiSecurePort),CloudHelpers.base64_encode(JSON.stringify(t))}o.enableSharing=function(){var r=CloudHelpers.promise();return P&&P.isOpened()?P._getAPI().getCameraSharingTokensList(T).done(function(e){for(var t=!1,o=0;o<e.objects.length;o++){var n=e.objects[o];if(n.name==A)return t=!0,void(1==n.enabled?r.resolve(R(n.token)):P._getAPI().updateCameraSharingToken(T,n.id,{enabled:!0}).done(function(e){r.resolve(R(n.token))}).fail(function(e){CloudHelpers.handleError(e,r)}))}t||P._getAPI().creareCameraSharingToken(T,A,["live","play","clipsplay"]).done(function(e){r.resolve(R(e.token))}).fail(function(e){CloudHelpers.handleError(e,r)})}).fail(function(e){CloudHelpers.handleError(e,r)}):r.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),r},o.disableSharing=function(e){var n=CloudHelpers.promise();return P&&P.isOpened()?P._getAPI().getCameraSharingTokensList(T).done(function(e){for(var t=0;t<e.objects.length;t++){var o=e.objects[t];if(o.name==A)return void P._getAPI().updateCameraSharingToken(T,o.id,{enabled:!1}).done(function(e){console.log(e),n.resolve()}).fail(function(e){CloudHelpers.handleError(e,n)})}n.reject()}).fail(function(e){CloudHelpers.handleError(e,n)}):n.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),n},o.toggleMemRec=function(e,t){var o=CloudHelpers.promise();return P&&P.isOpened()?P._getAPI().toggleMemRec(T,e,t).done(function(e){o.resolve(e)}).fail(function(e){CloudHelpers.handleError(e,o)}):o.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),o},o.createClip=function(e,t,o,n,r){var a=CloudHelpers.promise();if(!P||!P.isOpened())return a.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),a;t=CloudHelpers.formatUTCTime(t),o=CloudHelpers.formatUTCTime(o),n=CloudHelpers.formatUTCTime(n);return P._getAPI().createClip(T,e,t,o,n,r).done(function(e){a.resolve(e)}).fail(function(e){CloudHelpers.handleError(e,a)}),a},o.getClip=function(e,t){var o=CloudHelpers.promise();return P&&P.isOpened()?P._getAPI().getClip(e,t).done(function(e){o.resolve(e)}).fail(function(e){CloudHelpers.handleError(e,o)}):o.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),o};var S="COMMON_SHARING_TOKEN_FOR_STREAM";function k(e){var t={};return t.token=e,t.camid=T,t.cmngrid=b,t.access="all",t.api_p=80,t.api_sp=443,t.cam="cam.skyvr.videoexpertsgroup.com",t.cam_p=8888,t.cam_sp=8883,P.ServiceProviderUrl&&(t.svcp=P.ServiceProviderUrl),P.ApiHost&&(t.api=P.ApiHost),P.ApiPort&&80!=P.ApiPort&&(t.api_p=P.ApiPort),P.ApiSecurePort&&443!=P.ApiSecurePort&&(t.api_sp=P.ApiSecurePort),P.CamHost&&(t.cam=P.CamHost),P.CamPort&&(t.cam_p=P.CamPort),P.CamSecurePort&&(t.cam_sp=P.CamSecurePort),CloudHelpers.base64_encode(JSON.stringify(t))}o.enableSharingForStream=function(){var r=CloudHelpers.promise();return P&&P.isOpened()?P._getAPI().getCameraSharingTokensList(T).done(function(e){for(var t=!1,o=0;o<e.objects.length;o++){var n=e.objects[o];if(n.name==S)return t=!0,void(1==n.enabled?r.resolve(k(n.token)):P._getAPI().updateCameraSharingToken(T,n.id,{enabled:!0}).done(function(e){r.resolve(k(n.token))}).fail(function(e){CloudHelpers.handleError(e,r)}))}t||P._getAPI().creareCameraSharingToken(T,S,["all"]).done(function(e){r.resolve(k(e.token))}).fail(function(e){CloudHelpers.handleError(e,r)})}).fail(function(e){CloudHelpers.handleError(e,r)}):r.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),r},o.getStreamingURL=function(){var t=CloudHelpers.promise();return P&&P.isOpened()?P._getAPI().getCameraStreamingURLs(T).done(function(e){t.resolve(e)}).fail(function(e){CloudHelpers.handleError(e,t)}):t.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),t},o.setPublishPassword=function(e){w.publish_password=e}},window.CloudCameraListFilter=function(){var r=this;r.filterParams={detail:"detail",limit:50},r.setLimit=function(e){r.filterParams.limit=e},r.setOffset=function(e){r.filterParams.offset=e},r.setName=function(e){void 0!==e?r.filterParams.name=e:delete r.filterParams.name},r.setPartOfName=function(e){void 0!==e?r.filterParams.name__icontains=e:delete r.filterParams.name__icontains},r.sortByName=function(e){r.filterParams.order_by=(e?"-":"")+"name"},r.sortByDate=function(e){r.filterParams.order_by=(e?"-":"")+"created"},r.setOwner=function(e){console.warn("setPublic is deprecated"),void 0!==e?r.filterParams.is_owner=e:delete r.filterParams.is_owner},r.setPublic=function(e){console.warn("setPublic is deprecated"),void 0!==e?r.filterParams.public=e:delete r.filterParams.public},r.setForStream=function(e){void 0!==e&&void 0!==e?r.filterParams.url__isnull=e:delete r.filterParams.url__isnull},r.setPrivacy=function(e){void 0!==e&&e.name?"PS_OWNER_NOT_PUBLIC"==e.name?(r.filterParams.public=!1,r.filterParams.is_owner=!0):"PS_OWNER"==e.name?(delete r.filterParams.public,r.filterParams.is_owner=!0):"PS_PUBLIC_NOT_OWNERS"==e.name?(r.filterParams.public=!0,r.filterParams.is_owner=!1):"PS_PUBLIC"==e.name?(r.filterParams.public=!0,delete r.filterParams.is_owner):"PS_OWNERS_PUBLIC"==e.name?(r.filterParams.public=!0,r.filterParams.is_owner=!0):("PS_ALL"==e.name||console.error("Unknown privacy filter"),delete r.filterParams.public,delete r.filterParams.is_owner):(console.error("Unknown privacy filter"),delete r.filterParams.public,delete r.filterParams.is_owner)},r.setURL=function(e){void 0!==e?r.filterParams.url=e:delete r.filterParams.url},r.setLatLngBounds=function(e,t,o,n){console.warn("[CloudCamerasListFilter] SetLatLngBounds, TODO test -1 < lat,lang < 1"),e<=t&&(r.filterParams.latitude__gte=e,r.filterParams.latitude__lte=t),o<=n&&(r.filterParams.longitude__gte=o,r.filterParams.longitude__lte=n)},r._values=function(){return r.filterParams}},window.CloudCameraList=function(e){var l=this,i=e;l.getCamera=function(e){var t=CloudHelpers.promise();return i&&i.isOpened()?i._getAPI().getCamera(e).done(function(e){t.resolve(new CloudCamera(i,e))}).fail(function(e){CloudHelpers.handleError(e,t)}):t.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),t},l.createCamera=function(e,t,o){var n=CloudHelpers.promise();if(!i||!i.isOpened())return n.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),n;o={url:e,login:t,password:o};return i._getAPI().createCamera(o).done(function(e){n.resolve(new CloudCamera(i,e))}).fail(function(e){CloudHelpers.handleError(e,n)}),n},l.createCameraForStream=function(){var t=CloudHelpers.promise();if(!i||!i.isOpened())return t.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),t;return i._getAPI().createCamera({}).done(function(e){t.resolve(new CloudCamera(i,e))}).fail(function(e){CloudHelpers.handleError(e,t)}),t},l.findOrCreateCamera=function(e){var r=CloudHelpers.promise(),t=new CloudCameraListFilter;t.setOwner(!0);var a=CloudHelpers.splitUserInfoFromURL(e);return t.setURL(a.url),a.login=a.login||"",i._getAPI().camerasList(t._values()).done(function(e){for(var t=!1,o=0;o<e.objects.length;o++){var n=e.objects[o];if(n.login=n.login||"",n.login==a.login){t=!0,r.resolve(new CloudCamera(i,n));break}}t||l.createCamera(a.url,a.login,a.password).done(function(e){r.resolve(e)}).fail(function(e){CloudHelpers.handleError(e,r)})}).fail(function(e){CloudHelpers.handleError(e,r)}),r},l.getCameraList=function(e){var n=CloudHelpers.promise();return(e=e||new CloudCameraListFilter)._values?i&&i.isOpened()?i._getAPI().camerasList(e._values()).done(function(e){for(var t=[],o=0;o<e.objects.length;o++)t.push(new CloudCamera(i,e.objects[o]));n.resolve(t)}).fail(function(e){CloudHelpers.handleError(e,n)}):n.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION):(console.error(CloudReturnCode.ERROR_EXPECTED_FILTER),n.reject(CloudReturnCode.ERROR_EXPECTED_FILTER)),n},l.getCameraListLight=function(e){var t=CloudHelpers.promise();if(!(e=e||new CloudCameraListFilter)._values)return console.error(CloudReturnCode.ERROR_EXPECTED_FILTER),t.reject(CloudReturnCode.ERROR_EXPECTED_FILTER),t;if(!i||!i.isOpened())return t.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),t;e=e._values();return delete filterMap.detail,i._getAPI().camerasList(e).done(function(e){t.resolve(e.objects)}).fail(function(e){CloudHelpers.handleError(e,t)}),t},l.deleteCamera=function(e){var t=CloudHelpers.promise();return i&&i.isOpened()?i._getAPI().deleteCamera(e).done(function(){t.resolve()}).fail(function(e){CloudHelpers.handleError(e,t)}):t.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),t}},window.CloudSession=function(e,t){var o=this;o.type="session";var n,r,a,l,i,s,c,u,d,m,p,f,g,h,v,y,C=e,_=t.id,E=0,P=0,T=0;function b(e){r=(n=e).active,a=e.title,e.preview&&(I=e.preview.url),e.live_urls&&(h=e.live_urls.rtmp,v=e.live_urls.hls,y=e.live_urls.expire),s=e.latitude,c=e.longitude,l=e.streaming,i=e.public,u=e.start,d=e.end,m=e.has_records,e.statistics&&(P=e.statistics.peak_live||0,T=e.statistics.playback||0,E=e.statistics.live||0),g=e.author?e.author.preferred_name:"unknown",e.access&&(p=-1!=e.access.indexOf("all"),f=-1!=e.access.indexOf("watch"))}var I="";b(t),o._getConn=function(){return C},o._origJson=function(){return n},o.hasAccessAll=function(){return p},o.hasAccessWatch=function(){return p||f},o.getID=function(){return _},o.isOnline=function(){return r},o.getTitle=function(){return a},o.getAuthorPreferredName=function(){return g},o.getStatisticsLive=function(){return E},o.getStatisticsPeakLive=function(){return P},o.getStatisticsPlayback=function(){return T},o.getStartTime=function(){return null==u?(console.error("[CloudSession] #"+_+" Start time is null"),0):CloudHelpers.parseUTCTime(u)},o.getEndTime=function(){return null==u?(console.error("[CloudSession] #"+_+" End time is null but session is mActive: "+r),0):CloudHelpers.parseUTCTime(d)},o.getPreview=function(){return I},o.getLatitude=function(){return s},o.getLongitude=function(){return c},o.isStreaming=function(){return l},o.isPublic=function(){return i},o.hasRecords=function(){return m},o.getLiveUrl_Rtmp=function(){return h},o.getLiveUrl_HLS=function(){return v},o.getLiveUrl_Expire=function(){return y},o.refresh=function(){var t=CloudHelpers.promise();return C._getAPI().getCamsess(_).done(function(e){b(e),t.resolve()}).fail(function(e){CloudHelpers.handleError(e,t)}),t}},window.CloudSessionListFilter=function(){var r=this;r.filterParams={limit:50,order_by:"-start"},r.setLimit=function(e){r.filterParams.limit=e},r.setOffset=function(e){r.filterParams.offset=e},r.setTitle=function(e){r.filterParams.title__icontains=e},r.setStartLessThen=function(e){r.filterParams.start__lte=e},r.setHasRecords=function(e){"any"==e||("yes"==e?(r.filterParams.has_records=!0,r.filterParams.active=!1):"no"==e?(r.filterParams.has_records=!1,r.filterParams.active=!1):console.error("[CloudSessionListFilter] setHasRecords, expected 'any', 'yes' or 'no'"))},r.setStreaming=function(e){"any"==e||("yes"==e?(r.filterParams.streaming=!0,r.filterParams.camera_online=!0,r.filterParams.active=!0):"no"==e?(r.filterParams.streaming=!1,delete r.filterParams.camera_online,r.filterParams.active=!1):console.error("[CloudSessionListFilter] setStreaming, expected 'any', 'yes' or 'no'"))},r.setAuthorName=function(e){r.filterParams.author_name__icontains=e},r.setAuthorID=function(e){e?r.filterParams.author_id=e:delete r.filterParams.author_id},r.setAuthorPreferredName=function(e){e?r.filterParams.author_preferred_name__icontains=e:delete r.filterParams.author_preferred_name__icontains},r.setWithDetails=function(){console.warn("[CloudSessionListFilter] 'setWithDetails' not supported anymore. Please use getSessionList or getSessionListLight")},r.setOnline=function(e){console.warn("[CloudSessionListFilter] 'setOnline' not supported anymore")},r.setPublic=function(e){"any"==e||("yes"==e?r.filterParams.public=!0:"no"==e?r.filterParams.public=!1:console.error("[CloudSessionListFilter] setOnline, expected 'any', 'yes' or 'no'"))},r.setLatLngBounds=function(e,t,o,n){e<=t?(r.filterParams.latitude__gte=e,r.filterParams.latitude__lte=t):console.error("[CloudCamerasListFilter] latitude_max must be greater or equal to latitude_min"),o<=n?(r.filterParams.longitude__gte=o,r.filterParams.longitude__lte=n):console.error("[CloudCamerasListFilter] longitude_max must be greater or equal to longitude_min")},r._values=function(){var e,t={};for(e in r.filterParams)t[e]=r.filterParams[e];return t}},window.CloudSessionList=function(e){var r=e;this.getSession=function(e){var t=CloudHelpers.promise();return r&&r.isOpened()?r._getAPI().getCamsess(e).done(function(e){t.resolve(new CloudSession(r,e))}).fail(function(e){CloudHelpers.handleError(e,t)}):t.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),t},this.getSessionList=function(e){var n=CloudHelpers.promise();if(!(e=e||new CloudSessionListFilter)._values)return console.error(CloudReturnCode.ERROR_EXPECTED_FILTER),n.reject(CloudReturnCode.ERROR_EXPECTED_FILTER),n;if(!r||!r.isOpened())return n.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),n;e=e._values();return e.detail="detail",r._getAPI().getCamsessList(e).done(function(e){for(var t=[],o=0;o<e.objects.length;o++)t.push(new CloudSession(r,e.objects[o]));n.resolve(t)}).fail(function(e){CloudHelpers.handleError(e,n)}),n},this.getSessionListLight=function(e){var t=CloudHelpers.promise();if(!(e=e||new CloudSessionListFilter)._values)return console.error(CloudReturnCode.ERROR_EXPECTED_FILTER),t.reject(CloudReturnCode.ERROR_EXPECTED_FILTER),t;if(!r||!r.isOpened())return t.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),t;e=e._values();return delete e.detail,r._getAPI().getCamsessList(e).done(function(e){t.resolve(e.objects)}).fail(function(e){CloudHelpers.handleError(e,t)}),t},this.deleteSession=function(e){var t=CloudHelpers.promise();return r&&r.isOpened()?r._getAPI().deleteCamsess(e).done(function(){t.resolve()}).fail(function(e){CloudHelpers.handleError(e,t)}):t.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),t}},window.CloudPlayerEvent={},CloudPlayerEvent.CONNECTING={name:"CONNECTING",code:0,text:"Connection is establishing"},CloudPlayerEvent.CONNECTED={name:"CONNECTED",code:1,text:"Connection is established"},CloudPlayerEvent.PLAYED={name:"PLAYED",code:2,text:"Player changes state to PLAY."},CloudPlayerEvent.PAUSED={name:"PAUSED",code:3,text:"Player state is PAUSE."},CloudPlayerEvent.STOPED={name:"STOPED",code:4,text:"Player state is STOP."},CloudPlayerEvent.CLOSED={name:"CLOSED",code:6,text:"Player state is CLOSED."},CloudPlayerEvent.SEEK_COMPLETED={name:"SEEK_COMPLETED",code:17,text:"setPosition() is successfully finished."},CloudPlayerEvent.ERROR={name:"ERROR",code:105,text:"Player is disconnected from media stream due to an error"},CloudPlayerEvent.SOURCE_CHANGED={name:"SOURCE_CHANGED",code:3e3,text:"setSource() is successfully finished."},CloudPlayerEvent.POSITION_JUMPED={name:"POSITION_JUMPED",code:3001,text:"Position was changed by player (possible that player did not found records)."},CloudPlayerEvent.RANGE_ENDED={name:"RANGE_ENDED",code:4455,text:"The player reached the end of the range when playing"},CloudPlayerEvent.CHANNEL_STATUS={name:"CHANNEL_STATUS",code:4456,text:"When channel status"},CloudPlayerEvent.USER_CLICKED_ON_TIMELINE={name:"USER_CLICKED_ON_TIMELINE",code:4457,text:"When user click on timeline."},CloudPlayerEvent.CHANGED_CONTROLS={name:"CHANGED_CONTROLS",code:4458,text:"Event when controls changes"},CloudPlayerEvent.TIMELINE_END_UPDATED={name:"TIMELINE_END_UPDATED",code:4459,text:"Event when timeline end updated"},CloudPlayerEvent.ACCESS_TOKEN_EXPIRED_IN_5MIN={name:"ACCESS_TOKEN_EXPIRED_IN_5MIN",code:4460,text:"Access token expired in 5 minutes"},window._cloudPlayers=window._cloudPlayers||{},window.CloudPlayer=function(r,t){var h=this;h.options=t=t||{},h.elid=r;var v=null,o=null,n=!0,a=0,l=!0,i=!1,s=!1,c=!1,y=CloudHelpers.createCallbacks(),u="",d=null,m=null,p=null,f=null,g=null,C=!1,_=null,E=null,P=null,T=null,b=null,e=null,I=null,w=null,A=null,R=void 0,S="records",k=null;h.sdCardCompatible=!0;var L="main",O=null,M=null,N=null,x=null;if(h.VsFormat=null,h.mPTZActions=null,h.mPTZShow=!0,h.isMobile=CloudHelpers.isMobile(),h.timePolingLiveUrls=15e3,h.player=document.getElementById(r),_cloudPlayers[r])return _cloudPlayers[r];var D=-1,U=-1,H={w:0,h:0};if(CloudHelpers.isChrome()&&!h.isMobile?(videojs.options.hls=videojs.options.hls||{},videojs.options.html5.nativeAudioTracks=!0,videojs.options.html5.nativeVideoTracks=!1,videojs.options.hls.overrideNative=!1):(videojs.options.hls=videojs.options.hls||{},videojs.options.html5.nativeAudioTracks=!1,videojs.options.html5.nativeVideoTracks=!1,videojs.options.hls.overrideNative=!0),videojs.options.hls.enableLowInitialPlaylist=!0,videojs.options.suppressNotSupportedError=!1,videojs.options.techCanOverridePoster=!0,null==h.player)return console.error("[CloudPlayer] Not found element"),null;if("DIV"!=h.player.tagName)return console.error("[CloudPlayer] Expected DIV tag but got "+h.player.tagName),null;var j=-1,B=0,z=2e3,F=5e3,q=null;h.m={},h.m.mute=!1,h.m.waitSourceActivation=t.waitSourceActivation||0,h.m.useTimezone=t.useTimezone,h.m.useTimezone&&console.warn("[CloudPlayer] useTimezone: "+h.m.useTimezone),h.m.waitSourceActivation<0&&(console.warn("[CloudPlayer] option waitSourceActivation must be greater than -1"),h.m.waitSourceActivation=0),h.m.useNativeHLS=t.useNativeHLS||!1,h.m.backwardAudio=!1,h.m.backwardAudio=t.backwardAudio||null!=h.player.getAttribute("backward-audio")||h.m.backwardAudio,h.defualtAutohide=3e3,void 0!==t.autohide?h.m.autohide=t.autohide:h.m.autohide=h.defualtAutohide,t.trasholdPlaybackInMs&&(t.trasholdPlaybackInMs,console.log("[CloudPlayer] applied option trasholdPlaybackInMs "+t.trasholdPlaybackInMs)),h.mPlayerFormat="html5";var W="";if(t.preferredPlayerFormat)h.mPreferredPlayerFormat=t.preferredPlayerFormat,W=t.preferredPlayerFormat;else try{"jpeg"===(W=localStorage.getItem("preferred_player_format"))&&(W="")}catch(e){console.error("[CloudPlayer] error load format: ",e)}if("webrtc"==W||"html5"==W||"flash"==W||"jpeg"==W?h.mPlayerFormat=W:console.warn("[CloudPlayer] Unknown player format: ",W,", html5 is used by default"),t.useOnlyPlayerFormat){var V=t.useOnlyPlayerFormat;if("webrtc"!==V&&"html5"!==V&&"flash"!==V&&"jpeg"!==V)console.error("Wrong value of useOnlyPlayerFormat, expected 'webrtc' or 'html5' or 'flash'");else if(h.mPlayerFormat=V,h.mPreferredPlayerFormat=V,"jpeg"!==(T=V))try{localStorage.setItem("preferred_player_format",V)}catch(e){}}void 0!==t.mute&&(h.m.mute=!0===t.mute),h.swf_backwardaudio="",h.player.classList.add("cloudplayer"),h.player.classList.add("green"),h.player.classList.add("black"),h.player.innerHTML='<div class="cloudplayer-loader" style="display: inline-block"></div><div class="cloudplayer-screenshot-loading" style="display: none">\t\t<div class="cloudplayer-screenshot-loading">     </div></div><div class="cloudplayer-error" style="display: none">\t<div class="cloudplayer-error-text" style="display: none"></div></div><div class="cloudplayer-ptz"><div class="ptz-controls">\t<div class="ptz-arrow ptz-top"></div>\t<div class="ptz-arrow ptz-right"></div>\t<div class="ptz-arrow ptz-bottom"></div>\t<div class="ptz-arrow ptz-left"></div><div class="ptz-zoom">\t<div class="ptz-zoom-plus"></div>\t<div class="ptz-zoom-minus"></div></div></div><div class="ptz-presets"><h4>Presets</h4><ul class="presets-list"><li data-presetNo="1">1</li><li data-presetNo="2">2</li><li data-presetNo="3">3</li><li data-presetNo="4">4</li><li data-presetNo="5">5</li></ul></div></div><div class="cloudplayer-controls-zoom-container">\t<div class="cloudplayer-controls-zoom-position">\t\t<div class="cloudplayer-zoom-position-cursor"></div>\t</div>\t<div class="cloudplayer-controls-zoom'+(h.isMobile?" mobile ":"")+'">\t\t<div class="cloudplayer-zoom-up"></div>\t\t<div class="cloudplayer-zoom-progress zoom10x"></div>\t\t<div class="cloudplayer-zoom-down"></div>\t</div></div><div class="cloudplayer-controls-timelapse-container">\t<div class="cloudplayer-timelapse-controls">\t\t<div class="cloudplayer-timelapse-left" ><span class="cloudplayer-timelapse-icon">&#10094;&#10094;</span></div>\t\t<div class="cloudplayer-timelapse-pause"><span class="cloudplayer-timelapse-icon">&#10073;&#10073;</span></div>\t\t<div class="cloudplayer-timelapse-right"><span class="cloudplayer-timelapse-icon">&#10095;&#10095;</span></div>\t</div></div><div class="cloudplayer-watermark"></div><div class="cloudplayer-sdkversion">SDK '+CloudSDK.version+'</div><div class="cloudplayer-selectcliptime">    <table><tr><td>Before<br/><span>(sec.)</span></td><td>Date/Time</td><td>After<br/><span>(sec.)</span></td></tr>    <tr><td><input class="clipbefore" type="number" min=1 max=3600 value="10"></td><td class="clipdt"></td><td><input class="clipafter" type="number" min=1 max=3600 value="10"></td></tr>    <tr><td colspan="3"><div class="clipcreatebtn">Create clip &gt;</div></td></tr></table></div><div class="cloudplayer-selectbackuptime">    <table class="mem_rec_hide"><tr><td>Duration<br/><span>(sec.)</span></td><td>Date/Time</td></tr>    <tr><td style="width: 50%"><input class="backupduration" type="number" min=1 max=3600 value="900" style="width: 100%"></td><td class="syncdt" style="width: 50%"></td></tr>    <tr><td colspan="2"><div class="sdcardbackupbtn">Start SD Card Backup &gt;</div></td></tr>    <tr><td colspan="2" id="backup_result"></td></tr></table>\t   <div class="sd-divider mem_rec_hide"></div>     <div class="enable-disable-sdcard"></div></div><div class="cloudplayer-info'+(h.isMobile?" mobile ":"")+'"><div class="cloudplayer-info-main">\t\t<div class="cloudplayer-info-title">Settings</div>\t\t<div class="cloudplayer-info-container">\t\t<div class="cloudplayer-info-player-quality enabled"> Stream:\t\t<div class="selected-quality">Main</div></div>\t\t<div class="cloudplayer-info-player-mode" style="'+(null!==T?"disabled":"")+'"> Preferred format: \t\t<div class="selected-format"></div></div>'+(CloudHelpers.isIE()?"":'\t\t<div class="cloudplayer-info-player-dewarping enabled"  style="">Dewarping: \t\t<div class="selected-dewarping">Off</div></div>')+'\t\t<div class="cloudplayer-info-player-speed enabled">Speed: \t\t<div class="selected-speed">1x</div></div>\t\t\x3c!-- div class="cloudplayer-info-latency">Player Latency: \t\t\t<div class="cloudplayer-info-latency-minimal">Minimal Latency</div>\t\t\t/  \t\t<div class="cloudplayer-info-latency-smoothless">Maximum Smoothness</div>\t\t</div --\x3e\t\t\x3c!-- div class="cloudplayer-info-latency-not-supported">Player Latency: Setting is not available for HTML5 player</div --\x3e\t\t<div class="cloudplayer-info-bufferlength"></div>\t\t<div class="cloudplayer-info-audio-stream">Audio stream: \t\t\t<div class="cloudplayer-info-audio-stream-on">On</div>\t\t\t/  \t\t<div class="cloudplayer-info-audio-stream-off">Off</div>\t\t</div>\t\t<div class="cloudplayer-info-playerversion">Version: '+CloudSDK.version+" ("+CloudSDK.datebuild+')</div>\t\t<div class="cloudplayer-info-playertype">Used player:</div></div></div><div class="cloudplayer-info-setting quality-select">\t\t<div class="cloudplayer-info-title"><span class="back"></span>Stream</div>\t\t<div class="cloudplayer-info-container">\t\t\t<div class="cloudplayer-player-mode cloudplayer-quality-mode quality-main selected" data-quality="main">Main</div>\t\t\t<div class="cloudplayer-player-mode cloudplayer-quality-mode quality-live" data-quality="live">Live</div>\t\t</div></div><div class="cloudplayer-info-setting mode-select">\t\t<div class="cloudplayer-info-title"><span class="back"></span>Preferred format</div>\t\t<div class="cloudplayer-info-container">\t\t\t<div class="cloudplayer-player-mode cloudplayer-webrtc-mode" style="display: none">'+(t.alt_protocol_names?"Low latency":"WebRTC")+'</div> \t\t\t<div class="cloudplayer-player-mode cloudplayer-flash-mode selected">'+(t.alt_protocol_names?"Standard":"RTMP")+'</div> \t\t\t<div class="cloudplayer-player-mode cloudplayer-html5-mode">'+(t.alt_protocol_names?"Reliable":"HLS")+'</div>\t\t\t<div class="cloudplayer-player-mode cloudplayer-jpeg-mode">'+(t.alt_protocol_names?"Performance":"JPEG")+'</div>\t\t</div></div><div class="cloudplayer-info-setting dewarping-select">\t\t<div class="cloudplayer-info-title"><span class="back"></span>Dewarping</div>\t\t<div class="cloudplayer-info-container">\t\t\t<div class="cloudplayer-player-mode cloudplayer-dewarping-mode selected" data-dewarping="0">Off</div>\t\t\t<div class="cloudplayer-player-mode cloudplayer-dewarping-mode" data-dewarping="1">On</div>\t\t</div></div><div class="cloudplayer-info-setting speed-select">\t\t<div class="cloudplayer-info-title"><span class="back"></span>Speed</div>\t\t<div class="cloudplayer-info-container">\t\t\t<div class="cloudplayer-player-mode cloudplayer-speed-mode" data-speed="0.125">0.125x</div>\t\t\t<div class="cloudplayer-player-mode cloudplayer-speed-mode'+(h.isMobile?" mobile ":"")+'" data-speed="0.25">0.25x</div>\t\t\t<div class="cloudplayer-player-mode cloudplayer-speed-mode" data-speed="0.5">0.5x</div>\t\t\t<div class="cloudplayer-player-mode cloudplayer-speed-mode selected" data-speed="1">1x</div>\t\t\t<div class="cloudplayer-player-mode cloudplayer-speed-mode'+(h.isMobile?" mobile ":"")+'" data-speed="2">2x</div>\t\t\t<div class="cloudplayer-player-mode cloudplayer-speed-mode" data-speed="4">4x</div>\t\t\t<div class="cloudplayer-player-mode cloudplayer-speed-mode'+(h.isMobile?" mobile ":"")+'" data-speed="8">8x</div>\t\t\t<div class="cloudplayer-player-mode cloudplayer-speed-mode" data-speed="16">16x</div>\t\t</div></div></div><div class="cloudplayer-backwardaudio-container">'+(h.m.backwardAudio?'\t\t<object data="'+h.swf_backwardaudio+'" type="application/x-shockwave-flash" id="backwardaudio_swf_single" align="top">\t\t\t<param name="movie" value="'+h.swf_backwardaudio+'" />\t\t\t<embed type="application/x-shockwave-flash" src="'+h.swf_backwardaudio+'">\t\t\t<param name="allowScriptAccess" value="always"/>\t\t\t<param value="allowNetworking" value="all"/>\t\t\t<param name="menu" value="true" />\t\t\t<param name="wmode" value="transparent"/>\t\t\t\x3c!-- param name="bgcolor" value="#ffffff" / --\x3e\t\t\t<param name="menu" value="false" />\t\t</object>':"")+'\t\t<video class="cloudplayer-backward-webrtc" crossorigin="anonymous" autoplay=true preload playsinline="true" style="width: 10px; height: 10px; background-color: #000;"></video></div><div class="cloudplayer-calendar-container"></div><div class="cloudplayer-live-container"></div><div class="cloudplayer-controls-container"><div class="cloudplayer-timeline-container"></div><div class="cloudplayer-controls">\t<div class="cloudplayer-play" style="display: none"></div>\t<div class="cloudplayer-stop" style="display: none"></div>\t<div class="cloudplayer-pause hidden"></div>\t<div class="cloudplayer-volume-mute"></div>\t<div class="cloudplayer-volume-container">\t\t<input type="range" min="0" max="100" value="100" step="1" data-buffer="0" id="volume" class="cloudplayer-volume" data-rangeSlider>\t\t<output></output>\t</div>\t<div class="cloudplayer-time'+(h.isMobile?" mobile ":"")+(t.hideTime?" hidden":"")+'"></div>\t<div class="cloudplayer-volume-down"></div>\t<div class="cloudplayer-volume-progress vol7"></div>\t<div class="cloudplayer-volume-up"></div>\t<div class="cloudplayer-right-divider"></div>\t<div class="cloudplayer-microphone disabled"></div>\t<div class="cloudplayer-get-clip" style="display: none"></div>\t<div class="cloudplayer-get-shot" style="display: none"></div>\t<div class="cloudplayer-sd-backup" style="display: none"></div>\t<div class="cloudplayer-record-mode mode-records" style="display: none"></div>\t<div class="cloudplayer-single-element-divider"></div>\t<div class="cloudplayer-settings"></div>\t<div class="cloudplayer-show-zoom"></div>\t<div class="cloudplayer-show-ptz"></div>\t<div class="cloudplayer-fullscreen"></div></div></div><div class="cloudcameracalendar-content'+(h.isMobile?" mobile ":"")+'"></div><div class="cloudplayer-big-play-button" style="display: none"></div><canvas class="cloudplayer-stub-snapshot" style="width:100%; height:100%; display:none;"></canvas><canvas class="cloudplayer-snapshot hidden"></canvas><div class="cloudplayer-share-clip" style="width:100%; height:100%; display:none;"></div><div class="allvideotags" style="width:100%; height:100%;" >\t<video crossorigin="anonymous" id="'+r+'_vjs" class="video-js" preload="auto" class="video-js vjs-default-skin vjs-live vjs-fill" \t\tcontrols width="100%" height="100%"\t\t muted='+h.m.mute+' autoplay=true preload playsinline="true"></video>\t<div class="cloudplayer-vxgcloudplayer-container" style="position:absolute;top:0;left:0;width:100%!important;height:100%!important;z-index:-2;display:block;">\t\t<vxg-cloud-player class="cloudplayer-vxgcloudplayer" id="'+r+'_vxg_cloud_player" timelineselector="#'+r+'_timeline" thumbnails videomodule="k-video-sdvxg" controls="k-control-timepicker " style="display: block; width:100%;height:100%;"></vxg-cloud-player>\t</div>\t<video crossorigin="anonymous" id="'+r+'_native_hls" class="cloudplayer-native-hls"\t\tmuted='+h.m.mute+' autoplay=true preload  playsinline="true" ></video>\t<video crossorigin="anonymous" id="'+r+'_webrtc" class="cloudplayer-webrtc"\t\tmuted='+h.m.mute+' preload  playsinline="true" ></video> \t<div id="'+r+'_jpg" class="cloudplayer-jpeg"></div> \t<div id="'+r+'_timelapse" class="cloudplayer-timelapse"></div></div><div class="cloudplayer-black-screen" style="display: none">\t\t<div class="cloudplayer-watermark"></div>\t\t<div class="cloudplayer-sdkversion">SDK '+CloudSDK.version+'</div></div><div class="cloudplayer-debug" style="display: none; position : absolute; z-index: 12; width: 100%; height : 50px; background-color: white;">/<div>',h.vjs=videojs(r+"_vjs",{controls:!1}),h.vjs.on("error",function(e){var t;ft(),null!=h.vjs.error()&&(t=h.vjs.error(),h.isLive()?4!=t.code||CloudHelpers.supportFlash()||h.isMobile||"flash"!=h.mPlayerFormat?3==t.code&&h.isMobile?h._showConsoleError(CloudReturnCode.ERROR_COULD_NOT_DECODE_STREAM_OR_COULD_NOT_SET_COOKIE_HLS):h._showConsoleError({name:"VIDEOJS_ERROR",text:"Code "+t.code+": "+t.message,code:-6e3}):h._showConsoleError({name:"REQUIRE_FLASH",text:"Please install and enable <a target='_black' href='https://get.adobe.com/flashplayer/'>Adobe Flash Player</a> and try again",code:-6001}):h._showConsoleError({name:"VIDEOJS_ERROR",text:"Code "+t.code+": "+t.message,code:-6e3})),h._hideSnapshot(!1),h.stop("by_vjs_error"),setTimeout(function(){h.play()},1e3)});var G=null;h.time=0;var J=h.player,Z=h.player.getElementsByClassName("cloudplayer-controls")[0],X=h.player.getElementsByClassName("cloudplayer-volume")[0],Y=h.player.getElementsByClassName("cloudplayer-controls-zoom-container")[0],K=h.player.getElementsByClassName("cloudplayer-controls-zoom")[0],Q=h.player.getElementsByClassName("cloudplayer-controls-zoom-position")[0],ee=h.player.getElementsByClassName("cloudplayer-controls-container")[0],te=h.player.getElementsByClassName("cloudplayer-show-zoom")[0],oe=h.player.getElementsByClassName("cloudplayer-show-ptz")[0],ne=h.player.getElementsByClassName("cloudplayer-microphone")[0],re=h.player.getElementsByClassName("cloudplayer-get-shot")[0],ae=h.player.getElementsByClassName("cloudplayer-get-clip")[0],le=h.player.getElementsByClassName("cloudplayer-sd-backup")[0],ie=h.player.getElementsByClassName("cloudplayer-selectbackuptime")[0],se=h.player.getElementsByClassName("enable-disable-sdcard")[0],ce=h.player.getElementsByClassName("cloudplayer-ptz")[0],ue=h.player.getElementsByClassName("cloudplayer-play")[0],de=h.player.getElementsByClassName("cloudplayer-info")[0],me=h.player.getElementsByClassName("clipcreatebtn")[0],pe=h.player.getElementsByClassName("sdcardbackupbtn")[0],fe=h.player.getElementsByClassName("cloudplayer-stop")[0],ge=h.player.getElementsByClassName("cloudplayer-pause")[0],he=h.player.getElementsByClassName("cloudplayer-loader")[0],ve=h.player.getElementsByClassName("cloudplayer-error")[0],ye=h.player.getElementsByClassName("cloudplayer-error-text")[0],Ce=h.player.getElementsByClassName("cloudplayer-time")[0],_e=h.player.getElementsByClassName("clipdt")[0],Ee=h.player.getElementsByClassName("syncdt")[0],Pe=h.player.getElementsByClassName("cloudplayer-big-play-button")[0],d=h.player.getElementsByClassName("cloudplayer-webrtc")[0],f=h.player.getElementsByClassName("cloudplayer-native-hls")[0],Te=h.player.getElementsByClassName("cloudplayer-jpeg")[0],be=h.player.getElementsByClassName("cloudplayer-timelapse")[0],Ie=h.player.getElementsByClassName("cloudplayer-controls-timelapse-container")[0],we=h.player.getElementsByClassName("cloudplayer-timelapse-left")[0],Ae=h.player.getElementsByClassName("cloudplayer-timelapse-pause")[0],Re=h.player.getElementsByClassName("cloudplayer-timelapse-right")[0],Se=h.player.getElementsByClassName("cloudplayer-record-mode")[0],ke=h.player.getElementsByClassName("cloudplayer-info-playertype")[0],Le=h.player.getElementsByClassName("cloudplayer-settings")[0],Oe=(h.player.getElementsByClassName("cloudplayer-info-close")[0],h.player.querySelectorAll(".cloudplayer-info-title .back")),Me=h.player.getElementsByClassName("cloudplayer-info-player-mode")[0],Ne=h.player.querySelector(".cloudplayer-info-player-speed"),xe=h.player.getElementsByClassName("selected-quality")[0],De=h.player.getElementsByClassName("selected-format")[0],Ue=h.player.querySelector(".cloudplayer-info-player-speed.enabled .selected-speed"),He=h.player.querySelector(".cloudplayer-info-player-dewarping.enabled .selected-dewarping"),je=h.player.getElementsByClassName("cloudplayer-webrtc-mode")[0],Be=h.player.getElementsByClassName("cloudplayer-flash-mode")[0],ze=h.player.getElementsByClassName("cloudplayer-html5-mode")[0],Fe=h.player.getElementsByClassName("cloudplayer-jpeg-mode")[0],b=h.player.getElementsByClassName("cloudcameracalendar-content")[0],qe=h.player.getElementsByClassName("cloudplayer-calendar-container")[0],We=h.player.getElementsByClassName("ptz-left")[0],Ve=h.player.getElementsByClassName("ptz-right")[0],Ge=h.player.getElementsByClassName("ptz-top")[0],$e=h.player.getElementsByClassName("ptz-bottom")[0],Je=h.player.getElementsByClassName("ptz-zoom-plus")[0],W=h.player.getElementsByClassName("ptz-zoom-minus")[0],Ze=h.player.getElementsByClassName("cloudplayer-calendar-container")[0],Xe=h.player.getElementsByClassName("cloudplayer-live-container")[0],Ye=h.player.querySelectorAll(".cloudplayer-quality-mode"),Ke=h.player.querySelectorAll(".cloudplayer-speed-mode"),Qe=h.player.querySelectorAll(".cloudplayer-dewarping-mode"),k=h.player.getElementsByClassName("cloudplayer-vxgcloudplayer")[0],et=new CloudPlayerJpegLive(Te);h.options.jpegForcedUpdatePeriod&&et.setForcedUpdatePeriod(h.options.jpegForcedUpdatePeriod);var tt=new CloudPlayerJpegTimelapse(be),V=h.player.getElementsByClassName("cloudplayer-share-clip")[0];void 0!==V&&new CloudShareClipController(V,h._shareClipCallback);for(var ot=Ye.length-1;0<=ot;ot--)Ye[ot].onclick=st;for(var nt=Ke.length-1;0<=nt;nt--)Ke[nt].onclick=ct;for(var rt=Qe.length-1;0<=rt;rt--)Qe[rt].onclick=ut;"undefined"!=typeof rangeSlider&&rangeSlider.create(X);var at=document.querySelectorAll("[data-rangeSlider]");function lt(e){var t=e.value;e.parentNode.getElementsByTagName("output")[0].innerHTML=t+"%"}for(var it=at.length-1;0<=it;it--)lt(at[it]);function st(){for(var e,t=Ye.length-1;0<=t;t--)Ye[t].classList.remove("selected");this.classList.add("selected"),xe.textContent=this.textContent,e=this.dataset.quality,L=e,Rt(G)}function ct(){for(var e=Ke.length-1;0<=e;e--)Ke[e].classList.remove("selected");this.classList.add("selected"),Ue.textContent=this.textContent,function(e){for(var t=J.getElementsByClassName("cloudplayer-native-video"),o=0;o<t.length;o++)t[o].defaultPlaybackRate=t[o].playbackRate=e;k&&(k.playbackRate=e)}(this.dataset.speed)}function ut(){for(var e=Qe.length-1;0<=e;e--)Qe[e].classList.remove("selected");this.classList.add("selected"),He.textContent=this.textContent,1==this.dataset.dewarping?h.pano.start():h.pano.stop()}for(Array.prototype.slice.call(document.querySelectorAll('input[type="range"]')).forEach(function(e){e.addEventListener("input",function(e){lt(e.target)},!1)}),it=0;it<Oe.length;it++)Oe[it].onclick=function(){h.collapseMenu()};function dt(){ve.style.display="none",ye.style.display="none"}var mt=null;function pt(e){e=Number(e);CloudHelpers.isIE()?isNaN(e)&&(e=0):Number.isNaN(e)&&(e=0),1==h.mShowedBigPlayButton?ft():n||(0==e?(he.style.display="inline-block",n=!0):0<e&&(mt=setTimeout(function(){he.style.display="inline-block",n=!0},e)))}function ft(){n&&(null!=mt&&clearTimeout(mt),he.style.display="none",n=!1)}function gt(e){Ie.style.display=e?"flex":"none"}function ht(e){e=e||{},je.style.display=CloudHelpers.isIE()||!e.rtc&&!e.webrtc?"none":"",Be.style.display="none",ze.style.display=e.hls?"block":"none",Fe.style.display=e.hls?"block":"none",je.classList.remove("selected"),Be.classList.remove("selected"),ze.classList.remove("selected"),Fe.classList.remove("selected"),"webrtc"==h.mPlayerFormat?(je.classList.add("selected"),De.textContent=je.textContent):"flash"==h.mPlayerFormat?(Be.classList.add("selected"),De.textContent=Be.textContent):"html5"==h.mPlayerFormat?(ze.classList.add("selected"),De.textContent=ze.textContent):"jpeg"==h.mPlayerFormat&&(Fe.classList.add("selected"),De.textContent=Fe.textContent)}h.onDocumentClick=function(e){de.contains(e.target)||Le==e.target||Le.contains(e.target)||b==e.target||b.contains(e.target)||re==e.target||ae==e.target||le==e.target||ne==e.target||te==e.target||te.contains(e.target)||Y==e.target||Y.contains(e.target)||qe==e.target||qe.contains(e.target)||ie==e.target||ie.contains(e.target)||(h.player.classList.remove("showing-zoom","showing-settings"),h.sdControls&&(h.player.getElementsByClassName("cloudplayer-selectbackuptime")[0].style.display="none"),h.calendar&&(h.calendar.hideCalendar(),(e=h.player.getElementsByClassName("cloudcameratimeline-calendar")[0])&&e.classList.remove("shadowed")))},document.addEventListener("click",h.onDocumentClick),Le.onclick=function(){var e;J.classList.remove("showing-quality-selection"),J.classList.remove("showing-format-selection"),J.classList.remove("showing-speed-selection"),J.classList.remove("showing-dewarping-selection"),h.player.classList.toggle("showing-settings"),h.player.classList.remove("showing-zoom"),h.player.getElementsByClassName("cloudplayer-selectcliptime")[0].style.display="none",h.player.getElementsByClassName("cloudplayer-selectbackuptime")[0].style.display="none",h.calendar&&(h.calendar.hideCalendar(),(e=h.player.getElementsByClassName("cloudcameratimeline-calendar")[0])&&e.classList.remove("shadowed"))},xe.onclick=function(){J.classList.toggle("showing-quality-selection")},De.onclick=function(){J.classList.toggle("showing-format-selection")},Ue.onclick=function(){J.classList.toggle("showing-speed-selection")},null!=He&&(He.onclick=function(){J.classList.toggle("showing-dewarping-selection")}),We.onmousedown=function(){var e=v._getAPI();null!=e&&h.mPTZActions&&-1!=h.mPTZActions.indexOf("left")&&e.cameraPtzExecute(h.mSrc.getID(),{action:"left",timeout:1e4}).done(function(e){console.log("shifted to left")}).fail(function(e){console.error(e)})},Ve.onmousedown=function(){var e=v._getAPI();null!=e&&h.mPTZActions&&-1!=h.mPTZActions.indexOf("right")&&e.cameraPtzExecute(h.mSrc.getID(),{action:"right",timeout:1e4}).done(function(e){console.log("shifted to right")}).fail(function(e){console.error(e)})},Ge.onmousedown=function(){var e=v._getAPI();null!=e&&h.mPTZActions&&-1!=h.mPTZActions.indexOf("top")&&e.cameraPtzExecute(h.mSrc.getID(),{action:"top",timeout:1e4}).done(function(e){console.log("shifted to up")}).fail(function(e){console.error(e)})},$e.onmousedown=function(){var e=v._getAPI();null!=e&&h.mPTZActions&&-1!=h.mPTZActions.indexOf("bottom")&&e.cameraPtzExecute(h.mSrc.getID(),{action:"bottom",timeout:1e4}).done(function(e){console.log("shifted to down")}).fail(function(e){console.error(e)})},Je.onmousedown=function(){var e=v._getAPI();null!=e&&h.mPTZActions&&-1!=h.mPTZActions.indexOf("zoom_in")&&e.cameraPtzExecute(h.mSrc.getID(),{action:"zoom_in",timeout:1e4}).done(function(e){console.log("Zoomed in")}).fail(function(e){console.error(e)})},W.onmousedown=function(){var e=v._getAPI();null!=e&&h.mPTZActions&&-1!=h.mPTZActions.indexOf("zoom_out")&&e.cameraPtzExecute(h.mSrc.getID(),{action:"zoom_out",timeout:1e4}).done(function(e){console.log("Zoomed out")}).fail(function(e){console.error(e)})},Je.onmouseup=W.onmouseup=We.onmouseup=Ve.onmouseup=Ge.onmouseup=$e.onmouseup=function(){var e=v._getAPI();null!=e&&h.mPTZActions&&-1!=h.mPTZActions.indexOf("stop")&&e.cameraPtzExecute(h.mSrc.getID(),{action:"stop",timeout:1e3}).done(function(e){console.log("stop move")}).fail(function(e){console.error(e)})},te.onclick=function(){var e;h.player.classList.toggle("showing-zoom"),h.player.classList.remove("showing-settings"),h.player.getElementsByClassName("cloudplayer-selectcliptime")[0].style.display="none",h.player.getElementsByClassName("cloudplayer-selectbackuptime")[0].style.display="none",h.calendar&&(h.calendar.hideCalendar(),(e=h.player.getElementsByClassName("cloudcameratimeline-calendar")[0])&&e.classList.remove("shadowed"))},oe.onclick=function(){-1==j&&J.classList.toggle("showing-ptz")},re.onclick=function(){h._getSnapshot()},ne.onclick=function(){-1==j&&h._sendBackwardAudio()},me.onclick=function(){var e=h.player.getElementsByClassName("cloudplayer-selectcliptime")[0];e.style.display="none";var t=e.getElementsByClassName("clipbefore")[0],e=e.getElementsByClassName("clipafter")[0];isNaN(t.value)||isNaN(e.value)?alert('"Before" and "after" fields must contain a number'):(t=parseInt(t.value),e=parseInt(e.value),t<0||e<0?alert('"Before" and "after" fields must be above or equal 0'):t+e<10?alert("Min clip length is 10 seconds"):3600<t+e?alert("Max clip length is 1 hour (3600 seconds)"):h._getShareClip(t,e=3600<e?3600:e))},ae.onclick=function(){var e;kt?alert("Please wait until your previous clip making will completely finished"):-1!=j?"block"==(e=h.player.getElementsByClassName("cloudplayer-selectcliptime")[0]).style.display?e.style.display="none":(e.style.display="block",h.player.classList.remove("showing-zoom","showing-settings")):alert("Select a position with the recorded video on the timeline")},le.onclick=function(){var e=h.player.getElementsByClassName("cloudplayer-selectbackuptime")[0];"block"==e.style.display?(e.style.display="none",h.sdControls=!1):(e.style.display="block",Ee.innerHTML=(-1==j?new Date:new Date(j)).toLocaleString(),h.player.classList.remove("showing-zoom","showing-settings"),h.sdControls=!0)},pe.onclick=function(){var e=h.player.getElementsByClassName("cloudplayer-selectbackuptime")[0];e.style.display="none";e=e.getElementsByClassName("backupduration")[0];isNaN(e.value)?alert('"Duration" field must contain a number'):(e=parseInt(e.value))<0?alert('"Duration" field must be above or equal 0'):3600<e?alert("Max backup length is 1 hour (3600 seconds)"):h._getSdBackup(e=3600<e?3600:e)},se.onclick=function(){var e="true"==this.getAttribute("enabled");h._toggleSync(!e)},Se.onclick=function(){S=Se.classList.contains("mode-records")?(Se.classList.remove("mode-records"),Se.classList.add("mode-timelapse"),gt(!0),"timelapse"):(Se.classList.add("mode-records"),Se.classList.remove("mode-timelapse"),gt(!1),"records"),h.play()},we.onclick=function(){console.log("TODO: timelapse left"),tt&&(i=!0,tt.rewind(h.time))},Ae.onclick=function(){console.log("TODO: timelapse pause"),tt&&(i=l=!1,tt.pause())},Re.onclick=function(){console.log("TODO: timelapse right"),tt&&(i=!0,tt.fastforward(h.time))},je.onclick=function(){void 0===t.useOnlyPlayerFormat&&(h.setPlayerFormat("webrtc"),h.play())},Be.onclick=function(){void 0===t.useOnlyPlayerFormat&&(h.setPlayerFormat("flash"),h.play())},ze.onclick=function(){void 0===t.useOnlyPlayerFormat&&(h.setPlayerFormat("html5"),h.play())},Fe.onclick=function(){void 0===t.useOnlyPlayerFormat&&(h.setPlayerFormat("jpeg"),h.play())},h.isMobile&&(Be.style.display="none"),ht();var vt=h.player.getElementsByClassName("cloudplayer-black-screen")[0];function yt(){vt.style.display=""}ft(),h._showerror=function(e){console.error(e),h._setError(e),h.showErrorText(e.text),console.error(e.text),y.executeCallbacks(CloudPlayerEvent.ERROR,e)},h._showConsoleError=function(e){console.error(e),console.error(e.text)};var Ct=30,_t=15,Et=null;function Pt(){var e=0,e=60*-(new Date).getTimezoneOffset()*1e3,t=new Date,o=t.getTime()+e;if(o<0||Number.isNaN(o))return"";t.setTime(o);e=t.getUTCHours(),o="";return h.options.timelineampm&&(o=12<=e?" pm":" am",e=0==e?12:12<e?e-12:e)," "+("0000"+t.getUTCFullYear()).slice(-4)+"-"+("00"+(t.getUTCMonth()+1)).slice(-2)+"-"+("00"+t.getUTCDate()).slice(-2)+" "+("00"+e).slice(-2)+":"+("00"+t.getUTCMinutes()).slice(-2)+":"+("00"+t.getUTCSeconds()).slice(-2)+o}function Tt(e){var t=0,t=60*-(new Date).getTimezoneOffset()*1e3,o=new Date,e=e+t;if(e<0||Number.isNaN(e))return"";o.setTime(e);t=o.getUTCHours(),e="";return h.options.timelineampm&&(e=12<=t?" pm":" am",t=0==t?12:12<t?t-12:t)," "+("0000"+o.getUTCFullYear()).slice(-4)+"-"+("00"+(o.getUTCMonth()+1)).slice(-2)+"-"+("00"+o.getUTCDate()).slice(-2)+" "+("00"+t).slice(-2)+":"+("00"+o.getUTCMinutes()).slice(-2)+":"+("00"+o.getUTCSeconds()).slice(-2)+e}function bt(){console.log("before play"),h._hideSnapshot(!0)}function It(){clearInterval(e)}function wt(){console.warn("[PLAYER] Start poling player time"),clearInterval(e),e=setInterval(function(){if(i&&!l){var e=0;if("camera_records"==Et)e="timelapse"===S?tt.getcurrtime():Number(k.currentUtcTime);else if("camera_live"==Et)if("webrtc0"==u||"webrtc2"==u)e=d?d.currentTime:0;else if("native-hls"==u)e=f?f.currentTime:0;else if("jpeg"==u)e=et.getcurrtime();else{try{e=1e3*h.vjs.currentTime()}catch(e){console.error("Ignore: ",e)}try{t=h.vjs.videoHeight(),o=h.vjs.videoWidth(),H.w==o&&H.h==t||(setTimeout(function(){var e,t=h.vjs.el();!t||(e=t.getElementsByTagName("object")[0])&&(e.style.width="calc(100% - 5px)",setTimeout(function(){e.style.width=""},1e3))},1e3),H.w=o,H.h=t)}catch(e){}}else try{e=1e3*h.vjs.currentTime()}catch(e){console.error("Ignore: ",e)}e==h.time?(pt(h.options.loaderTimeout||0),a++,0==h.time&&Ct<a?(h.stop("by_poling_time_1"),"webrtc"===h.mPlayerFormat?(h.stop("by_setError"),h.play()):(h.count_ERROR_STREAM_UNREACHABLE=1+(0|h.count_ERROR_STREAM_UNREACHABLE),3<h.count_ERROR_STREAM_UNREACHABLE?(h._showerror(CloudReturnCode.ERROR_STREAM_UNREACHABLE),h.count_ERROR_STREAM_UNREACHABLE=0):(console.warn("[PLAYER] stream unreachable: restart count"+h.count_ERROR_STREAM_UNREACHABLE),h.stop("by_setError"),h.play()))):0!=h.time&&_t<a?(console.warn("Restart player"),h.stop("by_poling_time_2"),-1!=j&&h.time>j&&(j=Math.floor(h.time)),h.play()):"camera_records"==Et?"timelapse"===S&&CloudHelpers.getCurrentTimeUTC()-e<18e4&&(tt.pause(),setTimeout(function(){h.setPosition(CloudPlayer.POSITION_LIVE),h.play()},10)):(0!=h.time&&-1==j||pt(),"jpeg"==u||console.warn("[PLAYER] Wait stream "+a))):(h.count_ERROR_STREAM_UNREACHABLE=0,a=0,h.mShowedBigPlayButton,Pe.style.display="none","camera_records"==Et?(h.time=e,j=h.time,k.isPlaying()&&(Ce.innerHTML=Tt(h.time),_e.innerHTML=Ce.innerHTML)):"camera_live"==Et?(h.time=e,Ce.innerHTML=Pt(),h.isRange()&&CloudHelpers.getCurrentTimeUTC()>U&&(It(),h.stop("by_ended_timerange2"),y.executeCallbacks(CloudPlayerEvent.RANGE_ENDED,{}))):(h.time=-1==j?1e3*h.vjs.currentTime():q.startUTC+1e3*h.vjs.currentTime(),Ce.innerHTML=Pt()),0!=h.time&&ft(),dt()),h.isRange()&&h.time>U&&(j=D,It(),h.stop("by_ended_timerange"),y.executeCallbacks(CloudPlayerEvent.RANGE_ENDED,{}))}else ft();var t,o},1e3)}function At(e,t){h.mSrc?(a=0,"camera"==h.mSrc.type?(t=t,console.log("TODO: play records:"+t),setTimeout(function(){ft()},1e3),It(),k&&(Et="camera_records",k.parentElement.style.zIndex=-1,k.parentElement.style.opacity=1,k.setTimePromise(j).then(function(){wt()}).catch(function(){}),s="timepicker"!==t,h.pause())):h._showerror(CloudReturnCode.ERROR_INVALID_SOURCE)):h._showerror(CloudReturnCode.ERROR_SOURCE_NOT_CONFIGURED)}function Rt(e){if(e==G)return h.mSrc?"active"!=h.mSrc._origJson().status?(0==h.m.waitSourceActivation&&"setsource"!=h.mSrc._origJson().status&&(h._showerror(CloudReturnCode.ERROR_CAMERA_OFFLINE),y.executeCallbacks(CloudPlayerEvent.CHANNEL_STATUS,{status:"offline"})),void zt(e)):(a=0,void("camera"==h.mSrc.type?(zt(e),h._polingLoadCameraLiveUrl(e)):(console.error("[CloudPlayer] invalid source"),h.setError(100)))):(console.error("[CloudPlayer] source not set"),void h.setError(100));console.warn("_uniqPlay not current [cameraLiveUrls fail]")}function St(){function e(){CloudHelpers.isIOS()||CloudHelpers.isAndroid(),CloudHelpers.isChrome()&&!CloudHelpers.autoPlayAllowed&&h.mPlayerFormat;h.vjs.play(),It(),wt()}console.log("[PLAYER] _vjs_play_live, mEvent: ",o),Pe.style.display="none",CloudHelpers.isChrome()&&!CloudHelpers.autoPlayAllowed&&"html5"==h.mPlayerFormat?CloudHelpers.checkAutoplay(e):e()}k.addEventListener("playing",function(e){console.log("mVxgcloudplayer callback status is playing")}),k.addEventListener("pause",function(e){console.log("mVxgcloudplayer callback status is pause")}),k.addEventListener("statusupdate",function(e){console.log("mVxgcloudplayer callback status is "+e.status),"error"===e.status&&($(k).hasClass("camera_side_error")&&h.showErrorText("Camera side error"),$(k).hasClass("sync_timeout_error")&&h.showErrorText("Sync timeout"),$(k).hasClass("sync_error")?h.showErrorText("Syncronization error"):h.showErrorText("Error"),h.pause())}),h.showErrorText=function(e){ft(),ve.style.display="block",ye.style.display="inline-block",ye.innerHTML=e,yt()},h.getCalendarContent=function(){return b},h.setAccessToken=function(e){w=e},h.checkTokenExpire=function(){var e=CloudHelpers.getCurrentTimeUTC(),e=CloudHelpers.parseUTCTime(A)-e;e<3e5?y.executeCallbacks(CloudPlayerEvent.ACCESS_TOKEN_EXPIRED_IN_5MIN,e):setTimeout(function(){h.checkTokenExpire()},5e3)},h.setAccessTokenExpire=function(e){null!=(A=e)&&void 0!==A&&setTimeout(function(){h.checkTokenExpire()},5e3)},h.mPoster=null,h.setSource=function(g){return dt(),clearInterval(_),Ce.innerHTML="",new Promise(function(o,e){h.mSrc=g,v=null==h.mSrc?(ue.style.display="none",null):(ue.style.display="inline-block",g._getConn());h.mSrc._origJson();h.mSrc._origJson().status="setsource",h.isRange()?(i=CloudHelpers.getCurrentTimeUTC(),D<i&&i<U?h.setPosition(CloudPlayer.POSITION_LIVE):h.setPosition(D)):h.setPosition(CloudPlayer.POSITION_LIVE),y.executeCallbacks(CloudPlayerEvent.SOURCE_CHANGED);var t,n,r,a,l,i,s,c,u,d,m,p,f=h.player;f&&(f.classList.remove("showing-ptz"),t=h.player.getElementsByClassName("cloudplayer-show-ptz")[0],n=h.player.getElementsByClassName("cloudplayer-get-clip")[0],i=h.player.getElementsByClassName("cloudplayer-sd-backup")[0],r=h.player.getElementsByClassName("enable-disable-sdcard")[0],f=h.player.getElementsByClassName("cloudplayer-get-shot")[0],a=h.player.getElementsByClassName("cloudplayer-microphone")[0],l=h.player.getElementsByClassName("cloudplayer-info-player-quality")[0],h.mSrc&&h.mSrc._origJson().access.indexOf("all")<0?(t.style.display="none",n.style.display="none"):h.options.disableGetClip&&0!=h.options.disableGetClip||CloudHelpers.isIE()||(n.style.display="block"),h.options.disableGetShot&&0!=h.options.disableGetShot||CloudHelpers.isIE()||(f.style.display="block"),!1===h.options.disableSdCard&&(CloudHelpers.isIE()||(i.style.display="block")),v&&(i=h.mSrc.getID(),v._getAPI().getCamera2(i).done(function(e){var t=h.player.getElementsByClassName("mem_rec_hide");if(e.memorycard_recording){for(o=0;o<t.length;o++)t[o].style.display="none";r.innerHTML="Enable SD Card Backup",r.setAttribute("enabled",!0)}else{for(var o=0;o<t.length;o++)t[o].style.display="block";r.innerHTML="Enable Sync from Timeline",r.setAttribute("enabled",!1)}}),tt.setApi(v._getAPI()),s=h.player.getElementsByClassName("ptz-top")[0],c=h.player.getElementsByClassName("ptz-bottom")[0],u=h.player.getElementsByClassName("ptz-left")[0],d=h.player.getElementsByClassName("ptz-right")[0],m=h.player.getElementsByClassName("ptz-zoom-plus")[0],p=h.player.getElementsByClassName("ptz-zoom-minus")[0],h.options.livePoster&&1==h.options.livePoster&&v._getAPI().cameraPreview(h.mSrc.getID()).done(function(e){h.getCurrentVideoTag();var t=h.player.getElementsByClassName("allvideotags")[0].getElementsByTagName("video");h.mPoster=e.url;for(var o=0;o<t.length;o++)t[o].setAttribute("poster",h.mPoster);h.vjs.poster(h.mPoster)}).fail(function(e){}),v._getAPI().cameraPtz(h.mSrc.getID()).done(function(e){console.log(e);e=e.actions;void 0!==(h.mPTZActions=e)&&null!=e&&0<e.length?(h.mPTZShow&&(t.style.display="block"),s.style.display=-1<e.indexOf("top")?"block":"none",c.style.display=-1<e.indexOf("bottom")?"block":"none",u.style.display=-1<e.indexOf("left")?"block":"none",d.style.display=-1<e.indexOf("right")?"block":"none",m.style.display=-1<e.indexOf("zoom_in")?"block":"none",p.style.display=-1<e.indexOf("zoom_out")?"block":"none"):(t.style.display="none",h.mPTZActions=null)}).fail(function(e){console.log(e),t.style.display="none",h.mPTZActions=null}),navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?!0!==h.options.disableBackwardAudio&&v._getAPI().cameraAudio(h.mSrc.getID()).done(function(e){console.log(e),void 0!==e.caps&&void 0!==e.caps.backward_formats&&0<e.caps.backward_formats.length?(R=e.caps.backward_formats,a.classList.remove("disabled")):a.classList.add("disabled")}).fail(function(e){console.log("Backward channel request:"+e),a.classList.add("disabled")}):a.classList.add("disabled"),w&&k&&(k.setAttribute("src",w),k.pause().then(function(){console.log("vxgcloudplayer pause")}).catch(function(e){console.log("vxgcloudplayer catch:"+e)}),v._getAPI().cameraMediaStreams(h.mSrc.getID()).done(function(e){if(M=e.rec_ms_id,O=e.live_ms_id,e.hasOwnProperty("mstreams_supported"))for(const t of e.mstreams_supported)-1===t.vs_id.indexOf("JPEG")&&(t.id==M?N=t.vs_id:t.id==O&&(x=t.vs_id));M==O?l.style.display="none":(L="main",$(".selected-quality").html("Main"),$(".quality-main").addClass("selected"),$(".quality-live").removeClass("selected"),l.style.display="flex"),o()}).fail(function(e){console.log(e)}))))})},h.getSource=function(){return h.mSrc},h.removeCallback=function(e){y.removeCallback(e)},h.addCallback=function(e,t){y.addCallback(e,t)},h.onTimelineEndUpdate=function(){-1==j&&l&&"block"==ve.style.display&&(console.warn("TODO Restart live if some errors happends"),h.play())},h.playbackAutoplayBlocked=function(){-1==j&&console.warn("Skip error player already in live mode")},h.setPlayerFormat=function(e){if("webrtc"==(e=e.toLowerCase())||"flash"==e||"html5"==e||"jpeg"==e){h.mPlayerFormat=e;try{localStorage.setItem("preferred_player_format",h.mPlayerFormat)}catch(e){console.error("[CloudPlayer] error save format: ",e)}ht()}else console.error("Player format expected 'webrtc' or 'flash' or 'html5'")},h.getPlayerFormat=function(){return sMode};var kt=null;h._shareClipCallback=function(e,t,o){var n=h.player.getElementsByClassName("cloudplayer-get-clip")[0];e?("CloudShareClip in process.."===t&&alert("The video is being prepared ..."),n.classList.add("inprocess")):(null!=kt&&(clearInterval(kt),kt=null),n.classList.remove("step1"),n.classList.remove("step2"),n.classList.remove("step3"),n.classList.remove("step4"),n.classList.remove("inprocess")),void 0!==o?(console.log("ShareClipInfo: "+o.url),(n=document.createElement("a")).setAttribute("href",o.url),n.click()):console.log("ShareClipInfo: "+t)},h._getShareClip=function(e,t){var o,n=h.mSrc,r=j;-1!=r?(r-=1e3*e,void 0!==(o=h.player.getElementsByClassName("cloudplayer-share-clip")[0])&&void 0!==n&&w&&void 0!==w&&(o.createClip(n,w,h._shareClipCallback,r,1e3*(t+e)),kt=setInterval(function(){var e=h.player.getElementsByClassName("cloudplayer-get-clip")[0];e.classList.contains("inprocess")?e.classList.contains("step1")?(e.classList.remove("step1"),e.classList.add("step2")):e.classList.contains("step2")?(e.classList.remove("step2"),e.classList.add("step3")):e.classList.contains("step3")?(e.classList.remove("step3"),e.classList.add("step4")):(e.classList.contains("step4")&&e.classList.remove("step4"),e.classList.add("step1")):(e.classList.remove("step1"),e.classList.remove("step2"),e.classList.remove("step3"),e.classList.remove("step4"))},500))):alert("Select a position with the recorded video on the timeline")},h._getSdBackup=function(e){var t,o,n=h.mSrc,r=j;-1==r?t=(o=(new Date).getTime())-1e3*e:o=(t=r)+1e3*e;var d,m=CloudHelpers.formatUTCTime(t),p=CloudHelpers.formatUTCTime(o);void 0!==n&&w&&void 0!==w&&(d=h.player.getElementsByTagName("vxg-cloud-player")[0]).player.camera.get_v4_storage_records({start:m,end:p}).then(function(e){var a=e.objects,l=h.player.getElementsByClassName("cloudplayer-sd-backup")[0],t=0,i=setInterval(function(){t=t+45==360?0:t+45,l.style.transform=`rotate(${t}deg)`},500),s=h.player.getElementsByClassName("sdcardbackupbtn")[0],c=h.player.getElementsByClassName("enable-disable-sdcard")[0];s.classList.add("sd-backup-disable"),c.classList.add("sd-backup-disable");var u=h.player.querySelector(".cloudplayer-selectbackuptime .mem_rec_hide #backup_result");d.player.storage.sdStorageAndCheck(m,p).then(function(e){if(0==(o=d.player.storage.overlapArray(m,p,a)).length&&o.push({start:m,end:p}),0==e.length){s.classList.remove("sd-backup-disable"),c.classList.remove("sd-backup-disable");var t=$('<p id="no-sd-data" style="width: 100%; text-align: center;">No SD Card Data Found</p>');return u.append(t[0]),t=h.player.querySelector(".cloudplayer-selectbackuptime .mem_rec_hide #backup_result #no-sd-data"),l.style.transform="rotate(0deg)",clearInterval(i),void setTimeout(function(){t.remove()},5e3)}var o=d.player.storage.gapsInSDCard(e,o),o=d.player.storage.chunkSyncCalls(o),n=$('<progress id="backup-progress" value="0" max="100" style="width: 100%; height: 15px;" ></progress>');u.append(n[0]);var r=100/o.length,n=h.player.querySelector(".cloudplayer-selectbackuptime .mem_rec_hide #backup_result #backup-progress"),o=o.reduce((e,t)=>e.then(()=>d.player.storage.syncAndCheck(t.start,t.end,n,r)),Promise.resolve());Promise.resolve(o).then(function(){s.classList.remove("sd-backup-disable"),c.classList.remove("sd-backup-disable"),l.style.transform="rotate(0deg)",clearInterval(i),setTimeout(function(){n.remove()},15e3)},function(e){l.style.transform="rotate(0deg)",clearInterval(i),console.log(e.responseText)})})})},h._toggleSync=function(e){var t=h.mSrc;if(void 0!==t&&w&&void 0!==w){t.toggleMemRec(e,w);var o=h.player.getElementsByClassName("mem_rec_hide"),t=h.player.getElementsByClassName("enable-disable-sdcard")[0];if(e){for(n=0;n<o.length;n++)o[n].style.display="none";t.innerHTML="Enable SD Card Backup",t.setAttribute("enabled",!0)}else{for(var n=0;n<o.length;n++)o[n].style.display="block";t.innerHTML="Enable Sync from Timeline",t.setAttribute("enabled",!1)}}},h._onResize=function(){var e=h.player.getElementsByClassName("cloudplayer-snapshot")[0],t=h.player.getElementsByClassName("allvideotags")[0];void 0!==e&&(e.setAttribute("width",t.clientWidth),e.setAttribute("height",t.clientHeight))},h._onResize(),window.addEventListener("resize",h._onResize),h._getSnapshot=function(){if(h.player){for(var e=h.player.getElementsByClassName("cloudplayer-stub-snapshot")[0],t=null,o=h.player.getElementsByClassName("allvideotags")[0].getElementsByTagName("video"),n=0;n<o.length;n++){var r=o[n],a=(r.currentStyle||getComputedStyle(r,null)).display,l=(r.parentElement.currentStyle||getComputedStyle(r.parentElement,null)).display;if("block"===(a=r.classList.contains("vjs-tech")?l:a)||"inline-block"===a){t=r;break}}if(null!=t||j==CloudHelpers.POSITION_LIVE||null==k||null!=(t=k.getVideo()).src&&""!=t.src&&4==t.readyState){if(null!=t){var i=t.videoWidth,s=t.videoHeight;if(0==i&&(i=t.clientWidth),0==s&&(s=t.clientHeight),0<i&&0<s&&(e.setAttribute("width",i),e.setAttribute("height",s),context=e.getContext("2d"),null!=context))if(context.fillRect(0,0,i,s),context.drawImage(t,0,0,i,s),void 0!==e.msToBlob)try{var c=e.msToBlob();window.navigator.msSaveOrOpenBlob(c,"snapshot.png")}catch(e){console.warn("Can't create snapshot due error: "+e.toString())}else{var u=document.createElement("a");u.setAttribute("download","snapshot.png"),e.toBlob(function(e){e=URL.createObjectURL(e);u.setAttribute("href",e),u.click()})}}}else null!=t.poster&&""!=t.poster&&fetch(t.poster).then(function(e){return e.blob()}).then(e=>{e=window.URL.createObjectURL(e);const t=document.createElement("a");t.style.display="none",t.href=e,t.download="snapshot.jpg",document.body.appendChild(t),t.click(),window.URL.revokeObjectURL(e)}).catch(function(){})}},h._hideSnapshot=function(e){if(h.player){var t=h.player.getElementsByClassName("cloudplayer-snapshot")[0],o=null;e?$(t).addClass("hidden"):$(t).removeClass("hidden");for(var n,r,a,l,i,s,c,u=h.player.getElementsByTagName("video"),d=0;d<u.length;d++){var m=u[d],p=(m.currentStyle||getComputedStyle(m,null)).display,f=(m.parentElement.currentStyle||getComputedStyle(m.parentElement,null)).display;if("block"===(p=m.classList.contains("vjs-tech")?f:p)||"inline-block"===p){o=m;break}}null!=o&&(r=n=0,i=a=o.videoWidth,c=l=o.videoHeight,s=t.getAttribute("width"),e=t.getAttribute("height"),1<=(c=i/c)?(n=0,r=(e-(l=(a=s)/c))/2):(r=0,n=(s-(a=(l=e)*c))/2),context=t.getContext("2d"),null!=context&&(context.fillRect(n,r,a,l),context.drawImage(o,n,r,a,l)))}};var Lt=null;h.sendBackwardAudio=function(){return!0===h.options.disableBackwardAudio?(console.warn("Backward audio is disabled by configuration"),-1):j!=CloudHelpers.POSITION_LIVE?(console.warn("Can't control backward audio while player isn't LIVE mode"),-2):void 0===R?(console.warn("Camera doesn't supports backward audio"),-3):(h._sendBackwardAudio(),0)},h._sendBackwardAudio=function(e){var t=h.player.getElementsByClassName("cloudplayer-microphone")[0],o=h.player.getElementsByClassName("cloudplayer-backward-webrtc")[0];1==h.isBackwardAudioStarted?(console.log("TODO: Stop bw_audio"),t.classList.remove("prepare"),t.classList.remove("onair"),h.isBackwardAudioStarted=!1,null!=Lt&&(Lt.stopWS(),Lt=null)):(console.log("TODO: Start bw_audio"),v._getAPI().cameraBackwardUrls(h.mSrc.getID()).done(function(e){console.log(e),void 0!==e.webrtc_backward&&(t.classList.add("prepare"),h.isBackwardAudioStarted=!0,(Lt=new CloudPlayerWebRTC2(o,e.webrtc_backward.connection_url,e.webrtc_backward.ice_servers,{send_video:!1,send_audio:!0})).onServerError=function(e){t.classList.remove("onair"),h.isBackwardAudioStarted=!1,console.error("[WebRTC] Event error ",e),Lt.stopWS()},Lt.onStartStreaming=function(){console.log("afterIce"),t.classList.remove("prepare"),t.classList.add("onair")},Lt.startWS())}).fail(function(e){console.log(e)}))},h.setPosition=function(e){j=e,gt(!1),-1==j?(void 0===t.useOnlyPlayerFormat&&h.enableModeSetting(),h.collapseMenu(),C=!0,oe.classList.remove("inactive"),ne.classList.remove("inactive"),null!=h.mPTZActions&&h.mPTZShow&&(oe.style.display="block"),Se.style.display="none"):(h.disableModeSetting(),h.collapseMenu(),h.time=e,Ce.innerHTML=Tt(h.time),h.player.classList.remove("showing-ptz"),oe.classList.add("inactive"),ne.classList.add("inactive"),Se.classList.remove("mode-timelapse"),Se.classList.add("mode-records"),void 0!==h.options&&void 0!==h.options.debugTimelapse&&(Se.style.display=""),S="records",setTimeout(function(){1==h.isBackwardAudioStarted&&h._sendBackwardAudio()},100))},void 0!==t.position&&h.setPosition(j);var Ot=0;function Mt(e,t,o){for(var n=0;n<e.length;n++)o(e[n],t)}function Nt(){var e=h.player.getElementsByClassName("cloudplayer-volume-mute")[0],t=h.player.getElementsByClassName("cloudplayer-volume-down")[0],o=h.player.getElementsByClassName("cloudplayer-volume-progress")[0],n=h.player.getElementsByClassName("cloudplayer-volume-up")[0],r=h.player.getElementsByClassName("cloudplayer-volume-container")[0],a=h.player.getElementsByClassName("cloudplayer-volume")[0];function l(e){var t=0==e,o=document.getElementById(h.elid+"_native_hls"),n=document.getElementById(h.elid+"_vjs"),r=document.getElementById(h.elid+"_webrtc");null!=o&&void 0!==o&&(o.muted=t),null!=n&&void 0!==n&&(n.muted=t),h.vjs.muted(t),h.vjs.volume(e),k.muted=t,k.volume=e,null!=d&&(null!=r&&void 0!==r&&(r.muted=t),d.volume=e)}h.m=h.m||{},h.m.volume=1,e.style.display="inline-block",h.isMobile&&(r.style.display="none"),h.m.mute?(r.style.display="none",e.classList.add("unmute")):(h.isMobile||(r.style.display="flex"),e.classList.remove("unmute")),h.mute=function(){h.isAudioChannelExists()&&(h.m.mute=!h.m.mute,h.m.mute?(h.isMobile||(r.style.display="none"),e.classList.add("unmute")):(h.isMobile||(r.style.display="flex"),e.classList.remove("unmute")),l(h.m.mute?0:""+h.m.volume.toFixed(1)))},h.volume=function(e){if(h.isAudioChannelExists())return null==e?h.m.volume:(e=(e=1<e?1:e)<0?0:e,h.m.volume=Math.ceil(10*e)/10,l(h.m.mute?0:h.m.volume.toFixed(1)),void(o.className=o.className.replace(/vol\d+/g,"vol"+Math.ceil(10*h.m.volume))))},h.volup=function(){h.isAudioChannelExists()&&Math.round(10*h.m.volume)<10&&(h.m.volume=h.m.volume+.1,l(h.m.mute?0:h.m.volume.toFixed(1)),o.className=o.className.replace(/vol\d+/g,"vol"+Math.ceil(10*h.m.volume)))},h.voldown=function(){h.isAudioChannelExists()&&0<Math.round(10*h.m.volume)&&(h.m.volume=h.m.volume-.1,l(h.m.mute?0:h.m.volume.toFixed(1)),o.className=o.className.replace(/vol\d+/g,"vol"+Math.floor(10*h.m.volume)))},e.onclick=h.mute,t.onclick=h.voldown,n.onclick=h.volup,a.addEventListener("input",function(e){h.player.getElementsByClassName("cloudplayer-volume")[0]&&h.volume(e.target.value/100)}),h.vjs.ready(function(){h.isAudioChannelExists()&&(h.vjs.muted(!0),h.volume(h.m.volume))}),h.isAudioChannelExists()||(t.style.display="none",o.style.display="none",n.style.display="none",e.style.display="none"),h.options.disableAudioControl&&1==h.options.disableAudioControl&&(h.m.volume=1,h.m.mute=!1,e.style.display="none",t.style.display="none",o.style.display="none",n.style.display="none",r.style.display="none",a.style.display="none")}function xt(e,t){var o,n,r,a;t.rtc?(console.warn("webrtc0 - depracated"),u="webrtc0",ke.innerHTML="Used player: WebRTC (v0)",o="https:"==location.protocol?"wss://":"ws://",n=location.hostname,a=8080,v.ServiceProviderUrl,t.rtc&&("http"==(r=CloudHelpers.parseUri(t.rtc).protocol)||"ws"==r?o="ws://":"https"==r||"wss"==r?o="wss://":console.warn("Unknown protocol in '"+t+"'"),n=CloudHelpers.parseUri(t.rtc).host,a=CloudHelpers.parseUri(t.rtc).port),a=o+n+":"+a+"/",h.vjs.el().style.display="none",Te.style.display="none",f.style.display="none",d.style.display="block",window.CloudPlayerWebRTC0?((m=new CloudPlayerWebRTC0(d,a,t.rtmp)).onAutoplayBlocked=h.WebRTC2_autoplayBlocked,m.onServerError=function(e){console.error("[WebRTC0] Event error ",e),h._showerror(CloudReturnCode.ERROR_WEBRTC_SERVER_ERROR),h.stop("by_webrtc0_error")},m.startWS(),wt()):console.error("Not found module CloudPlayerWebRTC0")):h._showerror(CloudReturnCode.NOT_SUPPORTED_FORMAT)}function Dt(e,t){var o;t.webrtc?(u="webrtc2",ke.innerHTML="Used player: WebRTC (v2)",h.vjs.el().style.display="none",f.style.display="none",Te.style.display="none",d.style.display="block",window.CloudPlayerWebRTC2?(o=CloudHelpers.promise(),0<CloudHelpers.compareVersions(CloudPlayerWebRTC2.version,t.webrtc.version)?(console.warn("Expected version webrtc.version (v"+t.webrtc.version+")  mismatch with included CloudPlayerWebRTC (v"+CloudPlayerWebRTC2.version+")"),o=CloudHelpers.requestJS(t.webrtc.scripts.player,function(e){for(e=e.replace("CloudPlayerWebRTC =","CloudPlayerWebRTC2 =");-1!==e.indexOf("CloudPlayerWebRTC.");)e=e.replace("CloudPlayerWebRTC.","CloudPlayerWebRTC2.");return e})):o.resolve(),o.done(function(){console.log("[PLAYER] ",t.webrtc.connection_url),(p=new CloudPlayerWebRTC2(d,t.webrtc.connection_url,t.webrtc.ice_servers,{send_video:!1,send_audio:!1})).onAutoplayBlocked=h.WebRTC2_autoplayBlocked,p.onServerError=function(e){console.error("[WebRTC2] Event error ",e),h._showerror(CloudReturnCode.ERROR_WEBRTC_SERVER_ERROR),h.stop("by_webrtc2_error")},p.startWS(),wt()})):console.error("Not found module CloudPlayerWebRTC2")):h._showerror(CloudReturnCode.NOT_SUPPORTED_FORMAT)}function Ut(e,t){var o;t.rtmp?(ke.innerHTML="Used player: Flash",h.vjs.ready(function(){console.log("[PLAYER] Set url (rtmp): "+t.rtmp),h.vjs.options().flash.swf=CloudSDK.flashswf||"swf/video-js-by-vxg-buff200.swf",h.vjs.src([{src:t.rtmp,type:"rtmp/mp4"}]),CloudHelpers.isFireFox()?console.warn("in firefox not good solution for a hiding adobe flash player"):vt.style.display="block"}),h.vjs.off("ended"),h.vjs.on("ended",function(){h.stop("by_rtmp_ended")}),o=!1,h.vjs.off("loadeddata"),h.vjs.on("loadeddata",function(){console.warn("loadeddata"),o=!0,yt(),e==G?(ft(),Nt(),St()):console.warn("[PLAYER]  _uniqPlay not current [loadeddata]")}),h.vjs.on("playing",function(){bt()}),h.vjs.off("loadedmetadata"),h.vjs.on("loadedmetadata",function(){console.warn("loadedmetadata")}),setTimeout(function(){console.log("[PLAYER] Set url (rtmp) 2: "+t.rtmp),o||h.vjs.src([{src:t.rtmp,type:"rtmp/mp4"}])},5e3),It(),wt(),CloudHelpers.isChrome()&&!CloudHelpers.autoPlayAllowed?St():h.vjs.play()):h._showerror(CloudReturnCode.NOT_SUPPORTED_FORMAT)}function Ht(e,t){t.hls?(u="jpeg",ke.innerHTML="Used player: Jpeg",h.vjs.el().style.display="none",d.style.display="none",f.style.display="none",Te.style.display="block",window.CloudPlayerJpegLive?(t=h.options.jpegRedrawPeriod||1e3,et.play(v._getAPI(),h.mSrc,t),bt(),wt()):console.error("[PLAYER]  Not found module CloudPlayerJpegLive")):h._showerror(CloudReturnCode.NOT_SUPPORTED_FORMAT)}function jt(e,t){var o;t.hls?h.m.useNativeHLS?(o=t).hls?(u="native-hls",ke.innerHTML="Used player: NativeHLS",h.vjs.el().style.display="none",d.style.display="none",Te.style.display="none",f.style.display="block",window.CloudPlayerNativeHLS?((g=new CloudPlayerNativeHLS(f,o.hls)).play(),bt(),wt()):console.error("[PLAYER]  Not found module CloudPlayerNativeHLS")):h._showerror(CloudReturnCode.NOT_SUPPORTED_FORMAT):(h.vjs.el().style.display="block",d.style.display="none",Te.style.display="none",f.style.display="none",ke.innerHTML="Used player: HTML5 (hls)",u="hls",console.log("[PLAYER] Set url (hls): "+t.hls),clearInterval(I),function e(t,o){var n;o==G?((n=new XMLHttpRequest).open("GET",t.hls),n.onload=function(){if(o==G)if(200===n.status)o==G&&(h._applyMediaTiket(t.hls,t.expire),null==h.vsFormat||"H264"==h.vsFormat?h.vjs.src([{src:t.hls,type:"application/x-mpegURL"}]):"dash"in t&&h.vjs.src([{src:t.dash,type:"application/dash+xml"}]),n=null);else if(404===n.status)if(o==G){if(Ct<++a)return h.count_ERROR_STREAM_UNREACHABLE=1+(0|h.count_ERROR_STREAM_UNREACHABLE),void(3<h.count_ERROR_STREAM_UNREACHABLE?(h._showerror(CloudReturnCode.ERROR_STREAM_UNREACHABLE_HLS),h.count_ERROR_STREAM_UNREACHABLE=0):(h.stop(),h.play()));setTimeout(function(){console.warn("Wait one sec "+t.hls),n=null,e(t,o)},1e3)}else console.warn("[VXGCLOUDPLAYER] polingHLSList, camid was changed stop poling hls list, currentCmaID="+h.mSrc.getID());else console.error("Unhandled");else console.warn("_uniqPlay not current [_polingCameraHLSList 2]")},n.send()):console.warn("_uniqPlay not current [_polingCameraHLSList]")}(t,e),h.vjs.off("ended"),h.vjs.on("ended",function(){h.stop("by_hls_ended"),h._showerror(CloudReturnCode.ERROR_HLS_ENDED)}),c="",h.vjs.off("loadeddata"),h.vjs.on("loadeddata",function(){console.warn("loadeddata"),yt(),e==G?(ft(),Nt(),St(),CloudHelpers.isSafari()&&(c="loadeddata")):console.warn("_uniqPlay not current [loadeddata]")}),h.vjs.off("loadedmetadata"),h.vjs.on("loadedmetadata",function(){}),h.vjs.off("playing"),h.vjs.on("playing",function(){CloudHelpers.isSafari()&&"loadeddata"===c&&(c="playing"),bt()}),h.vjs.off("pause"),h.vjs.on("pause",function(){CloudHelpers.isSafari()&&"playing"===c&&(c="pause",St())}),It(),wt(),CloudHelpers.isChrome()&&!CloudHelpers.autoPlayAllowed?St():h.vjs.play()):h._showerror(CloudReturnCode.NOT_SUPPORTED_FORMAT)}function Bt(o){if(null!=G&&o!=G)return console.warn("[_polingCameraStatus] _uniqPlay not current 1"),void clearInterval(_);if(!h.mSrc)return console.warn("[_polingCameraStatus] no source"),void clearInterval(_);if("camera"!=h.mSrc.type)return console.warn("[_polingCameraStatus] no type camera"),void clearInterval(_);var e=h.mSrc.getID(),n=h.mSrc._origJson().status;v._getAPI().getCamera2(e,{}).done(function(e){var t=e.status;if(null!=G&&o!=G)return console.warn("[_polingCameraStatus] _uniqPlay not current (2) "+o+"!="+G),void clearInterval(_);"active"!==t&&0!=h.m.waitSourceActivation&&B>h.m.waitSourceActivation&&(h._showerror(CloudReturnCode.ERROR_CAMERA_OFFLINE),B=0),n!=t&&(console.warn("switched camera status: from "+n+" to "+t+" mLiveModeAutoStart: "+C),h.mSrc._origJson().status=t,C&&("active"==t?h.play():(h.stop("by_poling_camera_status"),h._showerror(CloudReturnCode.ERROR_CAMERA_OFFLINE),zt(o))),y.executeCallbacks(CloudPlayerEvent.CHANNEL_STATUS,{status:t}),P&&setTimeout(function(){P(h,t)},10))}).fail(function(e){console.error("[_polingCameraStatus] ",e),h.mSrc._origJson().status="error"})}function zt(t){setTimeout(function(){C=!0,clearInterval(_),Bt(t),B=100;var e=3e3,e="active"==h.mSrc._origJson().status?F:z;_=setInterval(function(){0<B&&(B+=e),Bt(t)},e)},100)}h.getPosition=function(){return i?-1==j?("webrtc0"==u||"webrtc2"==u)&&d&&0!=d.currentTime||"native-hls"==u&&f&&0!=f.currentTime||"jpeg"==u||"webrtc0"!=u&&"webrtc2"!=u&&h.vjs&&0!=h.vjs.currentTime()?CloudHelpers.getCurrentTimeUTC()+(v?v.getServerTimeDiff():0):0:0==h.time?j:Math.floor(h.time):s?Ot:0},h.isLive=function(){return-1==j&&!l},h.play=function(e){i?h.stop("by_play"):h._reset_players(),"camera"==h.mSrc.type?(G=Math.random(),o=e,console.warn("[PLAYER] mUniqPlay: "+G),ge.classList.remove("hidden"),ge.classList.remove("play"),ue.style.display="none",s=!(i=!(l=!1)),It(),dt(),h.isRange()&&-1==j&&CloudHelpers.getCurrentTimeUTC()>U&&(j=D),h.isRange()&&U<j&&(j=D),y.executeCallbacks(CloudPlayerEvent.PLAYED,e),-1==j?(Rt(G),y.executeCallbacks(CloudPlayerEvent.POSITION_JUMPED,{new_pos:CloudHelpers.getCurrentTimeUTC()})):"records"===S?(console.warn("Try load records from "+CloudHelpers.formatUTCTime(j)),At(0,e)):(console.log("TODO: timelapse"),h.mSrc?"camera"==h.mSrc.type?(Et="camera_records",be.style.display="",tt.play(300,j),wt()):h._showerror(CloudReturnCode.ERROR_INVALID_SOURCE):h._showerror(CloudReturnCode.ERROR_SOURCE_NOT_CONFIGURED)),"records"!==S&&pt(h.options.loaderTimeout||0)):h._showerror(CloudReturnCode.ERROR_INVALID_SOURCE)},h.pause=function(e){var t;l=!1,0==s?(Ot=h.getPosition(),i=!(s=!0),ge.classList.add("play"),-1==j?"webrtc"==h.mPlayerFormat?null!=m?m.pause():null!=p&&p.pause():"jpeg"==h.mPlayerFormat?et&&et.pause():h.vjs.pause():k.pause().then(function(e){console.log("pause: vxgcloudplayer pause ok")}).catch(function(e){console.log("pause: vxgcloudplayer pause cathc")})):(i=!(s=!1),ge.classList.remove("play"),-1==j?"webrtc"==h.mPlayerFormat?null!=m?m.play():null!=p&&p.play():"jpeg"==h.mPlayerFormat?et&&(t=h.options.jpegRedrawPeriod||1e3,et.play(v._getAPI(),h.mSrc,t)):h.vjs.play():k.play().then(function(e){i=!0,console.log("pause: vxgcloudplayer play ok")}).catch(function(e){console.log("pause: vxgcloudplayer play cathc")}))},h.getImages=function(){var e,t;v&&(e={},t=(new Date).getTime(),t=CloudHelpers.formatUTCTime(t),e.order_by="-time",e.limit=5,e.end=t,v._getAPI().cameraImages(e).done(function(e){console.log("done")}).fail(function(e){console.log("error")}))},h.stop=function(e){console.log("[PLAYER] stop called "+e),C=s=i=!(l=!(G=null)),clearInterval(_),y.executeCallbacks(CloudPlayerEvent.STOPED,e),("by_webrtc2_error"===e||"by_webrtc0_error"===e||"by_setError"===e&&"webrtc"===h.mPlayerFormat)&&(h.mPlayerFormat="html5"),console.log("[PLAYER] self.stop: somebody call"),"by_plrsdk_3"===e&&(h.mPoster=null),"by_destroy"!=e&&h._reset_players(),"by_plrsdk_1"===e&&(dt(),k&&(k.setAttribute("src",""),k.setTimePromise(Date.now()))),null!=m&&(m.stopWS(),d.style.display="none"),null!=p&&(p.stopWS(),d.style.display="none"),null!=g&&(g.stop(),f.style.display="none"),null!=et&&(et.stop(),Te.style.display="none"),fe.style.display="none",ue.style.display="inline-block",ge.classList.add("hidden"),It(),clearInterval(I),h._stopPolingMediaTicket(),"by_play"!==e&&ft()},h.close=function(){h.stop("by_close"),clearInterval(h.currentTime),clearInterval(_)},h.destroy=function(){document.removeEventListener("click",h.onDocumentClick),h.stop("by_destroy"),h.pano.stop(),delete h.pano,clearInterval(h.currentTime),clearInterval(_),h.vjs.dispose(),delete window._cloudPlayers[h.elid],k&&k.setAttribute("src",""),h.player.onwebkitfullscreenchange=null,h.player.onmozfullscreenchange=null,h.player.onfullscreenchange=null,h.player.onfullscreenchange=null,h.f_callbackFullscreenFunc&&(h.f_callbackFullscreenFunc=null)},h.error=function(){return h.mLastError||-1},h.onError=function(e){E=e},h.onChannelStatus=function(e){P=e},h._setError=function(e){setTimeout(function(){h.stop("by_setError"),ve.style.display="block",ye.style.display="inline-block"},10),h.mLastError=e,E&&(y.executeCallbacks(CloudPlayerEvent.ERROR,e),setTimeout(function(){E(h,e)},10))},h.setRange=function(e,t){console.warn("[PLAYER] setRange"),D=e,U=t},void 0!==t.range&&(Ae=parseInt(t.range.min,10),Re=parseInt(t.range.max,10),h.setRange(Ae,Re)),h.isRange=function(){return-1!=D&&-1!=U},h.resetRange=function(){console.warn("[PLAYER] resetRange"),U=D=-1},h._showZoomControl=function(e){e?(te.style.display="block",K.style.display="block"):(te.style.display="none",K.style.display="none")},h.showPTZControl=function(e){(h.mPTZShow=e)?void 0!==h.mPTZActions&&null!=h.mPTZActions&&0<h.mPTZActions.length&&(oe.style.display="block"):oe.style.display="none"},function(){h.currentZoom=0,h.player.getElementsByClassName("cloudplayer-show-zoom")[0],h.player.getElementsByClassName("cloudplayer-controls-zoom")[0];var t=h.player.getElementsByClassName("cloudplayer-controls-zoom-position")[0],e=h.player.getElementsByClassName("cloudplayer-zoom-up")[0],o=h.player.getElementsByClassName("cloudplayer-zoom-down")[0],n=h.player.getElementsByClassName("cloudplayer-zoom-progress")[0],l=h.player.getElementsByClassName("cloudplayer-zoom-position-cursor")[0],i=[];i.push(document.getElementById(r+"_vjs")),i.push(h.player.getElementsByClassName("cloudplayer-webrtc")[0]),i.push(h.player.getElementsByClassName("cloudplayer-jpeg")[0]),i.push(h.player.getElementsByClassName("cloudplayer-vxgcloudplayer")[0]),h.options.disableZoomControl&&1==h.options.disableZoomControl&&(te.style.display="none"),h.zoomCursorDownBool=!1,h.zoomCursorX=0,h.zoomCursorY=0,h.zoomCursorWidth=176,h.zoomCursorHeight=160,h.zoomControlsWidth=0,h.zoomControlsHeight=0,h.setNewZoom=function(e){h.currentZoom!=(e=(e=30<=e?30:e)<=10?10:e)&&(h.currentZoom=e,e="scale("+h.currentZoom/10+")",Mt(i,e,function(e,t){e.style.transform=t}),l.style.transform="scale("+10/h.currentZoom+")",n.className=n.className.replace(/zoom\d+x/g,"zoom"+Math.ceil(h.currentZoom)+"x"),t.style.display=10==h.currentZoom?"none":"",l.style.left="",l.style.top="",Mt(i,"",function(e,t){e.style.left=t,e.style.top=t}))},h.setNewZoom(10),h.zoomUp=function(){h.setNewZoom(h.currentZoom+5)},h.zoomDown=function(){h.setNewZoom(h.currentZoom-5)},h.zoomProgressDownBool=!1,h.zoomProgressDown=function(e){h.zoomProgressDownBool=!0},h.zoomProgressMove=function(e){var t;1==h.zoomProgressDownBool&&(t=e.pageY-CloudHelpers.getAbsolutePosition(e.currentTarget).y,e=n.offsetHeight,t=10*(Math.floor((e-t)/(e/5))/2+1),h.setNewZoom(t))},h.zoomProgressLeave=function(e){h.zoomProgressDownBool=!1},h.zoomProgressUp=function(e){var t;1==h.zoomProgressDownBool&&(t=e.pageY-CloudHelpers.getAbsolutePosition(e.currentTarget).y,e=n.offsetHeight,t=10*(Math.floor((e-t)/(e/5))/2+1),h.setNewZoom(t)),h.zoomProgressDownBool=!1},h.zoomCursorDown=function(e){void 0===e.pageX&&(e.pageX=e.touches[0].pageX),void 0===e.pageY&&(e.pageY=e.touches[0].pageY),h.zoomCursorX=e.pageX,h.zoomCursorY=e.pageY,h.zoomCursorWidth=l.offsetWidth,h.zoomCursorHeight=l.offsetHeight,h.zoomControlsWidth=t.offsetWidth,h.zoomControlsHeight=t.offsetHeight,h.zoomCursorDownBool=!0},h.zoomCursorUp=function(e){console.log("zoomCursorUp"),h.zoomCursorDownBool=!1},h.zoomCursorMove=function(e){var t,o,n,r,a;1==h.zoomCursorDownBool&&(void 0===e.pageX&&(e.pageX=e.touches[0].pageX),void 0===e.pageY&&(e.pageY=e.touches[0].pageY),n=h.zoomCursorX-e.pageX,a=h.zoomCursorY-e.pageY,h.zoomCursorX=e.pageX,h.zoomCursorY=e.pageY,t=l.offsetLeft-n,o=l.offsetTop-a,r=h.zoomControlsWidth-h.zoomCursorWidth*(10/h.currentZoom),(n=(e=h.zoomControlsHeight-h.zoomCursorHeight*(10/h.currentZoom))/2)<=(o=o<(a=-1*e/2)?a:o)&&(o=n),l.style.left=(t=(a=r/2)<=(t=t<(n=-1*r/2)?n:t)?a:t)+"px",l.style.top=o+"px",a=h.currentZoom/10-1,r=Math.floor(t/r*a*-100),a=Math.floor(o/e*a*-100),h.vjs.videoHeight(),h.vjs.videoWidth(),Mt(i,r+"%",function(e,t){e.style.left=t}),Mt(i,a+"%",function(e,t){e.style.top=t}))},e.onclick=h.zoomUp,o.onclick=h.zoomDown,l.addEventListener("mousedown",h.zoomCursorDown,!1),l.addEventListener("mousemove",h.zoomCursorMove,!1),l.addEventListener("mouseleave",h.zoomCursorUp,!1),l.addEventListener("mouseup",h.zoomCursorUp,!1),n.addEventListener("mousedown",h.zoomProgressDown,!1),n.addEventListener("mousemove",h.zoomProgressMove,!1),n.addEventListener("mouseleave",h.zoomProgressLeave,!1),n.addEventListener("mouseup",h.zoomProgressUp,!1),l.addEventListener("touchstart",h.zoomCursorDown,!1),l.addEventListener("touchmove",h.zoomCursorMove,!1),l.addEventListener("touchend",h.zoomCursorUp,!1)}(),h.isAudioChannelExists=function(){return!0},h.updateAudioStream=function(){el_info_audio_stream.style.display="none",v._getAPI().cameraMediaStreams(h.currentCamID).done(function(e){if(e.mstreams_supported&&1<e.mstreams_supported.length){el_info_audio_stream.style.display="block",h.mstreams.audio_on="",h.mstreams.audio_off="",h.mstreams.current=e.live_ms_id;for(var t=0;t<e.mstreams_supported.length;t++)e.mstreams_supported[t].as_id&&e.mstreams_supported[t].vs_id?h.mstreams.audio_on=e.mstreams_supported[t].id:e.mstreams_supported[t].vs_id&&(h.mstreams.audio_off=e.mstreams_supported[t].id);h.mstreams.audio_on==h.mstreams.current?el_info_audio_stream_on.classList.add("selected"):h.mstreams.audio_off==h.mstreams.current&&el_info_audio_stream_off.classList.add("selected")}else el_info_audio_stream.style.display="none";h.isAudioChannelExists()}).fail(function(e){console.error(e),el_info_audio_stream.style.display="none"})},Nt(),h.WebRTC0_autoplayBlocked=function(){It();try{m.stopWS()}catch(e){console.warn("WebRTC0_autoplayBlocked: skip error",e)}a=0,console.warn("_vjs_play. is mobile or autoplay not allowed. show big button"),Pe.style.display="block",Pe.onclick=function(e){o=e,Pe.style.display="none",a=0,h.play()}},h.WebRTC2_autoplayBlocked=function(){It();try{p.stopWS()}catch(e){console.warn("WebRTC2_autoplayBlocked: skip error",e)}a=0,console.warn("_vjs_play. is mobile or autoplay not allowed. show big button"),Pe.style.display="block",Pe.onclick=function(e){o=e,Pe.style.display="none",a=0,h.play()}},h._polingLoadCameraLiveUrl=function(o){var t;o==G?"camera"==h.mSrc.type?(h.updateAudioCaps&&h.updateAudioCaps(h.mSrc.getID()),Et="camera_live",t=u="",M&&O&&(t="main"==L?M:O,videoid="main"==L?N:x,console.log("changing stream quality to: "+L+" on id: "+t+" video_id: "+videoid),v._getAPI().getCameraVideoStream(h.mSrc.getID(),videoid).done(function(e){e&&(h.vsFormat=e.format),v._getAPI().cameraLiveUrls(h.mSrc.getID(),t).done(function(e){ht(e);var t=1;e.webrtc&&(t=e.webrtc.version.split(".")[0],t=parseInt(t,10)),null===(T=!e.hls&&!e.rtmp?"webrtc":T)?("webrtc"==h.mPlayerFormat&&(e.rtc&&CloudHelpers.supportWebRTC()?xt(0,e):e.webrtc&&2===t&&CloudHelpers.supportWebRTC()?Dt(0,e):jt(o,e)),"flash"==h.mPlayerFormat&&(CloudHelpers.useHls()?jt:Ut)(o,e),"html5"==h.mPlayerFormat&&jt(o,e),"jpeg"==h.mPlayerFormat&&Ht(0,e)):"flash"===T?Ut(o,e):"html5"===T?jt(o,e):e.rtc&&"webrtc"===T?xt(0,e):e.webrtc&&2===t&&"webrtc"===T?Dt(0,e):"jpeg"===T?Ht(0,e):h._showerror(CloudReturnCode.NOT_SUPPORTED_FORMAT)}).fail(function(e){console.error(e),o==G?e.status&&503==e.status&&++a<h.timePolingLiveUrls?setTimeout(function(){h._polingLoadCameraLiveUrl(o)},1e3):console.error(e):console.warn("_uniqPlay not current [_polingLoadCameraLiveUrl.fail]")})}).fail(function(e){console.error("Can can get video stream:"+e)}))):h._showerror(CloudReturnCode.ERROR_INVALID_SOURCE):console.warn("_uniqPlay not current [_polingLoadCameraLiveUrl]")},h._reset_players=function(){console.log("_reset_players"),h.vjs.reset(),h.mPoster&&h.vjs.poster(h.mPoster),h.vjs.controls(!1),h.vjs.muted(!0),h.vjs.autoplay(!0),h.vjs.volume(0),h.vjs.el().style.display="none",k.parentElement.style.zIndex=-2,k.parentElement.style.opacity=0,j==CloudHelpers.POSITION_LIVE&&k.pause().then(function(){}).catch(function(e){}),et.reset(),Te.style.display="none",tt.reset(),be.style.display="none",h.volume(h.m.volume),It(),h._stopPolingMediaTicket()},h.isPlaying=function(){return i},h.set_controls_opacity=function(e){Z.style.opacity!=e&&y.executeCallbacks(CloudPlayerEvent.CHANGED_CONTROLS,{opacity:e}),Z.style.opacity=e,K.style.opacity=e,Q.style.opacity=e,ee.style.opacity=e,de.style.opacity=e,b.style.opacity=e,ce.style.opacity=e,Y.style.opacity=e,Ze.style.opacity=e,Xe.style.opacity=e;var t=h.player.getElementsByClassName("cloudplayer-selectcliptime")[0];!parseInt(e)&&t&&(t.style.display="none")};var Ft=!0;ee.addEventListener("mouseover",function(e){Ft=!1}),ee.addEventListener("mouseout",function(e){Ft=!0}),h.restartTimeout=function(){h.m.autohide<0?h.set_controls_opacity("0"):0!=h.m.autohide?(h.set_controls_opacity("1"),clearTimeout(h.timeout),h.timeout=setTimeout(function(){Ft?h.set_controls_opacity("0"):h.restartTimeout()},h.m.autohide)):h.set_controls_opacity("1")},h.restartTimeout(),h.player.addEventListener("mousedown",h.restartTimeout,!0),h.player.addEventListener("mousemove",h.restartTimeout,!0),h.player.addEventListener("touchmove",h.restartTimeout,!0),h.player.addEventListener("touchstart",h.restartTimeout,!0),ue.onclick=function(){h.play("by_button_click")},ge.onclick=function(){h.pause("by_button_click")},fe.onclick=function(){h.stop("by_button_click")},h.size=function(e,t){console.error("[CloudPlayer] size not support")},h.setFullscreenCallback=function(e){h.f_callbackFullscreenFunc=e},h.setIOsFullscreenCallback=function(e){h.f_callbackIOsFullscreenFunc=e},h.getCurrentVideoTag=function(){for(var e=void 0,t=h.player.getElementsByClassName("allvideotags")[0].getElementsByTagName("video"),o=0;o<t.length;o++){var n=t[o],r=(n.currentStyle||getComputedStyle(n,null)).display,a=(n.parentElement.currentStyle||getComputedStyle(n.parentElement,null)).display;if("block"===(r=n.classList.contains("vjs-tech")?a:r)||"inline-block"===r){e=n;break}}return e},h.printDebug=function(e){var t=h.player.getElementsByClassName("cloudplayer-debug")[0];t.style.display="block";e=document.createTextNode(e+"\n");t.appendChild(e)},h.initFullscreenControls=function(){var e,t,o,n,r=h.player.getElementsByClassName("cloudplayer-fullscreen")[0];h.changedFullscreen=function(){console.log("changedFullscreen: "+document.webkitIsFullScreen),document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement?(e=h.player.style.height,t=h.player.style.width,n=h.player.style.maxHeight,o=h.player.style.maxWidth,h.player.style.height="100%",h.player.style.width="100%",h.player.style.maxHeight="100%",h.player.style.maxWidth="100%",console.log("changedFullscreen -> fullscreen"),screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape"),h.f_callbackFullscreenFunc&&h.f_callbackFullscreenFunc(!0)):(h.player.style.height=e,h.player.style.width=t,h.player.style.maxHeight=n,h.player.style.maxWidth=o,console.log("changedFullscreen -> NOT fullscreen"),h.f_callbackFullscreenFunc&&h.f_callbackFullscreenFunc(!1))},h.player.onwebkitfullscreenchange=h.changedFullscreen,h.player.onmozfullscreenchange=h.changedFullscreen,h.player.onfullscreenchange=h.changedFullscreen,h.fullscreen=function(){console.log("fullscreen: clicked"),CloudHelpers.isIOS()&&h.f_callbackIOsFullscreenFunc(),1==document.webkitIsFullScreen?document.webkitCancelFullScreen():document.mozFullScreen?document.mozCancelFullScreen():document.msFullscreenElement&&null!=document.msFullscreenElement?document.msExitFullscreen():h.player.mozRequestFullScreen?h.player.mozRequestFullScreen():h.player.requestFullscreen?h.player.requestFullscreen():h.player.webkitRequestFullscreen?h.player.webkitRequestFullscreen():h.player.msRequestFullscreen&&h.player.msRequestFullscreen()},r.onclick=h.fullscreen},h.initFullscreenControls(),h.initHLSMechanism=function(){h._applyMediaTiket=function(e,t){console.log("media-tiсket: old = "+h.hls_mediaticket_value),-1!=e.indexOf("?")&&(h.hls_mediaticket_value="?"+e.split("?")[1]),Date.parse(t+"Z"),console.log("media-tiсket: new = "+h.hls_mediaticket_value)},h._stopPolingMediaTicket=function(){clearInterval(h._polingMediaTicketInterval)}},h.initHLSMechanism(),window._cloudPlayers[r]=h,CloudHelpers.isIE()?h.pano=null:h.pano=new CloudPano(h.player.getElementsByClassName("allvideotags")[0],h),h.enableSpeedSetting=function(){Ne.classList.add("enabled")},h.disableSpeedSetting=function(){Ne.classList.remove("enabled")},h.enableModeSetting=function(){Me.classList.add("enabled")},h.disableModeSetting=function(){Me.classList.remove("enabled")},h.collapseMenu=function(){J.classList.remove("showing-format-selection"),J.classList.remove("showing-dewarping-selection"),J.classList.remove("showing-speed-selection"),J.classList.remove("showing-quality-selection")},void 0!==t.useOnlyPlayerFormat?h.disableModeSetting():h.enableModeSetting()},CloudPlayer.POSITION_LIVE=-1;var CloudShareClipModel=function(e){this.controller=e,this.camera=null,this.accessToken=null};CloudShareClipModel.prototype.createClip=function(e,t,o,n,r,a){var l;null!=e&&(this.camera=e,this.accessToken=t,(l=this).camera.createClip(o,n,r,a,this.accessToken).done(function(e){var t=e.id,o=e.status;"pending"===o?setTimeout(function(){l.clipStatus(t)},3e3):"done"===o?l.controller.processDone(o,e):l.controller.processDone(o)}).fail(function(e){l.controller.processDone("error")}))},CloudShareClipModel.prototype.clipStatus=function(o){var n=this;this.camera&&void 0!==this.camera&&this.camera.getClip(o,this.accessToken).done(function(e){console.log("Clip Status OK:"+e.status);var t=e.status;""===t||"pending"===t?setTimeout(function(){n.clipStatus(o)},3e3):"done"===t?n.controller.processDone(t,e):n.controller.processDone(t)}).fail(function(e){n.controller.processDone("error")})};var CloudShareClipView=function(e){this.element=e};CloudShareClipView.prototype.initDraw=function(e){this.element.innerHTML='<div class= "CloudShareClipContainer"></div>';this.element;this.container=this.element.getElementsByClassName("CloudShareClipContainer")[0],this.render(e)},CloudShareClipView.prototype.render=function(e){},CloudShareClipView.prototype.showWait=function(e){var t=this.container;e?$(t).addClass("waitdata"):$(t).removeClass("waitdata")};var CloudShareClipController=function(e){void 0!==e&&(this.callback_func=null,this.inProcess=!1,this.clModel=new CloudShareClipModel(this),this.clView=new CloudShareClipView(e),this.clView.element.createClip=this.createClip.bind(this),this.clView.initDraw(this))};CloudShareClipController.prototype.processDone=function(e,t){this.inProcess=!1,this.callback_func&&this.callback_func(this.inProcess,e,t)},CloudShareClipController.prototype.createClip=function(e,t,o,n,r){if(void 0!==o&&(this.callback_func=o),this.inProcess)return console.warn("CloudShareClip in process.."),void(this.callback_func&&this.callback_func(this.inProcess,"CloudShareClip in process.."));this.inProcess=!0,this.callback_func&&this.callback_func(this.inProcess,"CloudShareClip started");var a=n+(r=void 0===r?2e4:r),l="clip_"+n,o=(new Date).getTime()+9e5;console.log("DEBUG create clip "+e.getName()+" time:"+n+" dur:"+r),this.clModel.createClip(e,t,l,n,a,o)},CloudShareClipController.prototype.showWait=function(e){console.log("DEBUG swhoWait "+e),this.clView.showWait(e)},window.CloudPlayerNativeHLS=function(e,t){var o=e,n=t;console.warn("[NativeHLS] canPlay: application/vnd.apple.mpegurl => ",o.canPlayType("application/vnd.apple.mpegurl")),console.warn("[NativeHLS] canPlay: application/x-mpegURL => ",o.canPlayType("application/x-mpegURL")),console.warn("[NativeHLS] canPlay: video/mp4 => ",o.canPlayType("video/mp4")),this.play=function(){0<o.children.length&&o.removeChild(o.children[0]);var e=document.createElement("source");e.src=n,e.type="video/mp4",o.append(e),o.load()},this.stop=function(){0<o.children.length&&o.removeChild(o.children[0])},o.addEventListener("abort",function(){console.warn("[NativeHLS] abort")},!0),o.addEventListener("canplay",function(){console.warn("[NativeHLS] canplay")},!0),o.addEventListener("canplaythrough",function(){console.warn("[NativeHLS] canplaythrough")},!0),o.addEventListener("durationchange",function(){console.warn("[NativeHLS] durationchange")},!0),o.addEventListener("emptied",function(){console.warn("[NativeHLS] emptied")},!0),o.addEventListener("encrypted",function(){console.warn("[NativeHLS] encrypted")},!0),o.addEventListener("ended",function(){console.warn("[NativeHLS] ended")},!0),o.addEventListener("error",function(e,t){console.error("[NativeHLS] error ",e),console.error("[NativeHLS] error ",t)},!0),o.addEventListener("interruptbegin",function(){console.warn("[NativeHLS] interruptbegin")},!0),o.addEventListener("interruptend",function(){console.warn("[NativeHLS] interruptend")},!0),o.addEventListener("loadeddata",function(){console.warn("[NativeHLS] loadeddata"),o.play()},!0),o.addEventListener("loadedmetadata",function(){console.warn("[NativeHLS] loadedmetadata")},!0),o.addEventListener("loadstart",function(){console.warn("[NativeHLS] loadstart")},!0),o.addEventListener("mozaudioavailable",function(){console.warn("[NativeHLS] mozaudioavailable")},!0),o.addEventListener("pause",function(){console.warn("[NativeHLS] pause")},!0),o.addEventListener("play",function(){console.warn("[NativeHLS] play")},!0),o.addEventListener("playing",function(){console.warn("[NativeHLS] playing")},!0),o.addEventListener("progress",function(){console.warn("[NativeHLS] progress")},!0),o.addEventListener("ratechange",function(){console.warn("[NativeHLS] ratechange")},!0),o.addEventListener("seeked",function(){console.warn("[NativeHLS] seeked")},!0),o.addEventListener("seeking",function(){console.warn("[NativeHLS] seeking")},!0),o.addEventListener("stalled",function(){console.warn("[NativeHLS] stalled")},!0),o.addEventListener("suspend",function(){console.warn("[NativeHLS] suspend")},!0),o.addEventListener("timeupdate",function(){console.warn("[NativeHLS] timeupdate")},!0),o.addEventListener("volumechange",function(){console.warn("[NativeHLS] volumechange")},!0),o.addEventListener("waiting",function(){console.warn("[NativeHLS] waiting")},!0)},window.CloudPlayerNativeVideo=function(e){var o=document.getElementById(e),t=null,n=this,r="[NativeVideo] ",a=0,l=null;n.onAutoplayBlocked=function(){},n.on=function(e,t){"error"==e?l=t:"loadeddata"==e?o.onloadeddata=t:"ended"==e?o.onended=t:"autoplay_blocked"==e?0:console.error(r+"ON Unknown "+e)},n.off=function(e){"loadeddata"==e?o.onloadeddata=null:"ended"==e?o.onended=null:console.error(r+"OFF Unknown "+e)},n.ready=function(e){e(),console.log(r+"TODO ready")},n.muted=function(e){o.muted=e,console.log(r+"TODO muted")},n.volume=function(e){if(void 0===e)return o.volume;o.volume=e},n.reset=function(){console.warn(r,"reset"),a=0,o.pause(),null!=t&&t.removeAttribute("src"),o.load()},n.controls=function(e){console.log(r+"TODO controls")},n.autoplay=function(e){1==e&&console.error(r+"Not supported autoplay")},n.el=function(){return o},n.src=function(e){null==t&&(t=document.createElement("source"),o.appendChild(t)),o.pause(),CloudHelpers.isIE()||(o.currentTime=0),t.setAttribute("src",e[0].src),o.load()},n.currentTime=function(e){return void 0!==e?(a=e,void(CloudHelpers.isIE()||(o.currentTime=e))):o.currentTime||a},n.play=function(){var e,t;e=o.play(),t="",-1!==(t=window.Promise?window.Promise.toString():t).indexOf("function Promise()")||-1!==t.indexOf("function ZoneAwarePromise()")?e.catch(function(e){console.error(r+"checkAutoplay, error:",e),"NotAllowedError"==e.name?(console.error(r+"_checkAutoPlay: error.name:","NotAllowedError"),n.onAutoplayBlocked()):"AbortError"==e.name&&CloudHelpers.isSafari()?(console.error(r+"_checkAutoPlay: AbortError (Safari)"),n.onAutoplayBlocked()):(console.error(e),console.error(r+"checkAutoplay: happened something else"))}).then(function(){console.log(r+"checkAutoplay: then")}):console.error(r+"checkAutoplay: could not work in your browser ",e)},n.pause=function(){o.pause()},o.addEventListener("abort",function(){},!0),o.addEventListener("canplay",function(){},!0),o.addEventListener("canplaythrough",function(){},!0),o.addEventListener("durationchange",function(){},!0),o.addEventListener("emptied",function(){},!0),o.addEventListener("encrypted",function(){},!0),o.addEventListener("ended",function(){console.warn(r+"ended")},!0),o.addEventListener("error",function(e,t){console.error(r+"err0 ",e),null!=l&&l(e)},!0),o.addEventListener("interruptbegin",function(){},!0),o.addEventListener("interruptend",function(){},!0),o.addEventListener("loadeddata",function(){o.currentTime=a},!0),o.addEventListener("loadedmetadata",function(){},!0),o.addEventListener("loadstart",function(){},!0),o.addEventListener("mozaudioavailable",function(){},!0),o.addEventListener("pause",function(){},!0),o.addEventListener("play",function(){},!0),o.addEventListener("playing",function(){},!0),o.addEventListener("progress",function(){},!0),o.addEventListener("ratechange",function(){},!0),o.addEventListener("seeked",function(){},!0),o.addEventListener("seeking",function(){},!0),o.addEventListener("stalled",function(){},!0),o.addEventListener("suspend",function(){},!0),o.addEventListener("timeupdate",function(){},!0),o.addEventListener("volumechange",function(){},!0),o.addEventListener("waiting",function(){},!0)},window.CloudPlayerWebRTC0=function(e,t,o){var n,r=e,a=t,l=o,i=null,s="[WEBRTC0] ",c={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:turn.vxg.io:3478?transport=udp"],username:"vxgturn",credential:"vxgturn"}]},u=this,d=Math.floor(8990*Math.random()+10).toString();u.onWsError=function(e){console.error(e)},u.onAutoplayBlocked=function(){console.error(s+"onAutoplayBlocked")},CloudHelpers.isSafari()&&navigator.mediaDevices.getUserMedia({audio:!1,video:!0}).then(function(e){console.log(s+"Camera permission granted")}).catch(function(e,t){console.error(e,t)}),u.pause=function(){r&&r.src&&r.pause()},u.play=function(){r&&r.src&&r.play()},u.resetState=function(){n.close()},u.handleIncomingError=function(e){console.error(s+"IncomingError: ",e),resetState()},u.resetVideoElement=function(){r.pause(),r.src="",r.load()},u.onIncomingSDP=function(e){e.sdp=e.sdp.replace(/profile-level-id=[^;]+/,"profile-level-id=42e01f"),console.log(s+"Incoming SDP is "+JSON.stringify(e)),i.setRemoteDescription(e).then(function(){console.log("Remote SDP set"),"offer"==e.type&&(console.log(s+"Got SDP offer, creating answer"),i.createAnswer().then(u.onLocalDescription).catch(function(e){console.error("[WEBRTC0] createAnswer: ",e)}))}).catch(function(e){console.error(s+"setRemoteDescription: ",e)})},u.onLocalDescription=function(e){console.log(s+"Got local description: "+JSON.stringify(e)),i.setLocalDescription(e).then(function(){var e,t;console.log(s+"Sending SDP answer"),sdp={sdp:i.localDescription},n.send(JSON.stringify(sdp)),console.warn(s+"Streaming (1)"),e=r.play(),t="",-1!==(t=window.Promise?window.Promise.toString():t).indexOf("function Promise()")||-1!==t.indexOf("function ZoneAwarePromise()")?e.catch(function(e){console.error(s+"_checkAutoplay, error:",e),"NotAllowedError"==e.name?(console.error(s+"_checkAutoPlay: error.name:","NotAllowedError"),u.onAutoplayBlocked()):"AbortError"==e.name&&CloudHelpers.isSafari()?(console.error(s+"_checkAutoPlay: AbortError (Safari)"),u.onAutoplayBlocked()):(console.error(e),console.error(s+"checkAutoplay: happened something else"))}).then(function(){console.log(s+"checkAutoplay: then")}):console.error(s+"_checkAutoplay: could not work in your browser ",e)})},u.onIncomingICE=function(e){console.log(s+"Incoming ICE: "+JSON.stringify(e));e=new RTCIceCandidate(e);i.addIceCandidate(e).catch(function(e){console.error(s+"addIceCandidate ",e)})},u.onServerMessage=function(t){if(console.log(s+"Received "+t.data),"HELLO"!==t.data)if(t.data.startsWith("ERROR"))u.handleIncomingError(t.data);else{try{msg=JSON.parse(t.data)}catch(e){return void(e instanceof SyntaxError?handleIncomingError("Error parsing incoming JSON: "+t.data):handleIncomingError("Unknown error parsing response: "+t.data))}null==i&&u.createCall(msg),null!=msg.sdp?u.onIncomingSDP(msg.sdp):null!=msg.ice?u.onIncomingICE(msg.ice):u.handleIncomingError("Unknown incoming JSON: "+msg)}else console.log(s+"Registered with server, waiting for stream")},u.stopWS=function(){n.close()},u.onServerClose=function(e){u.resetVideoElement(),null!=i&&(i.close(),i=null)},u.onServerError=function(e){console.error("[WEBRTC0] Unable to connect to server, did you add an exception for the certificate?")},u.onRemoteStreamAdded=function(e){videoTracks=e.stream.getVideoTracks(),audioTracks=e.stream.getAudioTracks(),0<videoTracks.length?(console.log("[WEBRTC0] Incoming stream: "+videoTracks.length+" video tracks and "+audioTracks.length+" audio tracks"),r.srcObject=e.stream):u.handleIncomingError("[WEBRTC0] Stream with unknown tracks added, resetting")},u.errorUserMediaHandler=function(){console.error("[WEBRTC0] Browser doesn't support getUserMedia!")},u.createCall=function(e){connect_attempts=0,(i=new RTCPeerConnection(c)).onaddstream=u.onRemoteStreamAdded,e.sdp||console.log("[WEBRTC0] WARNING: First message wasn't an SDP message!?"),i.onicecandidate=function(e){null!=e.candidate?n.send(JSON.stringify({ice:e.candidate})):console.error("[WEBRTC0] ICE Candidate was null, done")},console.log("[WEBRTC0] Created peer connection for call, waiting for SDP")},u.startWS=function(){u.connect_attempts++,3<u.connect_attempts?console.error("[WEBRTC0] Too many connection attempts, aborting. Refresh page to try again"):(console.log("[WEBRTC0] Connecting to server..."),loc=null,(n=new WebSocket(a)).addEventListener("open",function(e){n.send("HELLO "+d),console.log(s+"Registering with server"),n.send("SPAWN "+l)}),n.addEventListener("error",u.onServerError),n.addEventListener("message",u.onServerMessage),n.addEventListener("close",u.onServerClose))}},window.CloudPlayerWebRTC2=function(e,t,o,n){n=n||{};var a=this,l="[WEBRTC2] ";console.log(l,n);var i=e,r="",s=t||"",c=n.send_video||!1,u=n.send_audio||!1,d={},m={iceServers:o||[]},p=!1,f=null;function g(){console.warn(l+"loadeddata"),console.warn(l+"currentTime = "+i.currentTime)}a.onWsError=function(e){console.error("[WEBRTC2] onWsError, ",e)},a.resetState=function(){f.close()},a.handleIncomingError=function(e){console.error("[WEBRTC2] ERROR: ",e),a.resetState()},a.pause=function(){i&&i.srcObject&&i.pause()},a.play=function(){i&&i.srcObject&&i.play()},a.reset=function(){i&&i.srcObject&&(i.pause(),i.srcObject=null,r="",i.load())},a.el=function(){return i},a.onAutoplayBlocked=function(){console.error(l+"onAutoplayBlocked")},a.initCalbacks=function(){i&&i.addEventListener("loadeddata",g,!0)},a.removeCalbacks=function(){i&&i.removeEventListener("loadeddata",g,!0)},a.createWatchingConnection=function(t){connect_attempts=0,console.assert(!(t in d)),objPeer=new RTCPeerConnection(m),objPeer.strPeerUID=t,d[t]=objPeer,objPeer.onaddstream=a.onRemoteStreamAdded,objPeer.onicecandidate=function(e){null!=e.candidate?f.send(JSON.stringify({to:t,ice:e.candidate})):console.error("[WEBRTC2] ICE Candidate was null, done")},console.log("[WEBRTC2] Created peer connection for call, waiting for SDP")},a.getUserMediaConstraints=function(){var e={};e.audio=u,e.video=c;try{console.warn(l+"getSupportedConstraints: ",navigator.mediaDevices.getSupportedConstraints())}catch(e){console.error(l+"error on getSupportedConstraints",e)}return e},a.createPublishingConnection=function(o){connect_attempts=0,console.assert(!(o in d)),p=!0,u||c?navigator.mediaDevices.getUserMedia(a.getUserMediaConstraints()).then(function(e){console.log("[WEBRTC2] Local stream successfully received");var t=new RTCPeerConnection(m);t.strPeerUID=o,(d[o]=t).onaddstream=a.onRemoteStreamAdded,t.onicecandidate=function(e){null!=e.candidate?f.send(JSON.stringify({to:o,ice:e.candidate})):console.error("[WEBRTC2] ICE Candidate was null, done")},t.onconnectionstatechange=function(e){console.error("[WEBRTC2] Connection state changed "+t.connectionState)},console.log("[WEBRTC2] Created peer connection for publishing"),t.addStream(e),console.log("[WEBRTC2] Local SDP set"),t.createOffer().then(function(e){t.setLocalDescription(e),console.log("[WEBRTC2] Sending SDP offer"),sdp={to:o,sdp:e},f.send(JSON.stringify(sdp)),console.warn("[WEBRTC2] Streaming (1)")}).catch(function(e){console.error("[WEBRTC2] error on createOffer ",e)})}).catch(function(e,t){console.error("[WEBRTC2] error on getUserMedia a1 = ",e),console.error("[WEBRTC2] error on getUserMedia a2 = ",t)}):console.error("[WEBRTC2] Publisher must send audio or video stream")},a.onIncomingSDP=function(o,n,r){r.sdp=r.sdp.replace(/profile-level-id=[^;]+/,"profile-level-id=42e01f"),console.log("[WEBRTC2] Incoming SDP from "+o+": "+JSON.stringify(r)),n.setRemoteDescription(r).then(function(){console.log("[WEBRTC2] Remote SDP set"),p?(console.assert("answer"===r.type),console.log("[WEBRTC2] Got SDP answer from "+o)):(console.assert("offer"===r.type),console.log("[WEBRTC2] Got SDP offer from "+o),onLocalDescription=function(e){console.log("[WEBRTC2] Got local description: "+JSON.stringify(e)),n.setLocalDescription(e).then(function(){var e,t;console.log("[WEBRTC2] Sending SDP answer to "+o),r={to:o,sdp:n.localDescription},f.send(JSON.stringify(r)),console.warn("[WEBRTC2] Streaming (2)"),a.onStartStreaming(),e=i.play(),t="",-1!==(t=window.Promise?window.Promise.toString():t).indexOf("function Promise()")||-1!==t.indexOf("function ZoneAwarePromise()")?e.catch(function(e){console.error(l+"_checkAutoplay, error:",e),"NotAllowedError"==e.name?(console.error(l+"_checkAutoPlay: error.name:","NotAllowedError"),a.onAutoplayBlocked()):"AbortError"==e.name&&CloudHelpers.isSafari()?(console.error(l+"_checkAutoPlay: AbortError (Safari)"),a.onAutoplayBlocked()):(console.error(e),console.error(l+"checkAutoplay: happened something else"))}).then(function(){console.log(l+"checkAutoplay: then")}):console.error(l+"_checkAutoplay: could not work in your browser ",e)})},c||u?(console.log("[WEBRTC2] Watcher is configured to send stream"),navigator.mediaDevices.getUserMedia({audio:u,video:c}).then(function(e){n.addStream(e),console.log("[WEBRTC2] Local SDP set, creating answer"),n.createAnswer().then(onLocalDescription).catch(function(e){console.error("[WEBRTC2] error on createAnswer (1) ",e)})})):(console.log("[WEBRTC2] Creating answer without stream sending"),n.createAnswer().then(onLocalDescription).catch(function(e){console.error("[WEBRTC2] error on createAnswer (2) ",e)})))}).catch(function(e){console.error("[WEBRTC2] error on setRemoteDescription ",e)})},a.onIncomingICE=function(e,t,o){console.log("[WEBRTC2] Incoming ICE from "+e+": "+JSON.stringify(o));o=new RTCIceCandidate(o);t.addIceCandidate(o).catch(function(e){console.error("[WEBRTC2] error on addIceCandidate ",e)})},a.onServerMessage=function(t){if(console.log("[WEBRTC2] Received "+t.data),t.data.startsWith("HELLO"))console.log("[WEBRTC2] Registered with server, waiting for stream");else if(t.data.startsWith("SESSION_STARTED")){var e=t.data.split(" ")[1];console.log("[WEBRTC2] Publisher "+e+" is going to start session"),a.createWatchingConnection(e)}else if(t.data.startsWith("SESSION_STOPPED")){e=t.data.split(" ")[1];console.log("[WEBRTC2] Session of publisher "+e+" is terminated"),e in d&&(d[e]&&(d[e].close(),d[e]=null),delete d[e],i&&r===e&&a.reset())}else if(t.data.startsWith("START_SESSION")){e=t.data.split(" ")[1];console.log("[WEBRTC2] Watcher "+e+" has come and awaiting for publishing"),a.createPublishingConnection(e)}else if(t.data.startsWith("ERROR"))a.handleIncomingError(t.data);else{var o=null,n="",e=null;try{n=(o=JSON.parse(t.data)).from,e=d[n]}catch(e){return void(e instanceof SyntaxError?a.handleIncomingError("Error parsing incoming JSON: "+t.data):a.handleIncomingError("Unknown error parsing response: "+t.data))}null!=o.sdp?a.onIncomingSDP(n,e,o.sdp):null!=o.ice?a.onIncomingICE(n,e,o.ice):a.handleIncomingError("Unknown incoming JSON: "+o)}},a.stopWS=function(){f.close(),a.removeCalbacks()},a.onServerClose=function(e){for(strSessionPartnerPeerUID in console.error("[WEBRTC2] Closed WebRTC ",e),a.reset(),d)d[strSessionPartnerPeerUID]&&(d[strSessionPartnerPeerUID].close(),d[strSessionPartnerPeerUID]=null);d={}},a.onServerError=function(e){console.error("[WEBRTC2] Unable to connect to server, did you add an exception for the certificate?",e)},a.onStartStreaming=function(){},a.onRemoteStreamAdded=function(e){videoTracks=e.stream.getVideoTracks(),audioTracks=e.stream.getAudioTracks(),0<videoTracks.length||0<audioTracks.length?(console.log("[WEBRTC2] Incoming stream: "+videoTracks.length+" video tracks and "+audioTracks.length+" audio tracks"),i&&""===r&&(i.srcObject=e.stream,r=e.currentTarget.strPeerUID)):a.handleIncomingError("[WEBRTC2] Stream with unknown tracks added, resetting")},a.errorUserMediaHandler=function(){console.error("[WEBRTC2] Browser doesn't support getUserMedia!")},a.startWS=function(){a.connect_attempts++,3<a.connect_attempts?console.error("[WEBRTC2] Too many connection attempts, aborting. Refresh page to try again"):(console.log("[WEBRTC2] Connecting to server..."),(f=new WebSocket(s)).addEventListener("open",function(e){f.send("HELLO "+window.CloudPlayerWebRTC2.version),console.log("[WEBRTC2] Registering with server")}),f.addEventListener("error",a.onServerError),f.addEventListener("message",a.onServerMessage),f.addEventListener("close",a.onServerClose))}},window.CloudPlayerWebRTC2.version="2.0.3";var JpegPlayerQue=function(e){this.limit=e,this.array=[]};JpegPlayerQue.prototype.isEmpty=function(){return 0==this.array.length},JpegPlayerQue.prototype.push=function(e){return this.array.length<this.limit?(this.array.push(e),this.array.length):-1},JpegPlayerQue.prototype.pop=function(){if(!this.isEmpty())return this.array.shift()},JpegPlayerQue.prototype.peek=function(){if(!this.isEmpty())return this.array[0]},JpegPlayerQue.prototype.clear=function(){for(;0<this.array.length;)this.array.pop()},JpegPlayerQue.prototype.size=function(){return this.array.length};var JpegPlayerModel=function(e){this.quelimit=e||100,this.queue=new JpegPlayerQue(e),this.callback_lowdata=void 0,this.callback_time=void 0,this.lasttime=void 0,this.need_more_data=!1,this.data_is_over=!1};JpegPlayerModel.prototype.stop=function(){this.data_is_over=!1,this.need_more_data=!1,this.queue.clear(),this.lasttime=void 0,this.need_more_data=!1},JpegPlayerModel.prototype.pushImageInfo=function(e){null==e?(this.data_is_over=!0,this.need_more_data=!1):(this.queue.push(e),this.need_more_data=!1,this.data_is_over=!1,this.lasttime=e.utctime)},JpegPlayerModel.prototype.getData=function(e){var t={},o=this.queue.pop();if(void 0!==o)try{t.url=o.url,t.width=o.width,t.height=o.height,t.time=o.time,t.utctime=o.utctime}catch(e){t.url=void 0}else t.url=void 0;this.queue.size()<this.quelimit/4&&null!=this.callback_lowdata&&void 0!==this.callback_lowdata&&(this.need_more_data||(this.callback_lowdata(this.lasttime),this.need_more_data=!0)),t.utctime&&null!=this.callback_time&&void 0!==this.callback_time&&this.callback_time(t.utctime),t.data_is_over=this.data_is_over,e(t)};var JpegPlayerView=function(e,t){this.element=e,this.controller=t,this.renderPeriod=1e3,this.startImageUpdateTime=-1,this.updateTO=null,this.isRunning=!1,this.lastHeight=void 0,this.lastWidth=void 0,this.lastRenderTime=-1,this.currentImage=null};JpegPlayerView.prototype.getCurrentImage=function(){return this.currentImage},JpegPlayerView.prototype.needToUpdateData=function(){let e=this;var t;e.isRunning&&(0<e.startImageUpdateTime?(t=(new Date).getTime()-e.startImageUpdateTime)>e.renderPeriod?(console.warn("Slowly imageload (more than "+e.renderPeriod+"ms): render speed is down "),e.updateTO=setTimeout(function(){e.controller.clModel.getData(e.controller.updateDataCB.bind(e.controller))},0)):(t=e.renderPeriod-t,e.updateTO=setTimeout(function(){e.controller.clModel.getData(e.controller.updateDataCB.bind(e.controller))},t)):(console.warn("No image, try again"),e.updateTO=setTimeout(function(){e.controller.clModel.getData(e.controller.updateDataCB.bind(e.controller))},e.renderPeriod)))},JpegPlayerView.prototype.initDraw=function(e,t,o){this.element.innerHTML='<div class= "JpegPlayerContainer" style="width:100%;height:100%;">\t<div class="JpegPlayerImages" style="position:relative;z-index:-1;width: 100%;height:100%;">\t\t<iframe class="JpegPlayerResizeCatcher" style="position:relative;z-index:-10; width:100%; height:100%; border:none;"></iframe>\t\t<img class="JpegPlayerImg0" style="position: absolute; display:none;"></img>\t\t<img class="JpegPlayerImg1" style="position: absolute;"></img>\t</div></div>',this.container=this.element.getElementsByClassName("JpegPlayerContainer")[0],this.images=this.element.getElementsByClassName("JpegPlayerImages")[0],this.inv_img=this.element.getElementsByClassName("JpegPlayerImg0")[0],this.vis_img=this.element.getElementsByClassName("JpegPlayerImg1")[0],this.resizeCatcher=this.element.getElementsByClassName("JpegPlayerResizeCatcher")[0].contentWindow,this.curimg=0;let n=this;this.resizeCatcher.addEventListener("resize",function(e){var t=n.lastWidth||void 0,o=n.lastHeight||void 0;n.fitToContainer(t,o)}),this.inv_img.addEventListener("load",function(){n.currentImage=n.inv_img.src,n.vis_img.src=n.inv_img.src,n.vis_img.style.display="",n.needToUpdateData()})},JpegPlayerView.prototype.fitToContainer=function(e,t){var o;void 0===e&&void 0===t||(o=this.images.clientHeight,(e=e/t)<(t=this.images.clientWidth)/o?(this.inv_img.style.height="100%",this.vis_img.style.height="100%",this.inv_img.style.width=o*e+"px",this.vis_img.style.width=o*e+"px",this.inv_img.style.right=(t-o*e)/2+"px",this.vis_img.style.right=(t-o*e)/2+"px",this.inv_img.style.top=0,this.vis_img.style.top=0):(this.inv_img.style.width="100%",this.vis_img.style.width="100%",this.inv_img.style.height=t/e+"px",this.vis_img.style.height=t/e+"px",this.inv_img.style.top=(o-t/e)/2+"px",this.vis_img.style.top=(o-t/e)/2+"px",this.inv_img.style.right=0,this.vis_img.style.right=0))},JpegPlayerView.prototype.render=function(e){var t=this;t.updateTO&&(clearTimeout(t.updateTO),t.updateTO=null),void 0!==e.url?(t.startImageUpdateTime=(new Date).getTime(),t.lastRenderTime=e.utctime,t.inv_img.src=e.url):(t.startImageUpdateTime=-1,""===t.vis_img.src&&(t.vis_img.style.display="none"),e.data_is_over?console.warn("[jpegplayer] data is over"):t.needToUpdateData());var o=e.width||t.lastWidth||void 0,e=e.height||t.lastHeight||void 0;t.lastHeight=e,t.lastWidth=o,t.fitToContainer(o,e)},JpegPlayerView.prototype.start=function(){this.updateTO&&(clearTimeout(this.updateTO),this.updateTO=null),this.lastRenderTime=-1,this.isRunning=!0},JpegPlayerView.prototype.stop=function(){this.updateTO&&(clearTimeout(this.updateTO),this.updateTO=null),this.lastRenderTime=-1,this.isRunning=!1};var JpegPlayerController=function(e,t){void 0!==e&&(this.clModel=new JpegPlayerModel(t||100),this.clView=new JpegPlayerView(e,this),this.clView.element.run=this.run.bind(this),this.clView.element.stop=this.stop.bind(this),this.clView.element.getShot=this.getShot.bind(this),this.clView.element.pushImageInfo=this.pushImageInfo.bind(this),this.clView.element.setLowDataCB=this.setLowDataCB.bind(this),this.clView.element.setTimeCB=this.setTimeCB.bind(this),this.clView.initDraw(this))};JpegPlayerController.prototype.pushImageInfo=function(e){this.clModel.pushImageInfo(e)},JpegPlayerController.prototype.setLowDataCB=function(e){this.clModel.callback_lowdata=e.bind()},JpegPlayerController.prototype.setTimeCB=function(e){this.clModel.callback_time=e.bind()},JpegPlayerController.prototype.getShot=function(){return this.clView.getCurrentImage()},JpegPlayerController.prototype.run=function(e,t){var o=this;o.clView.isRunning||(o.clView.renderPeriod=e||1e3,o.clView.start(),o.clModel.lasttime=t||void 0,o.clModel.getData(o.updateDataCB.bind(o)))},JpegPlayerController.prototype.stop=function(){this.clView.stop(),this.clModel.stop(),console.log("stop")},JpegPlayerController.prototype.updateDataCB=function(e){this.clView.render(e)},window.CloudPlayerJpegLive=function(e,t,o){var n=e,r=this,a=null,l="[JpegLive]",i=t,s=o,c=1e3,u=null,d=0,m=0,p=0,f=-1;r.getcurrtime=function(){return d},r.updateList=function(e){d+=1e3,void 0!==s&&void 0!==i&&i.cameraPreview(s.getID()).done(function(e){e.url&&((o={}).url=e.url,o.width=e.width,o.height=e.height,o.time=e.time,o.utctime=CloudHelpers.parseUTCTime(o.time),o.url.indexOf("X-Amz-Algorithm")<0&&(0<String(o.url).indexOf("?")?o.url=o.url+"&"+o.utctime:o.url=o.url+"?"+o.utctime),n.pushImageInfo(o));var t=o.utctime,o=(new Date).getTime();(0<=m&&m!=t||0<f&&f<o-p)&&(p=o,i.cameraUpdatePreview(s.getID()).done(function(e){m=t}).fail(function(e){console.error(l,e),m=0}),m=-1)}).fail(function(e){console.error(l,e)})},r.play=function(e,t,o){void(d=m=0)!==o&&(c=o),void 0!==e&&(i=e),void 0!==t&&(s=t),void 0!==a&&null!=a||(a=new JpegPlayerController(n),n.setLowDataCB(r.updateList)),n.run(c)},r.pause=function(){m="",n.stop()},r.stop=function(){d=m=0,clearTimeout(u),u=null,a&&n.stop(),0<n.children.length&&n.removeChild(n.children[0]),a=null},r.reset=function(){console.warn(l,"reset"),r.stop()},r.setForcedUpdatePeriod=function(e){f=e||-1},n.addEventListener("abort",function(){console.warn(l,"abort")},!0),n.addEventListener("canplay",function(){console.warn(l,"canplay")},!0),n.addEventListener("canplaythrough",function(){console.warn(l,"canplaythrough")},!0),n.addEventListener("durationchange",function(){console.warn(l,"durationchange")},!0),n.addEventListener("emptied",function(){console.warn(l,"emptied")},!0),n.addEventListener("encrypted",function(){console.warn(l,"encrypted")},!0),n.addEventListener("ended",function(){console.warn(l,"ended")},!0),n.addEventListener("error",function(e,t){console.error(l,"error ",e),console.error(l,"error ",t)},!0),n.addEventListener("interruptbegin",function(){console.warn(l,"interruptbegin")},!0),n.addEventListener("interruptend",function(){console.warn(l,"interruptend")},!0),n.addEventListener("loadeddata",function(){console.warn(l,"loadeddata"),n.play()},!0),n.addEventListener("loadedmetadata",function(){console.warn(l,"loadedmetadata")},!0),n.addEventListener("loadstart",function(){console.warn(l,"loadstart")},!0),n.addEventListener("mozaudioavailable",function(){console.warn(l,"mozaudioavailable")},!0),n.addEventListener("pause",function(){console.warn(l,"pause")},!0),n.addEventListener("play",function(){console.warn(l,"play")},!0),n.addEventListener("playing",function(){console.warn(l,"playing")},!0),n.addEventListener("progress",function(){console.warn(l,"progress")},!0),n.addEventListener("ratechange",function(){console.warn(l,"ratechange")},!0),n.addEventListener("seeked",function(){console.warn(l,"seeked")},!0),n.addEventListener("seeking",function(){console.warn(l,"seeking")},!0),n.addEventListener("stalled",function(){console.warn(l,"stalled")},!0),n.addEventListener("suspend",function(){console.warn(l,"suspend")},!0),n.addEventListener("timeupdate",function(){console.warn(l,"timeupdate")},!0),n.addEventListener("volumechange",function(){console.warn(l,"volumechange")},!0),n.addEventListener("waiting",function(){console.warn(l,"waiting")},!0)},window.CloudPlayerJpegTimelapse=function(e,o){var n=e,r=this,a=void 0,l=o,i=1e3,s=-1,c="-time",t=null;function u(e){s=e,t&&t(e)}function d(e){var t="";t=(void 0===e&&(e=(new Date).getTime()),CloudHelpers.formatUTCTime(e));e={};e.order_by=c,e.limit=75,"-time"===c?e.end=t:e.start=t,e.origin="recording_thumbnail",l&&l.cameraImages(e).done(function(e){if(console.log("done"),n)if(0<e.objects.length)for(var t=0;t<e.objects.length;t++){var o=e.objects[t];o.utctime=CloudHelpers.parseUTCTime(o.time),n.pushImageInfo(o)}else n.pushImageInfo(null)}).fail(function(e){console.log("err")})}function m(){s=-1,dirrection="-time"}r.getcurrtime=function(){return s},r.play=function(e=1e3,t){i=e,m(),void 0!==o&&(l=o),void 0!==a&&null!=a||(a=new JpegPlayerController(n),n.setLowDataCB(d),n.setTimeCB(u)),r.rewind(t)},r.setApi=function(e){l=e},r.pause=function(){n.stop()},r.rewind=function(e){var t;l&&void 0!==l&&(c="-time",(t=void 0)!==e?t=e:0<s&&(t=s),n.stop(),n.run(i,t))},r.fastforward=function(e){var t;l&&void 0!==l&&(c="time",(t=void 0)!==e?t=e:0<s&&(t=s),n.stop(),n.run(i,t))},r.stop=function(){m(),a&&n.stop(),0<n.children.length&&n.removeChild(n.children[0]),a=null},r.reset=function(){console.warn("[JpegTimelapse]","reset"),r.stop()},r.setTimeUpdateCallback=function(e){t=e}},window.CloudCameraTimelineMode={},CloudCameraTimelineMode.MINUTES_MODE={name:"MINUTES_MODE",code:0},CloudCameraTimelineMode.HOUR_MODE={name:"HOUR_MODE",code:1},CloudCameraTimelineMode.HOURS_12_MODE={name:"HOURS_12_MODE",code:2},window.CloudCameraTimelineView=function(e,t,o){var C=this;t=C.options=t||{};var p=null,l=0,n=null,f=108e5,g={},r=0,h=!1,a=0,i=0,v=0,s=e,c=null,d=0,m=null,y=-1,_=-1,u=!1,E=0,P=0,T=!1,b=0,I=0,w=!1,A=null,R=null,S=null,k=CloudHelpers.createCallbacks(),L=null,O=null,M=null,N=null;function x(e){if(null==e||"object"!=typeof e)return e;var t,o=e.constructor();for(t in e)e.hasOwnProperty(t)&&(o[t]=e[t]);return o}t.useTimezone&&(A=t.useTimezone,console.warn("[CloudTimeline] useTimezone: "+A)),void 0!==t.calendar&&(w=1==t.calendar),void 0!==t.polingRangeDataEveryInSec&&(R=parseInt(t.polingRangeDataEveryInSec));var D={HOURS_12_MODE:{len_ms:324e5,step_short:18e5,step_long:9e6},HOUR_MODE:{len_ms:54e5,step_short:3e5,step_long:18e5},MINUTES_MODE:{len_ms:9e5,step_short:6e4,step_long:3e5}},U=1086e4,H=x(D.MINUTES_MODE),j=document.createElement("div");j.classList.add("cloudcameratimeline"),j.classList.add("green"),j.classList.add("black"),M=o&&o.player?(L=o.player.getElementsByClassName("cloudplayer-timeline-container")[0],O=o.player.getElementsByClassName("cloudplayer-calendar-container")[0],o.player.getElementsByClassName("cloudplayer-live-container")[0]):(L=document.getElementsByClassName("cloudplayer-timeline-container")[0],O=document.getElementsByClassName("cloudplayer-calendar-container")[0],document.getElementsByClassName("cloudplayer-live-container")[0]),C.left_border=Math.floor(CloudHelpers.getCurrentTimeUTC()-H.len_ms/2),C.right_border=Math.floor(C.left_border+H.len_ms);var B=j.getElementsByClassName("cloudcameratimeline-content")[0],z=j.getElementsByClassName("cloudcameratimeline-data")[0],F=j.getElementsByClassName("cloudcameratimeline-calendar")[0],q=j.getElementsByClassName("cloudcameratimeline-cursor")[0],W=j.getElementsByClassName("cloudcameratimeline-scale")[0],V=j.getElementsByClassName("cloudcameratimeline-goto-live")[0],G=j.getElementsByClassName("cloudcameratimeline-left")[0],$=j.getElementsByClassName("cloudcameratimeline-right")[0],J=j.getElementsByClassName("shift-minus")[0],Z=j.getElementsByClassName("shift-plus")[0];if(O.appendChild(F),M.appendChild(V),C.elem=document.getElementById(e),N=null!=C.elem&&"DIV"===C.elem.tagName?(C.elem.appendChild(j),C.elem):(L.appendChild(j),L),C.elem=document.getElementById(e),null==C.elem)return console.error("[CloudCameraTimeline] Not found element"),null;if("DIV"!=C.elem.tagName)return console.error("[CloudCameraTimeline] Expected DIV tag but got "+C.elem.tagName),null;C.elem.classList.add("cloudcameratimeline"),C.elem.classList.add("green"),C.elem.classList.add("black");L=document.getElementsByClassName("cloudplayer-timeline-container")[0],O=document.getElementsByClassName("cloudplayer-calendar-container")[0],M=document.getElementsByClassName("cloudplayer-live-container")[0];L.appendChild(C.elem),C.elem.innerHTML='<div class="cloudcameratimeline-calendar" style="display: none"></div><div class="cloudcameratimeline-shift shift-minus">-1h</div><div class="cloudcameratimeline-left"></div><div class="cloudcameratimeline-content">\t\t<div class="cloudcameratimeline-scale"></div>\t\t<div class="cloudcameratimeline-data"></div>\t\t<div class="cloudcameratimeline-cursor"></div></div></div><div class="cloudcameratimeline-right"></div><div class="cloudcameratimeline-shift shift-plus">+1h</div><div class="cloudcameratimeline-goto-live disabled">Live</div>',C.left_border=Math.floor(CloudHelpers.getCurrentTimeUTC()-H.len_ms/2),C.right_border=Math.floor(C.left_border+H.len_ms);B=C.elem.getElementsByClassName("cloudcameratimeline-content")[0],z=C.elem.getElementsByClassName("cloudcameratimeline-data")[0],F=C.elem.getElementsByClassName("cloudcameratimeline-calendar")[0],q=C.elem.getElementsByClassName("cloudcameratimeline-cursor")[0],W=C.elem.getElementsByClassName("cloudcameratimeline-scale")[0],V=C.elem.getElementsByClassName("cloudcameratimeline-goto-live")[0],G=C.elem.getElementsByClassName("cloudcameratimeline-left")[0],$=C.elem.getElementsByClassName("cloudcameratimeline-right")[0],J=C.elem.getElementsByClassName("shift-minus")[0],Z=C.elem.getElementsByClassName("shift-plus")[0];O.appendChild(F),M.appendChild(V);var X=null;function Y(){var e=m.getPosition();0!=(e=0==e?CloudHelpers.getCurrentTimeUTC():e)?(m.stop("by_timeline_2"),m.setPosition(e-36e5),m.play()):console.log("Invalid current position")}function K(){var e;1!=m.isLive()&&(0!=(e=0==(e=m.getPosition())?CloudHelpers.getCurrentTimeUTC():e)?(m.stop("by_timeline_2"),m.setPosition(e+36e5),m.play()):console.log("Invalid current position "))}function Q(){a!=W.offsetWidth&&0!=W.offsetWidth&&(a=W.offsetWidth),i=a/(C.right_border-C.left_border),v=(C.right_border-C.left_border)/a}function ee(e){return e-=e%1e3,e-=e%f}function te(){clearInterval(C._polingCursor),V.classList.remove("now"),V.classList.add("disabled")}function oe(){var e,t;null!=p&&"camera"==p.type&&(e=p.getID(),t=CloudHelpers.formatUTCTime(d),null!=n._getAPI()&&n._getAPI().storageRecordsFirst(e,t,50).done(function(e){for(var t=!1,o=0;o<e.objects.length;o++){var n=e.objects[o],r=CloudHelpers.parseUTCTime(n.start),a=CloudHelpers.parseUTCTime(n.end),l=ee(r);ee(a);g[l]||(g[l]={status:1,data:[]});for(var i,s=0,c=0,u=0;u<g[l].data.length;u++)(i=g[l].data[u]).end>c&&(c=i.end),i.start<r&&r-2e3<i.end&&(a>i.end?(g[l].data[u].end=a,s=1,C._eventRedrawTimeline(),t=!0):s=2);0==s&&c<a&&(g[l].data.push(i={start:r,end:a}),C._eventRedrawTimeline(),t=!0),d<a&&(d=a+CloudHelpers.ONE_SECOND)}t&&(k.executeCallbacks(CloudPlayerEvent.TIMELINE_END_UPDATED,{}),null!=m&&setTimeout(m.onTimelineEndUpdate,1))}))}function ne(){clearInterval(c),c=null}function re(){clearInterval(c),d=CloudHelpers.getCurrentTimeUTC()-CloudHelpers.ONE_MINUTE,c=setInterval(oe,3e4)}function ae(e){return Math.floor((e-C.left_border)*i)}function le(e){var t;e=e||{},null!=m&&null!=m.getSource()?m.isLive()?(V.classList.remove("disabled"),V.classList.add("now")):(V.classList.remove("disabled"),V.classList.remove("now")):(V.classList.remove("now"),V.classList.add("disabled")),r<C.left_border-1e3||r>C.right_border+1e3?"none"!=q.style.display&&(q.style.display="none"):("inline-block"!=q.style.display&&(q.style.display="inline-block"),0!=r?-5<(t=ae(r))&&t<a?(q.style.left=t+b+-10+"px",100*(a-t)/a<3&&("poling"!=e.sender&&"click"!=e.sender||C.isRange()||u||T||(console.log("[TIMELINE] Auto move if not user drag"),setTimeout(function(){console.log("[TIMELINE] mCursorPosition: "+r),C.moveToPosition(r)},100)))):"none"!=q.style.display&&(q.style.display="none"):"none"!=q.style.display&&(q.style.display="none"))}function ie(){(new Date).getTime();var e=ee(C.left_border),t=ee(C.right_border)+f;if(t<e)console.error("[ERROR] start must be more than end");else{if(C.isRange()){if(e<mRangeMin_Normalize)return void console.error("[ERROR] Going beyond the range (start)");if(t>mRangeMax_Normalize)return void console.error("[ERROR] Going beyond the range (end)")}for(var o=z.getElementsByTagName("crect"),n=0,r=e;r<=t;r+=f){var a=g[r];if(a&&1==a.status)for(var l,i,s=0;s<a.data.length;s++)a.data[s].end<C.left_border||a.data[s].start>C.right_border||(l=(i=ae(a.data[s].start))+"px",i=ae(a.data[s].end)-i+"px",n<o.length?(o[n].style.display="",o[n].style.left=l,o[n].style.width=i):z.innerHTML+='<crect style="left: '+l+"; width: "+i+'"></crect>',n++)}for(r=n;r<o.length;r++)"none"!=o[r].style.display&&(o[r].style.display="none")}}function se(e,t){var o=ee(e),n=ee(t)+f;if(n<o)console.error("[ERROR] start must be more than end");else{if(C.isRange()){if(e<mRangeMin_Normalize)return void console.error("[ERROR] Going beyond the range (left)");if(n>mRangeMax_Normalize)return void console.error("[ERROR] Going beyond the range (right)")}if(null!=p)for(var r=o;r<=n;r+=f){var a=g[r];(!a||a&&-1==a.status)&&function(t){var e=CloudHelpers.promise(),o=g[t];o&&1==o.status?e.resolve():null!=p?(g[t]={},g[t].status=0,g[t].data=[],p.getTimeline(t,t+f).done(function(e){g[t]&&(g[t].status=1,g[t].data=e.periods),ie()}).fail(function(){g[t]&&(g[t].status=-1),e.reject()})):e.reject()}(r)}}}function ce(t){p.getTimeline(t,t+f).done(function(e){!function(e,t){if(0!=e.length||0!=t.length){for(var o=0;o<e.length;o++){for(var n=e[o],r=!1,a=0;a<t.length;a++){var l=t[a];n.start==l.start&&n.end==l.end&&(r=!0)}if(!r)return 1}for(a=0;a<t.length;a++){for(l=t[a],r=!1,o=0;o<e.length;o++)(n=e[o]).start==l.start&&n.end==l.end&&(r=!0);if(!r)return 1}}}(g[t].data,e.periods)||(g[t].data=e.periods,ie())})}function ue(){console.log("_reloadRangeData");var e=ee(y),t=ee(_)+f;if(null!=p)for(var o=e;o<=t;o+=f){var n=g[o];n&&1==n.status&&ce(o)}}function de(){console.log("_stopPolingRangeData"),clearInterval(S)}function me(){console.warn("_disposeTimeline"),d=0,g={},z.innerHTML="",te(),ne(),de(),null!=X&&X.dispose()}function pe(){console.warn("_changedSource"),me(),null!=m?(p=m.getSource())?(l=A?CloudHelpers.getOffsetTimezone(A):CloudHelpers.getOffsetTimezone(p.getTimezone()),n=p._getConn(),null!=X&&X.setSource(p),te(),C._polingCursor=setInterval(function(){null!=m?0!=m.getPosition()&&(r=m.getPosition()):r=0,le({sender:"poling"})},1e3),re(),de(),null!=R&&C.isRange()&&(S=setInterval(function(){null!=p&&ue()},1e3*R))):(p=n=null,l=0):p=null,C.redrawTimeline({sender:"changed_source"})}function fe(e,t){console.warn("_playerEvent ",e),"SOURCE_CHANGED"==e.name?pe():"POSITION_JUMPED"==e.name?(console.warn("POSITION_JUMPED",m),r=t.new_pos,le({sender:"pos jumped"}),C.moveToPosition(t.new_pos)):"STOPED"==e.name?ne():"PLAYED"==e.name&&(console.log("Timeline catch event: Player played "+t),c||re())}function ge(){b=0,"none"!=G.style.display&&(b+=80),I=0,"none"!=$.style.display&&(I+=80),0==b&&(b=80),0==I&&(I=80),B.style.width="calc(100% - "+(b+I)+"px)",B.style.left=b+"px",z.style.width="calc(100% - "+(b+I)+"px)",z.style.left=b+"px",W.style.width="calc(100% - "+(b+I)+"px)",W.style.left=b+"px"}F.onclick=function(){null!=X&&(console.log(m),m.player.classList.remove("showing-settings","showing-zoom"),X.toggleCalendar(F))},Z.onclick=K,$.onclick=K,J.onclick=Y,G.onclick=Y,V.onclick=function(e){var t;null!=m&&null!=m.getSource()&&(0==(t=V.classList).contains("now")&&0==t.contains("disabled")&&(m.setPosition(CloudPlayer.POSITION_LIVE),m.play(e),C.moveToPosition(CloudHelpers.getCurrentTimeUTC())),0!=t.contains("now")&&C.moveToPosition(CloudHelpers.getCurrentTimeUTC()))},Q(),C.removeCallback=function(e){k.removeCallback(e)},C.addCallback=function(e,t){k.addCallback(e,t)},C.reloadRangeData=function(){ue()},C.hideCalendarButton=function(){"none"!=F.style.display&&(F.style.display="none"),ge(),C.redrawTimeline()},C.showCalendarButton=function(){"none"==F.style.display&&(F.style.display=""),ge(),C.redrawTimeline()},C.hideArrowsButtons=function(){"none"!=G.style.display&&(G.style.display="none"),"none"!=$.style.display&&($.style.display="none"),ge(),C.redrawTimeline()},C.showArrowsButtons=function(){"none"==G.style.display&&(G.style.display=""),"none"==$.style.display&&($.style.display=""),ge(),C.redrawTimeline()},C.hideShiftButtons=function(){"none"!=J.style.display&&(J.style.display="none"),"none"!=Z.style.display&&(Z.style.display="none"),ge(),C.redrawTimeline()},C.showShiftButtons=function(){"none"==J.style.display&&(J.style.display=""),"none"==Z.style.display&&(Z.style.display=""),ge(),C.redrawTimeline()},C.hideGotoLiveButton=function(){"none"!=V.style.display&&(V.style.display="none"),ge(),C.redrawTimeline()},C.showGotoLiveButton=function(){"none"==V.style.display&&(V.style.display=""),ge(),C.redrawTimeline()},C.setPlayer=function(e){me(),m&&m.removeCallback(s),e?(null!=(m=e)?w&&((X=new CloudCameraCalendarView(m.getCalendarContent(),t)).onChangeDate=function(e,t){null!=m?(m.setPosition(e-l),C.moveToPosition(e-l),m.play(t)):console.error("[TIMELINE] player is null")},C.calendar=X):console.error("[TIMELINE] player is null"),pe(),m.addCallback(s,fe),m.setFullscreenCallback(function(){console.warn("fullscreenCallback"),C.redrawTimeline()})):(m=null,pe())},C.setRange=function(e,t){console.warn("[TIMELINE] setRange todo"),mRangeMin_Normalize=ee(y=e),mRangeMax_Normalize=ee(_=t)+f,N.classList.add("range"),Q();var o=_-y,e=y,t=_;o<=U?(C.hideArrowsButtons(),C.hideShiftButtons(),H.len_ms=o):(t=y+U,H.len_ms=U,(o=CloudHelpers.getCurrentTimeUTC())<_&&y<o&&t<o&&(t=o+Math.floor(U/2),e=(t=_<t?_:t)-U)),C.left_border=Math.floor(e),C.right_border=Math.floor(t),C.redrawTimeline({sender:"animation"})},C.isRange=function(){return-1!=y&&-1!=_},C.resetRange=function(){console.warn("[TIMELINE] resetRange"),_=y=-1,N.classList.remove("range"),C.showArrowsButtons(),C.showShiftButtons(),Q()},C.months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Spt","Oct","Nov","Dec"],C.dateFormat=function(e,t,o){var n,r,a="";return C.isRange()?(r=(e=((e=Math.floor((e-y)/1e3))-e%60)/60)%60,a=("00"+(e-r)/60).slice(-2)+":"+("00"+r).slice(-2)):((n=new Date).setTime(e+l),r=n.getUTCHours(),e="",o&&(e=12<=r?" pm":" am",r=0==r?12:12<r?r-12:r),a=("00"+r).slice(-2)+":"+("00"+n.getUTCMinutes()).slice(-2),a+=e,t&&(a+=" ("+n.getUTCDate()+" "+C.months[n.getUTCMonth()]+")")),a},C._eventRedrawTimeline=function(){setTimeout(C.redrawTimeline,10)},C.redrawTimeline=function(e){if(e=e||{},h)console.warn("redrawTimeline busy");else{h=!0,Q();var t=Math.floor(C.left_border/H.step_short),o=Math.floor(C.right_border/H.step_short)+1;C.isRange()&&(C.left_border<=y?G.classList.add("disabled"):G.classList.remove("disabled"),C.right_border>=_?$.classList.add("disabled"):$.classList.remove("disabled")),W.innerHTML='<vtext id="texttimelinetest"><vtext>';var n=document.getElementById("texttimelinetest");if(n){n.innerHTML=C.dateFormat(C.left_border,!1,!0===C.options.timelineampm);var r=n.clientWidth;n.innerHTML=C.dateFormat(C.left_border,!0,!0===C.options.timelineampm);for(var a=n.clientWidth,l=H.step_long;l<r*v;)l+=H.step_long;var i=2*l;W.innerHTML+="<hline></hline>";for(var s=t;s<o;s++){var c,u,d=s*H.step_short,m=ae(d);d%H.step_long==0?(u=m-((c=d%i==0)?a:r)/2,W.innerHTML+='<vline style="left: '+m+'px"></vline>',d%l==0&&(W.innerHTML+='<vtext style="left: '+u+'px">'+C.dateFormat(d,c,!0===C.options.timelineampm)+"</vtext>")):W.innerHTML+='<vline style="left: '+m+'px"></vline>'}if(le(e),null!=p)if(function(e,t){var e=ee(e),o=ee(t)+f;if(!(o<e)){for(var n=!0,r=e;r<=o;r+=f)(!g[r]||1!=g[r].status)&&(n=!1);return n}console.error("[ERROR] start must be more than end")}(C.left_border,C.right_border))ie();else{if(C.isRange()&&(C.left_border<mRangeMin_Normalize||C.right_border>mRangeMax_Normalize))return void(h=!1);se(C.left_border,C.right_border)}h=!1}}},C.redrawTimeline(),C.onTimeLineResize=function(){C.redrawTimeline()},window.addEventListener("resize",C.onTimeLineResize),C.animationTo=function(t,o,n){T=!0,n=n||H;var r=25,e=t-C.left_border,a=o-C.right_border;if(0==e&&0==a)return console.warn("Already in current position"),C.redrawTimeline({sender:"animation"}),void(T=!1);for(var l=n.step_short-H.step_short,i=n.step_long-H.step_long,s=0!=l&&0!=i,c=(C.left_border,C.right_border,[]),u=3.14/r,d=0,m=0;m<r;m++)d+=v=Math.sin(m*u),c.push({k:v});var p=e/d,f=a/d,g=l/d,h=i/d,i=c[0].k;c[0].left=C.left_border+i*p,c[0].right=C.right_border+i*f,s&&(c[0].step_short=H.step_short+i*g,c[0].step_long=H.step_long+i*h);for(m=1;m<r;m++){var v=c[m].k;c[m].left=c[m-1].left+v*p,c[m].right=c[m-1].right+v*f,s&&(c[m].step_short=c[m-1].step_short+v*g,c[m].step_long=c[m-1].step_short+v*h)}c[r-1].left=t,c[r-1].right=o;var y=0;setTimeout(function e(){C.left_border=Math.floor(c[y].left),C.right_border=Math.floor(c[y].right),s&&(H.step_short=Math.floor(c[y].step_short),H.step_long=Math.floor(c[y].step_long)),C.redrawTimeline({sender:"animation"}),++y<r?setTimeout(e,10):(s&&(H=x(n)),C.left_border=t,C.right_border=o,C.redrawTimeline({sender:"animation"}),T=!1)},15)},C.fixBorderLimit=function(e,t){var o={};return o.left=e,o.right=t,C.isRange()?(o.right>_&&(o.right=_,o.left=o.right-H.len_ms),o.left<y&&(o.left=y,o.right=o.left+H.len_ms)):(t=CloudHelpers.getCurrentTimeUTC()+H.len_ms/2,o.right>t&&(t=o.right-t,o.left=o.left-t,o.right=o.right-t)),o},C.moveToRight=function(){var e=C.right_border-C.left_border,e=Math.floor(.75*e),t=C.left_border+e,e=C.right_border+e,e=C.fixBorderLimit(t,e);C.animationTo(e.left,e.right)},$.onclick=C.moveToRight,C.moveToLeft=function(){var e=C.right_border-C.left_border,e=Math.floor(.75*e),t=C.left_border-e,e=C.right_border-e,e=C.fixBorderLimit(t,e);C.animationTo(e.left,e.right)},G.onclick=C.moveToLeft,C.moveToPosition=function(e){console.log("moveToPosition");var t=Math.floor((C.right_border-C.left_border)/2),o=e-t,t=e+t;C.isRange()&&(o<y||_<t)?console.error("Can not move beyond range"):C.animationTo(o,t)},C.mousedown=function(e){if(!u){E=e.offsetX,P=e.offsetX,u=!0,B.style.cursor="move";try{window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty()}catch(e){console.error(e)}}},C.mousemove=function(e){var t;u&&!C.isRange()&&(t=e.offsetX-P,0!=(t=void 0!==e.movementX?e.movementX:t)&&(e=Math.floor(t*v),P+=t,e=C.fixBorderLimit(C.left_border-e,C.right_border-e),C.left_border=e.left,C.right_border=e.right,C.redrawTimeline({sender:"mousemove"})))},C.mouseup=function(e){u&&(B.style.cursor="default",u=!1)},C.mouseout=function(e){u&&(e.relatedTarget&&"CRECT"==e.relatedTarget.nodeName||e.target&&"CRECT"==e.target.nodeName||e.relatedTarget&&"cloudcameratimeline-cursor"==e.relatedTarget.className||e.target&&"cloudcameratimeline-cursor"==e.target.className||(B.style.cursor="default",u=!1))},B.addEventListener("mousedown",C.mousedown),B.addEventListener("mousemove",C.mousemove),B.addEventListener("mouseup",C.mouseup),B.addEventListener("mouseout",C.mouseout),z.onclick=function(e){var t;null!=m?null!=p?E==P&&(t=e.currentTarget.getBoundingClientRect(),t=e.clientX-t.left,t=Math.floor(t*v),(t+=C.left_border)>=CloudHelpers.getCurrentTimeUTC()&&m?(r=CloudHelpers.getCurrentTimeUTC(),le({sender:"click"}),m.stop("by_timeline_1"),m.setPosition(CloudPlayer.POSITION_LIVE),m.play(),k.executeCallbacks(CloudPlayerEvent.USER_CLICKED_ON_TIMELINE,{pos:CloudPlayer.POSITION_LIVE})):t&&m?(r=t,le({sender:"click"}),m.stop("by_timeline_2"),m.setPosition(t),m.play(),k.executeCallbacks(CloudPlayerEvent.USER_CLICKED_ON_TIMELINE,{pos:t})):le({sender:"click"})):console.log("[CloudCameraTimeline] source is null"):console.log("[CloudCameraTimeline] player is null")},C.setMode=function(e){var t=null;if(!D[e.name])return console.error("Unknown timeline mode"),-1;var t=D[e.name],o=(C.right_border-C.left_border)/2+C.left_border,e=x(t),t=t.len_ms/2;return C.animationTo(o-t,o+t,e),0},C.getMode=function(){return H},C.destroy=function(){if(window.removeEventListener("resize",C.onTimeLineResize),C.elem&&"DIV"===C.elem.tagName)for(;C.elem.firstChild;)C.elem.removeChild(C.elem.firstChild);clearInterval(c)},void 0!==t.arrows&&(1==t.arrows?C.showArrowsButtons():C.hideArrowsButtons()),void 0!==t.gotoLive&&(1==t.gotoLive?C.showGotoLiveButton():C.hideGotoLiveButton()),void 0!==t.range&&(O=t.range.min,M=t.range.max,C.setRange(O,M)),w?C.showCalendarButton():C.hideCalendarButton(),console.log("options: ",t)},window.CloudCameraCalendarView=function(e,t){var n=e;var r=this,o=null,v={},a=null,l=[],i=null,s=(new Date).getMonth(),c=(new Date).getFullYear(),u=100*c+s,d=100*c+s;function m(e,t){return["January","February","March","April","May","June","July","August","September","October","November","December"][t%12]+" "+e}function y(e,t,o){return e+"-"+("00"+(t+1)).slice(-2)+"-"+("00"+o).slice(-2)}function p(e,t){var o=new Date;o.setFullYear(e),o.setMonth(t),o.setDate(1);for(var n=o.getDay(),r=(t-1+12)%12,a=0==t?e-1:e,l=(t+1+12)%12,i=11==t?e+1:e,o=new Date(i,l,0),s=o.getDate(),o=o.getDay(),c=["Su","Mo","Tu","We","Th","Fr","Sa"],u=[],d=(d=new Date(a,1+r,0).getDate())-n+1,m=0;m<n;m++)u.push({d:d,cl:"disabled",dt:y(i,l,d)}),d++;for(m=1;m<=s;m++)u.push({d:m,cl:"",dt:y(e,t,m)});for(var p=0,m=o+1;m<7;m++)u.push({d:++p,cl:"disabled",dt:y(i,l,p)});for(m=0;m<v.length;m++)for(var f=v[m],g=0;g<u.length;g++)u[g].dt===f&&(u[g].cl+="active-day");for(var h='<div class="cal-row week">',m=0;m<c.length;m++)h+='<div class="cal-day name">'+c[m]+"</div>";h+="</div>",h+='<div class="cal-row">';for(m=0;m<u.length;m++)m%7==0&&0<m&&(h+='</div><div class="cal-row">'),h+='<div class="cal-day '+u[m].cl+'" dt="'+u[m].dt+'">'+u[m].d+"</div>";return h+="</div>"}n.innerHTML='\t<div class="cloudcameracalendar-header">\t\t<div class="cloudcameracalendar-prev-month"></div>\t\t<div class="cloudcameracalendar-title">'+m(c,s)+"</div>\t\t<div class=\"cloudcameracalendar-next-month\"></div>\t</div>\t<div class='cloudcameracalendar-table'>"+p(c,s)+"\t</div>";n.getElementsByClassName("cloudcameracalendar-close")[0];var f=n.getElementsByClassName("cloudcameracalendar-prev-month")[0],g=n.getElementsByClassName("cloudcameracalendar-next-month")[0],h=n.getElementsByClassName("cloudcameracalendar-table")[0],C=n.getElementsByClassName("cloudcameracalendar-title")[0];r.renderContent=function(){C.innerHTML=m(c,s),h.innerHTML=p(c,s);for(var e=n.getElementsByClassName("active-day"),t=0;t<e.length;t++)e[t].onclick=function(e){var t=new Date(this.getAttribute("dt").replace(/-/g,"/"));t.setHours(8),r.onChangeDate&&r.onChangeDate(Date.parse(t),e)};var o=100*c+s;f.style.display=o<=u?"none":"",g.style.display=d<=o?"none":""},r.renderContent(),r.updateActivity=function(){if(null==o&&0==l.length)return console.log("[CALENDAR] mConn is null"),v=[],void r.renderContent();0!=l.length?new Promise((e,t)=>{v=[];for(var o=0;o<l.length;o++)cApi=l[o].conn._getAPI(),cApi.storageActivity(l[o].camID,!0).done(function(t){i=new Date;for(var e,o,n=0;n<t.objects.length;n++)v.some(e=>e==t.objects[n])||(v.push(t.objects[n]),e=t.objects[n].split("-"),o=parseInt(e[1],10)-1,o=100*parseInt(e[0],10)+o,d=0==n?u=o:(u=Math.min(o,u),Math.max(o,d)))});o==l.length&&e()}).then(()=>{r.renderContent()}):(mApi=o._getAPI(),mApi&&mApi.storageActivity(a,!0).done(function(e){i=new Date,v=e.objects;for(var t=0;t<v.length;t++){var o=v[t].split("-"),n=parseInt(o[1],10)-1,n=100*parseInt(o[0],10)+n;d=0==t?u=n:(u=Math.min(n,u),Math.max(n,d))}r.renderContent()}))},r.setSource=function(e){s=(new Date).getMonth(),c=(new Date).getFullYear(),i=null,Array.isArray(e)?(e.forEach(e=>{e=e.player.getSource();e&&(l.push({conn:e._getConn(),camID:e.getID()}),CloudHelpers.getOffsetTimezone(e.getTimezone()))}),r.updateActivity()):null!=e?(o=e._getConn(),a=e.getID(),CloudHelpers.getOffsetTimezone(e.getTimezone()),r.updateActivity()):(o=null,v=[],r.renderContent())},r.dispose=function(){o=null},f.onclick=function(){(s-=1)<0&&(s=11,c-=1),r.renderContent()},g.onclick=function(){11<(s+=1)&&(s=0,c+=1),r.renderContent()},r.isVisible=function(){return""!==n.style.display},r.showCalendar=function(){var e;console.log("[CALENDAR] show"),n.style.display="block",null!=o?null!=i?((e=new Date).setUTCHours(24),e.setUTCMinutes(0),e.setUTCSeconds(0),(new Date).getTime()>e.getTime()&&i.getTime()<e.getTime()&&r.updateActivity()):r.updateActivity():r.renderContent()},r.hideCalendar=function(){console.log("[CALENDAR] hide"),n.style.display=""},r.toggleCalendar=function(e){console.log("[CALENDAR] toggle"),r.isVisible()?(r.hideCalendar(),e.classList.remove("shadowed")):(r.showCalendar(),e.classList.add("shadowed"))}},window.CloudSessionTimeline=function(e){var y=this,m=null,t={};function C(e){if(null==e||"object"!=typeof e)return e;var t,o=e.constructor();for(t in e)e.hasOwnProperty(t)&&(o[t]=e[t]);return o}t.h12={to:"min",len_ms:324e5,step_short:18e5,step_long:9e6},t.hr={to:"h12",len_ms:54e5,step_short:3e5,step_long:18e5},t.min={to:"hr",len_ms:9e5,step_short:6e4,step_long:3e5};var _=C(t.min);if(y.elem=document.getElementById(e),null==y.elem)return console.error("[CloudPlayerTimeline] Not found element"),null;if("DIV"!=y.elem.tagName)return console.error("[CloudPlayerTimeline] Expected DIV tag but got "+y.elem.tagName),null;y.elem.classList.add("cloudplayertimeline"),y.elem.classList.add("green"),y.elem.classList.add("black"),y.elem.innerHTML='<div class="cloudplayertimeline-content">\t\t<div class="cloudplayertimeline-scale session"></div>\t\t<div class="cloudplayertimeline-data session"></div>\t\t<div class="cloudplayertimeline-cursor"></div></div>',y.left_border=CloudHelpers.getCurrentTimeUTC()-_.len_ms/2,y.right_border=y.left_border+_.len_ms,y.el_data=y.elem.getElementsByClassName("cloudplayertimeline-data")[0];var p=y.elem.getElementsByClassName("cloudplayertimeline-cursor")[0];function o(){clearInterval(y._polingCursor)}y.el_scale=y.elem.getElementsByClassName("cloudplayertimeline-scale")[0],y.setPlayer=function(e){o(),y.plr=e,y.plr&&(o(),y._polingCursor=setInterval(function(){var e=y.plr.getPosition();(e<y.left_border||e>y.right_border)&&"none"!=p.style.display&&(p.style.display="none"),"inline-block"!=p.style.display&&(p.style.display="inline-block"),0!=e&&(e=y.calcPosition(e)+50+"px",p.style.left=e)},1e3))},y.calcPosition=function(e){return Math.floor((e-y.left_border)*y.distPx)},y.months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Spt","Oct","Nov","Dec"],y.dateFormat=function(e,t){var o=new Date;o.setTime(e);e=("00"+o.getUTCHours()).slice(-2)+":"+("00"+o.getUTCMinutes()).slice(-2);return t&&(e+=" ("+o.getUTCDate()+" "+y.months[o.getUTCMonth()]+")"),e},y.redrawTimeline=function(){null!=(m=null!=y.plr?y.plr.getSource():null)&&(y.left_border=m.getStartTime(),y.right_border=m.getEndTime(),_.step_short=(y.right_border-y.left_border)/20),p.style.display="none",y.containerWidth=y.el_scale.offsetWidth,y.distPx=y.containerWidth/(y.right_border-y.left_border),y.distSec=(y.right_border-y.left_border)/y.containerWidth;var e=Math.floor(y.left_border/_.step_short),t=Math.floor(y.right_border/_.step_short)+1;y.el_data.innerHTML="",y.el_scale.innerHTML='<vtext id="texttimelinetest"><vtext>';var o=document.getElementById("texttimelinetest");o.innerHTML=y.dateFormat(y.left_border,!1);var n=o.clientWidth;o.innerHTML=y.dateFormat(y.left_border,!0);for(var r=o.clientWidth,a=_.step_long;n*y.distSec>a;)a+=_.step_long;var l=2*a;y.el_scale.innerHTML+="<hline></hline>";for(var i=e;i<t;i++){var s,c,u=i*_.step_short,d=y.calcPosition(u);u%_.step_long==0?(c=d-((s=u%l==0)?r:n)/2,y.el_scale.innerHTML+='<vline style="left: '+d+'px"></vline>',u%a==0&&(y.el_scale.innerHTML+='<vtext style="left: '+c+'px">'+y.dateFormat(u,s)+"</vtext>")):y.el_scale.innerHTML+='<vline style="left: '+d+'px"></vline>'}y.el_data.innerHTML="",null!=m&&m.getTimeline(y.left_border,y.right_border).done(function(e){var t=e.periods;y.el_data.innerHTML="";for(var o=0;o<t.length;o++){var n=y.calcPosition(t[o].start),r=y.calcPosition(t[o].end);y.el_data.innerHTML+='<crect style="left: '+n+"px; width: "+(r-n)+'px"></crect>'}}).fail(function(e){console.error(e)})},y.redrawTimeline(),window.addEventListener("resize",y.redrawTimeline),y.animationTo=function(e,t,o){for(var n=25,r=e-y.left_border,a=t-y.right_border,l=(o=o||_).step_short-_.step_short,i=o.step_long-_.step_long,s=0!=l&&0!=i,c=[],u=[],d=[],m=[],p=3.14/n,f=0,g=0;g<n;g++)f+=h=Math.sin(g*p);for(g=0;g<n;g++){var h=Math.sin(g*(3.14/n));c.push(h*(r/f)),u.push(h*(a/f)),s&&(d.push(h*(l/f)),m.push(h*(i/f)))}var v=0;setTimeout(function e(){y.left_border+=c[v],y.right_border+=u[v],s&&(_.step_short+=d[v],_.step_long+=m[v]),y.redrawTimeline(),++v<n?setTimeout(e,10):(s&&(_=C(o)),y.redrawTimeline())},15)},y.fixBorderLimit=function(e,t){var o={};o.left=e,o.right=t;t=CloudHelpers.getCurrentTimeUTC()+_.len_ms/2;return o.right>t&&(t=o.right-t,o.left=o.left-t,o.right=o.right-t),o},y._clickOnData=function(e){null!=y.plr?null!=m?(e=Math.floor(e.offsetX*y.distSec),(e+=y.left_border)&&y.plr&&(y.plr.stop("by_session_timeline_1"),y.plr.setPosition(e),y.plr.play())):console.log("[CloudCameraTimeline] source is null"):console.log("[CloudCameraTimeline] player is null")},y.el_data.onclick=y._clickOnData,y._startMove=!1,y._lastMoveX=0,y.mousedown=function(e){y._lastMoveX=e.offsetX,y._startMove=!0,y.el_data.style.cursor="move"},y.mousemove=function(e){var t;!y._startMove||0!=(t=e.offsetX-y._lastMoveX)&&(t=Math.floor(t*y.distSec),y._lastMoveX=e.offsetX,t=y.fixBorderLimit(y.left_border-t,y.right_border-t),y.left_border=t.left,y.right_border=t.right,y.redrawTimeline())},y.mouseup=function(e){y._startMove=!1,y.el_data.style.cursor="default"},y.el_data.addEventListener("mousedown",y.mousedown),y.el_data.addEventListener("mousemove",y.mousemove),y.el_data.addEventListener("mouseup",y.mouseup),y.el_data.addEventListener("mouseout",y.mouseup)},window.VXGCloudPlayerTimelineView=function(e,t,n){var o=this;t=o.options=t||{};var r=null,a=0,l=e,i=null,s=!1,c=null,u=(CloudHelpers.createCallbacks(),null),d=null,m=null,p=null,f=null,g=!1;t.useTimezone&&(c=t.useTimezone,console.warn("[CloudTimeline] useTimezone: "+c)),void 0!==t.calendar&&(s=1==t.calendar),void 0!==t.polingRangeDataEveryInSec&&parseInt(t.polingRangeDataEveryInSec);var h={HOURS_12_MODE:{len_ms:324e5,step_short:18e5,step_long:9e6},HOUR_MODE:{len_ms:54e5,step_short:3e5,step_long:18e5},MINUTES_MODE:{len_ms:9e5,step_short:6e4,step_long:3e5}},p=(function(e){if(null==e||"object"!=typeof e)return;var t,o=e.constructor();for(t in e)e.hasOwnProperty(t)&&(o[t]=e[t])}(h.MINUTES_MODE),n&&n.player?(u=n.player.getElementsByClassName("cloudplayer-timeline-container")[0],d=n.player.getElementsByClassName("cloudplayer-calendar-container")[0],m=n.player.getElementsByClassName("cloudplayer-live-container")[0],n.player.getElementsByClassName("cloudplayer-vxgcloudplayer")[0]):(u=document.getElementsByClassName("cloudplayer-timeline-container")[0],d=document.getElementsByClassName("cloudplayer-calendar-container")[0],m=document.getElementsByClassName("cloudplayer-live-container")[0],document.getElementsByClassName("cloudplayer-vxgcloudplayer")[0])),v=document.createElement("div");v.classList.add("cloudcameratimeline"),v.classList.add("green"),v.classList.add("black"),v.classList.add("row"),v.classList.add("no-gutters"),v.innerHTML='<div class="cloudcameratimeline-calendar" style="display: none"></div><div class="cloudcameratimeline-goto-live disabled">Live</div><div class="cloudcameratimeline-shift shift-minus col-1">-1h</div><div class="cloudcameratimeline-left col-1"></div><div id="'+e+'_timeline" class="ktimepicker-container" style="color:white;background:rgba(0,0,0,0);height:36px;max-width:80%!important;flex: 0 0 80%;margin-top: 8px;"></div></div><div class="cloudcameratimeline-right col-1"></div><div class="cloudcameratimeline-shift shift-plus col-1">+1h</div>';v.getElementsByClassName("cloudcameratimeline-content")[0],v.getElementsByClassName("cloudcameratimeline-data")[0];var y=v.getElementsByClassName("cloudcameratimeline-calendar")[0],C=(v.getElementsByClassName("cloudcameratimeline-cursor")[0],v.getElementsByClassName("cloudcameratimeline-scale")[0],v.getElementsByClassName("cloudcameratimeline-goto-live")[0]),_=v.getElementsByClassName("cloudcameratimeline-left")[0],E=v.getElementsByClassName("cloudcameratimeline-right")[0],P=v.getElementsByClassName("shift-minus")[0],h=v.getElementsByClassName("shift-plus")[0];d.appendChild(y),m.appendChild(C),u.appendChild(v),p.setAttribute("timelineselector","#"+e+"_timeline");var T=null,p=u.getElementsByClassName("ktimepicker-container")[0],e=new MutationObserver(function(e){for(var t of e)"childList"==t.type&&(console.log("A child node has been added or removed."),(f=u.getElementsByTagName("k-timeline-picker")[0])&&(f.addEventListener("change",function(e){var t,o;void 0!==n.mSrc&&null!=n.mSrc&&(g=!0,t=Number(f.getAttribute("centerutctime")),o=n.getPosition(),t>Date.now()?n.isLive()||(n.setPosition(CloudHelpers.POSITION_LIVE),n.play("timepicker")):o!=t&&(n.setPosition(t),n.play("timepicker")),g=!1)}),T.disconnect()))}),T=e;e.observe(p,{childList:!0});var b=null;function I(){var e=i.getPosition();0!=(e=0==e?CloudHelpers.getCurrentTimeUTC():e)?(i.stop("by_timeline_2"),i.setPosition(e-36e5),i.play()):console.log("Invalid current position")}function w(){var e;1!=i.isLive()&&(0!=(e=0==(e=i.getPosition())?CloudHelpers.getCurrentTimeUTC():e)?(i.stop("by_timeline_2"),i.setPosition(e+36e5),i.play()):console.log("Invalid current position "))}function A(){clearInterval(o._polingCursor),C.classList.remove("now"),C.classList.add("disabled"),o._polingCursor=setInterval(function(){null!=n?0!=n.getPosition()&&(a=n.getPosition()):a=0,void 0===n.mSrc||null==n.mSrc?(C.classList.remove("now"),C.classList.add("disabled")):n.isLive()?(C.classList.remove("disabled"),C.classList.add("now")):(C.classList.remove("disabled"),C.classList.remove("now")),(f=u.getElementsByTagName("k-timeline-picker")[0])&&0!=a&&!g&&n.isLive()&&n.player.getElementsByTagName("vxg-cloud-player")[0].setTimePromise(a).then(function(e){}).catch(function(e){})},1e3)}function R(e,t){console.warn("_playerEvent ",e),"SOURCE_CHANGED"==e.name?(console.warn("_changedSource"),null!=i&&(r=i.getSource())&&(c?CloudHelpers.getOffsetTimezone(c):CloudHelpers.getOffsetTimezone(r.getTimezone()),null!=b&&b.setSource(r)),null!=n&&A()):"POSITION_JUMPED"==e.name?(console.warn("POSITION_JUMPED",i),a=t.new_pos):"STOPED"==e.name?console.log("Timeline catch event: Player stoped "+t):"PLAYED"==e.name&&console.log("Timeline catch event: Player played "+t)}y.onclick=function(){null!=b&&(console.log(i),i.player.classList.remove("showing-settings","showing-zoom"),b.toggleCalendar(y))},h.onclick=w,E.onclick=w,P.onclick=I,_.onclick=I,C.onclick=function(e){var t;void 0!==n.mSrc&&null!=n.mSrc&&null!=n&&null!=n.getSource()&&(0==(t=C.classList).contains("now")&&0==t.contains("disabled")&&(n.setPosition(CloudPlayer.POSITION_LIVE),n.play()),t.contains("now"))},o.hideCalendarButton=function(){"none"!=y.style.display&&(y.style.display="none")},o.showCalendarButton=function(){"none"==y.style.display&&(y.style.display="")},o.hideGotoLiveButton=function(){"none"!=C.style.display&&(C.style.display="none")},o.showGotoLiveButton=function(){"none"==C.style.display&&(C.style.display="")},o.setPlayer=function(e){i&&i.removeCallback(l),e?(null!=(i=e)?s&&((b=new CloudCameraCalendarView(i.getCalendarContent(),t)).onChangeDate=function(e,t){null!=i?(i.setPosition(e),i.play(t)):console.error("[TIMELINE] player is null")},o.calendar=b):console.error("[TIMELINE] player is null"),i.addCallback(l,R),i.setFullscreenCallback(function(){console.warn("fullscreenCallback")})):i=null},void 0!==t.gotoLive&&(1==t.gotoLive?o.showGotoLiveButton():o.hideGotoLiveButton()),s?o.showCalendarButton():o.hideCalendarButton(),console.log("options: ",t)},window.CloudSDK=window.CloudSDK||{},CloudSDK.version="3.3.19",CloudSDK.datebuild="240226",console.log("CloudSDK.version="+CloudSDK.version+"_"+CloudSDK.datebuild),window.CloudPlayerList=function(e,t){var l=this;l.playerList=null,l.options=t||{},l.timeline=null,l.fullPlayer=null,l.killSync=!1,l.synchronize=function(o=[],e=!0){var n=[];e&&l.playerList&&l.joinedTimeline();var t=l.playerList.filter(e=>null!=e.mCameraID);if(t){var r=t.map(e=>({id:e.playerElementID,time:e.getPosition()})),e=r.map(e=>e.time);if(!(Math.max(...e)-Math.min(...e)<=1500)){var a=Math.min(...e);t.forEach(t=>{if(1500<r.find(e=>e.id==t.playerElementID).time-a){if(!o.some(e=>e.playerElementID==t.playerElementID)){if(l.killSync)return;var e=l.playerList.indexOf(t);l.playerList[e].pause()}n.push(t)}else o.some(e=>e.playerElementID==t.playerElementID)&&(l.killSync||(e=l.playerList.indexOf(t),l.playerList[e].play()))})}else{if(l.killSync)return;o.forEach(e=>{e.play()})}setTimeout(function(){if(!l.killSync)return l.synchronize(n,!1)},500)}else setTimeout(function(){if(!l.killSync)return l.synchronize([],!0)},500)},l.joinedTimeline=function(){var e;null!=l.playerList.find(e=>e.player.elid==l.fullPlayer.elid).mCameraID||(e=l.playerList.filter(e=>null!=e.mCameraID))&&(l.fullPlayer=e[0].player,l.timeline.assignNewPrimary(e[0],l.playerList)),l.timeline.setPlayer(l.fullPlayer,l.playerList),l.fullPlayer.calendar=l.timeline.calendar,l.timeline._initTimeline(l.playerList)},l.addPlayerToList=function(t){return null==l.timeline&&l.options.timeline&&(l.options.joinedTimeline=!0,l.timeline=new JoinedTimelineView(e,t,l.options),l.fullPlayer=t.player),null==l.playerList?l.playerList=[t]:l.playerList.some(e=>e.playerElementID==t.playerElementID)?null==l.playerList.find(e=>e.player.elid==l.fullPlayer.elid).mCameraID&&(l.fullPlayer=t.player,l.timeline.assignNewPrimary(t,l.playerList)):l.playerList.push(t),l.playerList},l.removePlayerFromList=function(e){var t=l.playerList.indexOf(e);-1!=t&&l.playerList.splice(t,1);t=l.playerList.filter(e=>null!=e.mCameraID);e.player.elid==l.fullPlayer.elid&&0!=t.length&&(l.fullPlayer=t[0].player,l.timeline.assignNewPrimary(t[0],l.playerList))},l.updatePlayerCamera=function(t){var e=l.playerList.findIndex(e=>e.playerElementID==t.playerElementID);-1!=e&&(l.playerList[e].mCameraID=t.mCameraID)},l.getPlayerList=function(){return l.playerList},l.killSyncPromise=function(o){return new Promise((e,t)=>(l.killSync=o,e(!0)))}},window.JoinedTimelineView=function(e,t,o){var r=this;o=r.options=o||{};var n=null,a=null,l=t,i=e,s=null,c=0,u=!1,d=null,m=(CloudHelpers.createCallbacks(),null),p=null,f=null,g=null,h=!1;o.useTimezone&&(d=o.useTimezone,console.warn("[CloudTimeline] useTimezone: "+d)),void 0!==o.calendar&&(u=1==o.calendar),void 0!==o.polingRangeDataEveryInSec&&parseInt(o.polingRangeDataEveryInSec);var v={HOURS_12_MODE:{len_ms:324e5,step_short:18e5,step_long:9e6},HOUR_MODE:{len_ms:54e5,step_short:3e5,step_long:18e5},MINUTES_MODE:{len_ms:9e5,step_short:6e4,step_long:3e5}},m=(function(e){if(null==e||"object"!=typeof e)return;var t,o=e.constructor();for(t in e)e.hasOwnProperty(t)&&(o[t]=e[t])}(v.MINUTES_MODE),document.getElementById(i).getElementsByClassName("cloudplayer-timeline-container")[0]),p=document.getElementById(i).getElementsByClassName("cloudplayer-calendar-container")[0],f=(document.getElementById(i).getElementsByClassName("cloudplayer-live-container")[0],l.element.getElementsByClassName("cloudplayer-vxgcloudplayer")[0]),y=document.createElement("div");y.classList.add("cloudcameratimeline"),y.classList.add("green"),y.classList.add("black"),y.innerHTML='<div class="cloudcameratimeline-calendar single-timeline" style="display: none" id="single-timeline-calendar-toggle"></div><div class="cloudplayer-pause single-timeline"></div><div class="cloudcameratimeline-goto-live single-timeline disabled">Live</div><div class="cloudcameratimeline-shift shift-minus">-1h</div><div class="cloudcameratimeline-left"></div><div class="timeline-container" style="width:85%;height:35px;"><div id="'+e+'_timeline" class="ktimepicker-container" style="color:white;background:rgba(0,0,0,0);width:100%;height:36px;bottom:5px;left:75px;"></div></div><div class="cloudcameratimeline-right single-timeline"></div><div class="cloudcameratimeline-shift shift-plus single-timeline">+1h</div>';y.getElementsByClassName("cloudcameratimeline-content")[0],y.getElementsByClassName("cloudcameratimeline-data")[0];var C=y.getElementsByClassName("cloudplayer-pause")[0],_=y.getElementsByClassName("cloudcameratimeline-calendar")[0],E=(y.getElementsByClassName("cloudcameratimeline-cursor")[0],y.getElementsByClassName("cloudcameratimeline-scale")[0],y.getElementsByClassName("cloudcameratimeline-goto-live")[0]),P=y.getElementsByClassName("cloudcameratimeline-left")[0],T=y.getElementsByClassName("cloudcameratimeline-right")[0],t=y.getElementsByClassName("shift-minus")[0],v=y.getElementsByClassName("shift-plus")[0];p.appendChild(_),p.appendChild(C),p.appendChild(E),m.appendChild(y),f.setAttribute("timelineselector","#"+e+"_timeline");var b=null,I=null,y=m.getElementsByClassName("ktimepicker-container")[0],e=new MutationObserver(function(e){console.log("observe_callback");for(var t of e)"childList"==t.type&&(console.log("A child node has been added or removed."),(g=m.getElementsByTagName("k-timeline-picker")[0])&&(g.addEventListener("change",function(e){var t,o;void 0!==a&&null!=a&&(h=!0,t=Number(g.getAttribute("centerutctime")),o=a.getPosition(),t>Date.now()?a.isLive()||n.forEach(e=>{e.setPosition(CloudHelpers.POSITION_LIVE),e.play("timepicker")}):o!=t&&(n.forEach(e=>{e.player.mSrc&&(e.player.setPosition(t),e.player.play("timepicker"))}),C.classList.add("play")),h=!1)}),I.disconnect()))});function w(){var t=a.getPosition();0!=(t=0==t?CloudHelpers.getCurrentTimeUTC():t)?n.forEach(e=>{e.setPosition(t-36e5),e.play()}):console.log("Invalid current position")}function A(){var t;1!=a.isLive()&&(0!=(t=0==(t=a.getPosition())?CloudHelpers.getCurrentTimeUTC():t)?t+36e5>CloudHelpers.getCurrentTimeUTC()?n.forEach(e=>{e.setPosition(CloudHelpers.POSITION_LIVE),e.play()}):n.forEach(e=>{e.setPosition(t+36e5),e.play()}):console.log("Invalid current position "))}function R(){clearInterval(r._polingCursor),E.classList.remove("now"),E.classList.add("disabled"),r._polingCursor=setInterval(function(){null!=a?0!=a.getPosition()&&(c=a.getPosition()):c=0,void 0===a.mSrc||null==a.mSrc?(E.classList.remove("now"),E.classList.add("disabled")):a.isLive()?(E.classList.remove("disabled"),E.classList.add("now")):(E.classList.remove("disabled"),E.classList.remove("now")),(g=m.getElementsByTagName("k-timeline-picker")[0])&&0!=c&&!h&&a.isLive()&&a.player.getElementsByTagName("vxg-cloud-player")[0].setTimePromise(c).then(function(e){}).catch(function(e){})},1e3)}function S(){console.warn("_changedSource"),playerSources=[],n&&n.forEach(t=>{playerSources.some(e=>e==t.getSource())||playerSources.push(t.getSource())}),null!=a&&(s=a.getSource())&&(d?CloudHelpers.getOffsetTimezone(d):CloudHelpers.getOffsetTimezone(s.getTimezone()),null!=b&&(playerSources?b.setSource(n):b.setSource(s))),null!=a&&R()}function k(e,t){console.warn("_playerEvent ",e),"SOURCE_CHANGED"==e.name?S():"POSITION_JUMPED"==e.name?(console.warn("POSITION_JUMPED",a),c=t.new_pos):"STOPED"==e.name?console.log("Timeline catch event: Player stoped "+t):"PLAYED"==e.name&&console.log("Timeline catch event: Player played "+t)}(I=e).observe(y,{childList:!0}),r._initTimeline=function(e){n=e,S()},r.assignNewPrimary=function(e,t){l.element.getElementsByClassName("cloudplayer-vxgcloudplayer")[0].setAttribute("timelineselector","#"),(f=(l=e).element.getElementsByClassName("cloudplayer-vxgcloudplayer")[0]).setAttribute("timelineselector","#"+i+"_timeline");var o=f.shadowRoot.querySelector("k-control-timepicker").shadowRoot.querySelector("k-timeline-picker");o&&o.remove();var n=f.shadowRoot.querySelector("k-control-timepicker"),o=document.getElementById(i+"_timeline").querySelector("k-timeline-picker");n.picker=o,n.picker.addEventListener("moving",function(e){n.early_playing=n.player.isPlaying(),n.player.pause().catch(function(){})},{once:!1}),n.player.addEventListener("timeupdate",function(e){n.skip_next_timeupdate?delete n.skip_next_timeupdate:e.detail.currentUtcTime&&(e.detail.currentUtcTime<new Date("Jan 1 2000 0:00:00").getTime()||n.picker.setAttribute("centerutctime",e.detail.currentUtcTime))},{once:!1}),n.picker.addEventListener("change",function(e){clearTimeout(n.change_time_timer),n.change_time_timer=setTimeout(function(){var e=parseInt(n.picker.getAttribute("centerutctime"));n.player.pause(),n.player.currentUtcTime=e,n.skip_next_timeupdate=!0,n.player.sendTimeUpdate();var t=parseInt(n.picker.getAttribute("step"));isNaN(t)||n.player.player.storage.posters_cache.autoPreload(e,t)},10)},{once:!1}),n.picker.addEventListener("getrange",function(e){n.range=n.player.player.rangeRequest(e.detail.time_from,e.detail.time_to,e.detail.from_out?5e3:0),e.detail.ranges=void 0!==n.range?n.range:{times:[],durations:[]}}),r.setPlayer(e.player,t),r._initTimeline(t)},_.onclick=function(){null!=b&&(console.log(a),a.player.classList.remove("showing-settings","showing-zoom"),b.toggleCalendar(_))},C.onclick=function(){a&&(a.isPlaying()?(n.forEach(e=>{e.player.mSrc&&e.player.pause()}),C.classList.add("play")):(n.forEach(e=>{e.player.mSrc&&e.player.play()}),C.classList.remove("play")))},v.onclick=A,T.onclick=A,t.onclick=w,P.onclick=w,E.onclick=function(e){var t;void 0!==a.mSrc&&null!=a.mSrc&&(null==a||null==a.getSource()||0==(t=E.classList).contains("now")&&0==t.contains("disabled")&&n.forEach(e=>{e.setPosition(CloudPlayer.POSITION_LIVE),e.play()}))},r.hideCalendarButton=function(){"none"!=_.style.display&&(_.style.display="none")},r.showCalendarButton=function(){"none"==_.style.display&&(_.style.display="")},r.hideGotoLiveButton=function(){"none"!=E.style.display&&(E.style.display="none")},r.showGotoLiveButton=function(){"none"==E.style.display&&(E.style.display="")},r.setPlayer=function(e,t){a&&a.removeCallback(i),t&&(n=t),e?(null!=(a=e)?u&&(e=document.getElementById("single-timeline-calendar"),(b=new CloudCameraCalendarView(e,o)).onChangeDate=function(t,o){null!=a?n.forEach(e=>{e.setPosition(t),e.play(o)}):console.error("[TIMELINE] player is null")},r.calendar=b):console.error("[TIMELINE] player is null"),a.addCallback(i,k)):a=null},void 0!==o.gotoLive&&(1==o.gotoLive?r.showGotoLiveButton():r.hideGotoLiveButton()),u?r.showCalendarButton():r.hideCalendarButton()},window.CloudPlayerSDK=function(e,t){console.log(t);var a=this;a.options=t||{},a.player=null,a.conn=null,a.filter=null,a.cm=null,a.mCameraID=null;var l=CloudPlayer.POSITION_LIVE;a.camera=null,a.svcp_url=null,a.sharedKey=null,a.playerElementID=null,a.tokenExpire=null;var i=!1;if(window._CloudPlayerSDK=window._CloudPlayerSDK||{},!e||""===e)throw"Player container element ID is required.";if(a.playerElementID=e,-1===a.playerElementID.indexOf("%")&&(a.playerElementID=encodeURIComponent(a.playerElementID)),a.conn=new CloudShareConnection(a.options),window._CloudPlayerSDK[e])throw"Oops! CloudPlayerSDK instance with player element ID: "+e+" already exist. Try use another ID.";window._CloudPlayerSDK[e]={},a.element=document.getElementById(e),a.element.classList.add("cloudplayersdk"),a.element.classList.add("cloudplayer"),a.element.classList.add("green"),a.element.classList.add("black"),a.element.innerHTML='<div class="cplayer" id="'+e+'_cplayer"></div><div class="lplayer" id="'+e+'_lplayer" style="display: none;"></div>',a.local_player=new vxgplayer(e+"_lplayer",a.options),a.player=new CloudPlayer(e+"_cplayer",a.options),console.log("self.options: ",a.options),null!=a.options.timeline&&0!=a.options.timeline&&(a.timeline=new VXGCloudPlayerTimelineView(e,a.options,a.player),a.timeline.setPlayer(a.player),a.player.player.classList.add("with-timeline"),a.player.calendar=a.timeline.calendar,console.log(a.player)),a.setSource=function(t){CloudHelpers.promise();if(!t||""===t)return a.player._showerror(CloudReturnCode.ERROR_ACCESS_TOKEN_REQUIRED),CloudReturnCode.ERROR_ACCESS_TOKEN_REQUIRED;var e=!(!t.url||!CloudHelpers.parseUri(t.url).host);if(t.url&&!e&&(t.options&&Object.assign(a.options,t.options),t=t.url),void 0!==t&&void 0!==t.url&&e)i=!0,a.svcp_url="",a.mCameraID="",a.element.getElementsByClassName("cplayer")[0].style.display="none",a.element.getElementsByClassName("lplayer")[0].style.display="",a.local_player.setSource(t);else{i=!1,a.local_player.stop(),a.element.getElementsByClassName("cplayer")[0].style.display="";var o=!(a.element.getElementsByClassName("lplayer")[0].style.display="none"),e=!1;try{var n,r=atob(t),r=JSON.parse(r);if(console.log("[CloudPlayerSDK] access_token: ",r),a.tokenExpire=null,r.expires)if(a.tokenExpire=r.expires,CloudHelpers.parseUTCTime(a.tokenExpire)-(new Date).getTime()<0)return a.player._showerror(CloudReturnCode.ERROR_ACCESS_TOKEN_EXPIRED),CloudReturnCode.ERROR_ACCESS_TOKEN_EXPIRED;r.token&&r.camid&&r.access&&""!==r.token&&""!==r.camid&&""!==r.access&&(a.sharedKey=r.token,a.mCameraID==r.camid&&(e=!0),a.mCameraID=r.camid),r.svcp&&""!=r.svcp&&(a.svcp_url==r.svcp&&(o=!0),a.svcp_url=r.svcp),r.api&&""!=r.api&&(n="",n=("file:"==location.protocol?"http:":location.protocol)+"//"+r.api,"http:"==location.protocol||"file:"==location.protocol?n+=r.api_p?":"+r.api_p:"":"https:"==location.protocol&&(n+=r.api_sp?":"+r.api_sp:""),n+="/",r.path&&""!=r.path&&(n+=r.path,n+="/"),a.svcp_url==n&&(o=!0),a.svcp_url=n)}catch(e){a.player._showerror(CloudReturnCode.ERROR_INVALID_ACCESS_TOKEN_FORMAT)}e&&o?(console.log("DEBUG: Same camid and svcp for newly token"),a.conn.updateToken(a.sharedKey),a.player.setAccessToken(t),a.player.setAccessTokenExpire(a.tokenExpire)):(a.player.stop("by_plrsdk_3"),null!=a.svcp_url&&(a.conn.ServiceProviderUrl=a.svcp_url.replace("file://","https://")),a.conn.open(a.sharedKey).done(function(e){a.conn&&(a.cm=new CloudCameraList(a.conn),a.cm.getCamera(a.mCameraID).done(function(e){a.camera=e,a.player.setAccessToken(t),a.player.setAccessTokenExpire(a.tokenExpire),a.player.setSource(a.camera).then(function(){console.log(a.camera),console.log(a.camera._origJson()),a.player.setPosition(l),a.player.play()})}).fail(function(e){console.log(e),a.player&&a.player._showerror(CloudReturnCode.ERROR_CHANNEL_NOT_FOUND)}))}).fail(function(e){a.player._showerror(CloudReturnCode.ERROR_NETWORK_ERROR)}))}},a.getSource=function(){return a.sharedKey||CloudReturnCode.ERROR_SOURCE_NOT_CONFIGURED},a.play=function(){if(i)a.local_player.play();else{if(!a.camera)return CloudReturnCode.ERROR_SOURCE_NOT_CONFIGURED;a.player.play()}},a.stop=function(){if(a.mCameraID=null,i)a.local_player.stop();else{if(!a.camera)return CloudReturnCode.ERROR_SOURCE_NOT_CONFIGURED;a.player.stop("by_plrsdk_1")}},a.pause=function(){if(i)a.local_player.pause();else{if(!a.camera)return CloudReturnCode.ERROR_SOURCE_NOT_CONFIGURED;a.player.pause()}},a.close=function(){a.local_player.stop(),a.local_player.dispose(),a.player.stop("by_plrsdk_2"),a.player.close(),a.player.player.innerHTML="",a.conn.close(),window._CloudPlayerSDK[e]&&delete window._CloudPlayerSDK[e]},a.sendBackwardAudio=function(){return a.player.sendBackwardAudio()},a.destroy=function(){a.player.destroy(),a.conn.close(),a.player.player.innerHTML="",a.player=null,a.local_player.dispose(),a.local_player=null,a.element.remove(),a.element=null,window._CloudPlayerSDK[a.playerElementID]&&delete window._CloudPlayerSDK[a.playerElementID]},a.isPlaying=function(){return a.camera?a.player.isPlaying():CloudReturnCode.ERROR_SOURCE_NOT_CONFIGURED},a.setPosition=function(e){if(l=parseInt(e),!a.camera)return CloudReturnCode.ERROR_SOURCE_NOT_CONFIGURED;a.player.stop("by_plrsdk_2"),a.player.setPosition(e),a.player.play()},a.getPosition=function(){return a.camera?a.player.getPosition():CloudReturnCode.ERROR_SOURCE_NOT_CONFIGURED},a.showTimeline=function(e){return a.camera?a.timeline?(document.getElementById("tagsplayer_timeline").style.display=e?"":"none",!0):(console.error(CloudReturnCode.ERROR_NOT_CONFIGURED.text),null):(console.error(CloudReturnCode.ERROR_SOURCE_NOT_CONFIGURED.text),null)},a.showCalendarControl=function(e){if(!a.timeline)return console.error(CloudReturnCode.ERROR_NOT_CONFIGURED.text),null;e?a.timeline.showCalendarButton():a.timeline.hideCalendarButton()},a.getChannelName=function(){return a.camera?a.camera.getName():CloudReturnCode.ERROR_SOURCE_NOT_CONFIGURED},a.setRange=function(e,t){a.player.setRange(e,t)},a.resetRange=function(){a.player.resetRange()},a.showZoomControl=function(e){a.player&&a.player._showZoomControl(e)},a.showPTZControl=function(e){a.player&&a.player.showPTZControl(e)},a.mOnError_callback=null,a.onError=function(e){e?(a.mOnError_callback=e,a.player.onError(function(e,t){a.mOnError_callback(a,t)})):a.player.onError(null)},a.mOnChannelStatus_callback=null,a.onChannelStatus=function(e){if(!e)return a.mOnChannelStatus_callback=null,void a.player.onChannelStatus(null);a.mOnChannelStatus_callback=e,a.player.onChannelStatus(function(e,t){a.mOnChannelStatus_callback(a,t)})},a.setIOsFullscreenCallback=function(e){a.player.setIOsFullscreenCallback(e)},a.addCallback=function(e,t){a.player.addCallback(e,t)},a.removeCallback=function(e){a.player.removeCallback(e)},a.getImages=function(){a.player.getImages()},a.sendBackwardAudio=function(){return a.player.sendBackwardAudio()}};for(var ptzconfig={xRot:-48.6,zRot:145,xScale:1,yScale:1,xShift:0,yShift:0,zCamShift:.2,zZoom:-.6,xLens:1,zLens:1,divider:4},jsscript=document.getElementsByTagName("script"),i=0;i<jsscript.length;i++){var pattern=/CloudSDK/i;pattern.test(jsscript[i].getAttribute("src"))&&(ptzconfig.src=jsscript[i].getAttribute("src").replace(/(\/[^\/]+)$/,"/"))}function changepztconfig(e,t){ptzconfig[t]=e}function testplay(){$("#player1_vjs_html5_api").attr("src","/video.mp4"),player1_vjs_html5_api.play()}function testplay2(){$("#player1_vjs_html5_api").attr("src","/fisheye.mp4"),player1_vjs_html5_api.play()}window.CloudPano=function(e,t){var a={};function l(e,t,o){var n=e.RGBA,r=e.RGBA,a=e.UNSIGNED_BYTE;try{e.bindTexture(e.TEXTURE_2D,t),e.texImage2D(e.TEXTURE_2D,0,n,r,a,o)}catch(e){console.warn("CloudPano.updateTexture: "+e.message)}}a.container=e,a.pano_player=t,a.ptzconfig=Object.assign({},ptzconfig),a.beMouseDown=!1,a.bezRot=a.bexRot=0,a.beX=a.beY=0,a.model={vertex:[],indices:[],texture:[]},a.load_model=function(){if(!a.textureBuffer){var t;try{t=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{t=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){try{t=new XMLHttpRequest}catch(e){t=!1}}}t.onreadystatechange=function(){if(!a.textureBuffer&&4==t.readyState&&(200==t.status||0==t.status)&&t.response){for(a.model=JSON.parse(t.response),a.model.indices=[],c=0,i=0;i<a.model.vertex.length;i+=3)a.model.indices.push(c++);a.vertexBuffer=a.gl.createBuffer(),a.gl.bindBuffer(a.gl.ARRAY_BUFFER,a.vertexBuffer),a.gl.bufferData(a.gl.ARRAY_BUFFER,new Float32Array(a.model.vertex),a.gl.STATIC_DRAW),a.gl.bindBuffer(a.gl.ARRAY_BUFFER,null),a.indexBuffer=a.gl.createBuffer(),a.gl.bindBuffer(a.gl.ELEMENT_ARRAY_BUFFER,a.indexBuffer),a.gl.bufferData(a.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(a.model.indices),a.gl.STATIC_DRAW),a.gl.bindBuffer(a.gl.ELEMENT_ARRAY_BUFFER,null),a.textureBuffer=a.gl.createBuffer(),a.gl.bindBuffer(a.gl.ARRAY_BUFFER,a.textureBuffer),a.gl.bufferData(a.gl.ARRAY_BUFFER,new Float32Array(a.model.texture),a.gl.STATIC_DRAW),a.gl.bindBuffer(a.gl.ARRAY_BUFFER,null),console.log("[CloudPlayer] vehicles count is "+a.model.vertex.length/3)}},a.pano_player.options&&a.pano_player.options.model3d?t.open("GET",a.pano_player.options.model3d,!0):t.open("GET",a.ptzconfig.src+"model.json",!0),t.send(null)}},a.mouseMoveHandler=function(e){var t=e.clientX,o=e.clientY;a.beMouseDown||1!=e.buttons||(a.bezRot=a.ptzconfig.zRot,a.bexRot=a.ptzconfig.xRot,a.beMouseDown=!0,a.beX=t,a.beY=o),0==e.buttons&&(a.beMouseDown=!1),a.beMouseDown&&(a.ptzconfig.zRot=a.bezRot+(a.beX-t)/5,a.ptzconfig.xRot=a.bexRot+(a.beY-o)/5,0<a.ptzconfig.xRot&&(a.ptzconfig.xRot=0),a.ptzconfig.xRot<-65.2&&(a.ptzconfig.xRot=-65.2))},a.mouseWheelHandler=function(e){var t=(e=e||window.event).deltaY||e.detail||e.wheelDelta;a.ptzconfig.zZoom-=t/1e3,.6<a.ptzconfig.zZoom&&(a.ptzconfig.zZoom=.6),a.ptzconfig.zZoom<-.6&&(a.ptzconfig.zZoom=-.6),e.preventDefault()},a.createGLContext=function(){var e=document.createElement("div");e.style.top="90px",e.style.position="absolute",e.style.color="black",e.style.fontSize="12px",e.innerHTML='            <span style="background:rgba(255,255,255,.7);padding:0 5px">Vertical camera move</span><br/>               <input style="width:250px" id="zCamShift" type="range" min="-1" max="2" step=".01" value="'+a.ptzconfig.zCamShift+'" onchange="changepztconfig(this.value,\'zCamShift\')"><br/>            <span for="zZoom" style="background:rgba(255,255,255,.7);padding:0 5px">Zooming</span><br/>                    <input style="width:250px" id="zZoom" type="range" min="-5" max="2" step=".1" value="'+a.ptzconfig.zZoom+'" onchange="changepztconfig(this.value,\'zZoom\')"><br/>            <span for="xRot" style="background:rgba(255,255,255,.7);padding:0 5px">Down camera</span><br/>              <input style="width:250px" id="xRot" type="range" min="-120" max="0" step="5" value="'+a.ptzconfig.xRot+'" onchange="changepztconfig(this.value,\'xRot\')"><br/>            <span for="xScale" style="background:rgba(255,255,255,.7);padding:0 5px">Zoom texture by X</span><br/> <input style="width:250px" id="xScale" type="range" min="-2.5" max="2.5" step=".01" value="'+a.ptzconfig.xScale+'" onchange="changepztconfig(this.value,\'xScale\')"><br/>            <span for="yScale" style="background:rgba(255,255,255,.7);padding:0 5px">Zoom texture by Y</span><br/> <input style="width:250px" id="yScale" type="range" min="-2.5" max="2.5" step=".01" value="'+a.ptzconfig.yScale+'" onchange="changepztconfig(this.value,\'yScale\')"><br/>            <span for="xShift" style="background:rgba(255,255,255,.7);padding:0 5px">Shift texture by X</span><br/>        <input style="width:250px" id="xShift" type="range" min="-2.5" max="2.5" step=".01" value="'+a.ptzconfig.xShift+'" onchange="changepztconfig(this.value,\'xShift\')"><br/>            <span for="yShift" style="background:rgba(255,255,255,.7);padding:0 5px">Shift texture by Y</span><br/>        <input style="width:250px" id="yShift" type="range" min="-2.5" max="2.5" step=".01" value="'+a.ptzconfig.yShift+'" onchange="changepztconfig(this.value,\'yShift\')"><br/>            <span for="zLens" style="background:rgba(255,255,255,.7);padding:0 5px">lens convexity correction </span><br/>     <input style="width:250px" id="yShift" type="range" min="-2.5" max="2.5" step=".01" value="'+a.ptzconfig.zLens+'" onchange="changepztconfig(this.value,\'zLens\')"><br/>            <span for="xLens" style="background:rgba(255,255,255,.7);padding:0 5px">lens zoom correction by X</span><br/>     <input style="width:250px" id="xLens" type="range" min=".5" max="2" step=".01" value="'+a.ptzconfig.xLens+'" onchange="changepztconfig(this.value,\'xLens\')"><br/>            <button onclick="testplay()">Play test sample</button>&nbsp;<button onclick="testplay2()">Play second sample</button>        ',a.canvas=document.createElement("canvas"),a.canvas.style.width="100%",a.canvas.style.height="100%",a.canvas.style.display="none",a.container.parentElement.insertBefore(a.canvas,a.container),a.canvas.setAttribute("width",a.container.parentElement.offsetWidth),a.canvas.setAttribute("height",a.container.parentElement.offsetHeight),a.image=document.createElement("img"),a.image.style.opacity="0",a.image.style.width="100%",a.image.style.height="100%",a.image.style.position="absolute",a.image.style.zIndex="-5",a.image.style.display="block",a.container.parentElement.insertBefore(a.image,a.canvas),a.canvas.addEventListener("mousemove",a.mouseMoveHandler),a.canvas.addEventListener("wheel",a.mouseWheelHandler);for(var t,o=["webgl","experimental-webgl","webkit-3d","moz-webgl"],n=0;n<o.length;++n){try{t=a.canvas.getContext(o[n])}catch(e){continue}if(t)return t}throw new Error("WebGL is not supported!")},a.compileShader=function(t,e,o){var n=t.createShader(t.VERTEX_SHADER);t.shaderSource(n,e),t.compileShader(n),r(n);e=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(e,o),t.compileShader(e),r(e);o=t.createProgram();return t.attachShader(o,n),t.attachShader(o,e),t.linkProgram(o),o;function r(e){if(!t.getShaderParameter(e,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(e))}},a.run=function(n){var r=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;if(!r)throw new Error("do not support 'requestAnimationFram'");r(function e(t){a=a||t;var o=t-a;a=t;n(o);r(e)});var a=null},a.ptz_enabled=!1,a.start=function(){a.load_model(),a.ptz_enabled=!0,a.canvas.style.display="block",a.container.style.visibility="hidden",a.container.style.position="fixed",a.container.style.top="0",a.container.style.height="1px",a.container.style.width="1px",a.container.style.zIndex="-1"},a.stop=function(){a.ptz_enabled=!1,a.canvas.style.display="none",a.container.style.visibility="",a.container.style.position="",a.container.style.top="",a.container.style.height="100%",a.container.style.width="100%",a.container.style.zIndex=""},a.model,a.gl=a.createGLContext();t=a.compileShader(a.gl,"        attribute vec3 aVertexPosition;\n        attribute vec2 aTextureCoord;\n        uniform mat4 uMVMatrix;\n        uniform mat4 uPMatrix;\n        uniform float fCamShift;\n        uniform float zLens;\n        varying vec2 vTextureCoord;\n        void main(void) {\n            gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition.x, aVertexPosition.y, aVertexPosition.z*zLens+fCamShift, 1.0);\n            vTextureCoord = aTextureCoord;\n        }","        precision mediump float;\n        varying vec2 vTextureCoord;\n        uniform sampler2D uSampler;\n        uniform vec4 uScale;\n        void main(void) {\n            gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x / uScale.x + uScale.z, vTextureCoord.y / uScale.y + uScale.w));\n        }");function s(e){return e*Math.PI/180}return a.gl.useProgram(t),a.aVertexPosition=a.gl.getAttribLocation(t,"aVertexPosition"),a.aTextureCoord=a.gl.getAttribLocation(t,"aTextureCoord"),a.uSampler=a.gl.getUniformLocation(t,"uSampler"),a.uScale=a.gl.getUniformLocation(t,"uScale"),a.pMatrixUniform=a.gl.getUniformLocation(t,"uPMatrix"),a.mvMatrixUniform=a.gl.getUniformLocation(t,"uMVMatrix"),a.fCamShift=a.gl.getUniformLocation(t,"fCamShift"),a.zLens=a.gl.getUniformLocation(t,"zLens"),a.texture=function(e){var t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);var o=e.RGBA,n=e.RGBA,r=e.UNSIGNED_BYTE,a=new Uint8Array([0,0,0,255]);return e.texImage2D(e.TEXTURE_2D,0,o,1,1,0,n,r,a),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameterf(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameterf(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),t}(a.gl),a.mvMatrix=glMatrix.mat4.create(),a.pMatrix=glMatrix.mat4.create(),a.run(function(e){if(a.ptz_enabled&&a.textureBuffer&&a.indexBuffer){for(var t,o=a.container.querySelectorAll("video"),n=null,r=0;r<o.length;++r)if("none"!=getComputedStyle(o[r],null).display&&"none"!=getComputedStyle(o[r].parentElement,null).display){n=o[r];break}null==n&&(null===(n=a.container.getElementsByTagName("vxg-cloud-player")[0].getVideo())||null!=(t=n.getAttribute("poster"))&&(a.image.src=t)),a.canvas.setAttribute("width",a.container.parentElement.offsetWidth),a.canvas.setAttribute("height",a.container.parentElement.offsetHeight),null!=n&&(a.pano_player.isPlaying()?l(a.gl,a.texture,n):l(a.gl,a.texture,a.image),l(a.gl,a.texture,n),a.gl.clearColor(0,0,0,1),a.gl.enable(a.gl.DEPTH_TEST),a.gl.clear(a.gl.COLOR_BUFFER_BIT|a.gl.DEPTH_BUFFER_BIT),a.gl.viewport(0,0,a.canvas.width,a.canvas.height),glMatrix.mat4.perspective(a.pMatrix,45,a.canvas.width/a.canvas.height,.1,100),glMatrix.mat4.identity(a.mvMatrix),glMatrix.mat4.translate(a.mvMatrix,a.mvMatrix,[0,0,a.ptzconfig.zZoom]),glMatrix.mat4.rotate(a.mvMatrix,a.mvMatrix,s(a.ptzconfig.xRot),[1,0,0]),glMatrix.mat4.rotate(a.mvMatrix,a.mvMatrix,s(a.ptzconfig.zRot),[0,0,1]),a.gl.enableVertexAttribArray(a.aVertexPosition),a.gl.bindBuffer(a.gl.ARRAY_BUFFER,a.vertexBuffer),a.gl.vertexAttribPointer(a.aVertexPosition,3,a.gl.FLOAT,!1,0,0),a.gl.enableVertexAttribArray(a.aTextureCoord),a.gl.bindBuffer(a.gl.ARRAY_BUFFER,a.textureBuffer),a.gl.vertexAttribPointer(a.aTextureCoord,2,a.gl.FLOAT,!1,0,0),a.gl.activeTexture(a.gl.TEXTURE0),a.gl.bindTexture(a.gl.TEXTURE_2D,a.texture),a.gl.pixelStorei(a.gl.UNPACK_FLIP_Y_WEBGL,!0),a.gl.uniform1i(a.uSampler,0),a.gl.uniform4f(a.uScale,a.ptzconfig.xScale,a.ptzconfig.yScale,a.ptzconfig.xShift,a.ptzconfig.yShift),a.gl.bindBuffer(a.gl.ELEMENT_ARRAY_BUFFER,a.indexBuffer),a.gl.uniformMatrix4fv(a.pMatrixUniform,!1,a.pMatrix),a.gl.uniformMatrix4fv(a.mvMatrixUniform,!1,a.mvMatrix),a.gl.uniform1f(a.fCamShift,a.ptzconfig.zCamShift),a.gl.uniform1f(a.zLens,a.ptzconfig.zLens),a.gl.drawElements(a.gl.TRIANGLES,a.model.vertex.length/3,a.gl.UNSIGNED_SHORT,a.model.indices))}}),a},function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("rangeSlider",[],t):"object"==typeof exports?exports.rangeSlider=t():e.rangeSlider=t()}(window,function(){return n={},r.m=o=[function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uuid=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},t.delay=function(e,t){for(var o=arguments.length,n=Array(2<o?o-2:0),r=2;r<o;r++)n[r-2]=arguments[r];return setTimeout(function(){return e.apply(null,n)},t)},t.debounce=function(n){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:100;return function(){for(var e=arguments.length,t=Array(e),o=0;o<e;o++)t[o]=arguments[o];return n.debouncing||(n.lastReturnVal=n.apply(window,t),n.debouncing=!0),clearTimeout(n.debounceTimeout),n.debounceTimeout=setTimeout(function(){n.debouncing=!1},r),n.lastReturnVal}};var n=t.isString=function(e){return e===""+e},a=(t.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},t.isNumberLike=function(e){return null!=e&&(n(e)&&isFinite(parseFloat(e))||isFinite(e))});t.getFirsNumberLike=function(){for(var e=arguments.length,t=Array(e),o=0;o<e;o++)t[o]=arguments[o];if(!t.length)return null;for(var n=0,r=t.length;n<r;n++)if(a(t[n]))return t[n];return null},t.isObject=function(e){return"[object Object]"===Object.prototype.toString.call(e)},t.simpleExtend=function(e,t){var o,n,r={};for(o in e)r[o]=e[o];for(n in t)r[n]=t[n];return r},t.between=function(e,t,o){return e<t?t:o<e?o:e}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e,t,o){return t&&r(e.prototype,t),o&&r(e,o),e},a=i(o(2)),l=i(o(0));function r(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t.default=e,t}o(3);var s=new RegExp("/[\\n\\t]/","g"),c="rangeSlider",u=a.supportsRange(),d={polyfill:!0,root:document,rangeClass:"rangeSlider",disabledClass:"rangeSlider--disabled",fillClass:"rangeSlider__fill",bufferClass:"rangeSlider__buffer",handleClass:"rangeSlider__handle",startEvent:["mousedown","touchstart","pointerdown"],moveEvent:["mousemove","touchmove","pointermove"],endEvent:["mouseup","touchend","pointerup"],min:null,max:null,step:null,value:null,buffer:null,stick:null,borderRadius:10,vertical:!1},n=(n(m,[{key:"update",value:function(e,t){return t&&(this.needTriggerEvents=!0),l.isObject(e)&&(l.isNumberLike(e.min)&&(this.element.setAttribute("min",""+e.min),this.min=e.min),l.isNumberLike(e.max)&&(this.element.setAttribute("max",""+e.max),this.max=e.max),l.isNumberLike(e.step)&&(this.element.setAttribute("step",""+e.step),this.step=e.step,this.toFixed=this._toFixed(e.step)),l.isNumberLike(e.buffer)&&this._setBufferPosition(e.buffer),l.isNumberLike(e.value)&&this._setValue(e.value)),this._update(),this.onSlideEventsCount=0,this.needTriggerEvents=!1,this}},{key:"destroy",value:function(){a.removeAllListenersFromEl(this,this.options.root),window.removeEventListener("resize",this._handleResize,!1),this.element.removeEventListener("change",this._changeEventListener,!1),this.element.style.cssText="",delete this.element[c],this.range&&this.range.parentNode.removeChild(this.range)}},{key:"_toFixed",value:function(e){return(e+"").replace(".","").length-1}},{key:"_init",value:function(){this.onInit&&"function"==typeof this.onInit&&this.onInit(),this._update(!1)}},{key:"_updatePercentFromValue",value:function(){this.percent=(this.value-this.min)/(this.max-this.min)}},{key:"_startEventListener",value:function(e,t){var o=this,n=e.target,r=!1;(1===e.which||"touches"in e)&&(a.forEachAncestors(n,function(e){return r=e.id===o.identifier&&!a.hasClass(e,o.options.disabledClass)},!0),r&&this._handleDown(e,t))}},{key:"_changeEventListener",value:function(e,t){t&&t.origin===this.identifier||(e=e.target.value,e=this._getPositionFromValue(e),this._setPosition(e))}},{key:"_update",value:function(e){var t=this.vertical?"offsetHeight":"offsetWidth";this.handleSize=a.getDimension(this.handle,t),this.rangeSize=a.getDimension(this.range,t),this.maxHandleX=this.rangeSize-this.handleSize,this.grabX=this.handleSize/2,this.position=this._getPositionFromValue(this.value),this.element.disabled?a.addClass(this.range,this.options.disabledClass):a.removeClass(this.range,this.options.disabledClass),this._setPosition(this.position),this.options.bufferClass&&this.options.buffer&&this._setBufferPosition(this.options.buffer),this._updatePercentFromValue(),!1!==e&&a.triggerEvent(this.element,"change",{origin:this.identifier})}},{key:"_handleResize",value:function(){var e=this;return l.debounce(function(){l.delay(function(){e._update()},300)},50)()}},{key:"_handleDown",value:function(e){var t,o;this.isInteractsNow=!0,e.preventDefault(),a.addEventListeners(this.options.root,this.options.moveEvent,this._handleMove),a.addEventListeners(this.options.root,this.options.endEvent,this._handleEnd),-1<(" "+e.target.className+" ").replace(s," ").indexOf(this.options.handleClass)||(o=this.range.getBoundingClientRect(),t=this._getRelativePosition(e),e=this.vertical?o.bottom:o.left,o=this._getPositionFromNode(this.handle)-e,e=t-this.grabX,this._setPosition(e),o<=t&&t<o+2*this.options.borderRadius&&(this.grabX=t-o),this._updatePercentFromValue())}},{key:"_handleMove",value:function(e){var t=this._getRelativePosition(e);this.isInteractsNow=!0,e.preventDefault(),this._setPosition(t-this.grabX)}},{key:"_handleEnd",value:function(e){e.preventDefault(),a.removeEventListeners(this.options.root,this.options.moveEvent,this._handleMove),a.removeEventListeners(this.options.root,this.options.endEvent,this._handleEnd),a.triggerEvent(this.element,"change",{origin:this.identifier}),(this.isInteractsNow||this.needTriggerEvents)&&this.onSlideEnd&&"function"==typeof this.onSlideEnd&&this.onSlideEnd(this.value,this.percent,this.position),this.onSlideEventsCount=0,this.isInteractsNow=!1}},{key:"_setPosition",value:function(e){var t,o,n,e=this._getValueFromPosition(l.between(e,0,this.maxHandleX));this.stick&&((o=e%(n=this.stick[0]))<(t=this.stick[1]||.1)?e-=o:Math.abs(n-o)<t&&(e=e-o+n)),n=this._getPositionFromValue(e),this.vertical?(this.container.style.height=n+this.grabX+"px",this.handle.style.webkitTransform="translateY(-"+n+"px)",this.handle.style.msTransform="translateY(-"+n+"px)",this.handle.style.transform="translateY(-"+n+"px)"):(this.container.style.width=n+this.grabX+"px",this.handle.style.webkitTransform="translateX("+n+"px)",this.handle.style.msTransform="translateX("+n+"px)",this.handle.style.transform="translateX("+n+"px)"),this._setValue(e),this.position=n,this.value=e,this._updatePercentFromValue(),(this.isInteractsNow||this.needTriggerEvents)&&(this.onSlideStart&&"function"==typeof this.onSlideStart&&0===this.onSlideEventsCount&&this.onSlideStart(this.value,this.percent,this.position),this.onSlide&&"function"==typeof this.onSlide&&this.onSlide(this.value,this.percent,this.position)),this.onSlideEventsCount++}},{key:"_setBufferPosition",value:function(e){var t,o=!0;if(isFinite(e))e=parseFloat(e);else{if(!l.isString(e))return void console.warn("New position must be XXpx or XX%");0<e.indexOf("px")&&(o=!1),e=parseFloat(e)}isNaN(e)?console.warn("New position is NaN"):this.options.bufferClass?(t=o?e:e/this.rangeSize*100,this.options.buffer=t=100<(t=t<0?0:t)?100:t,(e=t-(o=this.options.borderRadius/this.rangeSize*100))<0&&(e=0),this.vertical?(this.buffer.style.height=e+"%",this.buffer.style.bottom=.5*o+"%"):(this.buffer.style.width=e+"%",this.buffer.style.left=.5*o+"%"),this.element.setAttribute("data-buffer",t)):console.warn("You disabled buffer, it's className is empty")}},{key:"_getPositionFromNode",value:function(e){for(var t=this.vertical?this.maxHandleX:0;null!==e;)t+=this.vertical?e.offsetTop:e.offsetLeft,e=e.offsetParent;return t}},{key:"_getRelativePosition",value:function(e){var t=this.range.getBoundingClientRect(),o=this.vertical?t.bottom:t.left,n=0,t=this.vertical?"pageY":"pageX";return void 0!==e[t]?n=(e.touches&&e.touches.length?e.touches[0]:e)[t]:void 0!==e.originalEvent?void 0!==e.originalEvent[t]?n=e.originalEvent[t]:e.originalEvent.touches&&e.originalEvent.touches[0]&&void 0!==e.originalEvent.touches[0][t]&&(n=e.originalEvent.touches[0][t]):e.touches&&e.touches[0]&&void 0!==e.touches[0][t]?n=e.touches[0][t]:!e.currentPoint||void 0===e.currentPoint.x&&void 0===e.currentPoint.y||(n=this.vertical?e.currentPoint.y:e.currentPoint.x),this.vertical&&(n-=window.pageYOffset),this.vertical?o-n:n-o}},{key:"_getPositionFromValue",value:function(e){e=(e-this.min)/(this.max-this.min)*this.maxHandleX;return isNaN(e)?0:e}},{key:"_getValueFromPosition",value:function(e){e/=this.maxHandleX||1,e=this.step*Math.round(e*(this.max-this.min)/this.step)+this.min;return Number(e.toFixed(this.toFixed))}},{key:"_setValue",value:function(e,t){e===this.value&&!t||(this.element.value=e,this.value=e,a.triggerEvent(this.element,"input",{origin:this.identifier}))}}],[{key:"create",value:function(e,o){function t(e){var t=e[c];t||(t=new m(e,o),e[c]=t)}e.length?Array.prototype.slice.call(e).forEach(function(e){t(e)}):t(e)}}]),m);function m(e,t){!function(e){if(!(e instanceof m))throw new TypeError("Cannot call a class as a function")}(this);var o=void 0,n=void 0,r=void 0;this.element=e,this.options=l.simpleExtend(d,t),this.polyfill=this.options.polyfill,this.vertical=this.options.vertical,this.onInit=this.options.onInit,this.onSlide=this.options.onSlide,this.onSlideStart=this.options.onSlideStart,this.onSlideEnd=this.options.onSlideEnd,this.onSlideEventsCount=-1,this.isInteractsNow=!1,this.needTriggerEvents=!1,!this.polyfill&&u||(this.options.buffer=this.options.buffer||parseFloat(this.element.getAttribute("data-buffer")),this.identifier="js-"+c+"-"+l.uuid(),this.min=l.getFirsNumberLike(this.options.min,parseFloat(this.element.getAttribute("min")),0),this.max=l.getFirsNumberLike(this.options.max,parseFloat(this.element.getAttribute("max")),100),this.value=l.getFirsNumberLike(this.options.value,this.element.value,parseFloat(this.element.value||this.min+(this.max-this.min)/2)),this.step=l.getFirsNumberLike(this.options.step,parseFloat(this.element.getAttribute("step"))||(o=1)),this.percent=null,l.isArray(this.options.stick)&&1<=this.options.stick.length?this.stick=this.options.stick:(n=this.element.getAttribute("stick"))&&1<=(r=n.split(" ")).length&&(this.stick=r.map(parseFloat)),this.stick&&1===this.stick.length&&this.stick.push(1.5*this.step),this._updatePercentFromValue(),this.toFixed=this._toFixed(this.step),r=void 0,this.container=document.createElement("div"),a.addClass(this.container,this.options.fillClass),r=this.vertical?this.options.fillClass+"__vertical":this.options.fillClass+"__horizontal",a.addClass(this.container,r),this.handle=document.createElement("div"),a.addClass(this.handle,this.options.handleClass),r=this.vertical?this.options.handleClass+"__vertical":this.options.handleClass+"__horizontal",a.addClass(this.handle,r),this.range=document.createElement("div"),a.addClass(this.range,this.options.rangeClass),this.range.id=this.identifier,(e=e.getAttribute("title"))&&0<e.length&&this.range.setAttribute("title",e),this.options.bufferClass&&(this.buffer=document.createElement("div"),a.addClass(this.buffer,this.options.bufferClass),this.range.appendChild(this.buffer),r=this.vertical?this.options.bufferClass+"__vertical":this.options.bufferClass+"__horizontal",a.addClass(this.buffer,r)),this.range.appendChild(this.container),this.range.appendChild(this.handle),r=this.vertical?this.options.rangeClass+"__vertical":this.options.rangeClass+"__horizontal",a.addClass(this.range,r),l.isNumberLike(this.options.value)&&(this._setValue(this.options.value,!0),this.element.value=this.options.value),l.isNumberLike(this.options.buffer)&&this.element.setAttribute("data-buffer",this.options.buffer),l.isNumberLike(this.options.min)&&this.element.setAttribute("min",""+this.min),l.isNumberLike(this.options.max),this.element.setAttribute("max",""+this.max),(l.isNumberLike(this.options.step)||o)&&this.element.setAttribute("step",""+this.step),a.insertAfter(this.element,this.range),a.setCss(this.element,{position:"absolute",width:"1px",height:"1px",overflow:"hidden",opacity:"0"}),this._handleDown=this._handleDown.bind(this),this._handleMove=this._handleMove.bind(this),this._handleEnd=this._handleEnd.bind(this),this._startEventListener=this._startEventListener.bind(this),this._changeEventListener=this._changeEventListener.bind(this),this._handleResize=this._handleResize.bind(this),this._init(),window.addEventListener("resize",this._handleResize,!1),a.addEventListeners(this.options.root,this.options.startEvent,this._startEventListener),this.element.addEventListener("change",this._changeEventListener,!1))}(t.default=n).version="0.4.10",n.dom=a,n.functions=l,e.exports=t.default},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.supportsRange=t.removeAllListenersFromEl=t.removeEventListeners=t.addEventListeners=t.insertAfter=t.triggerEvent=t.forEachAncestors=t.removeClass=t.addClass=t.hasClass=t.setCss=t.getDimension=t.getHiddenParentNodes=t.isHidden=t.detectIE=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t.default=e,t}(o(0)),a="eventListenerList",o=(t.detectIE=function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");if(0<t)return parseInt(e.substring(t+5,e.indexOf(".",t)),10);if(0<e.indexOf("Trident/")){var o=e.indexOf("rv:");return parseInt(e.substring(o+3,e.indexOf(".",o)),10)}o=e.indexOf("Edge/");return 0<o&&parseInt(e.substring(o+5,e.indexOf(".",o)),10)})(),n=!(!window.PointerEvent||o)&&{passive:!1},l=t.isHidden=function(e){return 0===e.offsetWidth||0===e.offsetHeight||!1===e.open},c=t.getHiddenParentNodes=function(e){for(var t=[],o=e.parentNode;o&&l(o);)t.push(o),o=o.parentNode;return t},i=(t.getDimension=function(e,t){function o(e){void 0!==e.open&&(e.open=!e.open)}var n=c(e),r=n.length,a=[],l=e[t];if(r){for(var i=0;i<r;i++)a.push({display:n[i].style.display,height:n[i].style.height,overflow:n[i].style.overflow,visibility:n[i].style.visibility}),n[i].style.display="block",n[i].style.height="0",n[i].style.overflow="hidden",n[i].style.visibility="hidden",o(n[i]);for(var l=e[t],s=0;s<r;s++)o(n[s]),n[s].style.display=a[s].display,n[s].style.height=a[s].height,n[s].style.overflow=a[s].overflow,n[s].style.visibility=a[s].visibility}return l},t.setCss=function(e,t){for(var o in t)e.style[o]=t[o];return e.style},t.hasClass=function(e,t){return new RegExp(" "+t+" ").test(" "+e.className+" ")});t.addClass=function(e,t){i(e,t)||(e.className+=" "+t)},t.removeClass=function(e,t){var o=" "+e.className.replace(/[\t\r\n]/g," ")+" ";if(i(e,t)){for(;0<=o.indexOf(" "+t+" ");)o=o.replace(" "+t+" "," ");e.className=o.replace(/^\s+|\s+$/g,"")}},t.forEachAncestors=function(e,t,o){for(o&&t(e);e.parentNode&&!t(e);)e=e.parentNode;return e},t.triggerEvent=function(e,t,o){if(!r.isString(t))throw new TypeError("event name must be String");if(!(e instanceof HTMLElement))throw new TypeError("element must be HTMLElement");t=t.trim();var n=document.createEvent("CustomEvent");n.initCustomEvent(t,!1,!1,o),e.dispatchEvent(n)},t.insertAfter=function(e,t){return e.parentNode.insertBefore(t,e.nextSibling)},t.addEventListeners=function(t,e,o){e.forEach(function(e){t[a]||(t[a]={}),t[a][e]||(t[a][e]=[]),t.addEventListener(e,o,n),t[a][e].indexOf(o)<0&&t[a][e].push(o)})},t.removeEventListeners=function(o,e,n){e.forEach(function(e){var t=void 0;o.removeEventListener(e,n,!1),o[a]&&o[a][e]&&-1<(t=o[a][e].indexOf(n))&&o[a][e].splice(t,1)})},t.removeAllListenersFromEl=function(t,e){if(e[a]){for(var o in e[a])e[a][o].forEach(n,{eventName:o,el:e});e[a]={}}function n(e){e===t._startEventListener&&this.el.removeEventListener(this.eventName,e,!1)}},t.supportsRange=function(){var e=document.createElement("input");return e.setAttribute("type","range"),"text"!==e.type}},function(e,t,o){}],r.c=n,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(o,n,function(e){return t[e]}.bind(null,n));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1);function r(e){if(n[e])return n[e].exports;var t=n[e]={i:e,l:!1,exports:{}};return o[e].call(t.exports,t,t.exports,r),t.l=!0,t.exports}var o,n}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).glMatrix={})}(this,function(e){"use strict";var v="undefined"!=typeof Float32Array?Float32Array:Array,c=Math.random,t=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var o=Object.freeze({__proto__:null,EPSILON:1e-6,get ARRAY_TYPE(){return v},RANDOM:c,setMatrixArrayType:function(e){v=e},toRadian:function(e){return e*t},equals:function(e,t){return Math.abs(e-t)<=1e-6*Math.max(1,Math.abs(e),Math.abs(t))}});function n(e,t,o){var n=t[0],r=t[1],a=t[2],l=t[3],i=o[0],s=o[1],t=o[2],o=o[3];return e[0]=n*i+a*s,e[1]=r*i+l*s,e[2]=n*t+a*o,e[3]=r*t+l*o,e}function r(e,t,o){return e[0]=t[0]-o[0],e[1]=t[1]-o[1],e[2]=t[2]-o[2],e[3]=t[3]-o[3],e}var a=Object.freeze({__proto__:null,create:function(){var e=new v(4);return v!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},clone:function(e){var t=new v(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},fromValues:function(e,t,o,n){var r=new v(4);return r[0]=e,r[1]=t,r[2]=o,r[3]=n,r},set:function(e,t,o,n,r){return e[0]=t,e[1]=o,e[2]=n,e[3]=r,e},transpose:function(e,t){var o;return e===t?(o=t[1],e[1]=t[2],e[2]=o):(e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3]),e},invert:function(e,t){var o=t[0],n=t[1],r=t[2],a=t[3],t=o*a-r*n;return t?(e[0]=a*(t=1/t),e[1]=-n*t,e[2]=-r*t,e[3]=o*t,e):null},adjoint:function(e,t){var o=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=o,e},determinant:function(e){return e[0]*e[3]-e[2]*e[1]},multiply:n,rotate:function(e,t,o){var n=t[0],r=t[1],a=t[2],l=t[3],t=Math.sin(o),o=Math.cos(o);return e[0]=n*o+a*t,e[1]=r*o+l*t,e[2]=n*-t+a*o,e[3]=r*-t+l*o,e},scale:function(e,t,o){var n=t[0],r=t[1],a=t[2],l=t[3],t=o[0],o=o[1];return e[0]=n*t,e[1]=r*t,e[2]=a*o,e[3]=l*o,e},fromRotation:function(e,t){var o=Math.sin(t),t=Math.cos(t);return e[0]=t,e[1]=o,e[2]=-o,e[3]=t,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},str:function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},frob:function(e){return Math.hypot(e[0],e[1],e[2],e[3])},LDU:function(e,t,o,n){return e[2]=n[2]/n[0],o[0]=n[0],o[1]=n[1],o[3]=n[3]-e[2]*o[1],[e,t,o]},add:function(e,t,o){return e[0]=t[0]+o[0],e[1]=t[1]+o[1],e[2]=t[2]+o[2],e[3]=t[3]+o[3],e},subtract:r,exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},equals:function(e,t){var o=e[0],n=e[1],r=e[2],a=e[3],l=t[0],i=t[1],e=t[2],t=t[3];return Math.abs(o-l)<=1e-6*Math.max(1,Math.abs(o),Math.abs(l))&&Math.abs(n-i)<=1e-6*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(r-e)<=1e-6*Math.max(1,Math.abs(r),Math.abs(e))&&Math.abs(a-t)<=1e-6*Math.max(1,Math.abs(a),Math.abs(t))},multiplyScalar:function(e,t,o){return e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e[3]=t[3]*o,e},multiplyScalarAndAdd:function(e,t,o,n){return e[0]=t[0]+o[0]*n,e[1]=t[1]+o[1]*n,e[2]=t[2]+o[2]*n,e[3]=t[3]+o[3]*n,e},mul:n,sub:r});function l(e,t,o){var n=t[0],r=t[1],a=t[2],l=t[3],i=t[4],s=t[5],c=o[0],u=o[1],d=o[2],m=o[3],t=o[4],o=o[5];return e[0]=n*c+a*u,e[1]=r*c+l*u,e[2]=n*d+a*m,e[3]=r*d+l*m,e[4]=n*t+a*o+i,e[5]=r*t+l*o+s,e}function i(e,t,o){return e[0]=t[0]-o[0],e[1]=t[1]-o[1],e[2]=t[2]-o[2],e[3]=t[3]-o[3],e[4]=t[4]-o[4],e[5]=t[5]-o[5],e}var s=Object.freeze({__proto__:null,create:function(){var e=new v(6);return v!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e},clone:function(e){var t=new v(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},fromValues:function(e,t,o,n,r,a){var l=new v(6);return l[0]=e,l[1]=t,l[2]=o,l[3]=n,l[4]=r,l[5]=a,l},set:function(e,t,o,n,r,a,l){return e[0]=t,e[1]=o,e[2]=n,e[3]=r,e[4]=a,e[5]=l,e},invert:function(e,t){var o=t[0],n=t[1],r=t[2],a=t[3],l=t[4],i=t[5],t=o*a-n*r;return t?(e[0]=a*(t=1/t),e[1]=-n*t,e[2]=-r*t,e[3]=o*t,e[4]=(r*i-a*l)*t,e[5]=(n*l-o*i)*t,e):null},determinant:function(e){return e[0]*e[3]-e[1]*e[2]},multiply:l,rotate:function(e,t,o){var n=t[0],r=t[1],a=t[2],l=t[3],i=t[4],s=t[5],t=Math.sin(o),o=Math.cos(o);return e[0]=n*o+a*t,e[1]=r*o+l*t,e[2]=n*-t+a*o,e[3]=r*-t+l*o,e[4]=i,e[5]=s,e},scale:function(e,t,o){var n=t[0],r=t[1],a=t[2],l=t[3],i=t[4],s=t[5],t=o[0],o=o[1];return e[0]=n*t,e[1]=r*t,e[2]=a*o,e[3]=l*o,e[4]=i,e[5]=s,e},translate:function(e,t,o){var n=t[0],r=t[1],a=t[2],l=t[3],i=t[4],s=t[5],t=o[0],o=o[1];return e[0]=n,e[1]=r,e[2]=a,e[3]=l,e[4]=n*t+a*o+i,e[5]=r*t+l*o+s,e},fromRotation:function(e,t){var o=Math.sin(t),t=Math.cos(t);return e[0]=t,e[1]=o,e[2]=-o,e[3]=t,e[4]=0,e[5]=0,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},fromTranslation:function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},str:function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},frob:function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)},add:function(e,t,o){return e[0]=t[0]+o[0],e[1]=t[1]+o[1],e[2]=t[2]+o[2],e[3]=t[3]+o[3],e[4]=t[4]+o[4],e[5]=t[5]+o[5],e},subtract:i,multiplyScalar:function(e,t,o){return e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e[3]=t[3]*o,e[4]=t[4]*o,e[5]=t[5]*o,e},multiplyScalarAndAdd:function(e,t,o,n){return e[0]=t[0]+o[0]*n,e[1]=t[1]+o[1]*n,e[2]=t[2]+o[2]*n,e[3]=t[3]+o[3]*n,e[4]=t[4]+o[4]*n,e[5]=t[5]+o[5]*n,e},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},equals:function(e,t){var o=e[0],n=e[1],r=e[2],a=e[3],l=e[4],i=e[5],s=t[0],c=t[1],u=t[2],d=t[3],e=t[4],t=t[5];return Math.abs(o-s)<=1e-6*Math.max(1,Math.abs(o),Math.abs(s))&&Math.abs(n-c)<=1e-6*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(r-u)<=1e-6*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(a-d)<=1e-6*Math.max(1,Math.abs(a),Math.abs(d))&&Math.abs(l-e)<=1e-6*Math.max(1,Math.abs(l),Math.abs(e))&&Math.abs(i-t)<=1e-6*Math.max(1,Math.abs(i),Math.abs(t))},mul:l,sub:i});function u(){var e=new v(9);return v!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function d(e,t,o){var n=t[0],r=t[1],a=t[2],l=t[3],i=t[4],s=t[5],c=t[6],u=t[7],d=t[8],m=o[0],p=o[1],f=o[2],g=o[3],h=o[4],v=o[5],y=o[6],t=o[7],o=o[8];return e[0]=m*n+p*l+f*c,e[1]=m*r+p*i+f*u,e[2]=m*a+p*s+f*d,e[3]=g*n+h*l+v*c,e[4]=g*r+h*i+v*u,e[5]=g*a+h*s+v*d,e[6]=y*n+t*l+o*c,e[7]=y*r+t*i+o*u,e[8]=y*a+t*s+o*d,e}function m(e,t,o){return e[0]=t[0]-o[0],e[1]=t[1]-o[1],e[2]=t[2]-o[2],e[3]=t[3]-o[3],e[4]=t[4]-o[4],e[5]=t[5]-o[5],e[6]=t[6]-o[6],e[7]=t[7]-o[7],e[8]=t[8]-o[8],e}var p=Object.freeze({__proto__:null,create:u,fromMat4:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},clone:function(e){var t=new v(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},fromValues:function(e,t,o,n,r,a,l,i,s){var c=new v(9);return c[0]=e,c[1]=t,c[2]=o,c[3]=n,c[4]=r,c[5]=a,c[6]=l,c[7]=i,c[8]=s,c},set:function(e,t,o,n,r,a,l,i,s,c){return e[0]=t,e[1]=o,e[2]=n,e[3]=r,e[4]=a,e[5]=l,e[6]=i,e[7]=s,e[8]=c,e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},transpose:function(e,t){var o,n,r;return e===t?(o=t[1],n=t[2],r=t[5],e[1]=t[3],e[2]=t[6],e[3]=o,e[5]=t[7],e[6]=n,e[7]=r):(e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8]),e},invert:function(e,t){var o=t[0],n=t[1],r=t[2],a=t[3],l=t[4],i=t[5],s=t[6],c=t[7],u=t[8],d=u*l-i*c,m=-u*a+i*s,p=c*a-l*s,t=o*d+n*m+r*p;return t?(e[0]=d*(t=1/t),e[1]=(-u*n+r*c)*t,e[2]=(i*n-r*l)*t,e[3]=m*t,e[4]=(u*o-r*s)*t,e[5]=(-i*o+r*a)*t,e[6]=p*t,e[7]=(-c*o+n*s)*t,e[8]=(l*o-n*a)*t,e):null},adjoint:function(e,t){var o=t[0],n=t[1],r=t[2],a=t[3],l=t[4],i=t[5],s=t[6],c=t[7],t=t[8];return e[0]=l*t-i*c,e[1]=r*c-n*t,e[2]=n*i-r*l,e[3]=i*s-a*t,e[4]=o*t-r*s,e[5]=r*a-o*i,e[6]=a*c-l*s,e[7]=n*s-o*c,e[8]=o*l-n*a,e},determinant:function(e){var t=e[0],o=e[1],n=e[2],r=e[3],a=e[4],l=e[5],i=e[6],s=e[7],e=e[8];return t*(e*a-l*s)+o*(-e*r+l*i)+n*(s*r-a*i)},multiply:d,translate:function(e,t,o){var n=t[0],r=t[1],a=t[2],l=t[3],i=t[4],s=t[5],c=t[6],u=t[7],d=t[8],t=o[0],o=o[1];return e[0]=n,e[1]=r,e[2]=a,e[3]=l,e[4]=i,e[5]=s,e[6]=t*n+o*l+c,e[7]=t*r+o*i+u,e[8]=t*a+o*s+d,e},rotate:function(e,t,o){var n=t[0],r=t[1],a=t[2],l=t[3],i=t[4],s=t[5],c=t[6],u=t[7],d=t[8],t=Math.sin(o),o=Math.cos(o);return e[0]=o*n+t*l,e[1]=o*r+t*i,e[2]=o*a+t*s,e[3]=o*l-t*n,e[4]=o*i-t*r,e[5]=o*s-t*a,e[6]=c,e[7]=u,e[8]=d,e},scale:function(e,t,o){var n=o[0],o=o[1];return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=o*t[3],e[4]=o*t[4],e[5]=o*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},fromTranslation:function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},fromRotation:function(e,t){var o=Math.sin(t),t=Math.cos(t);return e[0]=t,e[1]=o,e[2]=0,e[3]=-o,e[4]=t,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromMat2d:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},fromQuat:function(e,t){var o=t[0],n=t[1],r=t[2],a=t[3],l=o+o,i=n+n,s=r+r,c=o*l,u=n*l,t=n*i,o=r*l,n=r*i,r=r*s,l=a*l,i=a*i,s=a*s;return e[0]=1-t-r,e[3]=u-s,e[6]=o+i,e[1]=u+s,e[4]=1-c-r,e[7]=n-l,e[2]=o-i,e[5]=n+l,e[8]=1-c-t,e},normalFromMat4:function(e,t){var o=t[0],n=t[1],r=t[2],a=t[3],l=t[4],i=t[5],s=t[6],c=t[7],u=t[8],d=t[9],m=t[10],p=t[11],f=t[12],g=t[13],h=t[14],v=t[15],y=o*i-n*l,C=o*s-r*l,_=o*c-a*l,E=n*s-r*i,P=n*c-a*i,T=r*c-a*s,b=u*g-d*f,I=u*h-m*f,t=u*v-p*f,u=d*h-m*g,d=d*v-p*g,m=m*v-p*h,p=y*m-C*d+_*u+E*t-P*I+T*b;return p?(e[0]=(i*m-s*d+c*u)*(p=1/p),e[1]=(s*t-l*m-c*I)*p,e[2]=(l*d-i*t+c*b)*p,e[3]=(r*d-n*m-a*u)*p,e[4]=(o*m-r*t+a*I)*p,e[5]=(n*t-o*d-a*b)*p,e[6]=(g*T-h*P+v*E)*p,e[7]=(h*_-f*T-v*C)*p,e[8]=(f*P-g*_+v*y)*p,e):null},projection:function(e,t,o){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/o,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},str:function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},frob:function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},add:function(e,t,o){return e[0]=t[0]+o[0],e[1]=t[1]+o[1],e[2]=t[2]+o[2],e[3]=t[3]+o[3],e[4]=t[4]+o[4],e[5]=t[5]+o[5],e[6]=t[6]+o[6],e[7]=t[7]+o[7],e[8]=t[8]+o[8],e},subtract:m,multiplyScalar:function(e,t,o){return e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e[3]=t[3]*o,e[4]=t[4]*o,e[5]=t[5]*o,e[6]=t[6]*o,e[7]=t[7]*o,e[8]=t[8]*o,e},multiplyScalarAndAdd:function(e,t,o,n){return e[0]=t[0]+o[0]*n,e[1]=t[1]+o[1]*n,e[2]=t[2]+o[2]*n,e[3]=t[3]+o[3]*n,e[4]=t[4]+o[4]*n,e[5]=t[5]+o[5]*n,e[6]=t[6]+o[6]*n,e[7]=t[7]+o[7]*n,e[8]=t[8]+o[8]*n,e},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},equals:function(e,t){var o=e[0],n=e[1],r=e[2],a=e[3],l=e[4],i=e[5],s=e[6],c=e[7],u=e[8],d=t[0],m=t[1],p=t[2],f=t[3],g=t[4],h=t[5],v=t[6],e=t[7],t=t[8];return Math.abs(o-d)<=1e-6*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(n-m)<=1e-6*Math.max(1,Math.abs(n),Math.abs(m))&&Math.abs(r-p)<=1e-6*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(a-f)<=1e-6*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(l-g)<=1e-6*Math.max(1,Math.abs(l),Math.abs(g))&&Math.abs(i-h)<=1e-6*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(s-v)<=1e-6*Math.max(1,Math.abs(s),Math.abs(v))&&Math.abs(c-e)<=1e-6*Math.max(1,Math.abs(c),Math.abs(e))&&Math.abs(u-t)<=1e-6*Math.max(1,Math.abs(u),Math.abs(t))},mul:d,sub:m});function f(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function g(e,t,o){var n=t[0],r=t[1],a=t[2],l=t[3],i=t[4],s=t[5],c=t[6],u=t[7],d=t[8],m=t[9],p=t[10],f=t[11],g=t[12],h=t[13],v=t[14],y=t[15],C=o[0],_=o[1],E=o[2],t=o[3];return e[0]=C*n+_*i+E*d+t*g,e[1]=C*r+_*s+E*m+t*h,e[2]=C*a+_*c+E*p+t*v,e[3]=C*l+_*u+E*f+t*y,C=o[4],_=o[5],E=o[6],t=o[7],e[4]=C*n+_*i+E*d+t*g,e[5]=C*r+_*s+E*m+t*h,e[6]=C*a+_*c+E*p+t*v,e[7]=C*l+_*u+E*f+t*y,C=o[8],_=o[9],E=o[10],t=o[11],e[8]=C*n+_*i+E*d+t*g,e[9]=C*r+_*s+E*m+t*h,e[10]=C*a+_*c+E*p+t*v,e[11]=C*l+_*u+E*f+t*y,C=o[12],_=o[13],E=o[14],t=o[15],e[12]=C*n+_*i+E*d+t*g,e[13]=C*r+_*s+E*m+t*h,e[14]=C*a+_*c+E*p+t*v,e[15]=C*l+_*u+E*f+t*y,e}function h(e,t,o){var n=t[0],r=t[1],a=t[2],l=t[3],i=n+n,s=r+r,c=a+a,u=n*i,d=n*s,t=n*c,n=r*s,r=r*c,a=a*c,i=l*i,s=l*s,c=l*c;return e[0]=1-(n+a),e[1]=d+c,e[2]=t-s,e[3]=0,e[4]=d-c,e[5]=1-(u+a),e[6]=r+i,e[7]=0,e[8]=t+s,e[9]=r-i,e[10]=1-(u+n),e[11]=0,e[12]=o[0],e[13]=o[1],e[14]=o[2],e[15]=1,e}function y(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function C(e,t){var o=t[0],n=t[1],r=t[2],a=t[4],l=t[5],i=t[6],s=t[8],c=t[9],t=t[10];return e[0]=Math.hypot(o,n,r),e[1]=Math.hypot(a,l,i),e[2]=Math.hypot(s,c,t),e}function _(e,t){var o=new v(3);C(o,t);var n=1/o[0],r=1/o[1],a=1/o[2],l=t[0]*n,i=t[1]*r,s=t[2]*a,c=t[4]*n,u=t[5]*r,d=t[6]*a,o=t[8]*n,n=t[9]*r,r=t[10]*a,t=l+u+r,a=0;return 0<t?(a=2*Math.sqrt(1+t),e[3]=.25*a,e[0]=(d-n)/a,e[1]=(o-s)/a,e[2]=(i-c)/a):u<l&&r<l?(a=2*Math.sqrt(1+l-u-r),e[3]=(d-n)/a,e[0]=.25*a,e[1]=(i+c)/a,e[2]=(o+s)/a):r<u?(a=2*Math.sqrt(1+u-l-r),e[3]=(o-s)/a,e[0]=(i+c)/a,e[1]=.25*a,e[2]=(d+n)/a):(a=2*Math.sqrt(1+r-l-u),e[3]=(i-c)/a,e[0]=(o+s)/a,e[1]=(d+n)/a,e[2]=.25*a),e}function E(e,t,o){return e[0]=t[0]-o[0],e[1]=t[1]-o[1],e[2]=t[2]-o[2],e[3]=t[3]-o[3],e[4]=t[4]-o[4],e[5]=t[5]-o[5],e[6]=t[6]-o[6],e[7]=t[7]-o[7],e[8]=t[8]-o[8],e[9]=t[9]-o[9],e[10]=t[10]-o[10],e[11]=t[11]-o[11],e[12]=t[12]-o[12],e[13]=t[13]-o[13],e[14]=t[14]-o[14],e[15]=t[15]-o[15],e}var P=Object.freeze({__proto__:null,create:function(){var e=new v(16);return v!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},clone:function(e){var t=new v(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},fromValues:function(e,t,o,n,r,a,l,i,s,c,u,d,m,p,f,g){var h=new v(16);return h[0]=e,h[1]=t,h[2]=o,h[3]=n,h[4]=r,h[5]=a,h[6]=l,h[7]=i,h[8]=s,h[9]=c,h[10]=u,h[11]=d,h[12]=m,h[13]=p,h[14]=f,h[15]=g,h},set:function(e,t,o,n,r,a,l,i,s,c,u,d,m,p,f,g,h){return e[0]=t,e[1]=o,e[2]=n,e[3]=r,e[4]=a,e[5]=l,e[6]=i,e[7]=s,e[8]=c,e[9]=u,e[10]=d,e[11]=m,e[12]=p,e[13]=f,e[14]=g,e[15]=h,e},identity:f,transpose:function(e,t){var o,n,r,a,l,i;return e===t?(o=t[1],n=t[2],r=t[3],a=t[6],l=t[7],i=t[11],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=o,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=a,e[11]=t[14],e[12]=r,e[13]=l,e[14]=i):(e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15]),e},invert:function(e,t){var o=t[0],n=t[1],r=t[2],a=t[3],l=t[4],i=t[5],s=t[6],c=t[7],u=t[8],d=t[9],m=t[10],p=t[11],f=t[12],g=t[13],h=t[14],v=t[15],y=o*i-n*l,C=o*s-r*l,_=o*c-a*l,E=n*s-r*i,P=n*c-a*i,T=r*c-a*s,b=u*g-d*f,I=u*h-m*f,w=u*v-p*f,A=d*h-m*g,R=d*v-p*g,S=m*v-p*h,t=y*S-C*R+_*A+E*w-P*I+T*b;return t?(e[0]=(i*S-s*R+c*A)*(t=1/t),e[1]=(r*R-n*S-a*A)*t,e[2]=(g*T-h*P+v*E)*t,e[3]=(m*P-d*T-p*E)*t,e[4]=(s*w-l*S-c*I)*t,e[5]=(o*S-r*w+a*I)*t,e[6]=(h*_-f*T-v*C)*t,e[7]=(u*T-m*_+p*C)*t,e[8]=(l*R-i*w+c*b)*t,e[9]=(n*w-o*R-a*b)*t,e[10]=(f*P-g*_+v*y)*t,e[11]=(d*_-u*P-p*y)*t,e[12]=(i*I-l*A-s*b)*t,e[13]=(o*A-n*I+r*b)*t,e[14]=(g*C-f*E-h*y)*t,e[15]=(u*E-d*C+m*y)*t,e):null},adjoint:function(e,t){var o=t[0],n=t[1],r=t[2],a=t[3],l=t[4],i=t[5],s=t[6],c=t[7],u=t[8],d=t[9],m=t[10],p=t[11],f=t[12],g=t[13],h=t[14],t=t[15];return e[0]=i*(m*t-p*h)-d*(s*t-c*h)+g*(s*p-c*m),e[1]=-(n*(m*t-p*h)-d*(r*t-a*h)+g*(r*p-a*m)),e[2]=n*(s*t-c*h)-i*(r*t-a*h)+g*(r*c-a*s),e[3]=-(n*(s*p-c*m)-i*(r*p-a*m)+d*(r*c-a*s)),e[4]=-(l*(m*t-p*h)-u*(s*t-c*h)+f*(s*p-c*m)),e[5]=o*(m*t-p*h)-u*(r*t-a*h)+f*(r*p-a*m),e[6]=-(o*(s*t-c*h)-l*(r*t-a*h)+f*(r*c-a*s)),e[7]=o*(s*p-c*m)-l*(r*p-a*m)+u*(r*c-a*s),e[8]=l*(d*t-p*g)-u*(i*t-c*g)+f*(i*p-c*d),e[9]=-(o*(d*t-p*g)-u*(n*t-a*g)+f*(n*p-a*d)),e[10]=o*(i*t-c*g)-l*(n*t-a*g)+f*(n*c-a*i),e[11]=-(o*(i*p-c*d)-l*(n*p-a*d)+u*(n*c-a*i)),e[12]=-(l*(d*h-m*g)-u*(i*h-s*g)+f*(i*m-s*d)),e[13]=o*(d*h-m*g)-u*(n*h-r*g)+f*(n*m-r*d),e[14]=-(o*(i*h-s*g)-l*(n*h-r*g)+f*(n*s-r*i)),e[15]=o*(i*m-s*d)-l*(n*m-r*d)+u*(n*s-r*i),e},determinant:function(e){var t=e[0],o=e[1],n=e[2],r=e[3],a=e[4],l=e[5],i=e[6],s=e[7],c=e[8],u=e[9],d=e[10],m=e[11],p=e[12],f=e[13],g=e[14],e=e[15];return(t*l-o*a)*(d*e-m*g)-(t*i-n*a)*(u*e-m*f)+(t*s-r*a)*(u*g-d*f)+(o*i-n*l)*(c*e-m*p)-(o*s-r*l)*(c*g-d*p)+(n*s-r*i)*(c*f-u*p)},multiply:g,translate:function(e,t,o){var n,r,a,l,i,s,c,u,d,m,p,f=o[0],g=o[1],h=o[2];return t===e?(e[12]=t[0]*f+t[4]*g+t[8]*h+t[12],e[13]=t[1]*f+t[5]*g+t[9]*h+t[13],e[14]=t[2]*f+t[6]*g+t[10]*h+t[14],e[15]=t[3]*f+t[7]*g+t[11]*h+t[15]):(n=t[0],r=t[1],a=t[2],l=t[3],i=t[4],s=t[5],c=t[6],u=t[7],d=t[8],m=t[9],p=t[10],o=t[11],e[0]=n,e[1]=r,e[2]=a,e[3]=l,e[4]=i,e[5]=s,e[6]=c,e[7]=u,e[8]=d,e[9]=m,e[10]=p,e[11]=o,e[12]=n*f+i*g+d*h+t[12],e[13]=r*f+s*g+m*h+t[13],e[14]=a*f+c*g+p*h+t[14],e[15]=l*f+u*g+o*h+t[15]),e},scale:function(e,t,o){var n=o[0],r=o[1],o=o[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},rotate:function(e,t,o,n){var r,a,l,i,s,c,u,d,m,p,f,g,h,v,y,C,_,E,P,T=n[0],b=n[1],I=n[2],w=Math.hypot(T,b,I);return w<1e-6?null:(T*=w=1/w,b*=w,I*=w,y=Math.sin(o),r=1-(v=Math.cos(o)),a=t[0],l=t[1],i=t[2],s=t[3],c=t[4],u=t[5],d=t[6],m=t[7],p=t[8],f=t[9],g=t[10],h=t[11],C=T*b*r-I*y,_=b*b*r+v,E=I*b*r+T*y,P=T*I*r+b*y,n=b*I*r-T*y,w=I*I*r+v,e[0]=a*(o=T*T*r+v)+c*(v=b*T*r+I*y)+p*(y=I*T*r-b*y),e[1]=l*o+u*v+f*y,e[2]=i*o+d*v+g*y,e[3]=s*o+m*v+h*y,e[4]=a*C+c*_+p*E,e[5]=l*C+u*_+f*E,e[6]=i*C+d*_+g*E,e[7]=s*C+m*_+h*E,e[8]=a*P+c*n+p*w,e[9]=l*P+u*n+f*w,e[10]=i*P+d*n+g*w,e[11]=s*P+m*n+h*w,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},rotateX:function(e,t,o){var n=Math.sin(o),r=Math.cos(o),a=t[4],l=t[5],i=t[6],s=t[7],c=t[8],u=t[9],d=t[10],o=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*r+c*n,e[5]=l*r+u*n,e[6]=i*r+d*n,e[7]=s*r+o*n,e[8]=c*r-a*n,e[9]=u*r-l*n,e[10]=d*r-i*n,e[11]=o*r-s*n,e},rotateY:function(e,t,o){var n=Math.sin(o),r=Math.cos(o),a=t[0],l=t[1],i=t[2],s=t[3],c=t[8],u=t[9],d=t[10],o=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*r-c*n,e[1]=l*r-u*n,e[2]=i*r-d*n,e[3]=s*r-o*n,e[8]=a*n+c*r,e[9]=l*n+u*r,e[10]=i*n+d*r,e[11]=s*n+o*r,e},rotateZ:function(e,t,o){var n=Math.sin(o),r=Math.cos(o),a=t[0],l=t[1],i=t[2],s=t[3],c=t[4],u=t[5],d=t[6],o=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*r+c*n,e[1]=l*r+u*n,e[2]=i*r+d*n,e[3]=s*r+o*n,e[4]=c*r-a*n,e[5]=u*r-l*n,e[6]=d*r-i*n,e[7]=o*r-s*n,e},fromTranslation:function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromRotation:function(e,t,o){var n=o[0],r=o[1],a=o[2],l=Math.hypot(n,r,a);return l<1e-6?null:(n*=l=1/l,r*=l,a*=l,o=Math.sin(t),t=1-(l=Math.cos(t)),e[0]=n*n*t+l,e[1]=r*n*t+a*o,e[2]=a*n*t-r*o,e[3]=0,e[4]=n*r*t-a*o,e[5]=r*r*t+l,e[6]=a*r*t+n*o,e[7]=0,e[8]=n*a*t+r*o,e[9]=r*a*t-n*o,e[10]=a*a*t+l,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},fromXRotation:function(e,t){var o=Math.sin(t),t=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t,e[6]=o,e[7]=0,e[8]=0,e[9]=-o,e[10]=t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromYRotation:function(e,t){var o=Math.sin(t),t=Math.cos(t);return e[0]=t,e[1]=0,e[2]=-o,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=o,e[9]=0,e[10]=t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromZRotation:function(e,t){var o=Math.sin(t),t=Math.cos(t);return e[0]=t,e[1]=o,e[2]=0,e[3]=0,e[4]=-o,e[5]=t,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromRotationTranslation:h,fromQuat2:function(e,t){var o=new v(3),n=-t[0],r=-t[1],a=-t[2],l=t[3],i=t[4],s=t[5],c=t[6],u=t[7],d=n*n+r*r+a*a+l*l;return 0<d?(o[0]=2*(i*l+u*n+s*a-c*r)/d,o[1]=2*(s*l+u*r+c*n-i*a)/d,o[2]=2*(c*l+u*a+i*r-s*n)/d):(o[0]=2*(i*l+u*n+s*a-c*r),o[1]=2*(s*l+u*r+c*n-i*a),o[2]=2*(c*l+u*a+i*r-s*n)),h(e,t,o),e},getTranslation:y,getScaling:C,getRotation:_,fromRotationTranslationScale:function(e,t,o,n){var r=t[0],a=t[1],l=t[2],i=t[3],s=r+r,c=a+a,u=l+l,d=r*s,m=r*c,p=r*u,t=a*c,r=a*u,a=l*u,l=i*s,s=i*c,c=i*u,i=n[0],u=n[1],n=n[2];return e[0]=(1-(t+a))*i,e[1]=(m+c)*i,e[2]=(p-s)*i,e[3]=0,e[4]=(m-c)*u,e[5]=(1-(d+a))*u,e[6]=(r+l)*u,e[7]=0,e[8]=(p+s)*n,e[9]=(r-l)*n,e[10]=(1-(d+t))*n,e[11]=0,e[12]=o[0],e[13]=o[1],e[14]=o[2],e[15]=1,e},fromRotationTranslationScaleOrigin:function(e,t,o,n,r){var a=t[0],l=t[1],i=t[2],s=t[3],c=a+a,u=l+l,d=i+i,m=a*c,p=a*u,f=a*d,g=l*u,h=l*d,v=i*d,y=s*c,t=s*u,a=s*d,l=n[0],i=n[1],c=n[2],u=r[0],s=r[1],d=r[2],n=(1-(g+v))*l,r=(p+a)*l,l=(f-t)*l,a=(p-a)*i,v=(1-(m+v))*i,i=(h+y)*i,t=(f+t)*c,y=(h-y)*c,c=(1-(m+g))*c;return e[0]=n,e[1]=r,e[2]=l,e[3]=0,e[4]=a,e[5]=v,e[6]=i,e[7]=0,e[8]=t,e[9]=y,e[10]=c,e[11]=0,e[12]=o[0]+u-(n*u+a*s+t*d),e[13]=o[1]+s-(r*u+v*s+y*d),e[14]=o[2]+d-(l*u+i*s+c*d),e[15]=1,e},fromQuat:function(e,t){var o=t[0],n=t[1],r=t[2],a=t[3],l=o+o,i=n+n,s=r+r,c=o*l,u=n*l,t=n*i,o=r*l,n=r*i,r=r*s,l=a*l,i=a*i,s=a*s;return e[0]=1-t-r,e[1]=u+s,e[2]=o-i,e[3]=0,e[4]=u-s,e[5]=1-c-r,e[6]=n+l,e[7]=0,e[8]=o+i,e[9]=n-l,e[10]=1-c-t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},frustum:function(e,t,o,n,r,a,l){var i=1/(o-t),s=1/(r-n),c=1/(a-l);return e[0]=2*a*i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*a*s,e[6]=0,e[7]=0,e[8]=(o+t)*i,e[9]=(r+n)*s,e[10]=(l+a)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=l*a*2*c,e[15]=0,e},perspective:function(e,t,o,n,r){var t=1/Math.tan(t/2);return e[0]=t/o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=r&&r!==1/0?(e[10]=(r+n)*(t=1/(n-r)),e[14]=2*r*n*t):(e[10]=-1,e[14]=-2*n),e},perspectiveFromFieldOfView:function(e,t,o,n){var r=Math.tan(t.upDegrees*Math.PI/180),a=Math.tan(t.downDegrees*Math.PI/180),l=Math.tan(t.leftDegrees*Math.PI/180),i=Math.tan(t.rightDegrees*Math.PI/180),s=2/(l+i),t=2/(r+a);return e[0]=s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t,e[6]=0,e[7]=0,e[8]=-(l-i)*s*.5,e[9]=(r-a)*t*.5,e[10]=n/(o-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*o/(o-n),e[15]=0,e},ortho:function(e,t,o,n,r,a,l){var i=1/(t-o),s=1/(n-r),c=1/(a-l);return e[0]=-2*i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+o)*i,e[13]=(r+n)*s,e[14]=(l+a)*c,e[15]=1,e},lookAt:function(e,t,o,n){var r,a=t[0],l=t[1],i=t[2],s=n[0],c=n[1],u=n[2],d=o[0],m=o[1],p=o[2];return Math.abs(a-d)<1e-6&&Math.abs(l-m)<1e-6&&Math.abs(i-p)<1e-6?f(e):(r=a-d,t=l-m,n=i-p,d=c*(n*=o=1/Math.hypot(r,t,n))-u*(t*=o),m=u*(r*=o)-s*n,p=s*t-c*r,(o=Math.hypot(d,m,p))?(d*=o=1/o,m*=o,p*=o):p=m=d=0,u=t*p-n*m,s=n*d-r*p,c=r*m-t*d,(o=Math.hypot(u,s,c))?(u*=o=1/o,s*=o,c*=o):c=s=u=0,e[0]=d,e[1]=u,e[2]=r,e[3]=0,e[4]=m,e[5]=s,e[6]=t,e[7]=0,e[8]=p,e[9]=c,e[10]=n,e[11]=0,e[12]=-(d*a+m*l+p*i),e[13]=-(u*a+s*l+c*i),e[14]=-(r*a+t*l+n*i),e[15]=1,e)},targetTo:function(e,t,o,n){var r=t[0],a=t[1],l=t[2],i=n[0],s=n[1],c=n[2],u=r-o[0],d=a-o[1],t=l-o[2],n=u*u+d*d+t*t;0<n&&(u*=n=1/Math.sqrt(n),d*=n,t*=n);o=s*t-c*d,c=c*u-i*t,s=i*d-s*u;return 0<(n=o*o+c*c+s*s)&&(o*=n=1/Math.sqrt(n),c*=n,s*=n),e[0]=o,e[1]=c,e[2]=s,e[3]=0,e[4]=d*s-t*c,e[5]=t*o-u*s,e[6]=u*c-d*o,e[7]=0,e[8]=u,e[9]=d,e[10]=t,e[11]=0,e[12]=r,e[13]=a,e[14]=l,e[15]=1,e},str:function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},frob:function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},add:function(e,t,o){return e[0]=t[0]+o[0],e[1]=t[1]+o[1],e[2]=t[2]+o[2],e[3]=t[3]+o[3],e[4]=t[4]+o[4],e[5]=t[5]+o[5],e[6]=t[6]+o[6],e[7]=t[7]+o[7],e[8]=t[8]+o[8],e[9]=t[9]+o[9],e[10]=t[10]+o[10],e[11]=t[11]+o[11],e[12]=t[12]+o[12],e[13]=t[13]+o[13],e[14]=t[14]+o[14],e[15]=t[15]+o[15],e},subtract:E,multiplyScalar:function(e,t,o){return e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e[3]=t[3]*o,e[4]=t[4]*o,e[5]=t[5]*o,e[6]=t[6]*o,e[7]=t[7]*o,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12]*o,e[13]=t[13]*o,e[14]=t[14]*o,e[15]=t[15]*o,e},multiplyScalarAndAdd:function(e,t,o,n){return e[0]=t[0]+o[0]*n,e[1]=t[1]+o[1]*n,e[2]=t[2]+o[2]*n,e[3]=t[3]+o[3]*n,e[4]=t[4]+o[4]*n,e[5]=t[5]+o[5]*n,e[6]=t[6]+o[6]*n,e[7]=t[7]+o[7]*n,e[8]=t[8]+o[8]*n,e[9]=t[9]+o[9]*n,e[10]=t[10]+o[10]*n,e[11]=t[11]+o[11]*n,e[12]=t[12]+o[12]*n,e[13]=t[13]+o[13]*n,e[14]=t[14]+o[14]*n,e[15]=t[15]+o[15]*n,e},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},equals:function(e,t){var o=e[0],n=e[1],r=e[2],a=e[3],l=e[4],i=e[5],s=e[6],c=e[7],u=e[8],d=e[9],m=e[10],p=e[11],f=e[12],g=e[13],h=e[14],v=e[15],y=t[0],C=t[1],_=t[2],E=t[3],P=t[4],T=t[5],b=t[6],I=t[7],w=t[8],A=t[9],R=t[10],S=t[11],k=t[12],L=t[13],e=t[14],t=t[15];return Math.abs(o-y)<=1e-6*Math.max(1,Math.abs(o),Math.abs(y))&&Math.abs(n-C)<=1e-6*Math.max(1,Math.abs(n),Math.abs(C))&&Math.abs(r-_)<=1e-6*Math.max(1,Math.abs(r),Math.abs(_))&&Math.abs(a-E)<=1e-6*Math.max(1,Math.abs(a),Math.abs(E))&&Math.abs(l-P)<=1e-6*Math.max(1,Math.abs(l),Math.abs(P))&&Math.abs(i-T)<=1e-6*Math.max(1,Math.abs(i),Math.abs(T))&&Math.abs(s-b)<=1e-6*Math.max(1,Math.abs(s),Math.abs(b))&&Math.abs(c-I)<=1e-6*Math.max(1,Math.abs(c),Math.abs(I))&&Math.abs(u-w)<=1e-6*Math.max(1,Math.abs(u),Math.abs(w))&&Math.abs(d-A)<=1e-6*Math.max(1,Math.abs(d),Math.abs(A))&&Math.abs(m-R)<=1e-6*Math.max(1,Math.abs(m),Math.abs(R))&&Math.abs(p-S)<=1e-6*Math.max(1,Math.abs(p),Math.abs(S))&&Math.abs(f-k)<=1e-6*Math.max(1,Math.abs(f),Math.abs(k))&&Math.abs(g-L)<=1e-6*Math.max(1,Math.abs(g),Math.abs(L))&&Math.abs(h-e)<=1e-6*Math.max(1,Math.abs(h),Math.abs(e))&&Math.abs(v-t)<=1e-6*Math.max(1,Math.abs(v),Math.abs(t))},mul:g,sub:E});function T(){var e=new v(3);return v!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function b(e){var t=e[0],o=e[1],e=e[2];return Math.hypot(t,o,e)}function I(e,t,o){var n=new v(3);return n[0]=e,n[1]=t,n[2]=o,n}function w(e,t,o){return e[0]=t[0]-o[0],e[1]=t[1]-o[1],e[2]=t[2]-o[2],e}function A(e,t,o){return e[0]=t[0]*o[0],e[1]=t[1]*o[1],e[2]=t[2]*o[2],e}function R(e,t,o){return e[0]=t[0]/o[0],e[1]=t[1]/o[1],e[2]=t[2]/o[2],e}function S(e,t){var o=t[0]-e[0],n=t[1]-e[1],e=t[2]-e[2];return Math.hypot(o,n,e)}function k(e,t){var o=t[0]-e[0],n=t[1]-e[1],e=t[2]-e[2];return o*o+n*n+e*e}function L(e){var t=e[0],o=e[1],e=e[2];return t*t+o*o+e*e}function O(e,t){var o=t[0],n=t[1],r=t[2],r=o*o+n*n+r*r;return 0<r&&(r=1/Math.sqrt(r)),e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function M(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function N(e,t,o){var n=t[0],r=t[1],a=t[2],l=o[0],t=o[1],o=o[2];return e[0]=r*o-a*t,e[1]=a*l-n*o,e[2]=n*t-r*l,e}var x,D=w,U=A,H=R,j=S,B=k,z=b,F=L,q=(x=T(),function(e,t,o,n,r,a){var l,i;for(t=t||3,o=o||0,i=n?Math.min(n*t+o,e.length):e.length,l=o;l<i;l+=t)x[0]=e[l],x[1]=e[l+1],x[2]=e[l+2],r(x,x,a),e[l]=x[0],e[l+1]=x[1],e[l+2]=x[2];return e}),W=Object.freeze({__proto__:null,create:T,clone:function(e){var t=new v(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},length:b,fromValues:I,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},set:function(e,t,o,n){return e[0]=t,e[1]=o,e[2]=n,e},add:function(e,t,o){return e[0]=t[0]+o[0],e[1]=t[1]+o[1],e[2]=t[2]+o[2],e},subtract:w,multiply:A,divide:R,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},min:function(e,t,o){return e[0]=Math.min(t[0],o[0]),e[1]=Math.min(t[1],o[1]),e[2]=Math.min(t[2],o[2]),e},max:function(e,t,o){return e[0]=Math.max(t[0],o[0]),e[1]=Math.max(t[1],o[1]),e[2]=Math.max(t[2],o[2]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},scale:function(e,t,o){return e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e},scaleAndAdd:function(e,t,o,n){return e[0]=t[0]+o[0]*n,e[1]=t[1]+o[1]*n,e[2]=t[2]+o[2]*n,e},distance:S,squaredDistance:k,squaredLength:L,negate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},normalize:O,dot:M,cross:N,lerp:function(e,t,o,n){var r=t[0],a=t[1],t=t[2];return e[0]=r+n*(o[0]-r),e[1]=a+n*(o[1]-a),e[2]=t+n*(o[2]-t),e},hermite:function(e,t,o,n,r,a){var l=a*a,i=l*(2*a-3)+1,s=l*(a-2)+a,c=l*(a-1),a=l*(3-2*a);return e[0]=t[0]*i+o[0]*s+n[0]*c+r[0]*a,e[1]=t[1]*i+o[1]*s+n[1]*c+r[1]*a,e[2]=t[2]*i+o[2]*s+n[2]*c+r[2]*a,e},bezier:function(e,t,o,n,r,a){var l=1-a,i=l*l,s=a*a,c=i*l,i=3*a*i,l=3*s*l,a=s*a;return e[0]=t[0]*c+o[0]*i+n[0]*l+r[0]*a,e[1]=t[1]*c+o[1]*i+n[1]*l+r[1]*a,e[2]=t[2]*c+o[2]*i+n[2]*l+r[2]*a,e},random:function(e,t){t=t||1;var o=2*c()*Math.PI,n=2*c()-1,r=Math.sqrt(1-n*n)*t;return e[0]=Math.cos(o)*r,e[1]=Math.sin(o)*r,e[2]=n*t,e},transformMat4:function(e,t,o){var n=t[0],r=t[1],a=t[2],t=o[3]*n+o[7]*r+o[11]*a+o[15];return e[0]=(o[0]*n+o[4]*r+o[8]*a+o[12])/(t=t||1),e[1]=(o[1]*n+o[5]*r+o[9]*a+o[13])/t,e[2]=(o[2]*n+o[6]*r+o[10]*a+o[14])/t,e},transformMat3:function(e,t,o){var n=t[0],r=t[1],t=t[2];return e[0]=n*o[0]+r*o[3]+t*o[6],e[1]=n*o[1]+r*o[4]+t*o[7],e[2]=n*o[2]+r*o[5]+t*o[8],e},transformQuat:function(e,t,o){var n=o[0],r=o[1],a=o[2],l=o[3],i=t[0],s=t[1],c=t[2],u=r*c-a*s,d=a*i-n*c,o=n*s-r*i,t=r*o-a*d,a=a*u-n*o,r=n*d-r*u,l=2*l;return d*=l,o*=l,a*=2,r*=2,e[0]=i+(u*=l)+(t*=2),e[1]=s+d+a,e[2]=c+o+r,e},rotateX:function(e,t,o,n){var r=[],a=[];return r[0]=t[0]-o[0],r[1]=t[1]-o[1],r[2]=t[2]-o[2],a[0]=r[0],a[1]=r[1]*Math.cos(n)-r[2]*Math.sin(n),a[2]=r[1]*Math.sin(n)+r[2]*Math.cos(n),e[0]=a[0]+o[0],e[1]=a[1]+o[1],e[2]=a[2]+o[2],e},rotateY:function(e,t,o,n){var r=[],a=[];return r[0]=t[0]-o[0],r[1]=t[1]-o[1],r[2]=t[2]-o[2],a[0]=r[2]*Math.sin(n)+r[0]*Math.cos(n),a[1]=r[1],a[2]=r[2]*Math.cos(n)-r[0]*Math.sin(n),e[0]=a[0]+o[0],e[1]=a[1]+o[1],e[2]=a[2]+o[2],e},rotateZ:function(e,t,o,n){var r=[],a=[];return r[0]=t[0]-o[0],r[1]=t[1]-o[1],r[2]=t[2]-o[2],a[0]=r[0]*Math.cos(n)-r[1]*Math.sin(n),a[1]=r[0]*Math.sin(n)+r[1]*Math.cos(n),a[2]=r[2],e[0]=a[0]+o[0],e[1]=a[1]+o[1],e[2]=a[2]+o[2],e},angle:function(e,t){var o=e[0],n=e[1],r=e[2],a=t[0],l=t[1],i=t[2],i=Math.sqrt(o*o+n*n+r*r)*Math.sqrt(a*a+l*l+i*i),i=i&&M(e,t)/i;return Math.acos(Math.min(Math.max(i,-1),1))},zero:function(e){return e[0]=0,e[1]=0,e[2]=0,e},str:function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},equals:function(e,t){var o=e[0],n=e[1],r=e[2],a=t[0],e=t[1],t=t[2];return Math.abs(o-a)<=1e-6*Math.max(1,Math.abs(o),Math.abs(a))&&Math.abs(n-e)<=1e-6*Math.max(1,Math.abs(n),Math.abs(e))&&Math.abs(r-t)<=1e-6*Math.max(1,Math.abs(r),Math.abs(t))},sub:D,mul:U,div:H,dist:j,sqrDist:B,len:z,sqrLen:F,forEach:q});function V(){var e=new v(4);return v!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function G(e){var t=new v(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function $(e,t,o,n){var r=new v(4);return r[0]=e,r[1]=t,r[2]=o,r[3]=n,r}function J(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Z(e,t,o,n,r){return e[0]=t,e[1]=o,e[2]=n,e[3]=r,e}function X(e,t,o){return e[0]=t[0]+o[0],e[1]=t[1]+o[1],e[2]=t[2]+o[2],e[3]=t[3]+o[3],e}function Y(e,t,o){return e[0]=t[0]-o[0],e[1]=t[1]-o[1],e[2]=t[2]-o[2],e[3]=t[3]-o[3],e}function K(e,t,o){return e[0]=t[0]*o[0],e[1]=t[1]*o[1],e[2]=t[2]*o[2],e[3]=t[3]*o[3],e}function Q(e,t,o){return e[0]=t[0]/o[0],e[1]=t[1]/o[1],e[2]=t[2]/o[2],e[3]=t[3]/o[3],e}function ee(e,t,o){return e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e[3]=t[3]*o,e}function te(e,t){var o=t[0]-e[0],n=t[1]-e[1],r=t[2]-e[2],e=t[3]-e[3];return Math.hypot(o,n,r,e)}function oe(e,t){var o=t[0]-e[0],n=t[1]-e[1],r=t[2]-e[2],e=t[3]-e[3];return o*o+n*n+r*r+e*e}function ne(e){var t=e[0],o=e[1],n=e[2],e=e[3];return Math.hypot(t,o,n,e)}function re(e){var t=e[0],o=e[1],n=e[2],e=e[3];return t*t+o*o+n*n+e*e}function ae(e,t){var o=t[0],n=t[1],r=t[2],a=t[3],t=o*o+n*n+r*r+a*a;return 0<t&&(t=1/Math.sqrt(t)),e[0]=o*t,e[1]=n*t,e[2]=r*t,e[3]=a*t,e}function le(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function ie(e,t,o,n){var r=t[0],a=t[1],l=t[2],t=t[3];return e[0]=r+n*(o[0]-r),e[1]=a+n*(o[1]-a),e[2]=l+n*(o[2]-l),e[3]=t+n*(o[3]-t),e}function se(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function ce(e,t){var o=e[0],n=e[1],r=e[2],a=e[3],l=t[0],i=t[1],e=t[2],t=t[3];return Math.abs(o-l)<=1e-6*Math.max(1,Math.abs(o),Math.abs(l))&&Math.abs(n-i)<=1e-6*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(r-e)<=1e-6*Math.max(1,Math.abs(r),Math.abs(e))&&Math.abs(a-t)<=1e-6*Math.max(1,Math.abs(a),Math.abs(t))}var ue,de=Y,me=K,pe=Q,fe=te,ge=oe,he=ne,ve=re,ye=(ue=V(),function(e,t,o,n,r,a){var l,i;for(t=t||4,o=o||0,i=n?Math.min(n*t+o,e.length):e.length,l=o;l<i;l+=t)ue[0]=e[l],ue[1]=e[l+1],ue[2]=e[l+2],ue[3]=e[l+3],r(ue,ue,a),e[l]=ue[0],e[l+1]=ue[1],e[l+2]=ue[2],e[l+3]=ue[3];return e}),Ce=Object.freeze({__proto__:null,create:V,clone:G,fromValues:$,copy:J,set:Z,add:X,subtract:Y,multiply:K,divide:Q,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},min:function(e,t,o){return e[0]=Math.min(t[0],o[0]),e[1]=Math.min(t[1],o[1]),e[2]=Math.min(t[2],o[2]),e[3]=Math.min(t[3],o[3]),e},max:function(e,t,o){return e[0]=Math.max(t[0],o[0]),e[1]=Math.max(t[1],o[1]),e[2]=Math.max(t[2],o[2]),e[3]=Math.max(t[3],o[3]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},scale:ee,scaleAndAdd:function(e,t,o,n){return e[0]=t[0]+o[0]*n,e[1]=t[1]+o[1]*n,e[2]=t[2]+o[2]*n,e[3]=t[3]+o[3]*n,e},distance:te,squaredDistance:oe,length:ne,squaredLength:re,negate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},normalize:ae,dot:le,cross:function(e,t,o,n){var r=o[0]*n[1]-o[1]*n[0],a=o[0]*n[2]-o[2]*n[0],l=o[0]*n[3]-o[3]*n[0],i=o[1]*n[2]-o[2]*n[1],s=o[1]*n[3]-o[3]*n[1],c=o[2]*n[3]-o[3]*n[2],u=t[0],o=t[1],n=t[2],t=t[3];return e[0]=o*c-n*s+t*i,e[1]=-u*c+n*l-t*a,e[2]=u*s-o*l+t*r,e[3]=-u*i+o*a-n*r,e},lerp:ie,random:function(e,t){var o,n,r,a,l,i;for(t=t||1;1<=(l=(o=2*c()-1)*o+(n=2*c()-1)*n););for(;1<=(i=(r=2*c()-1)*r+(a=2*c()-1)*a););var s=Math.sqrt((1-l)/i);return e[0]=t*o,e[1]=t*n,e[2]=t*r*s,e[3]=t*a*s,e},transformMat4:function(e,t,o){var n=t[0],r=t[1],a=t[2],t=t[3];return e[0]=o[0]*n+o[4]*r+o[8]*a+o[12]*t,e[1]=o[1]*n+o[5]*r+o[9]*a+o[13]*t,e[2]=o[2]*n+o[6]*r+o[10]*a+o[14]*t,e[3]=o[3]*n+o[7]*r+o[11]*a+o[15]*t,e},transformQuat:function(e,t,o){var n=t[0],r=t[1],a=t[2],l=o[0],i=o[1],s=o[2],c=o[3],u=c*n+i*a-s*r,d=c*r+s*n-l*a,o=c*a+l*r-i*n,a=-l*n-i*r-s*a;return e[0]=u*c+a*-l+d*-s-o*-i,e[1]=d*c+a*-i+o*-l-u*-s,e[2]=o*c+a*-s+u*-i-d*-l,e[3]=t[3],e},zero:function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},str:function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},exactEquals:se,equals:ce,sub:de,mul:me,div:pe,dist:fe,sqrDist:ge,len:he,sqrLen:ve,forEach:ye});function _e(){var e=new v(4);return v!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Ee(e,t,o){o*=.5;var n=Math.sin(o);return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(o),e}function Pe(e,t,o){var n=t[0],r=t[1],a=t[2],l=t[3],i=o[0],s=o[1],t=o[2],o=o[3];return e[0]=n*o+l*i+r*t-a*s,e[1]=r*o+l*s+a*i-n*t,e[2]=a*o+l*t+n*s-r*i,e[3]=l*o-n*i-r*s-a*t,e}function Te(e,t,o){o*=.5;var n=t[0],r=t[1],a=t[2],l=t[3],t=Math.sin(o),o=Math.cos(o);return e[0]=n*o+l*t,e[1]=r*o+a*t,e[2]=a*o-r*t,e[3]=l*o-n*t,e}function be(e,t,o){o*=.5;var n=t[0],r=t[1],a=t[2],l=t[3],t=Math.sin(o),o=Math.cos(o);return e[0]=n*o-a*t,e[1]=r*o+l*t,e[2]=a*o+n*t,e[3]=l*o-r*t,e}function Ie(e,t,o){o*=.5;var n=t[0],r=t[1],a=t[2],l=t[3],t=Math.sin(o),o=Math.cos(o);return e[0]=n*o+r*t,e[1]=r*o-n*t,e[2]=a*o+l*t,e[3]=l*o-a*t,e}function we(e,t){var o=t[0],n=t[1],r=t[2],a=t[3],l=Math.sqrt(o*o+n*n+r*r),t=Math.exp(a),a=0<l?t*Math.sin(l)/l:0;return e[0]=o*a,e[1]=n*a,e[2]=r*a,e[3]=t*Math.cos(l),e}function Ae(e,t){var o=t[0],n=t[1],r=t[2],a=t[3],t=Math.sqrt(o*o+n*n+r*r),t=0<t?Math.atan2(t,a)/t:0;return e[0]=o*t,e[1]=n*t,e[2]=r*t,e[3]=.5*Math.log(o*o+n*n+r*r+a*a),e}function Re(e,t,o,n){var r,a=t[0],l=t[1],i=t[2],s=t[3],c=o[0],u=o[1],d=o[2],m=o[3];return(t=a*c+l*u+i*d+s*m)<0&&(t=-t,c=-c,u=-u,d=-d,m=-m),n=1e-6<1-t?(o=Math.acos(t),t=Math.sin(o),r=Math.sin((1-n)*o)/t,Math.sin(n*o)/t):(r=1-n,n),e[0]=r*a+n*c,e[1]=r*l+n*u,e[2]=r*i+n*d,e[3]=r*s+n*m,e}function Se(e,t){var o,n,r,a=t[0]+t[4]+t[8];return 0<a?(r=Math.sqrt(a+1),e[3]=.5*r,e[0]=(t[5]-t[7])*(r=.5/r),e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r):(t[4]>t[o=0]&&(o=1),n=((o=t[8]>t[3*o+o]?2:o)+1)%3,a=(o+2)%3,r=Math.sqrt(t[3*o+o]-t[3*n+n]-t[3*a+a]+1),e[o]=.5*r,e[3]=(t[3*n+a]-t[3*a+n])*(r=.5/r),e[n]=(t[3*n+o]+t[3*o+n])*r,e[a]=(t[3*a+o]+t[3*o+a])*r),e}var ke,Le,Oe,Me,Ne,xe,De=G,D=$,U=J,H=Z,j=X,B=Pe,Ue=ee,He=le,F=ie,q=ne,de=q,me=re,pe=me,je=ae,fe=se,ge=ce,he=(ke=T(),Le=I(1,0,0),Oe=I(0,1,0),function(e,t,o){var n=M(t,o);return n<-.999999?(N(ke,Le,t),z(ke)<1e-6&&N(ke,Oe,t),O(ke,ke),Ee(e,ke,Math.PI),e):.999999<n?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(N(ke,t,o),e[0]=ke[0],e[1]=ke[1],e[2]=ke[2],e[3]=1+n,je(e,e))}),ve=(Me=_e(),Ne=_e(),function(e,t,o,n,r,a){return Re(Me,t,r,a),Re(Ne,o,n,a),Re(e,Me,Ne,2*a*(1-a)),e}),ye=(xe=u(),function(e,t,o,n){return xe[0]=o[0],xe[3]=o[1],xe[6]=o[2],xe[1]=n[0],xe[4]=n[1],xe[7]=n[2],xe[2]=-t[0],xe[5]=-t[1],xe[8]=-t[2],je(e,Se(e,xe))}),de=Object.freeze({__proto__:null,create:_e,identity:function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},setAxisAngle:Ee,getAxisAngle:function(e,t){var o=2*Math.acos(t[3]),n=Math.sin(o/2);return 1e-6<n?(e[0]=t[0]/n,e[1]=t[1]/n,e[2]=t[2]/n):(e[0]=1,e[1]=0,e[2]=0),o},getAngle:function(e,t){t=He(e,t);return Math.acos(2*t*t-1)},multiply:Pe,rotateX:Te,rotateY:be,rotateZ:Ie,calculateW:function(e,t){var o=t[0],n=t[1],t=t[2];return e[0]=o,e[1]=n,e[2]=t,e[3]=Math.sqrt(Math.abs(1-o*o-n*n-t*t)),e},exp:we,ln:Ae,pow:function(e,t,o){return Ae(e,t),Ue(e,e,o),we(e,e),e},slerp:Re,random:function(e){var t=c(),o=c(),n=c(),r=Math.sqrt(1-t),t=Math.sqrt(t);return e[0]=r*Math.sin(2*Math.PI*o),e[1]=r*Math.cos(2*Math.PI*o),e[2]=t*Math.sin(2*Math.PI*n),e[3]=t*Math.cos(2*Math.PI*n),e},invert:function(e,t){var o=t[0],n=t[1],r=t[2],a=t[3],t=o*o+n*n+r*r+a*a,t=t?1/t:0;return e[0]=-o*t,e[1]=-n*t,e[2]=-r*t,e[3]=a*t,e},conjugate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},fromMat3:Se,fromEuler:function(e,t,o,n){var r=.5*Math.PI/180;t*=r,o*=r,n*=r;var a=Math.sin(t),l=Math.cos(t),r=Math.sin(o),t=Math.cos(o),o=Math.sin(n),n=Math.cos(n);return e[0]=a*t*n-l*r*o,e[1]=l*r*n+a*t*o,e[2]=l*t*o-a*r*n,e[3]=l*t*n+a*r*o,e},str:function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},clone:De,fromValues:D,copy:U,set:H,add:j,mul:B,scale:Ue,dot:He,lerp:F,length:q,len:de,squaredLength:me,sqrLen:pe,normalize:je,exactEquals:fe,equals:ge,rotationTo:he,sqlerp:ve,setAxes:ye});function Be(e,t,o){var n=.5*o[0],r=.5*o[1],a=.5*o[2],l=t[0],i=t[1],o=t[2],t=t[3];return e[0]=l,e[1]=i,e[2]=o,e[3]=t,e[4]=n*t+r*o-a*i,e[5]=r*t+a*l-n*o,e[6]=a*t+n*i-r*l,e[7]=-n*l-r*i-a*o,e}function ze(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function Fe(e,t,o){var n=t[0],r=t[1],a=t[2],l=t[3],i=o[4],s=o[5],c=o[6],u=o[7],d=t[4],m=t[5],p=t[6],f=t[7],g=o[0],h=o[1],t=o[2],o=o[3];return e[0]=n*o+l*g+r*t-a*h,e[1]=r*o+l*h+a*g-n*t,e[2]=a*o+l*t+n*h-r*g,e[3]=l*o-n*g-r*h-a*t,e[4]=n*u+l*i+r*c-a*s+d*o+f*g+m*t-p*h,e[5]=r*u+l*s+a*i-n*c+m*o+f*h+p*g-d*t,e[6]=a*u+l*c+n*s-r*i+p*o+f*t+d*h-m*g,e[7]=l*u-n*i-r*s-a*c+f*o-d*g-m*h-p*t,e}var qe=He,We=me,pe=Object.freeze({__proto__:null,create:function(){var e=new v(8);return v!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e},clone:function(e){var t=new v(8);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t},fromValues:function(e,t,o,n,r,a,l,i){var s=new v(8);return s[0]=e,s[1]=t,s[2]=o,s[3]=n,s[4]=r,s[5]=a,s[6]=l,s[7]=i,s},fromRotationTranslationValues:function(e,t,o,n,r,a,l){var i=new v(8);i[0]=e,i[1]=t,i[2]=o,i[3]=n;r*=.5,a*=.5,l*=.5;return i[4]=r*n+a*o-l*t,i[5]=a*n+l*e-r*o,i[6]=l*n+r*t-a*e,i[7]=-r*e-a*t-l*o,i},fromRotationTranslation:Be,fromTranslation:function(e,t){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=.5*t[0],e[5]=.5*t[1],e[6]=.5*t[2],e[7]=0,e},fromRotation:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},fromMat4:function(e,t){var o=_e();_(o,t);var n=new v(3);return y(n,t),Be(e,o,n),e},copy:ze,identity:function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},set:function(e,t,o,n,r,a,l,i,s){return e[0]=t,e[1]=o,e[2]=n,e[3]=r,e[4]=a,e[5]=l,e[6]=i,e[7]=s,e},getReal:U,getDual:function(e,t){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7],e},setReal:U,setDual:function(e,t){return e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=t[3],e},getTranslation:function(e,t){var o=t[4],n=t[5],r=t[6],a=t[7],l=-t[0],i=-t[1],s=-t[2],t=t[3];return e[0]=2*(o*t+a*l+n*s-r*i),e[1]=2*(n*t+a*i+r*l-o*s),e[2]=2*(r*t+a*s+o*i-n*l),e},translate:function(e,t,o){var n=t[0],r=t[1],a=t[2],l=t[3],i=.5*o[0],s=.5*o[1],c=.5*o[2],u=t[4],d=t[5],o=t[6],t=t[7];return e[0]=n,e[1]=r,e[2]=a,e[3]=l,e[4]=l*i+r*c-a*s+u,e[5]=l*s+a*i-n*c+d,e[6]=l*c+n*s-r*i+o,e[7]=-n*i-r*s-a*c+t,e},rotateX:function(e,t,o){var n=-t[0],r=-t[1],a=-t[2],l=t[3],i=t[4],s=t[5],c=t[6],u=t[7],d=i*l+u*n+s*a-c*r,m=s*l+u*r+c*n-i*a,p=c*l+u*a+i*r-s*n,c=u*l-i*n-s*r-c*a;return Te(e,t,o),n=e[0],r=e[1],a=e[2],l=e[3],e[4]=d*l+c*n+m*a-p*r,e[5]=m*l+c*r+p*n-d*a,e[6]=p*l+c*a+d*r-m*n,e[7]=c*l-d*n-m*r-p*a,e},rotateY:function(e,t,o){var n=-t[0],r=-t[1],a=-t[2],l=t[3],i=t[4],s=t[5],c=t[6],u=t[7],d=i*l+u*n+s*a-c*r,m=s*l+u*r+c*n-i*a,p=c*l+u*a+i*r-s*n,c=u*l-i*n-s*r-c*a;return be(e,t,o),n=e[0],r=e[1],a=e[2],l=e[3],e[4]=d*l+c*n+m*a-p*r,e[5]=m*l+c*r+p*n-d*a,e[6]=p*l+c*a+d*r-m*n,e[7]=c*l-d*n-m*r-p*a,e},rotateZ:function(e,t,o){var n=-t[0],r=-t[1],a=-t[2],l=t[3],i=t[4],s=t[5],c=t[6],u=t[7],d=i*l+u*n+s*a-c*r,m=s*l+u*r+c*n-i*a,p=c*l+u*a+i*r-s*n,c=u*l-i*n-s*r-c*a;return Ie(e,t,o),n=e[0],r=e[1],a=e[2],l=e[3],e[4]=d*l+c*n+m*a-p*r,e[5]=m*l+c*r+p*n-d*a,e[6]=p*l+c*a+d*r-m*n,e[7]=c*l-d*n-m*r-p*a,e},rotateByQuatAppend:function(e,t,o){var n=o[0],r=o[1],a=o[2],l=o[3],i=t[0],s=t[1],c=t[2],o=t[3];return e[0]=i*l+o*n+s*a-c*r,e[1]=s*l+o*r+c*n-i*a,e[2]=c*l+o*a+i*r-s*n,e[3]=o*l-i*n-s*r-c*a,i=t[4],s=t[5],c=t[6],o=t[7],e[4]=i*l+o*n+s*a-c*r,e[5]=s*l+o*r+c*n-i*a,e[6]=c*l+o*a+i*r-s*n,e[7]=o*l-i*n-s*r-c*a,e},rotateByQuatPrepend:function(e,t,o){var n=t[0],r=t[1],a=t[2],l=t[3],i=o[0],s=o[1],c=o[2],t=o[3];return e[0]=n*t+l*i+r*c-a*s,e[1]=r*t+l*s+a*i-n*c,e[2]=a*t+l*c+n*s-r*i,e[3]=l*t-n*i-r*s-a*c,i=o[4],s=o[5],c=o[6],t=o[7],e[4]=n*t+l*i+r*c-a*s,e[5]=r*t+l*s+a*i-n*c,e[6]=a*t+l*c+n*s-r*i,e[7]=l*t-n*i-r*s-a*c,e},rotateAroundAxis:function(e,t,o,n){if(Math.abs(n)<1e-6)return ze(e,t);var r=Math.hypot(o[0],o[1],o[2]);n*=.5;var a=Math.sin(n),l=a*o[0]/r,i=a*o[1]/r,s=a*o[2]/r,c=Math.cos(n),a=t[0],o=t[1],r=t[2],n=t[3];e[0]=a*c+n*l+o*s-r*i,e[1]=o*c+n*i+r*l-a*s,e[2]=r*c+n*s+a*i-o*l,e[3]=n*c-a*l-o*i-r*s;a=t[4],o=t[5],r=t[6],t=t[7];return e[4]=a*c+t*l+o*s-r*i,e[5]=o*c+t*i+r*l-a*s,e[6]=r*c+t*s+a*i-o*l,e[7]=t*c-a*l-o*i-r*s,e},add:function(e,t,o){return e[0]=t[0]+o[0],e[1]=t[1]+o[1],e[2]=t[2]+o[2],e[3]=t[3]+o[3],e[4]=t[4]+o[4],e[5]=t[5]+o[5],e[6]=t[6]+o[6],e[7]=t[7]+o[7],e},multiply:Fe,mul:Fe,scale:function(e,t,o){return e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e[3]=t[3]*o,e[4]=t[4]*o,e[5]=t[5]*o,e[6]=t[6]*o,e[7]=t[7]*o,e},dot:qe,lerp:function(e,t,o,n){var r=1-n;return qe(t,o)<0&&(n=-n),e[0]=t[0]*r+o[0]*n,e[1]=t[1]*r+o[1]*n,e[2]=t[2]*r+o[2]*n,e[3]=t[3]*r+o[3]*n,e[4]=t[4]*r+o[4]*n,e[5]=t[5]*r+o[5]*n,e[6]=t[6]*r+o[6]*n,e[7]=t[7]*r+o[7]*n,e},invert:function(e,t){var o=We(t);return e[0]=-t[0]/o,e[1]=-t[1]/o,e[2]=-t[2]/o,e[3]=t[3]/o,e[4]=-t[4]/o,e[5]=-t[5]/o,e[6]=-t[6]/o,e[7]=t[7]/o,e},conjugate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=t[7],e},length:q,len:q,squaredLength:We,sqrLen:We,normalize:function(e,t){var o,n,r,a,l,i,s,c,u=We(t);return 0<u&&(u=Math.sqrt(u),o=t[0]/u,n=t[1]/u,r=t[2]/u,a=t[3]/u,t=o*(l=t[4])+n*(i=t[5])+r*(s=t[6])+a*(c=t[7]),e[0]=o,e[1]=n,e[2]=r,e[3]=a,e[4]=(l-o*t)/u,e[5]=(i-n*t)/u,e[6]=(s-r*t)/u,e[7]=(c-a*t)/u),e},str:function(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]},equals:function(e,t){var o=e[0],n=e[1],r=e[2],a=e[3],l=e[4],i=e[5],s=e[6],c=e[7],u=t[0],d=t[1],m=t[2],p=t[3],f=t[4],g=t[5],e=t[6],t=t[7];return Math.abs(o-u)<=1e-6*Math.max(1,Math.abs(o),Math.abs(u))&&Math.abs(n-d)<=1e-6*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(r-m)<=1e-6*Math.max(1,Math.abs(r),Math.abs(m))&&Math.abs(a-p)<=1e-6*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(l-f)<=1e-6*Math.max(1,Math.abs(l),Math.abs(f))&&Math.abs(i-g)<=1e-6*Math.max(1,Math.abs(i),Math.abs(g))&&Math.abs(s-e)<=1e-6*Math.max(1,Math.abs(s),Math.abs(e))&&Math.abs(c-t)<=1e-6*Math.max(1,Math.abs(c),Math.abs(t))}});function Ve(){var e=new v(2);return v!=Float32Array&&(e[0]=0,e[1]=0),e}function Ge(e,t,o){return e[0]=t[0]-o[0],e[1]=t[1]-o[1],e}function $e(e,t,o){return e[0]=t[0]*o[0],e[1]=t[1]*o[1],e}function Je(e,t,o){return e[0]=t[0]/o[0],e[1]=t[1]/o[1],e}function Ze(e,t){var o=t[0]-e[0],e=t[1]-e[1];return Math.hypot(o,e)}function Xe(e,t){var o=t[0]-e[0],e=t[1]-e[1];return o*o+e*e}function Ye(e){var t=e[0],e=e[1];return Math.hypot(t,e)}function Ke(e){var t=e[0],e=e[1];return t*t+e*e}var Qe,fe=Ye,ge=Ge,he=$e,ve=Je,ye=Ze,me=Xe,U=Ke,q=(Qe=Ve(),function(e,t,o,n,r,a){var l,i;for(t=t||2,o=o||0,i=n?Math.min(n*t+o,e.length):e.length,l=o;l<i;l+=t)Qe[0]=e[l],Qe[1]=e[l+1],r(Qe,Qe,a),e[l]=Qe[0],e[l+1]=Qe[1];return e}),q=Object.freeze({__proto__:null,create:Ve,clone:function(e){var t=new v(2);return t[0]=e[0],t[1]=e[1],t},fromValues:function(e,t){var o=new v(2);return o[0]=e,o[1]=t,o},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e},set:function(e,t,o){return e[0]=t,e[1]=o,e},add:function(e,t,o){return e[0]=t[0]+o[0],e[1]=t[1]+o[1],e},subtract:Ge,multiply:$e,divide:Je,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},min:function(e,t,o){return e[0]=Math.min(t[0],o[0]),e[1]=Math.min(t[1],o[1]),e},max:function(e,t,o){return e[0]=Math.max(t[0],o[0]),e[1]=Math.max(t[1],o[1]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},scale:function(e,t,o){return e[0]=t[0]*o,e[1]=t[1]*o,e},scaleAndAdd:function(e,t,o,n){return e[0]=t[0]+o[0]*n,e[1]=t[1]+o[1]*n,e},distance:Ze,squaredDistance:Xe,length:Ye,squaredLength:Ke,negate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e},inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},normalize:function(e,t){var o=t[0],n=t[1],n=o*o+n*n;return 0<n&&(n=1/Math.sqrt(n)),e[0]=t[0]*n,e[1]=t[1]*n,e},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]},cross:function(e,t,o){o=t[0]*o[1]-t[1]*o[0];return e[0]=e[1]=0,e[2]=o,e},lerp:function(e,t,o,n){var r=t[0],t=t[1];return e[0]=r+n*(o[0]-r),e[1]=t+n*(o[1]-t),e},random:function(e,t){t=t||1;var o=2*c()*Math.PI;return e[0]=Math.cos(o)*t,e[1]=Math.sin(o)*t,e},transformMat2:function(e,t,o){var n=t[0],t=t[1];return e[0]=o[0]*n+o[2]*t,e[1]=o[1]*n+o[3]*t,e},transformMat2d:function(e,t,o){var n=t[0],t=t[1];return e[0]=o[0]*n+o[2]*t+o[4],e[1]=o[1]*n+o[3]*t+o[5],e},transformMat3:function(e,t,o){var n=t[0],t=t[1];return e[0]=o[0]*n+o[3]*t+o[6],e[1]=o[1]*n+o[4]*t+o[7],e},transformMat4:function(e,t,o){var n=t[0],t=t[1];return e[0]=o[0]*n+o[4]*t+o[12],e[1]=o[1]*n+o[5]*t+o[13],e},rotate:function(e,t,o,n){var r=t[0]-o[0],a=t[1]-o[1],t=Math.sin(n),n=Math.cos(n);return e[0]=r*n-a*t+o[0],e[1]=r*t+a*n+o[1],e},angle:function(e,t){var o=e[0],n=e[1],r=t[0],e=t[1],t=Math.sqrt(o*o+n*n)*Math.sqrt(r*r+e*e);return Math.acos(Math.min(Math.max(t&&(o*r+n*e)/t,-1),1))},zero:function(e){return e[0]=0,e[1]=0,e},str:function(e){return"vec2("+e[0]+", "+e[1]+")"},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]},equals:function(e,t){var o=e[0],n=e[1],e=t[0],t=t[1];return Math.abs(o-e)<=1e-6*Math.max(1,Math.abs(o),Math.abs(e))&&Math.abs(n-t)<=1e-6*Math.max(1,Math.abs(n),Math.abs(t))},len:fe,sub:ge,mul:he,div:ve,dist:ye,sqrDist:me,sqrLen:U,forEach:q});e.glMatrix=o,e.mat2=a,e.mat2d=s,e.mat3=p,e.mat4=P,e.quat=de,e.quat2=pe,e.vec2=q,e.vec3=W,e.vec4=Ce,Object.defineProperty(e,"__esModule",{value:!0})}),window.CloudStreamerSDK=function(e,t){console.log(t);var n=this;n.options=t||{},n.conn=null,n.cm=null,n.mCameraID=null,n.camera=null,n.sharedKey=null,n.mAccessToken=null,n.streamer=document.getElementById(e),n.m={},n.conn=new CloudShareConnection(n.options),n.config={},n.config.ws_port=8888,n.config.wss_port=8883,n.config.host="cam.skyvr.videoexpertsgroup.com",n.api_host=n.options.cloud_domain||"web.skyvr.videoexpertsgroup.com",n.api_port=null;var o=n.api_security_port=null;n.streamer.classList.add("cloudstreamer"),n.streamer.classList.add("green"),n.streamer.classList.add("black"),n.streamer.innerHTML='<div class="cloudstreamer-loader" style="display: none"></div><div class="cloudstreamer-error" style="display: none">\t<div class="cloudstreamer-error-text" style="display: none"></div></div><div class="cloudstreamer-watermark"></div><div class="cloudstreamer-sdkversion">SDK '+CloudSDK.version+'</div><div class="cloudstreamer-black-screen" style="display: none">\t\t<div class="cloudstreamer-watermark"></div>\t\t<div class="cloudstreamer-sdkversion">SDK '+CloudSDK.version+'</div></div><div class="cloudplayer-controls">\t<div class="cloudplayer-stop" style="display: none"></div>\t<div class="cloudplayer-play" style="display: none"></div>\t<div class="cloudplayer-time"></div>\t<div class="cloudplayer-fullscreen"></div></div><video class="cloudstreamer-webcam-video" autoplay="true"></video>';var r=n.streamer.getElementsByClassName("cloudstreamer-loader")[0],a=n.streamer.getElementsByClassName("cloudstreamer-error")[0],l=n.streamer.getElementsByClassName("cloudstreamer-error-text")[0],i=n.streamer.getElementsByClassName("cloudstreamer-webcam-video")[0],s=n.streamer.getElementsByClassName("cloudplayer-stop")[0],c=n.streamer.getElementsByClassName("cloudplayer-play")[0],u=!1;function d(){u&&(r.style.display="none",u=!1)}n._setError=function(e){setTimeout(n.stop,10),n.mLastError=e,n.mCallback_onError&&n.mCallback_onError(n,e)},n.showErrorText=function(e){d(),a.style.display="inline-block",l.style.display="inline-block",l.innerHTML=e,s.style.display="none",c.style.display="none",i.srcObject=null},n.setSource=function(e){if(a.style.display="none",l.style.display="none",c.style.display="none",!e||""===e){var t="Access token is required";return console.error(t),n.showErrorText(t),CloudReturnCode.ERROR_INVALID_SOURCE}if("https:"==location.protocol){try{var o=atob(e),o=JSON.parse(o);console.log(o),o.token&&o.camid&&o.access&&""!==o.token&&""!==o.camid&&""!==o.access&&(n.sharedKey=o.token,n.mCameraID=o.camid),o.api&&(n.api_host=o.api,console.log("self.api_host: ",n.api_host)),o.api_p&&(n.api_port=o.api_p,console.log("self.api_port: ",n.api_port)),o.api_security_port&&(n.api_security_port=o.api_security_port,console.log("self.api_security_port: ",n.api_security_port))}catch(e){t="Invalid access token format";return console.error(t),CloudReturnCode.ERROR_INVALID_SOURCE}t=n.api_host;n.api_host==(n.options.cloud_domain||"web.skyvr.videoexpertsgroup.com")?t="https://"+n.api_host:"https:"===location.protocol?(t="https://"+n.api_host,null!=n.api_secutiry_port&&(t+=":"+n.api_secutiry_port)):"http:"!==location.protocol&&"file:"!==location.protocol||(t="http://"+n.api_host,null!=n.api_secutiry_port&&(t+=":"+n.api_secutiry_port)),n.conn.ServiceProviderUrl=t+"/",n.conn.open(n.sharedKey),n.mAccessToken=e,c.style.display=""}else n.showErrorText("Streamer is only available with HTTPS connection")},n.getSource=function(){return n.mAccessToken||CloudReturnCode.ERROR_SOURCE_NOT_CONFIGURED},n.start=function(){if(!n.sharedKey)return CloudReturnCode.ERROR_SOURCE_NOT_CONFIGURED;console.warn("[CloudStreamerSDK] Start"),n.stop("by_strm_sdk_1"),navigator.mediaDevices.getUserMedia&&navigator.mediaDevices.getUserMedia({video:!0}).then(function(e){i.srcObject=e,n.conn&&n.conn._getAPI().cameraStreamUrls_webrtc(n.mCameraID).done(function(e){var t;console.log("stream_urls: ",e),e.webrtc?(t=CloudHelpers.promise(),0<CloudHelpers.compareVersions(CloudPlayerWebRTC2.version,e.webrtc.version)?(console.warn("Expected version webrtc.version (v"+e.webrtc.version+")  mismatch with included CloudPlayerWebRTC (v"+CloudPlayerWebRTC2.version+")"),t=CloudHelpers.requestJS(e.webrtc.scripts.player,function(e){for(e=e.replace("CloudPlayerWebRTC =","CloudPlayerWebRTC2 =");-1!==e.indexOf("CloudPlayerWebRTC.");)e=e.replace("CloudPlayerWebRTC.","CloudPlayerWebRTC2.");return e})):t.resolve(),t.done(function(){(o=new CloudPlayerWebRTC2(null,e.webrtc.connection_url,e.webrtc.ice_servers,{send_video:!0,send_audio:!0})).startWS(),s.style.display="",c.style.display="none"}).fail(function(e){console.error("err: ",e),n.showErrorText("Problem with streaming protocol")})):n.showErrorText("Channel does not support WebRTC streamer")}).fail(function(e){console.error("err: ",e),n.showErrorText("Channel for streaming is not found")})}).catch(function(e){n.sharedKey=null,console.error(e),console.error("Something went wrong! ",e),-1!=(""+e).indexOf("Requested device is not found")&&n.showErrorText("Camera is not found")})},c.onclick=n.start,n.stop=function(){if(s.style.display="none",c.style.display=n.mAccessToken?"":"none",i.srcObject=null,!n.sharedKey)return CloudReturnCode.ERROR_SOURCE_NOT_CONFIGURED;try{o&&o.stopWS()}catch(e){console.error(e)}},s.onclick=n.stop,n.initFullscreenControls=function(){var e,t,o=n.streamer.getElementsByClassName("cloudplayer-fullscreen")[0];n.changedFullscreen=function(){console.log("changedFullscreen"),document.webkitIsFullScreen?(e=n.player.style.height,t=n.player.style.width,n.streamer.style.height="100%",n.streamer.style.width="100%",console.log("changedFullscreen -> fullscreen")):(n.streamer.style.height=e,n.streamer.style.width=t,console.log("changedFullscreen -> NOT fullscreen"))},document.addEventListener&&(document.addEventListener("webkitfullscreenchange",n.changedFullscreen,!1),document.addEventListener("mozfullscreenchange",n.changedFullscreen,!1),document.addEventListener("fullscreenchange",n.changedFullscreen,!1),document.addEventListener("MSFullscreenChange",n.changedFullscreen,!1)),n.fullscreen=function(){console.log("fullscreen: clicked"),1==document.webkitIsFullScreen?document.webkitCancelFullScreen():document.mozFullScreen?document.mozCancelFullScreen():document.msFullscreenElement&&null!=document.msFullscreenElement?document.msExitFullscreen():n.streamer.mozRequestFullScreen?n.streamer.mozRequestFullScreen():n.streamer.requestFullscreen?n.streamer.requestFullscreen():n.streamer.webkitRequestFullscreen?n.streamer.webkitRequestFullscreen():n.streamer.msRequestFullscreen&&n.streamer.msRequestFullscreen()},o.onclick=n.fullscreen},n.initFullscreenControls()};